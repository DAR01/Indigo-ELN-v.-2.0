!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ketcher=t()}}(function(){var t;return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n||t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(t){if(p===setTimeout)return setTimeout(t,0);if((p===r||!p)&&setTimeout)return p=setTimeout,setTimeout(t,0);try{return p(t,0)}catch(e){try{return p.call(null,t,0)}catch(e){return p.call(this,t,0)}}}function a(t){if(d===clearTimeout)return clearTimeout(t);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function s(){g&&h&&(g=!1,h.length?m=h.concat(m):b=-1,m.length&&l())}function l(){if(!g){var t=i(s);g=!0;for(var e=m.length;e;){for(h=m,m=[];++b<e;)h&&h[b].run();b=-1,e=m.length}h=null,g=!1,a(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var p,d,f=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:r}catch(t){p=r}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(t){d=o}}();var h,m=[],g=!1,b=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new u(t,e)),1!==m.length||g||i(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.prependListener=c,f.prependOnceListener=c,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],2:[function(e,n,r){(function(e){!function(o){function i(t){throw new RangeError(M[t])}function a(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function s(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),t=t.replace(I,"."),r+a(t.split("."),e).join(".")}function l(t){for(var e,n,r=[],o=0,i=t.length;o<i;)e=t.charCodeAt(o++),e>=55296&&e<=56319&&o<i?(n=t.charCodeAt(o++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--)):r.push(e);return r}function u(t){return a(t,function(t){var e="";return t>65535&&(t-=65536,e+=D(t>>>10&1023|55296),t=56320|1023&t),e+=D(t)}).join("")}function c(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:S}function p(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function d(t,e,n){var r=0;for(t=n?k(t/P):t>>1,t+=k(t/e);t>B*E>>1;r+=S)t=k(t/B);return k(r+(B+1)*t/(t+A))}function f(t){var e,n,r,o,a,s,l,p,f,h,m=[],g=t.length,b=0,y=j,v=C;for(n=t.lastIndexOf(_),n<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&i("not-basic"),m.push(t.charCodeAt(r));for(o=n>0?n+1:0;o<g;){for(a=b,s=1,l=S;o>=g&&i("invalid-input"),p=c(t.charCodeAt(o++)),(p>=S||p>k((O-b)/s))&&i("overflow"),b+=p*s,f=l<=v?T:l>=v+E?E:l-v,!(p<f);l+=S)h=S-f,s>k(O/h)&&i("overflow"),s*=h;e=m.length+1,v=d(b-a,e,0==a),k(b/e)>O-y&&i("overflow"),y+=k(b/e),b%=e,m.splice(b++,0,y)}return u(m)}function h(t){var e,n,r,o,a,s,u,c,f,h,m,g,b,y,v,w=[];for(t=l(t),g=t.length,e=j,n=0,a=C,s=0;s<g;++s)(m=t[s])<128&&w.push(D(m));for(r=o=w.length,o&&w.push(_);r<g;){for(u=O,s=0;s<g;++s)(m=t[s])>=e&&m<u&&(u=m);for(b=r+1,u-e>k((O-n)/b)&&i("overflow"),n+=(u-e)*b,e=u,s=0;s<g;++s)if(m=t[s],m<e&&++n>O&&i("overflow"),m==e){for(c=n,f=S;h=f<=a?T:f>=a+E?E:f-a,!(c<h);f+=S)v=c-h,y=S-h,w.push(D(p(h+v%y,0))),c=k(v/y);w.push(D(p(c,0))),a=d(n,b,r==o),n=0,++r}++n,++e}return w.join("")}function m(t){return s(t,function(t){return N.test(t)?f(t.slice(4).toLowerCase()):t})}function g(t){return s(t,function(t){return R.test(t)?"xn--"+h(t):t})}var b="object"==typeof r&&r&&!r.nodeType&&r,y="object"==typeof n&&n&&!n.nodeType&&n,v="object"==typeof e&&e;v.global!==v&&v.window!==v&&v.self!==v||(o=v);var w,x,O=2147483647,S=36,T=1,E=26,A=38,P=700,C=72,j=128,_="-",N=/^xn--/,R=/[^\x20-\x7E]/,I=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},B=S-T,k=Math.floor,D=String.fromCharCode;if(w={version:"1.4.1",ucs2:{decode:l,encode:u},decode:f,encode:h,toASCII:g,toUnicode:m},"function"==typeof t&&"object"==typeof t.amd&&t.amd)t("punycode",function(){return w});else if(b&&y)if(n.exports==b)y.exports=w;else for(x in w)w.hasOwnProperty(x)&&(b[x]=w[x]);else o.punycode=w}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,n,i){e=e||"&",n=n||"=";var a={};if("string"!=typeof t||0===t.length)return a;t=t.split(e);var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var l=t.length;s>0&&l>s&&(l=s);for(var u=0;u<l;++u){var c,p,d,f,h=t[u].replace(/\+/g,"%20"),m=h.indexOf(n);m>=0?(c=h.substr(0,m),p=h.substr(m+1)):(c=h,p=""),d=decodeURIComponent(c),f=decodeURIComponent(p),r(a,d)?o(a[d])?a[d].push(f):a[d]=[a[d],f]:a[d]=f}return a};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],4:[function(t,e,n){"use strict";function r(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var o=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?r(a(t),function(a){var s=encodeURIComponent(o(a))+n;return i(t[a])?r(t[a],function(t){return s+encodeURIComponent(o(t))}).join(e):s+encodeURIComponent(o(t[a]))}).join(e):s?encodeURIComponent(o(s))+n+encodeURIComponent(o(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},{}],5:[function(t,e,n){"use strict";n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":3,"./encode":4}],6:[function(t,e,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(t,e,n){if(t&&u.isObject(t)&&t instanceof r)return t;var o=new r;return o.parse(t,e,n),o}function i(t){return u.isString(t)&&(t=o(t)),t instanceof r?t.format():r.prototype.format.call(t)}function a(t,e){return o(t,!1,!0).resolve(e)}function s(t,e){return t?o(t,!1,!0).resolveObject(e):e}var l=t("punycode"),u=t("./util");n.parse=o,n.resolve=a,n.resolveObject=s,n.format=i,n.Url=r;var c=/^([a-z0-9.+-]+:)/i,p=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["<",">",'"',"`"," ","\r","\n","\t"],h=["{","}","|","\\","^","`"].concat(f),m=["'"].concat(h),g=["%","/","?",";","#"].concat(m),b=["/","?","#"],y={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},w={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=t("querystring");r.prototype.parse=function(t,e,n){if(!u.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),o=-1!==r&&r<t.indexOf("#")?"?":"#",i=t.split(o);i[0]=i[0].replace(/\\/g,"/"),t=i.join(o);var a=t;if(a=a.trim(),!n&&1===t.split("#").length){var s=d.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=e?x.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var p=c.exec(a);if(p){p=p[0];var f=p.toLowerCase();this.protocol=f,a=a.substr(p.length)}if(n||p||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var h="//"===a.substr(0,2);!h||p&&v[p]||(a=a.substr(2),this.slashes=!0)}if(!v[p]&&(h||p&&!w[p])){for(var O=-1,S=0;S<b.length;S++){var T=a.indexOf(b[S]);-1!==T&&(-1===O||T<O)&&(O=T)}var E,A;A=-1===O?a.lastIndexOf("@"):a.lastIndexOf("@",O),-1!==A&&(E=a.slice(0,A),a=a.slice(A+1),this.auth=decodeURIComponent(E)),O=-1;for(var S=0;S<g.length;S++){var T=a.indexOf(g[S]);-1!==T&&(-1===O||T<O)&&(O=T)}-1===O&&(O=a.length),this.host=a.slice(0,O),a=a.slice(O),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var C=this.hostname.split(/\./),S=0,j=C.length;S<j;S++){var _=C[S];if(_&&!_.match(/^[+a-z0-9A-Z_-]{0,63}$/)){for(var N="",R=0,I=_.length;R<I;R++)_.charCodeAt(R)>127?N+="x":N+=_[R];if(!N.match(/^[+a-z0-9A-Z_-]{0,63}$/)){var M=C.slice(0,S),B=C.slice(S+1),k=_.match(/^([+a-z0-9A-Z_-]{0,63})(.*)$/);k&&(M.push(k[1]),B.unshift(k[2])),B.length&&(a="/"+B.join(".")+a),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=l.toASCII(this.hostname));var D=this.port?":"+this.port:"",L=this.hostname||"";this.host=L+D,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!y[f])for(var S=0,j=m.length;S<j;S++){var F=m[S];if(-1!==a.indexOf(F)){var G=encodeURIComponent(F);G===F&&(G=escape(F)),a=a.split(F).join(G)}}var U=a.indexOf("#");-1!==U&&(this.hash=a.substr(U),a=a.slice(0,U));var H=a.indexOf("?");if(-1!==H?(this.search=a.substr(H),this.query=a.substr(H+1),e&&(this.query=x.parse(this.query)),a=a.slice(0,H)):e&&(this.search="",this.query={}),a&&(this.pathname=a),w[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var D=this.pathname||"",z=this.search||"";this.path=D+z}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,i="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(i=x.stringify(this.query));var a=this.search||i&&"?"+i||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||w[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),a=a.replace("#","%23"),e+o+n+a+r},r.prototype.resolve=function(t){return this.resolveObject(o(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if(u.isString(t)){var e=new r;e.parse(t,!1,!0),t=e}for(var n=new r,o=Object.keys(this),i=0;i<o.length;i++){var a=o[i];n[a]=this[a]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),l=0;l<s.length;l++){var c=s[l];"protocol"!==c&&(n[c]=t[c])}return w[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!w[t.protocol]){for(var p=Object.keys(t),d=0;d<p.length;d++){var f=p[d];n[f]=t[f]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||v[t.protocol])n.pathname=t.pathname;else{for(var h=(t.pathname||"").split("/");h.length&&!(t.host=h.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),n.pathname=h.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var m=n.pathname||"",g=n.search||"";n.path=m+g}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=y||b||n.host&&t.pathname,O=x,S=n.pathname&&n.pathname.split("/")||[],h=t.pathname&&t.pathname.split("/")||[],T=n.protocol&&!w[n.protocol];if(T&&(n.hostname="",n.port=null,n.host&&(""===S[0]?S[0]=n.host:S.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===h[0]?h[0]=t.host:h.unshift(t.host)),t.host=null),x=x&&(""===h[0]||""===S[0])),y)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,S=h;else if(h.length)S||(S=[]),S.pop(),S=S.concat(h),n.search=t.search,n.query=t.query;else if(!u.isNullOrUndefined(t.search)){if(T){n.hostname=n.host=S.shift();var E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");E&&(n.auth=E.shift(),n.host=n.hostname=E.shift())}return n.search=t.search,n.query=t.query,u.isNull(n.pathname)&&u.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!S.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var A=S.slice(-1)[0],P=(n.host||t.host||S.length>1)&&("."===A||".."===A)||""===A,C=0,j=S.length;j>=0;j--)A=S[j],"."===A?S.splice(j,1):".."===A?(S.splice(j,1),C++):C&&(S.splice(j,1),C--);if(!x&&!O)for(;C--;C)S.unshift("..");!x||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),P&&"/"!==S.join("/").substr(-1)&&S.push("");var _=""===S[0]||S[0]&&"/"===S[0].charAt(0);if(T){n.hostname=n.host=_?"":S.length?S.shift():"";var E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");E&&(n.auth=E.shift(),n.host=n.hostname=E.shift())}return x=x||n.host&&S.length,x&&!_&&S.unshift(""),S.length?n.pathname=S.join("/"):(n.pathname=null,n.path=null),u.isNull(n.pathname)&&u.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var t=this.host,e=p.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":7,punycode:2,querystring:5}],7:[function(t,e,n){"use strict";e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],8:[function(e,n,r){var o=o||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},a=t.webkitRequestFileSystem,s=t.requestFileSystem||a||t.mozRequestFileSystem,l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u=0,c=function(e){var r=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};t.chrome?r():setTimeout(r,500)},p=function(t,e,n){e=[].concat(e);for(var r=e.length;r--;){var o=t["on"+e[r]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){l(t)}}},d=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t},f=function(e,l,f){f||(e=d(e));var h,m,g,b=this,y=e.type,v=!1,w=function(){p(b,"writestart progress write writeend".split(" "))},x=function(){if(!v&&h||(h=n().createObjectURL(e)),m)m.location.href=h;else{void 0==t.open(h,"_blank")&&"undefined"!=typeof safari&&(t.location.href=h)}b.readyState=b.DONE,w(),c(h)},O=function(t){return function(){if(b.readyState!==b.DONE)return t.apply(this,arguments)}},S={create:!0,exclusive:!1};return b.readyState=b.INIT,l||(l="download"),o?(h=n().createObjectURL(e),r.href=h,r.download=l,void setTimeout(function(){i(r),w(),c(h),b.readyState=b.DONE})):(t.chrome&&y&&"application/octet-stream"!==y&&(g=e.slice||e.webkitSlice,e=g.call(e,0,e.size,"application/octet-stream"),v=!0),a&&"download"!==l&&(l+=".download"),("application/octet-stream"===y||a)&&(m=t),s?(u+=e.size,void s(t.TEMPORARY,u,O(function(t){t.root.getDirectory("saved",S,O(function(t){var n=function(){t.getFile(l,S,O(function(t){t.createWriter(O(function(n){n.onwriteend=function(e){m.location.href=t.toURL(),b.readyState=b.DONE,p(b,"writeend",e),c(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(t){n["on"+t]=b["on"+t]}),n.write(e),b.abort=function(){n.abort(),b.readyState=b.DONE},b.readyState=b.WRITING}),x)}),x)};t.getFile(l,{create:!1},O(function(t){t.remove(),n()}),O(function(t){t.code===t.NOT_FOUND_ERR?n():x()}))}),x)}),x)):void x())},h=f.prototype,m=function(t,e,n){return new f(t,e,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return n||(t=d(t)),navigator.msSaveOrOpenBlob(t,e||"download")}:(h.abort=function(){var t=this;t.readyState=t.DONE,p(t,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,m)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==n&&n.exports?n.exports.saveAs=o:void 0!==t&&null!==t&&null!=t.amd&&t([],function(){return o})},{}],9:[function(t,e,n){"use strict";e.exports=t("./lib/core.js"),t("./lib/done.js"),t("./lib/es6-extensions.js"),t("./lib/node-extensions.js")},{"./lib/core.js":10,"./lib/done.js":11,"./lib/es6-extensions.js":12,"./lib/node-extensions.js":13}],10:[function(t,e,n){"use strict";function r(t){function e(t){if(null===l)return void c.push(t);a(function(){var e=l?t.onFulfilled:t.onRejected;if(null===e)return void(l?t.resolve:t.reject)(u);var n;try{n=e(u)}catch(e){return void t.reject(e)}t.resolve(n)})}function n(t){try{if(t===p)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void i(e.bind(t),n,r)}l=!0,u=t,s()}catch(t){r(t)}}function r(t){l=!1,u=t,s()}function s(){for(var t=0,n=c.length;t<n;t++)e(c[t]);c=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");var l=null,u=null,c=[],p=this;this.then=function(t,n){return new p.constructor(function(r,i){e(new o(t,n,r,i))})},i(t,n,r)}function o(t,e,n,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r}function i(t,e,n){var r=!1;try{t(function(t){r||(r=!0,e(t))},function(t){r||(r=!0,n(t))})}catch(t){if(r)return;r=!0,n(t)}}var a=t("asap");e.exports=r},{asap:14}],11:[function(t,e,n){"use strict";var r=t("./core.js"),o=t("asap");e.exports=r,r.prototype.done=function(t,e){(arguments.length?this.then.apply(this,arguments):this).then(null,function(t){o(function(){throw t})})}},{"./core.js":10,asap:14}],12:[function(t,e,n){"use strict";function r(t){this.then=function(e){return"function"!=typeof e?this:new o(function(n,r){i(function(){try{n(e(t))}catch(t){r(t)}})})}}var o=t("./core.js"),i=t("asap");e.exports=o,r.prototype=o.prototype;var a=new r(!0),s=new r(!1),l=new r(null),u=new r(void 0),c=new r(0),p=new r("");o.resolve=function(t){if(t instanceof o)return t;if(null===t)return l;if(void 0===t)return u;if(!0===t)return a;if(!1===t)return s;if(0===t)return c;if(""===t)return p;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new o(e.bind(t))}catch(t){return new o(function(e,n){n(t)})}return new r(t)},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(t){r(i,t)},n)}e[i]=a,0==--o&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var o=e.length,i=0;i<e.length;i++)r(i,e[i])})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){t.forEach(function(t){o.resolve(t).then(e,n)})})},o.prototype.catch=function(t){return this.then(null,t)}},{"./core.js":10,asap:14}],13:[function(t,e,n){"use strict";var r=t("./core.js"),o=t("asap");e.exports=r,r.denodeify=function(t,e){return e=e||1/0,function(){var n=this,o=Array.prototype.slice.call(arguments);return new r(function(r,i){for(;o.length&&o.length>e;)o.pop();o.push(function(t,e){t?i(t):r(e)});var a=t.apply(n,o);!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then||r(a)})}},r.nodeify=function(t){return function(){var e=Array.prototype.slice.call(arguments),n="function"==typeof e[e.length-1]?e.pop():null,i=this;try{return t.apply(this,arguments).nodeify(n,i)}catch(t){if(null===n||void 0===n)return new r(function(e,n){n(t)});o(function(){n.call(i,t)})}}},r.prototype.nodeify=function(t,e){if("function"!=typeof t)return this;this.then(function(n){o(function(){t.call(e,null,n)})},function(n){o(function(){t.call(e,n)})})}},{"./core.js":10,asap:14}],14:[function(t,e,n){(function(t){function n(){for(;o.next;){o=o.next;var t=o.task;o.task=void 0;var e=o.domain;e&&(o.domain=void 0,e.enter());try{t()}catch(t){if(l)throw e&&e.exit(),setTimeout(n,0),e&&e.enter(),t;setTimeout(function(){throw t},0)}e&&e.exit()}a=!1}function r(e){i=i.next={task:e,domain:l&&t.domain,next:null},a||(a=!0,s())}var o={task:void 0,next:null},i=o,a=!1,s=void 0,l=!1;if(void 0!==t&&t.nextTick)l=!0,s=function(){t.nextTick(n)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var u=new MessageChannel;u.port1.onmessage=n,s=function(){u.port2.postMessage(0)}}else s=function(){setTimeout(n,0)};e.exports=r}).call(this,t("_process"))},{_process:1}],15:[function(t,e,n){var r={};e.exports=r,r.createElement=function(t){return document.createElement(t)},r.createText=function(t){return document.createTextNode(t)},r.style=function(t,e){t.style.cssText=e},r.append=function(t,e){t.appendChild(e)},r.remove=function(t,e){t.removeChild(e)}},{}],16:[function(t,e,n){var r=t("promise"),o=t("./dom"),i=t("./ruler"),a=function(t,e){e=e||{weight:"normal"},this.family=t,this.style=e.style||"normal",this.variant=e.variant||"normal",this.weight=e.weight||"normal",this.stretch=e.stretch||"stretch",this.featureSettings=e.featureSettings||"normal"};e.exports=a,a.HAS_WEBKIT_FALLBACK_BUG=null,a.DEFAULT_TIMEOUT=3e3,a.getUserAgent=function(){return window.navigator.userAgent},a.hasWebKitFallbackBug=function(){if(null===a.HAS_WEBKIT_FALLBACK_BUG){var t=/AppleWeb[kK]it\/([0-9]+)(?:\.([0-9]+))/.exec(a.getUserAgent());a.HAS_WEBKIT_FALLBACK_BUG=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)}return a.HAS_WEBKIT_FALLBACK_BUG},a.prototype.getStyle=function(){return"font-style:"+this.style+";font-variant:"+this.variant+";font-weight:"+this.weight+";font-stretch:"+this.stretch+";font-feature-settings:"+this.featureSettings+";-moz-font-feature-settings:"+this.featureSettings+";-webkit-font-feature-settings:"+this.featureSettings+";"},a.prototype.check=function(t,e){var n=t||"BESbswy",s=e||a.DEFAULT_TIMEOUT,l=this.getStyle(),u=o.createElement("div"),c=new i(n),p=new i(n),d=new i(n),f=-1,h=-1,m=-1,g=-1,b=-1,y=-1,v=this;return c.setFont('"Times New Roman", sans-serif',l),p.setFont("serif",l),d.setFont("monospace",l),o.append(u,c.getElement()),o.append(u,p.getElement()),o.append(u,d.getElement()),o.append(document.body,u),g=c.getWidth(),b=p.getWidth(),y=d.getWidth(),new r(function(t,e){function n(){null!==u.parentNode&&o.remove(document.body,u)}function r(){-1!==f&&-1!==h&&-1!==m&&f===h&&h===m&&(a.hasWebKitFallbackBug()?f===g&&h===g&&m===g||f===b&&h===b&&m===b||f===y&&h===y&&m===y||(n(),t(v)):(n(),t(v)))}setTimeout(function(){n(),e(v)},s),c.onResize(function(t){f=t,r()}),c.setFont(v.family+",sans-serif",l),p.onResize(function(t){h=t,r()}),p.setFont(v.family+",serif",l),d.onResize(function(t){m=t,r()}),d.setFont(v.family+",monospace",l)})}},{"./dom":15,"./ruler":17,promise:9}],17:[function(t,e,n){var r=t("./dom"),o=function(t){var e="display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;";this.element=r.createElement("div"),this.element.setAttribute("aria-hidden","true"),r.append(this.element,r.createText(t)),this.collapsible=r.createElement("span"),this.expandable=r.createElement("span"),this.collapsibleInner=r.createElement("span"),this.expandableInner=r.createElement("span"),this.lastOffsetWidth=-1,r.style(this.collapsible,e),r.style(this.expandable,e),r.style(this.expandableInner,e),r.style(this.collapsibleInner,"display:inline-block;width:200%;height:200%;"),r.append(this.collapsible,this.collapsibleInner),r.append(this.expandable,this.expandableInner),r.append(this.element,this.collapsible),r.append(this.element,this.expandable)};e.exports=o,o.prototype.getElement=function(){return this.element},o.prototype.setFont=function(t,e){r.style(this.element,"min-width:20px;min-height:20px;display:inline-block;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font-size:100px;font-family:"+t+";"+e)},o.prototype.getWidth=function(){return this.element.offsetWidth},o.prototype.setWidth=function(t){this.element.style.width=t+"px"},o.prototype.reset=function(){var t=this.getWidth(),e=t+100;return this.expandableInner.style.width=e+"px",this.expandable.scrollLeft=e,this.collapsible.scrollLeft=this.collapsible.scrollWidth+100,this.lastOffsetWidth!==t&&(this.lastOffsetWidth=t,!0)},o.prototype.onScroll=function(t){this.reset()&&null!==this.element.parentNode&&t(this.lastOffsetWidth)},o.prototype.onResize=function(t){var e=this;this.collapsible.addEventListener("scroll",function(){e.onScroll(t)},!1),this.expandable.addEventListener("scroll",function(){e.onScroll(t)},!1),this.reset()}},{"./dom":15}],18:[function(t,e,n){"use strict";function r(t,e,n,r,o){var i=this.validateSchema(t,o,e,n);return!i.valid&&r instanceof Function&&r(i),i.valid}function o(t,e,n,r,o,i){if(!e.properties||void 0===e.properties[o])if(!1===e.additionalProperties)i.addError({name:"additionalProperties",argument:o,message:"additionalProperty "+JSON.stringify(o)+" exists in instance when not allowed"});else{var a=e.additionalProperties||{},s=this.validateSchema(t[o],a,n,r.makeChild(a,o));s.instance!==i.instance[o]&&(i.instance[o]=s.instance),i.importErrors(s)}}function i(t,e,n){var r,o=n.length;for(r=e+1,o;r<o;r++)if(a.deepCompareStrict(t,n[r]))return!1;return!0}var a=t("./helpers"),s=a.ValidatorResult,l=a.SchemaError,u={};u.ignoreProperties={id:!0,default:!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,extends:!0};var c=u.validators={};c.type=function(t,e,n,r){if(void 0===t)return null;var o=new s(t,e,n,r),i=Array.isArray(e.type)?e.type:[e.type];if(!i.some(this.testType.bind(this,t,e,n,r))){var a=i.map(function(t){return t.id&&"<"+t.id+">"||t+""});o.addError({name:"type",argument:a,message:"is not of a type(s) "+a})}return o},c.anyOf=function(t,e,n,o){if(void 0===t)return null;var i=new s(t,e,n,o),a=new s(t,e,n,o);if(!Array.isArray(e.anyOf))throw new l("anyOf must be an array");if(!e.anyOf.some(r.bind(this,t,n,o,function(t){a.importErrors(t)}))){var u=e.anyOf.map(function(t,e){return t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+e+"]"});n.nestedErrors&&i.importErrors(a),i.addError({name:"anyOf",argument:u,message:"is not any of "+u.join(",")})}return i},c.allOf=function(t,e,n,r){if(void 0===t)return null;if(!Array.isArray(e.allOf))throw new l("allOf must be an array");var o=new s(t,e,n,r),i=this;return e.allOf.forEach(function(e,a){var s=i.validateSchema(t,e,n,r);if(!s.valid){var l=e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+a+"]";o.addError({name:"allOf",argument:{id:l,length:s.errors.length,valid:s},message:"does not match allOf schema "+l+" with "+s.errors.length+" error[s]:"}),o.importErrors(s)}}),o},c.oneOf=function(t,e,n,o){if(void 0===t)return null;if(!Array.isArray(e.oneOf))throw new l("oneOf must be an array");var i=new s(t,e,n,o),a=new s(t,e,n,o),u=e.oneOf.filter(r.bind(this,t,n,o,function(t){a.importErrors(t)})).length,c=e.oneOf.map(function(t,e){return t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+e+"]"});return 1!==u&&(n.nestedErrors&&i.importErrors(a),i.addError({name:"oneOf",argument:c,message:"is not exactly one from "+c.join(",")})),i},c.properties=function(t,e,n,r){if(void 0!==t&&t instanceof Object){var o=new s(t,e,n,r),i=e.properties||{};for(var a in i){var l=(t||void 0)&&t[a],u=this.validateSchema(l,i[a],n,r.makeChild(i[a],a));u.instance!==o.instance[a]&&(o.instance[a]=u.instance),o.importErrors(u)}return o}},c.patternProperties=function(t,e,n,r){if(void 0!==t&&this.types.object(t)){var i=new s(t,e,n,r),a=e.patternProperties||{};for(var l in t){var u=!0;for(var c in a){if(new RegExp(c).test(l)){u=!1;var p=this.validateSchema(t[l],a[c],n,r.makeChild(a[c],l));p.instance!==i.instance[l]&&(i.instance[l]=p.instance),i.importErrors(p)}}u&&o.call(this,t,e,n,r,l,i)}return i}},c.additionalProperties=function(t,e,n,r){if(void 0!==t&&this.types.object(t)){if(e.patternProperties)return null;var i=new s(t,e,n,r);for(var a in t)o.call(this,t,e,n,r,a,i);return i}},c.minProperties=function(t,e,n,r){if(!t||"object"!=typeof t)return null;var o=new s(t,e,n,r);return Object.keys(t).length>=e.minProperties||o.addError({name:"minProperties",argument:e.minProperties,message:"does not meet minimum property length of "+e.minProperties}),o},c.maxProperties=function(t,e,n,r){if(!t||"object"!=typeof t)return null;var o=new s(t,e,n,r);return Object.keys(t).length<=e.maxProperties||o.addError({name:"maxProperties",argument:e.maxProperties,message:"does not meet maximum property length of "+e.maxProperties}),o},c.items=function(t,e,n,r){if(!Array.isArray(t))return null;var o=this,i=new s(t,e,n,r);return void 0!==t&&e.items?(t.every(function(t,a){var s=Array.isArray(e.items)?e.items[a]||e.additionalItems:e.items;if(void 0===s)return!0;if(!1===s)return i.addError({name:"items",message:"additionalItems not permitted"}),!1;var l=o.validateSchema(t,s,n,r.makeChild(s,a));return l.instance!==i.instance[a]&&(i.instance[a]=l.instance),i.importErrors(l),!0}),i):i},c.minimum=function(t,e,n,r){if("number"!=typeof t)return null;var o=new s(t,e,n,r),i=!0;return i=e.exclusiveMinimum&&!0===e.exclusiveMinimum?t>e.minimum:t>=e.minimum,i||o.addError({name:"minimum",argument:e.minimum,message:"must have a minimum value of "+e.minimum}),o},c.maximum=function(t,e,n,r){if("number"!=typeof t)return null;var o,i=new s(t,e,n,r);return o=e.exclusiveMaximum&&!0===e.exclusiveMaximum?t<e.maximum:t<=e.maximum,o||i.addError({name:"maximum",argument:e.maximum,message:"must have a maximum value of "+e.maximum}),i},c.divisibleBy=function(t,e,n,r){if("number"!=typeof t)return null;if(0==e.divisibleBy)throw new l("divisibleBy cannot be zero");var o=new s(t,e,n,r);return t/e.divisibleBy%1&&o.addError({name:"divisibleBy",argument:e.divisibleBy,message:"is not divisible by (multiple of) "+JSON.stringify(e.divisibleBy)}),o},c.multipleOf=function(t,e,n,r){if("number"!=typeof t)return null;if(0==e.multipleOf)throw new l("multipleOf cannot be zero");var o=new s(t,e,n,r);return t/e.multipleOf%1&&o.addError({name:"multipleOf",argument:e.multipleOf,message:"is not a multiple of (divisible by) "+JSON.stringify(e.multipleOf)}),o},c.required=function(t,e,n,r){var o=new s(t,e,n,r);return void 0===t&&!0===e.required?o.addError({name:"required",message:"is required"}):t&&"object"==typeof t&&Array.isArray(e.required)&&e.required.forEach(function(e){void 0===t[e]&&o.addError({
name:"required",argument:e,message:"requires property "+JSON.stringify(e)})}),o},c.pattern=function(t,e,n,r){if("string"!=typeof t)return null;var o=new s(t,e,n,r);return t.match(e.pattern)||o.addError({name:"pattern",argument:e.pattern,message:"does not match pattern "+JSON.stringify(e.pattern)}),o},c.format=function(t,e,n,r){var o=new s(t,e,n,r);return o.disableFormat||a.isFormat(t,e.format,this)||o.addError({name:"format",argument:e.format,message:"does not conform to the "+JSON.stringify(e.format)+" format"}),o},c.minLength=function(t,e,n,r){if("string"!=typeof t)return null;var o=new s(t,e,n,r);return t.length>=e.minLength||o.addError({name:"minLength",argument:e.minLength,message:"does not meet minimum length of "+e.minLength}),o},c.maxLength=function(t,e,n,r){if("string"!=typeof t)return null;var o=new s(t,e,n,r);return t.length<=e.maxLength||o.addError({name:"maxLength",argument:e.maxLength,message:"does not meet maximum length of "+e.maxLength}),o},c.minItems=function(t,e,n,r){if(!Array.isArray(t))return null;var o=new s(t,e,n,r);return t.length>=e.minItems||o.addError({name:"minItems",argument:e.minItems,message:"does not meet minimum length of "+e.minItems}),o},c.maxItems=function(t,e,n,r){if(!Array.isArray(t))return null;var o=new s(t,e,n,r);return t.length<=e.maxItems||o.addError({name:"maxItems",argument:e.maxItems,message:"does not meet maximum length of "+e.maxItems}),o},c.uniqueItems=function(t,e,n,r){function o(t,e,n){for(var r=e+1;r<n.length;r++)if(a.deepCompareStrict(t,n[r]))return!1;return!0}var i=new s(t,e,n,r);return Array.isArray(t)?(t.every(o)||i.addError({name:"uniqueItems",message:"contains duplicate item"}),i):i},c.uniqueItems=function(t,e,n,r){if(!Array.isArray(t))return null;var o=new s(t,e,n,r);return t.every(i)||o.addError({name:"uniqueItems",message:"contains duplicate item"}),o},c.dependencies=function(t,e,n,r){if(!t||"object"!=typeof t)return null;var o=new s(t,e,n,r);for(var i in e.dependencies)if(void 0!==t[i]){var a=e.dependencies[i],l=r.makeChild(a,i);if("string"==typeof a&&(a=[a]),Array.isArray(a))a.forEach(function(e){void 0===t[e]&&o.addError({name:"dependencies",argument:l.propertyPath,message:"property "+e+" not found, required by "+l.propertyPath})});else{var u=this.validateSchema(t,a,n,l);o.instance!==u.instance&&(o.instance=u.instance),u&&u.errors.length&&(o.addError({name:"dependencies",argument:l.propertyPath,message:"does not meet dependency required by "+l.propertyPath}),o.importErrors(u))}}return o},c.enum=function(t,e,n,r){if(!Array.isArray(e.enum))throw new l("enum expects an array",e);if(void 0===t)return null;var o=new s(t,e,n,r);return e.enum.some(a.deepCompareStrict.bind(null,t))||o.addError({name:"enum",argument:e.enum,message:"is not one of enum values: "+e.enum.join(",")}),o},c.not=c.disallow=function(t,e,n,r){var o=this;if(void 0===t)return null;var i=new s(t,e,n,r),a=e.not||e.disallow;return a?(Array.isArray(a)||(a=[a]),a.forEach(function(a){if(o.testType(t,e,n,r,a)){var s=a&&a.id&&"<"+a.id+">"||a;i.addError({name:"not",argument:s,message:"is of prohibited type "+s})}}),i):null},e.exports=u},{"./helpers":19}],19:[function(t,e,n){"use strict";function r(t,e){return e+": "+t.toString()+"\n"}function o(t,e,n,r){"object"==typeof n?e[r]=s(t[r],n):-1===t.indexOf(n)&&e.push(n)}function i(t,e,n){e[n]=t[n]}function a(t,e,n,r){"object"==typeof e[r]&&e[r]&&t[r]?n[r]=s(t[r],e[r]):n[r]=e[r]}function s(t,e){var n=Array.isArray(e),r=n&&[]||{};return n?(t=t||[],r=r.concat(t),e.forEach(o.bind(null,t,r))):(t&&"object"==typeof t&&Object.keys(t).forEach(i.bind(null,t,r)),Object.keys(e).forEach(a.bind(null,t,e,r))),r}function l(t){return"/"+encodeURIComponent(t).replace(/~/g,"%7E")}var u=t("url"),c=n.ValidationError=function(t,e,n,r,o,i){r&&(this.property=r),t&&(this.message=t),n&&(n.id?this.schema=n.id:this.schema=n),e&&(this.instance=e),this.name=o,this.argument=i,this.stack=this.toString()};c.prototype.toString=function(){return this.property+" "+this.message};var p=n.ValidatorResult=function(t,e,n,r){this.instance=t,this.schema=e,this.propertyPath=r.propertyPath,this.errors=[],this.throwError=n&&n.throwError,this.disableFormat=n&&!0===n.disableFormat};p.prototype.addError=function(t){var e;if("string"==typeof t)e=new c(t,this.instance,this.schema,this.propertyPath);else{if(!t)throw new Error("Missing error detail");if(!t.message)throw new Error("Missing error message");if(!t.name)throw new Error("Missing validator type");e=new c(t.message,this.instance,this.schema,this.propertyPath,t.name,t.argument)}if(this.throwError)throw e;return this.errors.push(e),e},p.prototype.importErrors=function(t){"string"==typeof t||t&&t.validatorType?this.addError(t):t&&t.errors&&Array.prototype.push.apply(this.errors,t.errors)},p.prototype.toString=function(t){return this.errors.map(r).join("")},Object.defineProperty(p.prototype,"valid",{get:function(){return!this.errors.length}});var d=n.SchemaError=function t(e,n){this.message=e,this.schema=n,Error.call(this,e),Error.captureStackTrace(this,t)};d.prototype=Object.create(Error.prototype,{constructor:{value:d,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var f=n.SchemaContext=function(t,e,n,r,o){this.schema=t,this.options=e,this.propertyPath=n,this.base=r,this.schemas=o};f.prototype.resolve=function(t){return u.resolve(this.base,t)},f.prototype.makeChild=function(t,e){var n=void 0===e?this.propertyPath:this.propertyPath+m(e),r=u.resolve(this.base,t.id||""),o=new f(t,this.options,n,r,Object.create(this.schemas));return t.id&&!o.schemas[r]&&(o.schemas[r]=t),o};var h=n.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(t){return"string"==typeof t&&parseFloat(t)===parseInt(t,10)&&!isNaN(t)},regex:function(t){var e=!0;try{new RegExp(t)}catch(t){e=!1}return e},style:/\s*(.+?):\s*([^;]+);?/g,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};h.regexp=h.regex,h.pattern=h.regex,h.ipv4=h["ip-address"],n.isFormat=function(t,e,n){if("string"==typeof t&&void 0!==h[e]){if(h[e]instanceof RegExp)return h[e].test(t);if("function"==typeof h[e])return h[e](t)}else if(n&&n.customFormats&&"function"==typeof n.customFormats[e])return n.customFormats[e](t);return!0};var m=n.makeSuffix=function(t){return t=t.toString(),t.match(/[.\s\[\]]/)||t.match(/^[\d]/)?t.match(/^\d+$/)?"["+t+"]":"["+JSON.stringify(t)+"]":"."+t};n.deepCompareStrict=function t(e,n){if(typeof e!=typeof n)return!1;if(e instanceof Array)return n instanceof Array&&(e.length===n.length&&e.every(function(r,o){return t(e[o],n[o])}));if("object"==typeof e){if(!e||!n)return e===n;var r=Object.keys(e),o=Object.keys(n);return r.length===o.length&&r.every(function(r){return t(e[r],n[r])})}return e===n},e.exports.deepMerge=s,n.objectGetPath=function(t,e){for(var n,r=e.split("/").slice(1);"string"==typeof(n=r.shift());){var o=decodeURIComponent(n.replace(/~0/,"~").replace(/~1/g,"/"));if(!(o in t))return;t=t[o]}return t},n.encodePath=function(t){return t.map(l).join("")}},{url:6}],20:[function(t,e,n){"use strict";var r=e.exports.Validator=t("./validator");e.exports.ValidatorResult=t("./helpers").ValidatorResult,e.exports.ValidationError=t("./helpers").ValidationError,e.exports.SchemaError=t("./helpers").SchemaError,e.exports.validate=function(t,e,n){return(new r).validate(t,e,n)}},{"./helpers":19,"./validator":21}],21:[function(t,e,n){"use strict";function r(t){var e="string"==typeof t?t:t.$ref;return"string"==typeof e&&e}var o=t("url"),i=t("./attribute"),a=t("./helpers"),s=a.ValidatorResult,l=a.SchemaError,u=a.SchemaContext,c=function t(){this.customFormats=Object.create(t.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(p),this.attributes=Object.create(i.validators)};c.prototype.customFormats={},c.prototype.schemas=null,c.prototype.types=null,c.prototype.attributes=null,c.prototype.unresolvedRefs=null,c.prototype.addSchema=function(t,e){if(!t)return null;var n=e||t.id;return this.addSubSchema(n,t),n&&(this.schemas[n]=t),this.schemas[n]},c.prototype.addSubSchema=function(t,e){if(e&&"object"==typeof e){if(e.$ref){var n=o.resolve(t,e.$ref);return void(void 0===this.schemas[n]&&(this.schemas[n]=null,this.unresolvedRefs.push(n)))}var r=e.id&&o.resolve(t,e.id),i=r||t;if(r){if(this.schemas[r]){if(!a.deepCompareStrict(this.schemas[r],e))throw new Error("Schema <"+e+"> already exists with different definition");return this.schemas[r]}this.schemas[r]=e;var s=r.replace(/^([^#]*)#$/,"$1");this.schemas[s]=e}return this.addSubSchemaArray(i,e.items instanceof Array?e.items:[e.items]),this.addSubSchemaArray(i,e.extends instanceof Array?e.extends:[e.extends]),this.addSubSchema(i,e.additionalItems),this.addSubSchemaObject(i,e.properties),this.addSubSchema(i,e.additionalProperties),this.addSubSchemaObject(i,e.definitions),this.addSubSchemaObject(i,e.patternProperties),this.addSubSchemaObject(i,e.dependencies),this.addSubSchemaArray(i,e.disallow),this.addSubSchemaArray(i,e.allOf),this.addSubSchemaArray(i,e.anyOf),this.addSubSchemaArray(i,e.oneOf),this.addSubSchema(i,e.not),this.schemas[r]}},c.prototype.addSubSchemaArray=function(t,e){if(e instanceof Array)for(var n=0;n<e.length;n++)this.addSubSchema(t,e[n])},c.prototype.addSubSchemaObject=function(t,e){if(e&&"object"==typeof e)for(var n in e)this.addSubSchema(t,e[n])},c.prototype.setSchemas=function(t){this.schemas=t},c.prototype.getSchema=function(t){return this.schemas[t]},c.prototype.validate=function(t,e,n,r){n||(n={});var i=n.propertyName||"instance",a=o.resolve(n.base||"/",e.id||"");if(r||(r=new u(e,n,i,a,Object.create(this.schemas)),r.schemas[a]||(r.schemas[a]=e)),e){var s=this.validateSchema(t,e,n,r);if(!s)throw new Error("Result undefined");return s}throw new l("no schema specified",e)},c.prototype.validateSchema=function(t,e,n,o){var c=new s(t,e,n,o);if(!e)throw new Error("schema is undefined");if(e.extends)if(e.extends instanceof Array){var p={schema:e,ctx:o};e.extends.forEach(this.schemaTraverser.bind(this,p)),e=p.schema,p.schema=null,p.ctx=null,p=null}else e=a.deepMerge(e,this.superResolve(e.extends,o));var d;if(d=r(e)){var f=this.resolve(e,d,o),h=new u(f.subschema,n,o.propertyPath,f.switchSchema,o.schemas);return this.validateSchema(t,f.subschema,n,h)}var m=n&&n.skipAttributes||[];for(var g in e)if(!i.ignoreProperties[g]&&m.indexOf(g)<0){var b=null,y=this.attributes[g];if(y)b=y.call(this,t,e,n,o);else if(!1===n.allowUnknownAttributes)throw new l("Unsupported attribute: "+g,e);b&&c.importErrors(b)}if("function"==typeof n.rewrite){var v=n.rewrite.call(this,t,e,n,o);c.instance=v}return c},c.prototype.schemaTraverser=function(t,e){t.schema=a.deepMerge(t.schema,this.superResolve(e,t.ctx))},c.prototype.superResolve=function(t,e){var n;return(n=r(t))?this.resolve(t,n,e).subschema:t},c.prototype.resolve=function(t,e,n){if(e=n.resolve(e),n.schemas[e])return{subschema:n.schemas[e],switchSchema:e};var r=o.parse(e),i=r&&r.hash,s=i&&i.length&&e.substr(0,e.length-i.length);if(!s||!n.schemas[s])throw new l("no such schema <"+e+">",t);var u=a.objectGetPath(n.schemas[s],i.substr(1));if(void 0===u)throw new l("no such schema "+i+" located in <"+s+">",t);return{subschema:u,switchSchema:e}},c.prototype.testType=function(t,e,n,r,o){if("function"==typeof this.types[o])return this.types[o].call(this,t);if(o&&"object"==typeof o){var i=this.validateSchema(t,o,n,r);return void 0===i||!(i&&i.errors.length)}return!0};var p=c.prototype.types={};p.string=function(t){return"string"==typeof t},p.number=function(t){return"number"==typeof t&&isFinite(t)},p.integer=function(t){return"number"==typeof t&&t%1==0},p.boolean=function(t){return"boolean"==typeof t},p.array=function(t){return t instanceof Array},p.null=function(t){return null===t},p.date=function(t){return t instanceof Date},p.any=function(t){return!0},p.object=function(t){return t&&"object"==typeof t&&!(t instanceof Array)&&!(t instanceof Date)},e.exports=c},{"./attribute":18,"./helpers":19,url:6}],22:[function(t,e,n){"use strict";function r(t,e){function n(r,i){if(t(r,i))return!0;if(Array.isArray(r)){if(!Array.isArray(i)||r.length!==i.length)return!1;for(var a=0;a<r.length;a++)if(!n(r[a],i[a]))return!1;return!0}if(Array.isArray(i))return!1;if("object"==typeof r){if("object"!=typeof i)return!1;var s=null===r,l=null===i;if(s||l)return s===l;var u=Object.keys(r),c=Object.keys(i);if(u.length!==c.length)return!1;for(var a=0;a<u.length;a++){var p=u[a];if(o.call(r,p)&&(!o.call(i,p)||!(e?n:t)(r[p],i[p])))return!1}return!0}return!1}return n}n.__esModule=!0,n.default=r;var o=Object.prototype.hasOwnProperty;e.exports=n.default},{}],23:[function(t,e,n){"use strict";n.__esModule=!0;var r=t("./memoize"),o=function(t){return t&&t.__esModule?t:{default:t}}(r);n.default=o.default,e.exports=n.default},{"./memoize":25}],24:[function(t,e,n){"use strict";function r(t,e){function n(t){for(var n=0;n<o.length;n++){var r=o[n];if(e(t,r.key))return n>0&&(o.splice(n,1),o.unshift(r)),r.value}}function r(e,r){n(e)||(o.unshift({key:e,value:r}),o.length>t&&o.pop())}var o=[];return{get:n,put:r}}n.__esModule=!0,n.default=r,e.exports=n.default},{}],25:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return 1===t?s.default(e):u.default(t,e)}function i(){for(var t=1,e=function(t,e){return t===e},n=!1,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];"number"==typeof i[0]&&(t=i.shift()),"function"==typeof i[0]&&(e=i.shift()),"boolean"==typeof i[0]&&(n=i[0]);var s=o(t,p.default(e,n));return function(t){return function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=s.get(n);return void 0===o&&(o=t.apply(t,n),s.put(n,o)),o}}}n.__esModule=!0,n.default=i;var a=t("./singletonCache"),s=r(a),l=t("./lruCache"),u=r(l),c=t("./deepEquals"),p=r(c);e.exports=n.default},{"./deepEquals":22,"./lruCache":24,"./singletonCache":26}],26:[function(t,e,n){"use strict";function r(t){var e=void 0;return{get:function(n){if(e&&t(n,e.key))return e.value},put:function(t,n){e={key:t,value:n}}}}n.__esModule=!0,n.default=r,e.exports=n.default},{}],27:[function(e,n,r){!function(o,i){"object"==typeof r&&void 0!==n?n.exports=i(e("preact"),e("redux")):"function"==typeof t&&t.amd?t(["preact","redux"],i):o.preactRedux=i(o.preact,o.Redux)}(this,function(t,e){function n(){}function r(){var t=[],e=[];return{clear:function(){e=G,t=G},notify:function(){for(var n=t=e,r=0;r<n.length;r++)n[r]()},subscribe:function(n){var r=!0;return e===t&&(e=t.slice()),e.push(n),function(){r&&t!==G&&(r=!1,e===t&&(e=t.slice()),e.splice(e.indexOf(n),1))}}}}function o(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t);try{throw new Error(t)}catch(t){}}function i(){V||(V=!0,o("<Provider> does not support changing `store` on the fly. It is most likely that you see this error because you updated to Redux 2.x and React Redux 2.x which no longer hot reload reducers automatically. See https://github.com/reactjs/react-redux/releases/tag/v2.0.0 for the migration instructions."))}function a(e){var n,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=o.getDisplayName,a=void 0===i?function(t){return"ConnectAdvanced("+t+")"}:i,s=o.methodName,l=void 0===s?"connectAdvanced":s,u=o.renderCountProp,c=void 0===u?void 0:u,p=o.shouldHandleStateChanges,d=void 0===p||p,f=o.storeKey,h=void 0===f?"store":f,m=o.withRef,g=void 0!==m&&m,b=L(o,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef"]),y=h+"Subscription",v=J++,w=(n={},n[h]=z,n[y]=I.instanceOf(H),n),x=(r={},r[y]=I.instanceOf(H),r);return function(n){Z("function"==typeof n,"You must pass a component to the function returned by connect. Instead received "+n);var r=n.displayName||n.name||"Component",o=a(r),i=k({},b,{getDisplayName:a,methodName:l,renderCountProp:c,shouldHandleStateChanges:d,storeKey:h,withRef:g,displayName:o,wrappedComponentName:r,WrappedComponent:n}),s=function(r){function a(t,e){B(this,a);var n=F(this,r.call(this,t,e));return n.version=v,n.state={},n.renderCount=0,n.store=n.props[h]||n.context[h],n.parentSub=t[y]||e[y],n.setWrappedInstance=n.setWrappedInstance.bind(n),Z(n.store,'Could not find "'+h+'" in either the context or props of "'+o+'". Either wrap the root component in a <Provider>, or explicitly pass "'+h+'" as a prop to "'+o+'".'),n.getState=n.store.getState.bind(n.store),n.initSelector(),n.initSubscription(),n}return D(a,r),a.prototype.getChildContext=function(){var t;return t={},t[y]=this.subscription||this.parentSub,t},a.prototype.componentDidMount=function(){d&&(this.subscription.trySubscribe(),this.selector.run(this.props),this.selector.shouldComponentUpdate&&this.forceUpdate())},a.prototype.componentWillReceiveProps=function(t){this.selector.run(t)},a.prototype.shouldComponentUpdate=function(){return this.selector.shouldComponentUpdate},a.prototype.componentWillUnmount=function(){this.subscription&&this.subscription.tryUnsubscribe(),this.subscription=null,this.store=null,this.parentSub=null,this.selector.run=function(){}},a.prototype.getWrappedInstance=function(){return Z(g,"To access the wrapped instance, you need to specify { withRef: true } in the options argument of the "+l+"() call."),this.wrappedInstance},a.prototype.setWrappedInstance=function(t){this.wrappedInstance=t},a.prototype.initSelector=function(){var t=this.store.dispatch,n=this.getState,r=e(t,i),o=this.selector={shouldComponentUpdate:!0,props:r(n(),this.props),run:function(t){try{var e=r(n(),t);(o.error||e!==o.props)&&(o.shouldComponentUpdate=!0,o.props=e,o.error=null)}catch(t){o.shouldComponentUpdate=!0,o.error=t}}}},a.prototype.initSubscription=function(){var t=this;d&&function(){var e=t.subscription=new H(t.store,t.parentSub),n={};e.onStateChange=function(){this.selector.run(this.props),this.selector.shouldComponentUpdate?(this.componentDidUpdate=function(){this.componentDidUpdate=void 0,e.notifyNestedSubs()},this.setState(n)):e.notifyNestedSubs()}.bind(t)}()},a.prototype.isSubscribed=function(){return Boolean(this.subscription)&&this.subscription.isSubscribed()},a.prototype.addExtraProps=function(t){if(!g&&!c)return t;var e=k({},t);return g&&(e.ref=this.setWrappedInstance),c&&(e[c]=this.renderCount++),e},a.prototype.render=function(){var e=this.selector;if(e.shouldComponentUpdate=!1,e.error)throw e.error;return t.h(n,this.addExtraProps(e.props))},a}(t.Component);return s.WrappedComponent=n,s.displayName=o,s.childContextTypes=x,s.contextTypes=w,s.prototype.componentWillUpdate=function(){this.version!==v&&(this.version=v,this.initSelector(),this.subscription&&this.subscription.tryUnsubscribe(),this.initSubscription(),d&&this.subscription.trySubscribe())},K(s,n)}}function s(t,e){if(t===e)return!0;var n=0,r=0;for(var o in t){if(X.call(t,o)&&t[o]!==e[o])return!1;n++}for(var i in e)X.call(e,i)&&r++;return n===r}function l(t){return Q(Object(t))}function u(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function c(t){return!!t&&"object"==(void 0===t?"undefined":M(t))}function p(t){if(!c(t)||it.call(t)!=tt||u(t))return!1;var e=l(t);if(null===e)return!0;var n=rt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&nt.call(n)==ot}function d(t,e,n){p(t)||o(n+"() in "+e+" must return a plain object. Instead received "+t+".")}function f(t){return function(e,n){function r(){return o}var o=t(e,n);return r.dependsOnOwnProps=!1,r}}function h(t){return null!==t.dependsOnOwnProps&&void 0!==t.dependsOnOwnProps?Boolean(t.dependsOnOwnProps):1!==t.length}function m(t,e){return function(n,r){var o=r.displayName,i=function(t,e){return i.dependsOnOwnProps?i.mapToProps(t,e):i.mapToProps(t)};return i.dependsOnOwnProps=h(t),i.mapToProps=function(n,r){i.mapToProps=t;var a=i(n,r);return"function"==typeof a&&(i.mapToProps=a,i.dependsOnOwnProps=h(a),a=i(n,r)),d(a,o,e),a},i}}function g(t){return"function"==typeof t?m(t,"mapDispatchToProps"):void 0}function b(t){return t?void 0:f(function(t){return{dispatch:t}})}function y(t){return t&&"object"===(void 0===t?"undefined":M(t))?f(function(n){return e.bindActionCreators(t,n)}):void 0}function v(t){return"function"==typeof t?m(t,"mapStateToProps"):void 0}function w(t){return t?void 0:f(function(){return{}})}function x(t,e,n){return k({},n,t,e)}function O(t){return function(e,n){var r=n.displayName,o=n.pure,i=n.areMergedPropsEqual,a=!1,s=void 0;return function(e,n,l){var u=t(e,n,l);return a?o&&i(u,s)||(s=u):(a=!0,s=u,d(s,r,"mergeProps")),s}}}function S(t){return"function"==typeof t?O(t):void 0}function T(t){return t?void 0:function(){return x}}function E(t,e,n){if(!t)throw new Error("Unexpected value for "+e+" in "+n+".");"mapStateToProps"!==e&&"mapDispatchToProps"!==e||t.hasOwnProperty("dependsOnOwnProps")||o("The selector for "+e+" of "+n+" did not specify a value for dependsOnOwnProps.")}function A(t,e,n,r){E(t,"mapStateToProps",r),E(e,"mapDispatchToProps",r),E(n,"mergeProps",r)}function P(t,e,n,r){return function(o,i){return n(t(o,i),e(r,i),i)}}function C(t,e,n,r,o){function i(o,i){return h=o,m=i,g=t(h,m),b=e(r,m),y=n(g,b,m),f=!0,y}function a(){return g=t(h,m),e.dependsOnOwnProps&&(b=e(r,m)),y=n(g,b,m)}function s(){return t.dependsOnOwnProps&&(g=t(h,m)),e.dependsOnOwnProps&&(b=e(r,m)),y=n(g,b,m)}function l(){var e=t(h,m),r=!d(e,g);return g=e,r&&(y=n(g,b,m)),y}function u(t,e){var n=!p(e,m),r=!c(t,h);return h=t,m=e,n&&r?a():n?s():r?l():y}var c=o.areStatesEqual,p=o.areOwnPropsEqual,d=o.areStatePropsEqual,f=!1,h=void 0,m=void 0,g=void 0,b=void 0,y=void 0;return function(t,e){return f?u(t,e):i(t,e)}}function j(t,e){var n=e.initMapStateToProps,r=e.initMapDispatchToProps,o=e.initMergeProps,i=L(e,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),a=n(t,i),s=r(t,i),l=o(t,i);return A(a,s,l,i.displayName),(i.pure?C:P)(a,s,l,t,i)}function _(t,e,n){for(var r=e.length-1;r>=0;r--){var o=e[r](t);if(o)return o}return function(e,r){throw new Error("Invalid value of type "+(void 0===t?"undefined":M(t))+" for "+n+" argument when connecting component "+r.wrappedComponentName+".")}}function N(t,e){return t===e}var R={only:function(t){return t&&t[0]||null}};n.isRequired=n;var I={element:n,func:n,shape:function(){return n},instanceOf:function(){return n}},M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},B=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},k=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},D=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},L=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},F=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},G=null,U={notify:function(){}},H=function(){function t(e,n){B(this,t),this.store=e,this.parentSub=n,this.unsubscribe=null,this.listeners=U}return t.prototype.addNestedSub=function(t){return this.trySubscribe(),this.listeners.subscribe(t)},t.prototype.notifyNestedSubs=function(){this.listeners.notify()},t.prototype.isSubscribed=function(){return Boolean(this.unsubscribe)},t.prototype.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.onStateChange):this.store.subscribe(this.onStateChange),this.listeners=r())},t.prototype.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=U)},t}(),z=I.shape({subscribe:I.func.isRequired,dispatch:I.func.isRequired,getState:I.func.isRequired}),V=!1,W=function(t){function e(n,r){B(this,e);var o=F(this,t.call(this,n,r));return o.store=n.store,o}return D(e,t),e.prototype.getChildContext=function(){return{store:this.store,storeSubscription:null}},e.prototype.render=function(){return R.only(this.props.children)},e}(t.Component);W.prototype.componentWillReceiveProps=function(t){this.store!==t.store&&i()},W.childContextTypes={store:z.isRequired,storeSubscription:I.instanceOf(H)},W.displayName="Provider";var q={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,mixins:!0,propTypes:!0,type:!0},$={name:!0,length:!0,prototype:!0,caller:!0,arguments:!0,arity:!0},Y="function"==typeof Object.getOwnPropertySymbols,K=function(t,e,n){if("string"!=typeof e){var r=Object.getOwnPropertyNames(e);Y&&(r=r.concat(Object.getOwnPropertySymbols(e)));for(var o=0;o<r.length;++o)if(!(q[r[o]]||$[r[o]]||n&&n[r[o]]))try{t[r[o]]=e[r[o]]}catch(t){}}return t},Z=function(){},J=0,X=Object.prototype.hasOwnProperty,Q=Object.getPrototypeOf,tt="[object Object]",et=Object.prototype,nt=Function.prototype.toString,rt=et.hasOwnProperty,ot=nt.call(Object),it=et.toString,at=[g,b,y],st=[v,w],lt=[S,T];return{Provider:W,connect:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.connectHOC,n=void 0===e?a:e,r=t.mapStateToPropsFactories,o=void 0===r?st:r,i=t.mapDispatchToPropsFactories,l=void 0===i?at:i,u=t.mergePropsFactories,c=void 0===u?lt:u,p=t.selectorFactory,d=void 0===p?j:p;return function(t,e,r){var i=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],a=i.pure,u=void 0===a||a,p=i.areStatesEqual,f=void 0===p?N:p,h=i.areOwnPropsEqual,m=void 0===h?s:h,g=i.areStatePropsEqual,b=void 0===g?s:g,y=i.areMergedPropsEqual,v=void 0===y?s:y,w=L(i,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),x=_(t,o,"mapStateToProps"),O=_(e,l,"mapDispatchToProps"),S=_(r,c,"mergeProps");return n(d,k({methodName:"connect",getDisplayName:function(t){return"Connect("+t+")"},shouldHandleStateChanges:Boolean(t),initMapStateToProps:x,initMapDispatchToProps:O,initMergeProps:S,pure:u,areStatesEqual:f,areOwnPropsEqual:m,areStatePropsEqual:b,areMergedPropsEqual:v},w))}}(),connectAdvanced:a}})},{preact:28,redux:42}],28:[function(e,n,r){!function(e,o){"object"==typeof r&&void 0!==n?o(r):"function"==typeof t&&t.amd?t(["exports"],o):o(e.preact=e.preact||{})}(this,function(t){function e(t,e,n){this.nodeName=t,this.attributes=e,this.children=n,this.key=e&&e.key}function n(t,n){var r,o,i,a,s=[];for(a=arguments.length;a-- >2;)G.push(arguments[a]);for(n&&n.children&&(G.length||G.push(n.children),delete n.children);G.length;)if((o=G.pop())instanceof Array)for(a=o.length;a--;)G.push(o[a]);else null!=o&&!1!==o&&("number"!=typeof o&&!0!==o||(o=String(o)),i="string"==typeof o,i&&r?s[s.length-1]+=o:(s.push(o),r=i));var l=new e(t,n||void 0,s);return F.vnode&&F.vnode(l),l}function r(t,e){if(e)for(var n in e)t[n]=e[n];return t}function o(t){return r({},t)}function i(t,e){for(var n=e.split("."),r=0;r<n.length&&t;r++)t=t[n[r]];return t}function a(t){return"function"==typeof t}function s(t){return"string"==typeof t}function l(t){var e="";for(var n in t)t[n]&&(e&&(e+=" "),e+=n);return e}function u(t,e){return n(t.nodeName,r(o(t.attributes),e),arguments.length>2?[].slice.call(arguments,2):t.children)}function c(t,e,n){var r=e.split("."),o=r[0];return function(e){var a,l,u=e&&e.currentTarget||this,c=t.state,p=c,d=s(n)?i(e,n):u.nodeName?(u.nodeName+u.type).match(/^input(che|rad)/i)?u.checked:u.value:e;if(r.length>1){for(l=0;l<r.length-1;l++)p=p[r[l]]||(p[r[l]]={});p[r[l]]=d,d=c[o]}t.setState((a={},a[o]=d,a))}}function p(t){!t._dirty&&(t._dirty=!0)&&1==K.push(t)&&(F.debounceRendering||V)(d)}function d(){var t,e=K;for(K=[];t=e.pop();)t._dirty&&M(t)}function f(t){var e=t&&t.nodeName;return e&&a(e)&&!(e.prototype&&e.prototype.render)}function h(t,e){return t.nodeName(b(t),e||W)}function m(t,e){return s(e)?t instanceof Text:s(e.nodeName)?g(t,e.nodeName):a(e.nodeName)?t._componentConstructor===e.nodeName||f(e):void 0}function g(t,e){return t.normalizedNodeName===e||H(t.nodeName)===H(e)}function b(t){var e=o(t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(n)for(var r in n)void 0===e[r]&&(e[r]=n[r]);return e}function y(t){var e=t.parentNode;e&&e.removeChild(t)}function v(t,e,n,r,o){if("className"===e&&(e="class"),"class"===e&&r&&"object"==typeof r&&(r=l(r)),"key"===e);else if("class"!==e||o)if("style"===e){if((!r||s(r)||s(n))&&(t.style.cssText=r||""),r&&"object"==typeof r){if(!s(n))for(var i in n)i in r||(t.style[i]="");for(var i in r)t.style[i]="number"!=typeof r[i]||$[i]?r[i]:r[i]+"px"}}else if("dangerouslySetInnerHTML"===e)r&&(t.innerHTML=r.__html);else if("o"==e[0]&&"n"==e[1]){var u=t._listeners||(t._listeners={});e=H(e.substring(2)),r?u[e]||t.addEventListener(e,x,!!Y[e]):u[e]&&t.removeEventListener(e,x,!!Y[e]),u[e]=r}else if("list"!==e&&"type"!==e&&!o&&e in t)w(t,e,null==r?"":r),null!=r&&!1!==r||t.removeAttribute(e);else{var c=o&&e.match(/^xlink\:?(.+)/);null==r||!1===r?c?t.removeAttributeNS("http://www.w3.org/1999/xlink",H(c[1])):t.removeAttribute(e):"object"==typeof r||a(r)||(c?t.setAttributeNS("http://www.w3.org/1999/xlink",H(c[1]),r):t.setAttribute(e,r))}else t.className=r||""}function w(t,e,n){try{t[e]=n}catch(t){}}function x(t){return this._listeners[t.type](F.event&&F.event(t)||t)}function O(t){if(y(t),t instanceof Element){t._component=t._componentConstructor=null;var e=t.normalizedNodeName||H(t.nodeName)
;(Z[e]||(Z[e]=[])).push(t)}}function S(t,e){var n=H(t),r=Z[n]&&Z[n].pop()||(e?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t));return r.normalizedNodeName=n,r}function T(){for(var t;t=J.pop();)t.componentDidMount&&t.componentDidMount()}function E(t,e,n,r,o,i){X++||(Q=o instanceof SVGElement);var a=A(t,e,n,r);return o&&a.parentNode!==o&&o.appendChild(a),--X||i||T(),a}function A(t,e,n,r){for(var o=e&&e.attributes;f(e);)e=h(e,n);if(null==e&&(e=""),s(e)){if(t){if(t instanceof Text&&t.parentNode)return t.nodeValue=e,t;j(t)}return document.createTextNode(e)}if(a(e.nodeName))return B(t,e,n,r);var i=t,l=e.nodeName,u=Q;if(s(l)||(l=String(l)),Q="svg"===l||"foreignObject"!==l&&Q,t){if(!g(t,l)){for(i=S(l,Q);t.firstChild;)i.appendChild(t.firstChild);j(t)}}else i=S(l,Q);e.children&&1===e.children.length&&"string"==typeof e.children[0]&&1===i.childNodes.length&&i.firstChild instanceof Text?i.firstChild.nodeValue=e.children[0]:(e.children&&e.children.length||i.firstChild)&&P(i,e.children,n,r);var c=i[q];if(!c){i[q]=c={};for(var p=i.attributes,d=p.length;d--;)c[p[d].name]=p[d].value}return _(i,e.attributes,c),o&&"function"==typeof o.ref&&(c.ref=o.ref)(i),Q=u,i}function P(t,e,n,r){var o,i,s,l,u=t.childNodes,c=[],p={},d=0,f=0,h=u.length,g=0,b=e&&e.length;if(h)for(var y=0;y<h;y++){var v=u[y],w=b?(i=v._component)?i.__key:(i=v[q])?i.key:null:null;w||0===w?(d++,p[w]=v):c[g++]=v}if(b)for(var y=0;y<b;y++){s=e[y],l=null;var w=s.key;if(null!=w)d&&w in p&&(l=p[w],p[w]=void 0,d--);else if(!l&&f<g){for(o=f;o<g;o++)if((i=c[o])&&m(i,s)){l=i,c[o]=void 0,o===g-1&&g--,o===f&&f++;break}!l&&f<g&&a(s.nodeName)&&r&&(l=c[f],c[f++]=void 0)}l=A(l,s,n,r),l&&l!==t&&l!==u[y]&&t.insertBefore(l,u[y]||null)}if(d)for(var y in p)p[y]&&j(p[y]);f<g&&C(c)}function C(t,e){for(var n=t.length;n--;)t[n]&&j(t[n],e)}function j(t,e){var n=t._component;n?k(n,!e):(t[q]&&t[q].ref&&t[q].ref(null),e||O(t),t.childNodes&&t.childNodes.length&&C(t.childNodes,e))}function _(t,e,n){for(var r in n)e&&r in e||null==n[r]||v(t,r,n[r],n[r]=void 0,Q);if(e)for(var o in e)"children"===o||"innerHTML"===o||o in n&&e[o]===("value"===o||"checked"===o?t[o]:n[o])||v(t,o,n[o],n[o]=e[o],Q)}function N(t){var e=t.constructor.name,n=tt[e];n?n.push(t):tt[e]=[t]}function R(t,e,n){var r=new t(e,n),o=tt[t.name];if(D.call(r,e,n),o)for(var i=o.length;i--;)if(o[i].constructor===t){r.nextBase=o[i].nextBase,o.splice(i,1);break}return r}function I(t,e,n,r,o){t._disable||(t._disable=!0,(t.__ref=e.ref)&&delete e.ref,(t.__key=e.key)&&delete e.key,!t.base||o?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,r),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&!1===F.syncComponentUpdates&&t.base?p(t):M(t,1,o)),t.__ref&&t.__ref(t))}function M(t,e,n,i){if(!t._disable){var s,l,u,c,p=t.props,d=t.state,m=t.context,g=t.prevProps||p,y=t.prevState||d,v=t.prevContext||m,w=t.base,x=t.nextBase,O=w||x,S=t._component;if(w&&(t.props=g,t.state=y,t.context=v,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(p,d,m)?s=!0:t.componentWillUpdate&&t.componentWillUpdate(p,d,m),t.props=p,t.state=d,t.context=m),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!s){for(t.render&&(l=t.render(p,d,m)),t.getChildContext&&(m=r(o(m),t.getChildContext()));f(l);)l=h(l,m);var A,P,C=l&&l.nodeName;if(a(C)){u=S;var _=b(l);u&&u.constructor===C?I(u,_,1,m):(A=u,u=R(C,_,m),u.nextBase=u.nextBase||x,u._parentComponent=t,t._component=u,I(u,_,0,m),M(u,1,n,!0)),P=u.base}else c=O,A=S,A&&(c=t._component=null),(O||1===e)&&(c&&(c._component=null),P=E(c,l,m,n||!w,O&&O.parentNode,!0));if(O&&P!==O&&u!==S){var N=O.parentNode;N&&P!==N&&N.replaceChild(P,O),c||A||!t._parentComponent||(O._component=null,j(O))}if(A&&k(A,P!==O),t.base=P,P&&!i){for(var B=t,D=t;D=D._parentComponent;)B=D;P._component=B,P._componentConstructor=B.constructor}}!w||n?J.unshift(t):!s&&t.componentDidUpdate&&t.componentDidUpdate(g,y,v);var L,F=t._renderCallbacks;if(F)for(;L=F.pop();)L.call(t);X||i||T()}}function B(t,e,n,r){for(var o=t&&t._component,i=t,a=o&&t._componentConstructor===e.nodeName,s=a,l=b(e);o&&!s&&(o=o._parentComponent);)s=o.constructor===e.nodeName;return o&&s&&(!r||o._component)?(I(o,l,3,n,r),t=o.base):(o&&!a&&(k(o,!0),t=i=null),o=R(e.nodeName,l,n),t&&!o.nextBase&&(o.nextBase=t),I(o,l,1,n,r),t=o.base,i&&t!==i&&(i._component=null,j(i))),t}function k(t,e){var n=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var r=t._component;r?k(r,e):n&&(n[q]&&n[q].ref&&n[q].ref(null),t.nextBase=n,e&&(y(n),N(t)),C(n.childNodes,!e)),t.__ref&&t.__ref(null),t.componentDidUnmount&&t.componentDidUnmount()}function D(t,e){this._dirty=!0,this.context=e,this.props=t,this.state||(this.state={})}function L(t,e,n){return E(n,t,{},!1,e)}var F={},G=[],U={},H=function(t){return U[t]||(U[t]=t.toLowerCase())},z="undefined"!=typeof Promise&&Promise.resolve(),V=z?function(t){z.then(t)}:setTimeout,W={},q="undefined"!=typeof Symbol?Symbol.for("preactattr"):"__preactattr_",$={boxFlex:1,boxFlexGroup:1,columnCount:1,fillOpacity:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,strokeOpacity:1,widows:1,zIndex:1,zoom:1},Y={blur:1,error:1,focus:1,load:1,resize:1,scroll:1},K=[],Z={},J=[],X=0,Q=!1,tt={};r(D.prototype,{linkState:function(t,e){var n=this._linkedStates||(this._linkedStates={});return n[t+e]||(n[t+e]=c(this,t,e))},setState:function(t,e){var n=this.state;this.prevState||(this.prevState=o(n)),r(n,a(t)?t(n,this.props):t),e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),p(this)},forceUpdate:function(){M(this,2)},render:function(){}}),t.h=n,t.cloneElement=u,t.Component=D,t.render=L,t.rerender=d,t.options=F})},{}],29:[function(t,e,n){"use strict";var r=t("strict-uri-encode");n.extract=function(t){return t.split("?")[1]||""},n.parse=function(t){return"string"!=typeof t?{}:(t=t.trim().replace(/^(\?|#|&)/,""),t?t.split("&").reduce(function(t,e){var n=e.replace(/\+/g," ").split("="),r=n.shift(),o=n.length>0?n.join("="):void 0;return r=decodeURIComponent(r),o=void 0===o?null:decodeURIComponent(o),t.hasOwnProperty(r)?Array.isArray(t[r])?t[r].push(o):t[r]=[t[r],o]:t[r]=o,t},{}):{})},n.stringify=function(t){return t?Object.keys(t).sort().map(function(e){var n=t[e];return Array.isArray(n)?n.sort().map(function(t){return r(e)+"="+r(t)}).join("&"):r(e)+"="+r(n)}).filter(function(t){return t.length>0}).join("&"):""}},{"strict-uri-encode":30}],30:[function(t,e,n){"use strict";e.exports=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}},{}],31:[function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e,n,o){switch(void 0===t?"undefined":s(t)){case"object":return"function"==typeof t[o]?t[o].apply(t,r(n)):t[o];case"function":return t(e);default:return t}}function i(t){var e=t.timestamp,n=t.duration;return function(t,r,o){var i=["action"];return i.push("%c"+String(t.type)),e&&i.push("%c@ "+r),n&&i.push("%c(in "+o.toFixed(2)+" ms)"),i.join(" ")}}function a(t,e){var n=e.logger,r=e.actionTransformer,a=e.titleFormatter,s=void 0===a?i(e):a,u=e.collapsed,p=e.colors,d=e.level,f=e.diff,h=void 0===e.titleFormatter;t.forEach(function(i,a){var m=i.started,g=i.startedTime,b=i.action,y=i.prevState,v=i.error,w=i.took,x=i.nextState,O=t[a+1];O&&(x=O.prevState,w=O.started-m);var S=r(b),T="function"==typeof u?u(function(){return x},b,i):u,E=(0,l.formatTime)(g),A=p.title?"color: "+p.title(S)+";":"",P=["color: gray; font-weight: lighter;"];P.push(A),e.timestamp&&P.push("color: gray; font-weight: lighter;"),e.duration&&P.push("color: gray; font-weight: lighter;");var C=s(S,E,w);try{T?p.title&&h?n.groupCollapsed.apply(n,["%c "+C].concat(P)):n.groupCollapsed(C):p.title&&h?n.group.apply(n,["%c "+C].concat(P)):n.group(C)}catch(t){n.log(C)}var j=o(d,S,[y],"prevState"),_=o(d,S,[S],"action"),N=o(d,S,[v,y],"error"),R=o(d,S,[x],"nextState");j&&(p.prevState?n[j]("%c prev state","color: "+p.prevState(y)+"; font-weight: bold",y):n[j]("prev state",y)),_&&(p.action?n[_]("%c action    ","color: "+p.action(S)+"; font-weight: bold",S):n[_]("action    ",S)),v&&N&&(p.error?n[N]("%c error     ","color: "+p.error(v,y)+"; font-weight: bold;",v):n[N]("error     ",v)),R&&(p.nextState?n[R]("%c next state","color: "+p.nextState(x)+"; font-weight: bold",x):n[R]("next state",x)),f&&(0,c.default)(y,x,n,T);try{n.groupEnd()}catch(t){n.log("—— log end ——")}})}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.printBuffer=a;var l=t("./helpers"),u=t("./diff"),c=function(t){return t&&t.__esModule?t:{default:t}}(u)},{"./diff":33,"./helpers":34}],32:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(t){return t},actionTransformer:function(t){return t},errorTransformer:function(t){return t},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},e.exports=n.default},{}],33:[function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t){return"color: "+u[t].color+"; font-weight: bold"}function i(t){var e=t.kind,n=t.path,r=t.lhs,o=t.rhs,i=t.index,a=t.item;switch(e){case"E":return[n.join("."),r,"→",o];case"N":return[n.join("."),o];case"D":return[n.join(".")];case"A":return[n.join(".")+"["+i+"]",a];default:return[]}}function a(t,e,n,a){var s=(0,l.default)(t,e);try{a?n.groupCollapsed("diff"):n.group("diff")}catch(t){n.log("diff")}s?s.forEach(function(t){var e=t.kind,a=i(t);n.log.apply(n,["%c "+u[e].text,o(e)].concat(r(a)))}):n.log("—— no diff ——");try{n.groupEnd()}catch(t){n.log("—— diff end —— ")}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;var s=t("deep-diff"),l=function(t){return t&&t.__esModule?t:{default:t}}(s),u={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}};e.exports=n.default},{"deep-diff":36}],34:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=n.repeat=function(t,e){return new Array(e+1).join(t)},o=n.pad=function(t,e){return r("0",e-t.toString().length)+t};n.formatTime=function(t){return o(t.getHours(),2)+":"+o(t.getMinutes(),2)+":"+o(t.getSeconds(),2)+"."+o(t.getMilliseconds(),3)},n.timer="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date},{}],35:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=o({},l.default,t),n=e.logger,r=e.stateTransformer,s=e.errorTransformer,u=e.predicate,c=e.logErrors,p=e.diffPredicate;if(void 0===n)return function(){return function(t){return function(e){return t(e)}}};if(t.getState&&t.dispatch)return console.error("[redux-logger] redux-logger not installed. Make sure to pass logger instance as middleware:\n// Logger with default options\nimport { logger } from 'redux-logger'\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n// Or you can create your own logger with custom options http://bit.ly/redux-logger-options\nimport createLogger from 'redux-logger'\nconst logger = createLogger({\n  // ...options\n});\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n"),function(){return function(t){return function(e){return t(e)}}};var d=[];return function(t){var n=t.getState;return function(t){return function(l){if("function"==typeof u&&!u(n,l))return t(l);var f={};d.push(f),f.started=a.timer.now(),f.startedTime=new Date,f.prevState=r(n()),f.action=l;var h=void 0;if(c)try{h=t(l)}catch(t){f.error=s(t)}else h=t(l);f.took=a.timer.now()-f.started,f.nextState=r(n());var m=e.diff&&"function"==typeof p?p(n,l):e.diff;if((0,i.printBuffer)(d,o({},e,{diff:m})),d.length=0,f.error)throw f.error;return h}}}}Object.defineProperty(n,"__esModule",{value:!0}),n.logger=n.createLogger=n.defaults=void 0;var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=t("./core"),a=t("./helpers"),s=t("./defaults"),l=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dispatch,n=t.getState;if("function"==typeof e||"function"==typeof n)return r()({dispatch:e,getState:n});console.error("\n[redux-logger v3] BREAKING CHANGE\n[redux-logger v3] Since 3.0.0 redux-logger exports by default logger with default settings.\n[redux-logger v3] Change\n[redux-logger v3] import createLogger from 'redux-logger'\n[redux-logger v3] to\n[redux-logger v3] import { createLogger } from 'redux-logger'\n")};n.defaults=l.default,n.createLogger=r,n.logger=u,n.default=u},{"./core":31,"./defaults":32,"./helpers":34}],36:[function(e,n,r){(function(e){!function(e,o){"use strict";"function"==typeof t&&t.amd?t([],function(){return o()}):"object"==typeof r?n.exports=o():e.DeepDiff=o()}(this,function(t){"use strict";function n(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function r(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function o(t,e,n){o.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function i(t,e){i.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function a(t,e){a.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function s(t,e,n){s.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function l(t,e,n){var r=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,r),t}function u(t){var e=typeof t;return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":"[object Date]"===Object.prototype.toString.call(t)?"date":void 0!==t.toString&&/^\/.*\//.test(t.toString())?"regexp":"object"}function c(e,n,r,p,d,f,h){d=d||[];var m=d.slice(0);if(void 0!==f){if(p){if("function"==typeof p&&p(m,f))return;if("object"==typeof p){if(p.prefilter&&p.prefilter(m,f))return;if(p.normalize){var g=p.normalize(m,f,e,n);g&&(e=g[0],n=g[1])}}}m.push(f)}"regexp"===u(e)&&"regexp"===u(n)&&(e=e.toString(),n=n.toString());var b=typeof e,y=typeof n;if("undefined"===b)"undefined"!==y&&r(new i(m,n));else if("undefined"===y)r(new a(m,e));else if(u(e)!==u(n))r(new o(m,e,n));else if("[object Date]"===Object.prototype.toString.call(e)&&"[object Date]"===Object.prototype.toString.call(n)&&e-n!=0)r(new o(m,e,n));else if("object"===b&&null!==e&&null!==n){if(h=h||[],h.indexOf(e)<0){if(h.push(e),Array.isArray(e)){var v;e.length;for(v=0;v<e.length;v++)v>=n.length?r(new s(m,v,new a(t,e[v]))):c(e[v],n[v],r,p,m,v,h);for(;v<n.length;)r(new s(m,v,new i(t,n[v++])))}else{var w=Object.keys(e),x=Object.keys(n);w.forEach(function(o,i){var a=x.indexOf(o);a>=0?(c(e[o],n[o],r,p,m,o,h),x=l(x,a)):c(e[o],t,r,p,m,o,h)}),x.forEach(function(e){c(t,n[e],r,p,m,e,h)})}h.length=h.length-1}}else e!==n&&("number"===b&&isNaN(e)&&isNaN(n)||r(new o(m,e,n)))}function p(e,n,r,o){return o=o||[],c(e,n,function(t){t&&o.push(t)},r),o.length?o:t}function d(t,e,n){if(n.path&&n.path.length){var r,o=t[e],i=n.path.length-1;for(r=0;r<i;r++)o=o[n.path[r]];switch(n.kind){case"A":d(o[n.path[r]],n.index,n.item);break;case"D":delete o[n.path[r]];break;case"E":case"N":o[n.path[r]]=n.rhs}}else switch(n.kind){case"A":d(t[e],n.index,n.item);break;case"D":t=l(t,e);break;case"E":case"N":t[e]=n.rhs}return t}function f(t,e,n){if(t&&e&&n&&n.kind){for(var r=t,o=-1,i=n.path?n.path.length-1:0;++o<i;)void 0===r[n.path[o]]&&(r[n.path[o]]="number"==typeof n.path[o]?[]:{}),r=r[n.path[o]];switch(n.kind){case"A":d(n.path?r[n.path[o]]:r,n.index,n.item);break;case"D":delete r[n.path[o]];break;case"E":case"N":r[n.path[o]]=n.rhs}}}function h(t,e,n){if(n.path&&n.path.length){var r,o=t[e],i=n.path.length-1;for(r=0;r<i;r++)o=o[n.path[r]];switch(n.kind){case"A":h(o[n.path[r]],n.index,n.item);break;case"D":case"E":o[n.path[r]]=n.lhs;break;case"N":delete o[n.path[r]]}}else switch(n.kind){case"A":h(t[e],n.index,n.item);break;case"D":case"E":t[e]=n.lhs;break;case"N":t=l(t,e)}return t}function m(t,e,n){if(t&&e&&n&&n.kind){var r,o,i=t;for(o=n.path.length-1,r=0;r<o;r++)void 0===i[n.path[r]]&&(i[n.path[r]]={}),i=i[n.path[r]];switch(n.kind){case"A":h(i[n.path[r]],n.index,n.item);break;case"D":case"E":i[n.path[r]]=n.lhs;break;case"N":delete i[n.path[r]]}}}function g(t,e,n){if(t&&e){c(t,e,function(r){n&&!n(t,e,r)||f(t,e,r)})}}var b,y,v=[];return b="object"==typeof e&&e?e:"undefined"!=typeof window?window:{},y=b.DeepDiff,y&&v.push(function(){void 0!==y&&b.DeepDiff===p&&(b.DeepDiff=y,y=t)}),n(o,r),n(i,r),n(a,r),n(s,r),Object.defineProperties(p,{diff:{value:p,enumerable:!0},observableDiff:{value:c,enumerable:!0},applyDiff:{value:g,enumerable:!0},applyChange:{value:f,enumerable:!0},revertChange:{value:m,enumerable:!0},isConflict:{value:function(){return void 0!==y},enumerable:!0},noConflict:{value:function(){return v&&(v.forEach(function(t){t()}),v=null),p},enumerable:!0}}),p})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){"use strict";function r(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(n,r,i){var s=t(n,r,i),l=s.dispatch,u=[],c={getState:s.getState,dispatch:function(t){return l(t)}};return u=e.map(function(t){return t(c)}),l=a.default.apply(void 0,u)(s.dispatch),o({},s,{dispatch:l})}}}n.__esModule=!0;var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.default=r;var i=t("./compose"),a=function(t){return t&&t.__esModule?t:{default:t}}(i)},{"./compose":40}],38:[function(t,e,n){"use strict";function r(t,e){return function(){return e(t.apply(void 0,arguments))}}function o(t,e){if("function"==typeof t)return r(t,e);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var n=Object.keys(t),o={},i=0;i<n.length;i++){var a=n[i],s=t[a];"function"==typeof s&&(o[a]=r(s,e))}return o}n.__esModule=!0,n.default=o},{}],39:[function(t,e,n){(function(e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n=e&&e.type;return"Given action "+(n&&'"'+n.toString()+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function i(t,e,n,r){var o=Object.keys(e),i=n&&n.type===l.ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===o.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,c.default)(t))return"The "+i+' has unexpected type of "'+{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+o.join('", "')+'"';var a=Object.keys(t).filter(function(t){return!e.hasOwnProperty(t)&&!r[t]});return a.forEach(function(t){r[t]=!0}),a.length>0?"Unexpected "+(a.length>1?"keys":"key")+' "'+a.join('", "')+'" found in '+i+'. Expected to find one of the known reducer keys instead: "'+o.join('", "')+'". Unexpected keys will be ignored.':void 0}function a(t){Object.keys(t).forEach(function(e){var n=t[e];if(void 0===n(void 0,{type:l.ActionTypes.INIT}))throw new Error('Reducer "'+e+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');if(void 0===n(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+l.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.')})}function s(t){for(var n=Object.keys(t),r={},s=0;s<n.length;s++){var l=n[s];"production"!==e.env.NODE_ENV&&void 0===t[l]&&(0,d.default)('No reducer provided for key "'+l+'"'),"function"==typeof t[l]&&(r[l]=t[l])}var u=Object.keys(r);if("production"!==e.env.NODE_ENV)var c={};var p;try{a(r)}catch(t){p=t}return function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments[1];if(p)throw p;if("production"!==e.env.NODE_ENV){var a=i(t,r,n,c);a&&(0,d.default)(a)}for(var s=!1,l={},f=0;f<u.length;f++){var h=u[f],m=r[h],g=t[h],b=m(g,n);if(void 0===b){var y=o(h,n);throw new Error(y)}l[h]=b,s=s||b!==g}return s?l:t}}n.__esModule=!0,n.default=s;var l=t("./createStore"),u=t("lodash/isPlainObject"),c=r(u),p=t("./utils/warning"),d=r(p)}).call(this,t("_process"))},{"./createStore":41,"./utils/warning":43,_process:1,"lodash/isPlainObject":53}],40:[function(t,e,n){"use strict";function r(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(0===e.length)return function(t){return t};if(1===e.length)return e[0];var r=e[e.length-1],o=e.slice(0,-1);return function(){return o.reduceRight(function(t,e){return e(t)},r.apply(void 0,arguments))}}n.__esModule=!0,n.default=r},{}],41:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){function r(){b===g&&(b=g.slice())}function i(){return m}function s(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var e=!0;return r(),b.push(t),function(){if(e){e=!1,r();var n=b.indexOf(t);b.splice(n,1)}}}function c(t){if(!(0,a.default)(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(y)throw new Error("Reducers may not dispatch actions.");try{y=!0,m=h(m,t)}finally{y=!1}for(var e=g=b,n=0;n<e.length;n++)e[n]();return t}function p(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");h=t,c({type:u.INIT})}function d(){var t,e=s;return t={subscribe:function(t){function n(){t.next&&t.next(i())}if("object"!=typeof t)throw new TypeError("Expected the observer to be an object.");return n(),{unsubscribe:e(n)}}},t[l.default]=function(){return this},t}var f;if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(o)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var h=t,m=e,g=[],b=g,y=!1;return c({type:u.INIT}),f={dispatch:c,subscribe:s,getState:i,replaceReducer:p},f[l.default]=d,f}n.__esModule=!0,n.ActionTypes=void 0,n.default=o;var i=t("lodash/isPlainObject"),a=r(i),s=t("symbol-observable"),l=r(s),u=n.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":53,"symbol-observable":54}],42:[function(t,e,n){(function(e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(){}n.__esModule=!0,n.compose=n.applyMiddleware=n.bindActionCreators=n.combineReducers=n.createStore=void 0;var i=t("./createStore"),a=r(i),s=t("./combineReducers"),l=r(s),u=t("./bindActionCreators"),c=r(u),p=t("./applyMiddleware"),d=r(p),f=t("./compose"),h=r(f),m=t("./utils/warning"),g=r(m);"production"!==e.env.NODE_ENV&&"string"==typeof o.name&&"isCrushed"!==o.name&&(0,g.default)("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build."),n.createStore=a.default,n.combineReducers=l.default,n.bindActionCreators=c.default,n.applyMiddleware=d.default,n.compose=h.default}).call(this,t("_process"))},{"./applyMiddleware":37,"./bindActionCreators":38,"./combineReducers":39,"./compose":40,"./createStore":41,"./utils/warning":43,_process:1}],43:[function(t,e,n){"use strict";function r(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t);try{throw new Error(t)}catch(t){}}n.__esModule=!0,n.default=r},{}],44:[function(t,e,n){var r=t("./_root"),o=r.Symbol;e.exports=o},{"./_root":51}],45:[function(t,e,n){function r(t){return null==t?void 0===t?l:s:u&&u in Object(t)?i(t):a(t)}var o=t("./_Symbol"),i=t("./_getRawTag"),a=t("./_objectToString"),s="[object Null]",l="[object Undefined]",u=o?o.toStringTag:void 0;e.exports=r},{"./_Symbol":44,"./_getRawTag":48,"./_objectToString":49}],46:[function(t,e,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],47:[function(t,e,n){var r=t("./_overArg"),o=r(Object.getPrototypeOf,Object);e.exports=o},{"./_overArg":50}],48:[function(t,e,n){function r(t){var e=a.call(t,l),n=t[l];try{t[l]=void 0;var r=!0}catch(t){}var o=s.call(t);return r&&(e?t[l]=n:delete t[l]),o}var o=t("./_Symbol"),i=Object.prototype,a=i.hasOwnProperty,s=i.toString,l=o?o.toStringTag:void 0;e.exports=r},{"./_Symbol":44}],49:[function(t,e,n){function r(t){return i.call(t)}var o=Object.prototype,i=o.toString;e.exports=r},{}],50:[function(t,e,n){function r(t,e){return function(n){return t(e(n))}}e.exports=r},{}],51:[function(t,e,n){var r=t("./_freeGlobal"),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();e.exports=i},{"./_freeGlobal":46}],52:[function(t,e,n){function r(t){return null!=t&&"object"==typeof t}e.exports=r},{}],53:[function(t,e,n){function r(t){if(!a(t)||o(t)!=s)return!1;var e=i(t);if(null===e)return!0;var n=p.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==d}var o=t("./_baseGetTag"),i=t("./_getPrototype"),a=t("./isObjectLike"),s="[object Object]",l=Function.prototype,u=Object.prototype,c=l.toString,p=u.hasOwnProperty,d=c.call(Object);e.exports=r},{"./_baseGetTag":45,"./_getPrototype":47,"./isObjectLike":52}],54:[function(t,e,n){e.exports=t("./lib/index")},{"./lib/index":55}],55:[function(t,e,n){(function(r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o,i=t("./ponyfill"),a=function(t){return t&&t.__esModule?t:{default:t}}(i);o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:void 0!==e?e:Function("return this")();var s=(0,a.default)(o);n.default=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill":56}],56:[function(t,e,n){"use strict";function r(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],57:[function(t,e,n){function r(t,e,n){this.f=t,this.once=e,this.priority=n}function o(){this.handlers=[]}function i(t,e){for(var n=0;n<t.handlers.length&&!(t.handlers[n].priority<e.priority);n++);t.handlers=t.handlers.slice(0,n).concat(e).concat(t.handlers.slice(n))}function a(){o.call(this)}function s(){o.call(this)}function l(){o.call(this)}n.Subscription=o,o.prototype.handlersForDispatch=function(){for(var t=this.handlers,e=null,n=t.length-1;n>=0;n--)t[n].once&&(e||(e=t.slice()),e.splice(n,1));return e&&(this.handlers=e),t},o.prototype.add=function(t,e){i(this,new r(t,!1,e||0))},o.prototype.addOnce=function(t,e){i(this,new r(t,!0,e||0))},o.prototype.remove=function(t){for(var e=0;e<this.handlers.length;e++)if(this.handlers[e].f==t)return void(this.handlers=this.handlers.slice(0,e).concat(this.handlers.slice(e+1)))},o.prototype.hasHandler=function(){return this.handlers.length>0},o.prototype.dispatch=function(){for(var t=this.handlersForDispatch(),e=0;e<t.length;e++)t[e].f.apply(null,arguments)},n.PipelineSubscription=a,a.prototype=new o,a.prototype.dispatch=function(t){for(var e=this.handlersForDispatch(),n=0;n<e.length;n++)t=e[n].f(t);return t},n.StoppableSubscription=s,s.prototype=new o,s.prototype.dispatch=function(){for(var t=this.handlersForDispatch(),e=0;e<t.length;e++){var n=t[e].f.apply(null,arguments);if(n)return n}},n.DOMSubscription=l,l.prototype=new o,l.prototype.dispatch=function(t){for(var e=this.handlersForDispatch(),n=0;n<e.length;n++)if(e[n].f(t)||t.defaultPrevented)return!0;return!1}},{}],58:[function(t,e,n){function r(t){var e=(!s||!t.ctrlKey&&!t.altKey&&!t.metaKey)&&t.key||(t.shiftKey?i:o)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}for(var o={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},i={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:";",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},a="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),s=a&&+a[1]<57,l=0;l<10;l++)o[48+l]=o[96+l]=String(l);for(var l=1;l<=24;l++)o[l+111]="F"+l;for(var l=65;l<=90;l++)o[l]=String.fromCharCode(l+32),i[l]=String.fromCharCode(l);for(var u in o)i.hasOwnProperty(u)||(i[u]=o[u]);e.exports=r,r.base=o,r.shift=i},{}],59:[function(t,e,n){function r(t,e,n,r){return new Promise(function(o,i){function a(){t().then(function(t){try{e(t)?o(t):setTimeout(a,n)}catch(t){i(t)}},function(t){return i(t)})}setTimeout(a,r||0)})}function o(t,e){return t.replace(/:(\w+)/g,function(t,n){return e[n]})}function i(t,e){function n(t,e,n,r){return n&&"GET"==t&&(e=o(e,n)),fetch(a+e,{method:t,headers:Object.assign({Accept:"application/json"},r),body:"GET"!=t?n:null,credentials:"same-origin"}).then(function(t){return t.json().then(function(e){return t.ok?e:Promise.reject(e.error)})}).catch(function(t){throw"Cannot parse result\n"+t})}function i(t,r,o){return function(i,a){var l=Object.assign({},o,i);return l.options=Object.assign(l.options||{},e,a),s.then(function(){return n(t,r,JSON.stringify(l),{"Content-Type":"application/json"})})}}var a=!t||/\/$/.test(t)?t:t+"/",s=n("GET","indigo/info").then(function(t){return{indigoVersion:t.Indigo.version}}).catch(function(){
throw Error("Server is not compatible")});return Object.assign(s,{convert:i("POST","indigo/convert"),layout:i("POST","indigo/layout"),clean:i("POST","indigo/clean"),aromatize:i("POST","indigo/aromatize"),dearomatize:i("POST","indigo/dearomatize"),calculateCip:i("POST","indigo/calculate_cip"),automap:i("POST","indigo/automap"),check:i("POST","indigo/check"),calculate:i("POST","indigo/calculate"),recognize:function(t){var e=n("POST","imago/uploads",t,{"Content-Type":t.type||"application/octet-stream"}),o=n.bind(null,"GET","imago/uploads/:id");return e.then(function(t){return r(o.bind(null,{id:t.upload_id}),function(t){if("FAILURE"===t.state)throw t;return"SUCCESS"===t.state},500,300)}).then(function(t){return{struct:t.metadata.mol_str}})}})}e.exports=i},{}],60:[function(t,e,n){var r=[null,{label:"H",period:1,group:1,color:"#000000",title:"Hydrogen",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:1.00794},{label:"He",period:1,group:8,color:"#d9ffff",title:"Helium",state:"gas",origin:"primordial",type:"noble",atomic_mass:4.0026022},{label:"Li",period:2,group:1,color:"#cc80ff",title:"Lithium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:6.94},{label:"Be",period:2,group:2,color:"#c2ff00",title:"Beryllium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:9.01218315},{label:"B",period:2,group:3,color:"#ffb5b5",title:"Boron",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:10.81},{label:"C",period:2,group:4,title:"Carbon",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:12.011},{label:"N",period:2,group:5,color:"#304ff7",title:"Nitrogen",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:14.007},{label:"O",period:2,group:6,leftH:!0,color:"#ff0d0d",title:"Oxygen",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:15.999},{label:"F",period:2,group:7,leftH:!0,color:"#8fe04f",title:"Fluorine",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:18.9984031636},{label:"Ne",period:2,group:8,color:"#b3e3f5",title:"Neon",state:"gas",origin:"primordial",type:"noble",atomic_mass:20.17976},{label:"Na",period:3,group:1,color:"#ab5cf2",title:"Sodium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:22.989769282},{label:"Mg",period:3,group:2,color:"#8aff00",title:"Magnesium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:24.305},{label:"Al",period:3,group:3,color:"#bfa6a6",title:"Aluminium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:26.98153857},{label:"Si",period:3,group:4,color:"#f0c7a1",title:"Silicon",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:28.085},{label:"P",period:3,group:5,color:"#ff8000",title:"Phosphorus",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:30.9737619985},{label:"S",period:3,group:6,leftH:!0,color:"#d9a61a",title:"Sulfur",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:32.06},{label:"Cl",period:3,group:7,leftH:!0,color:"#1fd01f",title:"Chlorine",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:35.45},{label:"Ar",period:3,group:8,color:"#80d1e3",title:"Argon",state:"gas",origin:"primordial",type:"noble",atomic_mass:39.9481},{label:"K",period:4,group:1,color:"#8f40d4",title:"Potassium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:39.09831},{label:"Ca",period:4,group:2,color:"#3dff00",title:"Calcium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:40.0784},{label:"Sc",period:4,group:3,color:"#e6e6e6",title:"Scandium",state:"solid",origin:"primordial",type:"transition",atomic_mass:44.9559085},{label:"Ti",period:4,group:4,color:"#bfc2c7",title:"Titanium",state:"solid",origin:"primordial",type:"transition",atomic_mass:47.8671},{label:"V",period:4,group:5,color:"#a6a6ab",title:"Vanadium",state:"solid",origin:"primordial",type:"transition",atomic_mass:50.94151},{label:"Cr",period:4,group:6,color:"#8a99c7",title:"Chromium",state:"solid",origin:"primordial",type:"transition",atomic_mass:51.99616},{label:"Mn",period:4,group:7,color:"#9c7ac7",title:"Manganese",state:"solid",origin:"primordial",type:"transition",atomic_mass:54.9380443},{label:"Fe",period:4,group:8,color:"#e06633",title:"Iron",state:"solid",origin:"primordial",type:"transition",atomic_mass:55.8452},{label:"Co",period:4,group:8,color:"#f08fa1",title:"Cobalt",state:"solid",origin:"primordial",type:"transition",atomic_mass:58.9331944},{label:"Ni",period:4,group:8,color:"#4fd14f",title:"Nickel",state:"solid",origin:"primordial",type:"transition",atomic_mass:58.69344},{label:"Cu",period:4,group:1,color:"#c78033",title:"Copper",state:"solid",origin:"primordial",type:"transition",atomic_mass:63.5463},{label:"Zn",period:4,group:2,color:"#7d80b0",title:"Zinc",state:"solid",origin:"primordial",type:"transition",atomic_mass:65.382},{label:"Ga",period:4,group:3,color:"#c28f8f",title:"Gallium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:69.7231},{label:"Ge",period:4,group:4,color:"#668f8f",title:"Germanium",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:72.6308},{label:"As",period:4,group:5,color:"#bd80e3",title:"Arsenic",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:74.9215956},{label:"Se",period:4,group:6,leftH:!0,color:"#ffa100",title:"Selenium",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:78.9718},{label:"Br",period:4,group:7,leftH:!0,color:"#a62929",title:"Bromine",state:"liquid",origin:"primordial",type:"diatomic",atomic_mass:79.904},{label:"Kr",period:4,group:8,color:"#5cb8d1",title:"Krypton",state:"gas",origin:"primordial",type:"noble",atomic_mass:83.7982},{label:"Rb",period:5,group:1,color:"#702eb0",title:"Rubidium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:85.46783},{label:"Sr",period:5,group:2,color:"#00ff00",title:"Strontium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:87.621},{label:"Y",period:5,group:3,color:"#94ffff",title:"Yttrium",state:"solid",origin:"primordial",type:"transition",atomic_mass:88.905842},{label:"Zr",period:5,group:4,color:"#94e0e0",title:"Zirconium",state:"solid",origin:"primordial",type:"transition",atomic_mass:91.2242},{label:"Nb",period:5,group:5,color:"#73c2c9",title:"Niobium",state:"solid",origin:"primordial",type:"transition",atomic_mass:92.906372},{label:"Mo",period:5,group:6,color:"#54b5b5",title:"Molybdenum",state:"solid",origin:"primordial",type:"transition",atomic_mass:95.951},{label:"Tc",period:5,group:7,color:"#3b9e9e",title:"Technetium",state:"solid",origin:"decay",type:"transition",atomic_mass:98},{label:"Ru",period:5,group:8,color:"#248f8f",title:"Ruthenium",state:"solid",origin:"primordial",type:"transition",atomic_mass:101.072},{label:"Rh",period:5,group:8,color:"#0a7d8c",title:"Rhodium",state:"solid",origin:"primordial",type:"transition",atomic_mass:102.905502},{label:"Pd",period:5,group:8,color:"#006985",title:"Palladium",state:"solid",origin:"primordial",type:"transition",atomic_mass:106.421},{label:"Ag",period:5,group:1,color:"#bfbfbf",title:"Silver",state:"solid",origin:"primordial",type:"transition",atomic_mass:107.86822},{label:"Cd",period:5,group:2,color:"#ffd98f",title:"Cadmium",state:"solid",origin:"primordial",type:"transition",atomic_mass:112.4144},{label:"In",period:5,group:3,color:"#a67573",title:"Indium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:114.8181},{label:"Sn",period:5,group:4,color:"#668080",title:"Tin",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:118.7107},{label:"Sb",period:5,group:5,color:"#9e63b5",title:"Antimony",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:121.7601},{label:"Te",period:5,group:6,color:"#d47a00",title:"Tellurium",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:127.603},{label:"I",period:5,group:7,leftH:!0,color:"#940094",title:"Iodine",state:"solid",origin:"primordial",type:"diatomic",atomic_mass:126.904473},{label:"Xe",period:5,group:8,color:"#429eb0",title:"Xenon",state:"gas",origin:"primordial",type:"noble",atomic_mass:131.2936},{label:"Cs",period:6,group:1,color:"#57178f",title:"Caesium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:132.905451966},{label:"Ba",period:6,group:2,color:"#00c900",title:"Barium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:137.3277},{label:"La",period:6,group:3,color:"#70d4ff",title:"Lanthanum",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:138.905477},{label:"Ce",period:6,group:3,color:"#ffffc7",title:"Cerium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:140.1161},{label:"Pr",period:6,group:3,color:"#d9ffc7",title:"Praseodymium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:140.907662},{label:"Nd",period:6,group:3,color:"#c7ffc7",title:"Neodymium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:144.2423},{label:"Pm",period:6,group:3,color:"#a3ffc7",title:"Promethium",state:"solid",origin:"decay",type:"lanthanide",atomic_mass:145},{label:"Sm",period:6,group:3,color:"#8fffc7",title:"Samarium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:150.362},{label:"Eu",period:6,group:3,color:"#61ffc7",title:"Europium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:151.9641},{label:"Gd",period:6,group:3,color:"#45ffc7",title:"Gadolinium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:157.253},{label:"Tb",period:6,group:3,color:"#30ffc7",title:"Terbium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:158.925352},{label:"Dy",period:6,group:3,color:"#1fffc7",title:"Dysprosium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:162.5001},{label:"Ho",period:6,group:3,color:"#00ff9c",title:"Holmium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:164.930332},{label:"Er",period:6,group:3,color:"#00e675",title:"Erbium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:167.2593},{label:"Tm",period:6,group:3,color:"#00d452",title:"Thulium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:168.934222},{label:"Yb",period:6,group:3,color:"#00bf38",title:"Ytterbium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:173.0451},{label:"Lu",period:6,group:3,color:"#00ab24",title:"Lutetium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:174.96681},{label:"Hf",period:6,group:4,color:"#4dc2ff",title:"Hafnium",state:"solid",origin:"primordial",type:"transition",atomic_mass:178.492},{label:"Ta",period:6,group:5,color:"#4da6ff",title:"Tantalum",state:"solid",origin:"primordial",type:"transition",atomic_mass:180.947882},{label:"W",period:6,group:6,color:"#2194d6",title:"Tungsten",state:"solid",origin:"primordial",type:"transition",atomic_mass:183.841},{label:"Re",period:6,group:7,color:"#267dab",title:"Rhenium",state:"solid",origin:"primordial",type:"transition",atomic_mass:186.2071},{label:"Os",period:6,group:8,color:"#266696",title:"Osmium",state:"solid",origin:"primordial",type:"transition",atomic_mass:190.233},{label:"Ir",period:6,group:8,color:"#175487",title:"Iridium",state:"solid",origin:"primordial",type:"transition",atomic_mass:192.2173},{label:"Pt",period:6,group:8,color:"#d1d1e0",title:"Platinum",state:"solid",origin:"primordial",type:"transition",atomic_mass:195.0849},{label:"Au",period:6,group:1,color:"#ffd124",title:"Gold",state:"solid",origin:"primordial",type:"transition",atomic_mass:196.9665695},{label:"Hg",period:6,group:2,color:"#b8b8d1",title:"Mercury",state:"liquid",origin:"primordial",type:"transition",atomic_mass:200.5923},{label:"Tl",period:6,group:3,color:"#a6544d",title:"Thallium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:204.38},{label:"Pb",period:6,group:4,color:"#575961",title:"Lead",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:207.21},{label:"Bi",period:6,group:5,color:"#9e4fb5",title:"Bismuth",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:208.980401},{label:"Po",period:6,group:6,color:"#ab5c00",title:"Polonium",state:"solid",origin:"decay",type:"post-transition",atomic_mass:209},{label:"At",period:6,group:7,color:"#754f45",title:"Astatine",state:"solid",origin:"decay",type:"metalloid",atomic_mass:210},{label:"Rn",period:6,group:8,color:"#428296",title:"Radon",state:"gas",origin:"decay",type:"noble",atomic_mass:222},{label:"Fr",period:7,group:1,color:"#420066",title:"Francium",state:"solid",origin:"decay",type:"alkali",atomic_mass:223},{label:"Ra",period:7,group:2,color:"#007d00",title:"Radium",state:"solid",origin:"decay",type:"alkaline-earth",atomic_mass:226},{label:"Ac",period:7,group:3,color:"#70abfa",title:"Actinium",state:"solid",origin:"decay",type:"actinide",atomic_mass:227},{label:"Th",period:7,group:3,color:"#00baff",title:"Thorium",state:"solid",origin:"primordial",type:"actinide",atomic_mass:232.03774},{label:"Pa",period:7,group:3,color:"#00a1ff",title:"Protactinium",state:"solid",origin:"decay",type:"actinide",atomic_mass:231.035882},{label:"U",period:7,group:3,color:"#008fff",title:"Uranium",state:"solid",origin:"primordial",type:"actinide",atomic_mass:238.028913},{label:"Np",period:7,group:3,color:"#0080ff",title:"Neptunium",state:"solid",origin:"decay",type:"actinide",atomic_mass:237},{label:"Pu",period:7,group:3,color:"#006bff",title:"Plutonium",state:"solid",origin:"decay",type:"actinide",atomic_mass:244},{label:"Am",period:7,group:3,color:"#545cf2",title:"Americium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:243},{label:"Cm",period:7,group:3,color:"#785ce3",title:"Curium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:247},{label:"Bk",period:7,group:3,color:"#8a4fe3",title:"Berkelium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:247},{label:"Cf",period:7,group:3,color:"#a136d4",title:"Californium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:251},{label:"Es",period:7,group:3,color:"#b31fd4",title:"Einsteinium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:252},{label:"Fm",period:7,group:3,title:"Fermium",origin:"synthetic",type:"actinide",atomic_mass:257},{label:"Md",period:7,group:3,title:"Mendelevium",origin:"synthetic",type:"actinide",atomic_mass:258},{label:"No",period:7,group:3,title:"Nobelium",origin:"synthetic",type:"actinide",atomic_mass:259},{label:"Lr",period:7,group:3,title:"Lawrencium",origin:"synthetic",type:"actinide",atomic_mass:266},{label:"Rf",period:7,group:4,color:"#4dc2ff",title:"Rutherfordium",origin:"synthetic",type:"transition",atomic_mass:267},{label:"Db",period:7,group:5,color:"#4da6ff",title:"Dubnium",origin:"synthetic",type:"transition",atomic_mass:268},{label:"Sg",period:7,group:6,color:"#2194d6",title:"Seaborgium",origin:"synthetic",type:"transition",atomic_mass:269},{label:"Bh",period:7,group:7,color:"#267dab",title:"Bohrium",origin:"synthetic",type:"transition",atomic_mass:270},{label:"Hs",period:7,group:8,color:"#266696",title:"Hassium",origin:"synthetic",type:"transition",atomic_mass:269},{label:"Mt",period:7,group:8,color:"#175487",title:"Meitnerium",origin:"synthetic",atomic_mass:278},{label:"Ds",period:7,group:8,color:"#d1d1e0",title:"Darmstadtium",origin:"synthetic",atomic_mass:281},{label:"Rg",period:7,group:1,color:"#ffd124",title:"Roentgenium",origin:"synthetic",atomic_mass:282},{label:"Cn",period:7,group:2,color:"#b8b8d1",title:"Copernicium",origin:"synthetic",type:"transition",atomic_mass:285},{label:"Nh",period:7,group:3,title:"Nihonium",origin:"synthetic",atomic_mass:286},{label:"Fl",period:7,group:4,title:"Flerovium",origin:"synthetic",type:"post-transition",atomic_mass:289},{label:"Mc",period:7,group:5,title:"Moscovium",origin:"synthetic",atomic_mass:289},{label:"Lv",period:7,group:6,title:"Livermorium",origin:"synthetic",atomic_mass:293},{label:"Ts",period:7,group:7,title:"Tennessine",origin:"synthetic",atomic_mass:294},{label:"Og",period:7,group:8,title:"Oganesson",origin:"synthetic",atomic_mass:294}];r.map=r.reduce(function(t,e,n){return e&&(t[e.label]=n),t},{}),e.exports=r},{}],61:[function(t,e,n){function r(t,e,n){return Object.keys(t).reduce(function(n,o){return"labels"==o?t.labels.reduce(function(t,n){return t[n]=e||!0,t},n):r(t[o],e?e.concat(o):[o],n)},n||{})}function o(t,e){return e.reduce(function(t,e){return t&&t[e]||null},t)}var i={atom:{any:{labels:["A","AH"]},"no-carbon":{labels:["Q","QH"]},metal:{labels:["M","MH"]},halogen:{labels:["X","XH"]}},group:{labels:["G","GH","G*","GH*"],acyclic:{labels:["ACY","ACH"],carbo:{labels:["ABC","ABH"],alkynyl:{labels:["AYL","AYH"]},alkyl:{labels:["ALK","ALH"]},alkenyl:{labels:["AEL","AEH"]}},hetero:{labels:["AHC","AHH"],alkoxy:{labels:["AOX","AOH"]}}},cyclic:{labels:["CYC","CYH"],"no-carbon":{labels:["CXX","CXH"]},carbo:{labels:["CBC","CBH"],aryl:{labels:["ARY","ARH"]},cycloalkyl:{labels:["CAL","CAH"]},cycloalkenyl:{labels:["CEL","CEH"]}},hetero:{labels:["CHC","CHH"],aryl:{labels:["HAR","HAH"]}}}},special:{labels:["H+","D","T","R","Pol"]}};i.map=r(i),i.map["*"]=i.map.A,i.get=function(t){return r(o(t))},e.exports=i},{}],62:[function(t,e,n){function r(t){if(0==t[0].search("\\$MDL"))return w.parseRg2000(t);var e=o(t.slice(3));return e.name=t[0].trim(),e}function o(t){var e=y(t[0],S.fmtInfo.countsLinePartition),n=e[11].trim();if(t=t.slice(1),"V2000"==n)return w.parseCTabV2000(t,e);if("V3000"==n)return x.parseCTabV3000(t,!T);throw new Error("Molfile version unknown: "+n)}function i(t){var e=t[0].trim().split(" ");return e.length>1&&"V3000"==e[1]?x.parseRxn3000(t):w.parseRxn2000(t)}function a(t,e){var n=[];if(e.bonds.each(function(r,o){var i=e.atoms.get(o.begin),a=e.atoms.get(o.end);(v.contains(i.sgs,t.id)&&!v.contains(a.sgs,t.id)||v.contains(a.sgs,t.id)&&!v.contains(i.sgs,t.id))&&n.push(r)},t),0!=n.length&&2!=n.length)throw{id:t.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};t.bonds=n}function s(t,e){var n=[];e.bonds.each(function(r,o){var i=e.atoms.get(o.begin),a=e.atoms.get(o.end);(v.contains(i.sgs,t.id)&&!v.contains(a.sgs,t.id)||v.contains(a.sgs,t.id)&&!v.contains(i.sgs,t.id))&&n.push(r)},t),t.bonds=n}function l(t,e){}function u(t,e){t.atoms=O.SGroup.getAtoms(e,t)}function c(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];a=a.concat(m("SAL",i,Object.keys(t.atomSet),r)),a=a.concat(m("SPA",i,Object.keys(t.parentAtomSet),r)),a=a.concat(m("SBL",i,t.bonds,o));var s="M  SMT "+i+" "+t.data.mul;return a.push(s),a=a.concat(g(e,t,i)),a.join("\n")}function p(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];return a=a.concat(m("SAL",i,t.atoms,r)),a=a.concat(m("SBL",i,t.bonds,o)),a=a.concat(g(e,t,i)),a.join("\n")}function d(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];return a=a.concat(m("SAL",i,t.atoms,r)),a=a.concat(m("SBL",i,t.bonds,o)),t.data.name&&""!=t.data.name&&a.push("M  SMT "+i+" "+t.data.name),a.join("\n")}function f(t,e,n,r){var o=(n[t.id]+"").padStart(3),i=t.data,a=t.pp;i.absolute||(a=a.sub(O.SGroup.getMassCentre(e,t.atoms)));var s=[];s=s.concat(m("SAL",o,t.atoms,r));var l="M  SDT "+o+" "+(i.fieldName||"").padEnd(30)+(i.fieldType||"").padStart(2)+(i.units||"").padEnd(20)+(i.query||"").padStart(2);i.queryOp&&(l+=i.queryOp.padEnd(15)),s.push(l);var u="M  SDD "+o+" "+S.paddedNum(a.x,10,4)+S.paddedNum(-a.y,10,4)+"    "+(i.attached?"A":"D")+(i.absolute?"A":"R")+(i.showUnits?"U":" ")+"   "+(i.nCharnCharsToDisplay>=0?S.paddedNum(i.nCharnCharsToDisplay,3):"ALL")+"  1   "+(i.tagChar||" ")+"  "+S.paddedNum(i.daspPos,1)+"  ";s.push(u);var c=b(i.fieldValue).replace(/\n*$/,"");return c.split("\n").each(function(t){for(;t.length>69;)s.push("M  SCD "+o+" "+t.slice(0,69)),t=t.slice(69);s.push("M  SED "+o+" "+t)}),s.join("\n")}function h(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];return a=a.concat(m("SAL",i,t.atoms,r)),a=a.concat(m("SBL",i,t.bonds,o)),a=a.concat(g(e,t,i)),a.join("\n")}function m(t,e,n,r){if(!n)return[];for(var o=[],i=0;i<Math.floor((n.length+14)/15);++i){for(var a=Math.min(n.length-15*i,15),s="M  "+t+" "+e+" "+S.paddedNum(a,2),l=0;l<a;++l)s+=" "+S.paddedNum(r[n[15*i+l]],3);o.push(s)}return o}function g(t,e,n){var r=[],o=[],i=v.fromList(e.atoms);O.SGroup.getCrossBonds(r,o,t,i),O.SGroup.bracketPos(e,t,o);for(var a=e.bracketBox,s=e.bracketDir,l=s.rotateSC(1,0),u=O.SGroup.getBracketParameters(t,o,i,a,s,l),c=[],p=0;p<u.length;++p){for(var d=u[p],f=d.c.addScaled(d.n,-.5*d.h).yComplement(),h=d.c.addScaled(d.n,.5*d.h).yComplement(),m="M  SDI "+n+S.paddedNum(4,3),g=[f.x,f.y,h.x,h.y],b=0;b<g.length;++b)m+=S.paddedNum(g[b],10,4);c.push(m)}return c}function b(t){return t.replace(P,"\n")}function y(t,e,n){for(var r=[],o=0,i=0;o<e.length;++o)r.push(t.slice(i,i+e[o])),n&&i++,i+=e[o];return r}var v=t("../../util/set"),w=t("./v2000"),x=t("./v3000"),O=t("./../struct/index"),S=t("./utils"),T=!0,E={MUL:O.SGroup.prepareMulForSaving,SRU:a,SUP:s,DAT:u,GEN:l},A={MUL:c,SRU:p,SUP:d,DAT:f,GEN:h},P=/\r\n|[\n\r]/g;e.exports={parseCTab:o,parseMol:r,parseRxn:i,prepareForSaving:E,saveToMolfile:A}},{"../../util/set":199,"./../struct/index":77,"./utils":66,"./v2000":67,"./v3000":68}],63:[function(t,e,n){function r(t,e){var n=new o,r=t.split(/\r\n|[\n\r]/g);try{return n.parseCTFile(r)}catch(t){if(e.badHeaderRecover){try{return n.parseCTFile(r.slice(1))}catch(t){}try{return n.parseCTFile([""].concat(r))}catch(t){}}throw t}}var o=t("./molfile");e.exports={stringify:function(t,e){var n=e||{};return new o(n.v3000).saveMolecule(t,n.ignoreErrors,n.noRgroups,n.preserveIndigoDesc)},parse:function(t,e){return r(t,e||{})}}},{"./molfile":64}],64:[function(t,e,n){function r(t){this.molecule=null,this.molfile=null,this.v3000=t||!1}var o=t("./../element"),i=t("./common"),a=t("./utils");r.prototype.parseCTFile=function(t){var e=null;return e=0==t[0].search("\\$RXN")?i.parseRxn(t):i.parseMol(t),e.initHalfBonds(),e.initNeighbors(),e.markFragments(),e},r.prototype.prepareSGroups=function(t,e){var n=this.molecule,r=[],o=0;if(this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach(function(a){var s=n.sgroups.get(a),l=!1;try{i.prepareForSaving[s.type](s,n)}catch(e){if(!t||"number"!=typeof e.id)throw e;l=!0}(l||!e&&/^INDIGO_.+_DESC$/i.test(s.data.fieldName))&&(o+=l,r.push(s.id))},this),o)throw new Error("WARNING: "+o+" invalid S-groups were detected. They will be omitted.");for(var a=0;a<r.length;++a)n.sGroupDelete(r[a]);return n},r.prototype.getCTab=function(t,e){return this.molecule=t.clone(),this.molfile="",this.writeCTab2000(e),this.molfile},r.prototype.saveMolecule=function(t,e,n,o){if(this.reaction=t.rxnArrows.count()>0,t.rxnArrows.count()>1)throw new Error("Reaction may not contain more than one arrow");if(this.molfile=""+t.name,this.reaction){if(t.rgroups.count()>0)throw new Error("Unable to save the structure - reactions with r-groups are not supported at the moment");var i=t.getComponents(),s=i.reactants,l=i.products,u=s.concat(l);this.molfile="$RXN\n\n\n\n"+a.paddedNum(s.length,3)+a.paddedNum(l.length,3)+a.paddedNum(0,3)+"\n";for(var c=0;c<u.length;++c){var p=new r(!1),d=t.clone(u[c],null,!0),f=p.saveMolecule(d,!1,!0);this.molfile+="$MOL\n"+f}return this.molfile}if(t.rgroups.count()>0){if(!n){var h=new r(!1).getCTab(t.getScaffold(),t.rgroups);return this.molfile="$MDL  REV  1\n$MOL\n$HDR\n\n\n\n$END HDR\n",this.molfile+="$CTAB\n"+h+"$END CTAB\n",t.rgroups.each(function(e,n){this.molfile+="$RGP\n",this.writePaddedNumber(e,3),this.molfile+="\n",n.frags.each(function(e,n){var o=new r(!1).getCTab(t.getFragment(n));this.molfile+="$CTAB\n"+o+"$END CTAB\n"},this),this.molfile+="$END RGP\n"},this),this.molfile+="$END MOL\n",this.molfile}t=t.getScaffold()}return this.molecule=t.clone(),this.prepareSGroups(e,o),this.writeHeader(),this.writeCTab2000(),this.molfile},r.prototype.writeHeader=function(){var t=new Date;this.writeCR(),this.writeWhiteSpace(2),this.write("Ketcher"),this.writeWhiteSpace(),this.writeCR((t.getMonth()+1+"").padStart(2)+(t.getDate()+"").padStart(2)+(t.getFullYear()%100+"").padStart(2)+(t.getHours()+"").padStart(2)+(t.getMinutes()+"").padStart(2)+"2D 1   1.00000     0.00000     0"),this.writeCR()},r.prototype.write=function(t){this.molfile+=t},r.prototype.writeCR=function(t){0==arguments.length&&(t=""),this.molfile+=t+"\n"},r.prototype.writeWhiteSpace=function(t){0==arguments.length&&(t=1),this.write(" ".repeat(Math.max(t,0)))},r.prototype.writePadded=function(t,e){this.write(t),this.writeWhiteSpace(e-t.length)},r.prototype.writePaddedNumber=function(t,e){var n=(t-0).toString();this.writeWhiteSpace(e-n.length),this.write(n)},r.prototype.writePaddedFloat=function(t,e,n){this.write(a.paddedNum(t,e,n))},r.prototype.writeCTab2000Header=function(){this.writePaddedNumber(this.molecule.atoms.count(),3),this.writePaddedNumber(this.molecule.bonds.count(),3),this.writePaddedNumber(0,3),this.writeWhiteSpace(3),this.writePaddedNumber(this.molecule.isChiral?1:0,3),this.writePaddedNumber(0,3),this.writeWhiteSpace(12),this.writePaddedNumber(999,3),this.writeCR(" V2000")},r.prototype.writeCTab2000=function(t){function e(t,e){for(;e.length>0;){for(var n=[];e.length>0&&n.length<8;)n.push(e[0]),e.splice(0,1);this.write(t),this.writePaddedNumber(n.length,3),n.each(function(t){this.writeWhiteSpace(),this.writePaddedNumber(this.mapping[t[0]],3),this.writeWhiteSpace(),this.writePaddedNumber(t[1],3)},this),this.writeCR()}}this.writeCTab2000Header(),this.mapping={};var n=1,r=[],s=[];for(this.molecule.atoms.each(function(t,e){this.writePaddedFloat(e.pp.x,10,4),this.writePaddedFloat(-e.pp.y,10,4),this.writePaddedFloat(e.pp.z,10,4),this.writeWhiteSpace();var i=e.label;null!=e.atomList?(i="L",r.push(t)):e.pseudo?e.pseudo.length>3&&(i="A",s.push({id:t,value:"'"+e.pseudo+"'"})):e.alias?s.push({id:t,value:e.alias}):o.map[i]||-1!=["A","Q","X","*","R#"].indexOf(i)||(i="C",s.push({id:t,value:e.label})),this.writePadded(i,3),this.writePaddedNumber(0,2),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),void 0===e.hCount&&(e.hCount=0),this.writePaddedNumber(e.hCount,3),void 0===e.stereoCare&&(e.stereoCare=0),this.writePaddedNumber(e.stereoCare,3),this.writePaddedNumber(e.explicitValence<0?0:0==e.explicitValence?15:e.explicitValence,3),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),void 0===e.aam&&(e.aam=0),this.writePaddedNumber(e.aam,3),void 0===e.invRet&&(e.invRet=0),this.writePaddedNumber(e.invRet,3),void 0===e.exactChangeFlag&&(e.exactChangeFlag=0),this.writePaddedNumber(e.exactChangeFlag,3),this.writeCR(),this.mapping[t]=n,n++},this),this.bondMapping={},n=1,this.molecule.bonds.each(function(t,e){this.bondMapping[t]=n++,this.writePaddedNumber(this.mapping[e.begin],3),this.writePaddedNumber(this.mapping[e.end],3),this.writePaddedNumber(e.type,3),void 0===e.stereo&&(e.stereo=0),this.writePaddedNumber(e.stereo,3),this.writePadded(e.xxx,3),void 0===e.topology&&(e.topology=0),this.writePaddedNumber(e.topology,3),void 0===e.reactingCenterStatus&&(e.reactingCenterStatus=0),this.writePaddedNumber(e.reactingCenterStatus,3),this.writeCR()},this);s.length>0;)this.write("A  "),this.writePaddedNumber(s[0].id+1,3),this.writeCR(),this.writeCR(s[0].value),s.splice(0,1);var l=[],u=[],c=[],p=[],d=[],f=[],h=[],m=[],g=[];this.molecule.atoms.each(function(t,e){if(0!=e.charge&&l.push([t,e.charge]),0!=e.isotope&&u.push([t,e.isotope]),0!=e.radical&&c.push([t,e.radical]),null!=e.rglabel&&"R#"==e.label)for(var n=0;n<32;n++)e.rglabel&1<<n&&p.push([t,n+1]);null!=e.attpnt&&f.push([t,e.attpnt]),0!=e.ringBondCount&&h.push([t,e.ringBondCount]),0!=e.substitutionCount&&g.push([t,e.substitutionCount]),0!=e.unsaturatedAtom&&m.push([t,e.unsaturatedAtom])}),t&&t.each(function(t,e){if(e.resth||e.ifthen>0||e.range.length>0){var n="  1 "+a.paddedNum(t,3)+" "+a.paddedNum(e.ifthen,3)+" "+a.paddedNum(e.resth?1:0,3)+"   "+e.range;d.push(n)}}),e.call(this,"M  CHG",l),e.call(this,"M  ISO",u),e.call(this,"M  RAD",c),e.call(this,"M  RGP",p);for(var b=0;b<d.length;++b)this.write("M  LOG"+d[b]+"\n");if(e.call(this,"M  APO",f),e.call(this,"M  RBC",h),e.call(this,"M  SUB",g),e.call(this,"M  UNS",m),r.length>0)for(b=0;b<r.length;++b){var y=r[b],v=this.molecule.atoms.get(y).atomList;this.write("M  ALS"),this.writePaddedNumber(y+1,4),this.writePaddedNumber(v.ids.length,3),this.writeWhiteSpace(),this.write(v.notList?"T":"F");for(var w=v.labelList(),x=0;x<w.length;++x)this.writeWhiteSpace(),this.writePadded(w[x],3);this.writeCR()}var O={},S=1,T={};this.molecule.sGroupForest.getSGroupsBFS().forEach(function(t){T[S]=t,O[t]=S++},this);for(var E=1;E<S;++E){var A=T[E],P=this.molecule.sgroups.get(A);this.write("M  STY"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(E,3),this.writeWhiteSpace(1),this.writePadded(P.type,3),this.writeCR(),this.write("M  SLB"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(E,3),this.writeWhiteSpace(1),this.writePaddedNumber(E,3),this.writeCR();var C=this.molecule.sGroupForest.parent.get(A);if(C>=0&&(this.write("M  SPL"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(E,3),this.writeWhiteSpace(1),this.writePaddedNumber(O[C],3),this.writeCR()),"SRU"==P.type&&P.data.connectivity){var j="";j+=" ",j+=E.toString().padStart(3),j+=" ",j+=(P.data.connectivity||"").padEnd(3),this.write("M  SCN"),this.writePaddedNumber(1,3),this.write(j.toUpperCase()),this.writeCR()}"SRU"==P.type&&(this.write("M  SMT "),this.writePaddedNumber(E,3),this.writeWhiteSpace(),this.write(P.data.subscript||"n"),this.writeCR()),this.writeCR(i.saveToMolfile[P.type](P,this.molecule,O,this.mapping,this.bondMapping))}this.writeCR("M  END")},e.exports=r},{"./../element":60,"./common":62,"./utils":66}],65:[function(t,e,n){function r(t,e){for(var n={},r=P.partitionLineFixed(t,3,!0),o=P.parseDecimalInt(r[0]),i=0;i<o;++i)n[P.parseDecimalInt(r[2*i+1])-1]=e?r[2*i+2].trim():P.parseDecimalInt(r[2*i+2]);return n}function o(t,e){for(var n=[],r=P.partitionLineFixed(t,3,!0),o=P.parseDecimalInt(r[0]),i=0;i<o;++i)n.push([P.parseDecimalInt(r[2*i+1])-1,e?r[2*i+2].trim():P.parseDecimalInt(r[2*i+2])]);return n}function i(t,e,n){t.data.mul=t.data.subscript-0;var r={};t.atoms=A.SGroup.filterAtoms(t.atoms,n),t.patoms=A.SGroup.filterAtoms(t.patoms,n);for(var o=1;o<t.data.mul;++o)for(var i=0;i<t.patoms.length;++i){var a=t.atoms[o*t.patoms.length+i];if(!(a<0)){if(t.patoms[i]<0)throw new Error("parent atom missing");r[a]=t.patoms[i]}}t.patoms=A.SGroup.removeNegative(t.patoms);var s=S(t.patoms),l=[];e.bonds.each(function(t,e){var n=e.begin in r,o=e.end in r;n&&o||n&&e.end in s||o&&e.begin in s?l.push(t):n?e.begin=r[e.begin]:o&&(e.end=r[e.end])},t);for(var u=0;u<l.length;++u)e.bonds.remove(l[u]);for(var c in r)e.atoms.remove(c),n[c]=-1;t.atoms=t.patoms,t.patoms=null}function a(t){t.data.connectivity=(t.data.connectivity||"EU").trim().toLowerCase()}function s(t){t.data.name=(t.data.subscript||"").trim(),t.data.subscript=""}function l(t,e,n){}function u(t,e){t.data.absolute||(t.pp=t.pp.add(A.SGroup.getMassCentre(e,t.atoms)))}function c(t,e,n){var r={MUL:i,SRU:a,SUP:s,DAT:u,GEN:l};e.id=t.sgroups.add(e),r[e.type](e,t,n);for(var o=0;o<e.atoms.length;++o)t.atoms.has(e.atoms[o])&&T.add(t.atoms.get(e.atoms[o]).sgs,e.id);return"DAT"==e.type?t.sGroupForest.insert(e.id,-1,[]):t.sGroupForest.insert(e.id),e.id}function p(t,e){var n=r(e,!0);for(var o in n){var i=n[o];if(!(i in A.SGroup.TYPES))throw new Error("Unsupported S-group type");var a=new A.SGroup(i);a.number=o,t[o]=a}}function d(t,e,n,o,i){var a=r(n,!o);for(var s in a)(i?t[s]:t[s].data)[e]=a[s]}function f(t,e,n,r){var o=P.parseDecimalInt(n.slice(1,4))-1,i=P.parseDecimalInt(n.slice(4,8)),a=O(P.partitionLineFixed(n.slice(8),3,!0));if(a.length!=i)throw new Error("File format invalid");r&&(a=a.map(function(t){return t+r})),t[o][e]=t[o][e].concat(a)}function h(t,e){t.data.fieldName=e}function m(t,e){t.data.query=e}function g(t,e){t.data.queryOp=e}function b(t,e){var n=P.partitionLine(e,[4,31,2,20,2,3],!1),r=P.parseDecimalInt(n[0])-1,o=n[1].trim(),i=n[2].trim(),a=n[3].trim(),s=n[4].trim(),l=n[5].trim(),u=t[r];u.data.fieldType=i,u.data.fieldName=o,u.data.units=a,u.data.query=s,u.data.queryOp=l}function y(t,e){
var n=P.partitionLine(e,[10,10,4,1,1,1,3,3,3,3,2,3,2],!1),r=parseFloat(n[0]),o=parseFloat(n[1]),i="A"==n[3].trim(),a="A"==n[4].trim(),s="U"==n[5].trim(),l=n[7].trim();l="ALL"==l?-1:P.parseDecimalInt(l);var u=n[10].trim(),c=P.parseDecimalInt(n[11].trim());t.pp=new E(r,-o),t.data.attached=i,t.data.absolute=a,t.data.showUnits=s,t.data.nCharsToDisplay=l,t.data.tagChar=u,t.data.daspPos=c}function v(t,e){y(t[P.parseDecimalInt(e.substr(0,4))-1],e.substr(5))}function w(t,e,n){t.data.fieldValue=(t.data.fieldValue||"")+e,n&&(t.data.fieldValue=t.data.fieldValue.trimRight(),t.data.fieldValue.startsWith('"')&&t.data.fieldValue.endsWith('"')&&(t.data.fieldValue=t.data.fieldValue.substr(1,t.data.fieldValue.length-2)))}function x(t,e,n){var r=P.parseDecimalInt(e.substr(0,5))-1,o=e.substr(5);w(t[r],o,n)}function O(t){for(var e=[],n=0;n<t.length;++n)e[n]=P.parseDecimalInt(t[n]);return e}function S(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=t[n];return e}var T=t("../../util/set"),E=t("../../util/vec2"),A=t("./../struct/index"),P=t("./utils");e.exports={readKeyValuePairs:r,readKeyMultiValuePairs:o,loadSGroup:c,initSGroup:p,applySGroupProp:d,applySGroupArrayProp:f,applyDataSGroupName:h,applyDataSGroupQuery:m,applyDataSGroupQueryOp:g,applyDataSGroupDesc:b,applyDataSGroupInfo:y,applyDataSGroupData:w,applyDataSGroupInfoLine:v,applyDataSGroupDataLine:x}},{"../../util/set":199,"../../util/vec2":200,"./../struct/index":77,"./utils":66}],66:[function(t,e,n){function r(t,e,n){var r=t.toFixed(n||0).replace(",",".");if(r.length>e)throw new Error("number does not fit");return r.padStart(e)}function o(t){var e=parseInt(t,10);return isNaN(e)?0:e}function i(t,e,n){for(var r=[],o=0,i=0;o<e.length;++o)r.push(t.slice(i,i+e[o])),n&&i++,i+=e[o];return r}function a(t,e,n){for(var r=[],o=0;o<t.length;o+=e)r.push(t.slice(o,o+e)),n&&o++;return r}function s(t,e,n){function r(t,e,n,r,o){var i=new l(r-n.min.x,o?1-n.min.y:-(n.min.y+n.max.y)/2);return e.atoms.each(function(t,e){e.pp.add_(i)}),e.sgroups.each(function(t,e){e.pp&&e.pp.add_(i)}),n.min.add_(i),n.max.add_(i),e.mergeInto(t),n.max.x-n.min.x}var o,i=new u,a=[],s=[],c=[],h=[],m=[],g=[],b={cnt:0,totalLength:0};for(o=0;o<t.length;++o){var y=t[o],v=y.getBondLengthData();b.cnt+=v.cnt,b.totalLength+=v.totalLength}if(f){var w=1/(0==b.cnt?1:b.totalLength/b.cnt);for(o=0;o<t.length;++o)y=t[o],y.scale(w)}for(o=0;o<t.length;++o){y=t[o];var x=y.getCoordBoundingBoxObj();if(x){var O=o<e?p.REACTANT:o<e+n?p.PRODUCT:p.AGENT;O==p.REACTANT?(a.push(x),h.push(y)):O==p.AGENT?(s.push(x),m.push(y)):O==p.PRODUCT&&(c.push(x),g.push(y)),y.atoms.each(function(t,e){e.rxnFragmentType=O})}}if(d){var S=0;for(o=0;o<h.length;++o)S+=r(i,h[o],a[o],S,!1)+2;for(S+=2,o=0;o<m.length;++o)S+=r(i,m[o],s[o],S,!0)+2;for(S+=2,o=0;o<g.length;++o)S+=r(i,g[o],c[o],S,!1)+2}else{for(o=0;o<h.length;++o)h[o].mergeInto(i);for(o=0;o<m.length;++o)m[o].mergeInto(i);for(o=0;o<g.length;++o)g[o].mergeInto(i)}var T,E,A,P,C=null,j=null;for(o=0;o<a.length-1;++o)T=a[o],E=a[o+1],A=(T.max.x+E.min.x)/2,P=(T.max.y+T.min.y+E.max.y+E.min.y)/4,i.rxnPluses.add(new u.RxnPlus({pp:new l(A,P)}));for(o=0;o<a.length;++o)0==o?(C={},C.max=new l(a[o].max),C.min=new l(a[o].min)):(C.max=l.max(C.max,a[o].max),C.min=l.min(C.min,a[o].min));for(o=0;o<c.length-1;++o)T=c[o],E=c[o+1],A=(T.max.x+E.min.x)/2,P=(T.max.y+T.min.y+E.max.y+E.min.y)/4,i.rxnPluses.add(new u.RxnPlus({pp:new l(A,P)}));for(o=0;o<c.length;++o)0==o?(j={},j.max=new l(c[o].max),j.min=new l(c[o].min)):(j.max=l.max(j.max,c[o].max),j.min=l.min(j.min,c[o].min));if(T=C,E=j,T||E){var _=T?new l(T.max.x,(T.max.y+T.min.y)/2):null,N=E?new l(E.min.x,(E.max.y+E.min.y)/2):null;_||(_=new l(N.x-3,N.y)),N||(N=new l(_.x+3,_.y)),i.rxnArrows.add(new u.RxnArrow({pp:l.lc2(_,.5,N,.5)}))}else i.rxnArrows.add(new u.RxnArrow({pp:new l(0,0)}));return i.isReaction=!0,i}var l=t("../../util/vec2"),u=t("./../struct/index"),c={bondTypeMap:{1:u.Bond.PATTERN.TYPE.SINGLE,2:u.Bond.PATTERN.TYPE.DOUBLE,3:u.Bond.PATTERN.TYPE.TRIPLE,4:u.Bond.PATTERN.TYPE.AROMATIC,5:u.Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE,6:u.Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC,7:u.Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC,8:u.Bond.PATTERN.TYPE.ANY},bondStereoMap:{0:u.Bond.PATTERN.STEREO.NONE,1:u.Bond.PATTERN.STEREO.UP,4:u.Bond.PATTERN.STEREO.EITHER,6:u.Bond.PATTERN.STEREO.DOWN,3:u.Bond.PATTERN.STEREO.CIS_TRANS},v30bondStereoMap:{0:u.Bond.PATTERN.STEREO.NONE,1:u.Bond.PATTERN.STEREO.UP,2:u.Bond.PATTERN.STEREO.EITHER,3:u.Bond.PATTERN.STEREO.DOWN},bondTopologyMap:{0:u.Bond.PATTERN.TOPOLOGY.EITHER,1:u.Bond.PATTERN.TOPOLOGY.RING,2:u.Bond.PATTERN.TOPOLOGY.CHAIN},countsLinePartition:[3,3,3,3,3,3,3,3,3,3,3,6],atomLinePartition:[10,10,10,1,3,2,3,3,3,3,3,3,3,3,3,3,3],bondLinePartition:[3,3,3,3,3,3,3],atomListHeaderPartition:[3,1,1,4,1,1],atomListHeaderLength:11,atomListHeaderItemLength:4,chargeMap:[0,3,2,1,0,-1,-2,-3],valenceMap:[void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,0],implicitHydrogenMap:[void 0,0,1,2,3,4],v30atomPropMap:{CHG:"charge",RAD:"radical",MASS:"isotope",VAL:"explicitValence",HCOUNT:"hCount",INVRET:"invRet",SUBST:"substitutionCount",UNSAT:"unsaturatedAtom",RBCNT:"ringBondCount"},rxnItemsPartition:[3,3,3]},p={NONE:0,REACTANT:1,PRODUCT:2,AGENT:3},d=!1,f=!1;e.exports={fmtInfo:c,paddedNum:r,parseDecimalInt:o,partitionLine:i,partitionLineFixed:a,rxnMerge:s}},{"../../util/vec2":200,"./../struct/index":77}],67:[function(t,e,n){function r(t){var e=w.partitionLine(t,w.fmtInfo.atomLinePartition),n={pp:new m(parseFloat(e[0]),-parseFloat(e[1]),parseFloat(e[2])),label:e[4].trim(),explicitValence:w.fmtInfo.valenceMap[w.parseDecimalInt(e[10])],massDifference:w.parseDecimalInt(e[5]),charge:w.fmtInfo.chargeMap[w.parseDecimalInt(e[6])],hCount:w.parseDecimalInt(w.parseDecimalInt(e[8])),stereoCare:0!=w.parseDecimalInt(e[9]),aam:w.parseDecimalInt(e[14]),invRet:w.parseDecimalInt(e[15]),exactChangeFlag:0!=w.parseDecimalInt(e[16])};return new y.Atom(n)}function o(t){var e=w.partitionLine(t,w.fmtInfo.bondLinePartition),n={begin:w.parseDecimalInt(e[0])-1,end:w.parseDecimalInt(e[1])-1,type:w.fmtInfo.bondTypeMap[w.parseDecimalInt(e[2])],stereo:w.fmtInfo.bondStereoMap[w.parseDecimalInt(e[3])],xxx:e[4],topology:w.fmtInfo.bondTopologyMap[w.parseDecimalInt(e[5])],reactingCenterStatus:w.parseDecimalInt(e[6])};return new y.Bond(n)}function i(t){for(var e=w.partitionLine(t,w.fmtInfo.atomListHeaderPartition),n=w.parseDecimalInt(e[0])-1,r="T"==e[2].trim(),o=w.parseDecimalInt(e[4].trim()),i=t.slice(w.fmtInfo.atomListHeaderLength),a=[],s=w.fmtInfo.atomListHeaderItemLength,l=0;l<o;++l)a[l]=w.parseDecimalInt(i.slice(l*s,(l+1)*s-1));return{aid:n,atomList:new y.AtomList({notList:r,ids:a})}}function a(t,e,n,r,o,i){for(var a=new g;n<r;){var s=e[n];if("A"==s.charAt(0)){var l=e[++n],u=/'.+'/.test(l);u&&!a.get("pseudo")&&a.set("pseudo",new g),u||a.get("alias")||a.set("alias",new g),u&&(l=l.replace(/'/g,"")),a.get(u?"pseudo":"alias").set(w.parseDecimalInt(s.slice(3,6))-1,l)}else if("M"==s.charAt(0)){var c=s.slice(3,6),p=s.slice(6);if("END"==c)break;if("CHG"==c)a.get("charge")||a.set("charge",new g),a.get("charge").update(v.readKeyValuePairs(p));else if("RAD"==c)a.get("radical")||a.set("radical",new g),a.get("radical").update(v.readKeyValuePairs(p));else if("ISO"==c)a.get("isotope")||a.set("isotope",new g),a.get("isotope").update(v.readKeyValuePairs(p));else if("RBC"==c)a.get("ringBondCount")||a.set("ringBondCount",new g),a.get("ringBondCount").update(v.readKeyValuePairs(p));else if("SUB"==c)a.get("substitutionCount")||a.set("substitutionCount",new g),a.get("substitutionCount").update(v.readKeyValuePairs(p));else if("UNS"==c)a.get("unsaturatedAtom")||a.set("unsaturatedAtom",new g),a.get("unsaturatedAtom").update(v.readKeyValuePairs(p));else if("RGP"==c){a.get("rglabel")||a.set("rglabel",new g);for(var d=a.get("rglabel"),f=v.readKeyMultiValuePairs(p),m=0;m<f.length;m++){var b=f[m];d.set(b[0],(d.get(b[0])||0)|1<<b[1]-1)}}else if("LOG"==c){p=p.slice(4);var y=w.parseDecimalInt(p.slice(0,3).trim()),x=w.parseDecimalInt(p.slice(4,7).trim()),O=w.parseDecimalInt(p.slice(8,11).trim()),S=p.slice(12).trim(),T={};x>0&&(T.ifthen=x),T.resth=1==O,T.range=S,i[y]=T}else if("APO"==c)a.get("attpnt")||a.set("attpnt",new g),a.get("attpnt").update(v.readKeyValuePairs(p));else if("ALS"==c){a.get("atomList")||a.set("atomList",new g);var E=h(w.partitionLine(p,[1,3,3,1,1,1]),w.partitionLineFixed(p.slice(10),4,!1));a.get("atomList").update(E),a.get("label")||a.set("label",new g);for(var A in E)a.get("label").set(A,"L#")}else if("STY"==c)v.initSGroup(o,p);else if("SST"==c)v.applySGroupProp(o,"subtype",p);else if("SLB"==c)v.applySGroupProp(o,"label",p,!0);else if("SPL"==c)v.applySGroupProp(o,"parent",p,!0,!0);else if("SCN"==c)v.applySGroupProp(o,"connectivity",p);else if("SAL"==c)v.applySGroupArrayProp(o,"atoms",p,-1);else if("SBL"==c)v.applySGroupArrayProp(o,"bonds",p,-1);else if("SPA"==c)v.applySGroupArrayProp(o,"patoms",p,-1);else if("SMT"==c){var P=w.parseDecimalInt(p.slice(0,4))-1;o[P].data.subscript=p.slice(4).trim()}else"SDT"==c?v.applyDataSGroupDesc(o,p):"SDD"==c?v.applyDataSGroupInfoLine(o,p):"SCD"==c?v.applyDataSGroupDataLine(o,p,!1):"SED"==c&&v.applyDataSGroupDataLine(o,p,!0)}++n}return a}function s(t,e,n){e.each(function(e,r){t.get(e)[n]=r})}function l(t,e){var n,l=new y,u=w.parseDecimalInt(e[0]),c=w.parseDecimalInt(e[1]),p=w.parseDecimalInt(e[2]);l.isChiral=0!=w.parseDecimalInt(e[4]);var d=w.parseDecimalInt(e[5]),f=w.parseDecimalInt(e[10]),h=0,m=t.slice(h,h+u);h+=u;var g=t.slice(h,h+c);h+=c;var b=t.slice(h,h+p);h+=p+d;var x=m.map(r);for(n=0;n<x.length;++n)l.atoms.add(x[n]);var O=g.map(o);for(n=0;n<O.length;++n)l.bonds.add(O[n]);b.map(i).each(function(t){l.atoms.get(t.aid).atomList=t.atomList,l.atoms.get(t.aid).label="L#"});var S={},T={};a(l,t,h,Math.min(t.length,h+f),S,T).each(function(t,e){s(l.atoms,e,t)});var E,A={};for(E in S){var P=S[E];if("DAT"===P.type&&0===P.atoms.length){var C=S[E].parent;if(C>=0){var j=S[C-1];"GEN"===j.type&&(P.atoms=[].slice.call(j.atoms))}}}for(E in S)v.loadSGroup(l,S[E],A);var _=[];for(E in S)y.SGroup.filter(l,S[E],A),0!=S[E].atoms.length||S[E].allAtoms||_.push(E);for(n=0;n<_.length;++n)l.sGroupForest.remove(_[n]),l.sgroups.remove(_[n]);for(var N in T)l.rgroups.set(N,new y.RGroup(T[N]));return l}function u(t){if(t=t.slice(7),"$CTAB"!=t[0].trim())throw new Error("RGFile format invalid");for(var e=1;"$"!=t[e].charAt(0);)e++;if("$END CTAB"!=t[e].trim())throw new Error("RGFile format invalid");var n=t.slice(1,e);t=t.slice(e+1);for(var r={};;){if(0==t.length)throw new Error("Unexpected end of file");var o=t[0].trim();if("$END MOL"==o){t=t.slice(1);break}if("$RGP"!=o)throw new Error("RGFile format invalid");var i=t[1].trim()-0;for(r[i]=[],t=t.slice(2);;){if(0==t.length)throw new Error("Unexpected end of file");if("$END RGP"==(o=t[0].trim())){t=t.slice(1);break}if("$CTAB"!=o)throw new Error("RGFile format invalid");for(e=1;"$"!=t[e].charAt(0);)e++;if("$END CTAB"!=t[e].trim())throw new Error("RGFile format invalid");r[i].push(t.slice(1,e)),t=t.slice(e+1)}}var a=p(n),s={};if(x)for(var l in r){s[l]=[];for(var u=0;u<r[l].length;++u)s[l].push(p(r[l][u]))}return d(a,s)}function c(t){t=t.slice(4);var e=w.partitionLine(t[0],w.fmtInfo.rxnItemsPartition),n=e[0]-0,r=e[1]-0,o=e[2]-0;t=t.slice(1);for(var i=[];t.length>0&&"$MOL"==t[0].substr(0,4);){t=t.slice(1);for(var a=0;a<t.length&&"$MOL"!=t[a].substr(0,4);)a++;var s,l=t.slice(0,a);0==l[0].search("\\$MDL")?s=u(l):(s=p(l.slice(3)),s.name=l[0].trim()),i.push(s),t=t.slice(a)}return w.rxnMerge(i,n,r,o)}function p(t){var e=w.partitionLine(t[0],w.fmtInfo.countsLinePartition);return t=t.slice(1),l(t,e)}function d(t,e){var n=new y;t.mergeInto(n,null,null,!1,!0);for(var r in e)for(var o=0;o<e[r].length;++o){var i=e[r][o];i.rgroups.set(r,new y.RGroup);var a={},s=i.frags.add(a);i.rgroups.get(r).frags.add(s),i.atoms.each(function(t,e){e.fragment=s}),i.mergeInto(n)}return n}function f(t){for(var e=[],n=0;n<t.length;++n)e.push(b.map[t[n].trim()]);return e}function h(t,e){var n=w.parseDecimalInt(t[1])-1,r=w.parseDecimalInt(t[2]),o="T"==t[4].trim(),i=f(e.slice(0,r)),a={};return a[n]=new y.AtomList({notList:o,ids:i}),a}var m=t("../../util/vec2"),g=t("../../util/map"),b=t("./../element"),y=t("./../struct/index"),v=t("./parseSGroup"),w=t("./utils"),x=!0;e.exports={parseCTabV2000:l,parseRg2000:u,parseRxn2000:c}},{"../../util/map":196,"../../util/vec2":200,"./../element":60,"./../struct/index":77,"./parseSGroup":65,"./utils":66}],68:[function(t,e,n){function r(t){var e,n,r,o,i;e=c(t);var a={pp:new b(parseFloat(e[2]),-parseFloat(e[3]),parseFloat(e[4])),aam:e[5].trim()},s=e[1].trim();if('"'==s.charAt(0)&&'"'==s.charAt(s.length-1)&&(s=s.substr(1,s.length-2)),"]"==s.charAt(s.length-1)){s=s.substr(0,s.length-1);var l={};if(l.notList=!1,"NOT ["==s.substr(0,5))l.notList=!0,s=s.substr(5);else{if("["!=s.charAt(0))throw new Error("Error: atom list expected, found '"+s+"'");s=s.substr(1)}l.ids=g(s.split(",")),a.atomList=new v.AtomList(l),a.label="L#"}else a.label=s;for(e.splice(0,6),i=0;i<e.length;++i)if(n=d(e[i],"="),r=n[0],o=n[1],r in x.fmtInfo.v30atomPropMap){var u=x.parseDecimalInt(o);if("VAL"==r){if(0==u)continue;-1==u&&(u=0)}a[x.fmtInfo.v30atomPropMap[r]]=u}else if("RGROUPS"==r){o=o.trim().substr(1,o.length-2);var p=o.split(" ").slice(1);a.rglabel=0;for(var f=0;f<p.length;++f)a.rglabel|=1<<p[f]-1}else"ATTCHPT"==r&&(a.attpnt=o.trim()-0);return new v.Atom(a)}function o(t){var e,n,r,o,i;e=c(t);var a={begin:x.parseDecimalInt(e[2])-1,end:x.parseDecimalInt(e[3])-1,type:x.fmtInfo.bondTypeMap[x.parseDecimalInt(e[1])]};for(e.splice(0,4),i=0;i<e.length;++i)n=d(e[i],"="),r=n[0],o=n[1],"CFG"==r?(a.stereo=x.fmtInfo.v30bondStereoMap[x.parseDecimalInt(o)],a.type==v.Bond.PATTERN.TYPE.DOUBLE&&a.stereo==v.Bond.PATTERN.STEREO.EITHER&&(a.stereo=v.Bond.PATTERN.STEREO.CIS_TRANS)):"TOPO"==r?a.topology=x.fmtInfo.bondTopologyMap[x.parseDecimalInt(o)]:"RXCTR"==r?a.reactingCenterStatus=x.parseDecimalInt(o):"STBOX"==r&&(a.stereoCare=x.parseDecimalInt(o));return new v.Bond(a)}function i(t,e,n){for(n++;"M  V30 END COLLECTION"!=e[n].trim();)n++;return++n}function a(t,e,n,r,o){var i="";for(o++;o<e.length;){if(i=m(e[o++]).trim(),"END SGROUP"==i.trim())return o;for(;"-"==i.charAt(i.length-1);)i=(i.substr(0,i.length-1)+m(e[o++])).trim();var a=f(i),s=a[1],l=new v.SGroup(s);l.number=a[0]-0,l.type=s,l.label=a[2]-0,n[l.number]=l;for(var u={},c=3;c<a.length;++c){var g=d(a[c],"=");if(2!=g.length)throw new Error("A record of form AAA=BBB or AAA=(...) expected, got '"+a[c]+"'");var b=g[0];b in u||(u[b]=[]),u[b].push(g[1])}l.atoms=h(u.ATOMS[0],-1),u.PATOMS&&(l.patoms=h(u.PATOMS[0],-1)),l.bonds=u.BONDS?h(u.BONDS[0],-1):[];var y=u.BRKXYZ;if(l.brkxyz=[],y)for(var x=0;x<y.length;++x)l.brkxyz.push(h(y[x]));u.MULT&&(l.data.subscript=u.MULT[0]-0),u.LABEL&&(l.data.subscript=u.LABEL[0].trim()),u.CONNECT&&(l.data.connectivity=u.CONNECT[0].toLowerCase()),u.FIELDDISP&&w.applyDataSGroupInfo(l,p(u.FIELDDISP[0])),u.FIELDDATA&&w.applyDataSGroupData(l,u.FIELDDATA[0],!0),u.FIELDNAME&&w.applyDataSGroupName(l,u.FIELDNAME[0]),u.QUERYTYPE&&w.applyDataSGroupQuery(l,u.QUERYTYPE[0]),u.QUERYOP&&w.applyDataSGroupQueryOp(l,u.QUERYOP[0]),w.loadSGroup(t,l,r)}throw new Error("S-group declaration incomplete.")}function s(t,e){var n=new v,s=0;if("M  V30 BEGIN CTAB"!=t[s++].trim())throw Error("CTAB V3000 invalid");if("M  V30 COUNTS"!=t[s].slice(0,13))throw Error("CTAB V3000 invalid");var u=t[s].slice(14).split(" ");if(n.isChiral=1==x.parseDecimalInt(u[4]),s++,"M  V30 BEGIN ATOM"==t[s].trim()){s++;for(var c;s<t.length&&"END ATOM"!=(c=m(t[s++]).trim());){for(;"-"==c.charAt(c.length-1);)c=(c.substring(0,c.length-1)+m(t[s++])).trim();n.atoms.add(r(c))}if("M  V30 BEGIN BOND"==t[s].trim())for(s++;s<t.length&&"END BOND"!=(c=m(t[s++]).trim());){for(;"-"==c.charAt(c.length-1);)c=(c.substring(0,c.length-1)+m(t[s++])).trim();n.bonds.add(o(c))}for(var p={},d={};"M  V30 END CTAB"!=t[s].trim();)if("M  V30 BEGIN COLLECTION"==t[s].trim())s=i(n,t,s);else{if("M  V30 BEGIN SGROUP"!=t[s].trim())throw Error("CTAB V3000 invalid");s=a(n,t,p,d,s)}}if("M  V30 END CTAB"!=t[s++].trim())throw Error("CTAB V3000 invalid");return e||l(n,t.slice(s)),n}function l(t,e){for(var n={},r={},o=0;o<e.length&&0==e[o].search("M  V30 BEGIN RGROUP");){var i=e[o++].split(" ").pop();for(n[i]=[],r[i]={};;){var a=e[o].trim();if(0!=a.search("M  V30 RLOGIC")){if("M  V30 BEGIN CTAB"!=a)throw Error("CTAB V3000 invalid");for(var l=0;l<e.length&&"M  V30 END CTAB"!=e[o+l].trim();++l);var u=e.slice(o,o+l+1),c=s(u,!0);if(n[i].push(c),o=o+l+1,"M  V30 END RGROUP"==e[o].trim()){o++;break}}else{a=a.slice(13);var p=a.trim().split(/\s+/g),d=x.parseDecimalInt(p[0]),f=x.parseDecimalInt(p[1]),h=p.slice(2).join(" "),m={};d>0&&(m.ifthen=d),m.resth=1==f,m.range=h,r[i]=m,o++}}}for(var g in n)for(var b=0;b<n[g].length;++b){var y=n[g][b];y.rgroups.set(g,new v.RGroup(r[g]));var w=y.frags.add({});y.rgroups.get(g).frags.add(w),y.atoms.each(function(t,e){e.fragment=w}),y.mergeInto(t)}}function u(t){t=t.slice(4);for(var e=t[0].split(/\s+/g).slice(3),n=e[0]-0,r=e[1]-0,o=e.length>2?e[2]-0:0,i=[],a=[],u=null,c=[],p=0;p<t.length;++p){var d,f=t[p].trim();if(f.startsWith("M  V30 COUNTS"));else{if("M  END"==f)break;if("M  V30 BEGIN PRODUCT"==f)console.assert(null==u,"CTab format invalid"),u=a;else if("M  V30 END PRODUCT"==f)console.assert(u===a,"CTab format invalid"),u=null;else if("M  V30 BEGIN REACTANT"==f)console.assert(null==u,"CTab format invalid"),u=i;else if("M  V30 END REACTANT"==f)console.assert(u===i,"CTab format invalid"),u=null;else if(f.startsWith("M  V30 BEGIN RGROUP"))console.assert(null==u,"CTab format invalid"),d=function(e){for(var n=e;n<t.length;++n)if("M  V30 END RGROUP"==t[n].trim())return n;console.error("CTab format invalid")}(p),c.push(t.slice(p,d+1)),p=d;else{if("M  V30 BEGIN CTAB"!=f)throw new Error("line unrecognized: "+f);d=function(e){for(var n=e;n<t.length;++n)if("M  V30 END CTAB"==t[n].trim())return n;console.error("CTab format invalid")}(p),u.push(t.slice(p,d+1)),p=d}}}var h=[],m=i.concat(a);for(d=0;d<m.length;++d){var g=s(m[d],e);h.push(g)}var b=x.rxnMerge(h,n,r,o);return l(b,function(t){for(var e=[],n=0;n<t.length;++n)e=e.concat(t[n]);return e}(c)),b}function c(t){var e,n,r=[],o=0,i=-1,a=t.toArray(),s=!1;for(n=0;n<t.length;++n)e=a[n],"("==e?o++:")"==e&&o--,'"'==e&&(s=!s),s||" "!=a[n]||0!=o||(n>i+1&&r.push(t.slice(i+1,n)),i=n);return n>i+1&&r.push(t.slice(i+1,n)),i=n,r}function p(t){return'"'===t[0]&&'"'===t[t.length-1]?t.substr(1,t.length-2):t}function d(t,e){var n=t.indexOf(e);return[t.slice(0,n),t.slice(n+1)]}function f(t){for(var e=[],n=0,r=!1,o=0;o<t.length;++o){var i=t.charAt(o);'"'==i?r=!r:r||("("==i?n++:")"==i?n--:" "==i&&0==n&&(e.push(t.slice(0,o)),t=t.slice(o+1).trim(),o=0))}if(0!=n)throw new Error("Brace balance broken. S-group properies invalid!");return t.length>0&&e.push(t.trim()),e}function h(t,e){if(!t)return null;var n=[];t=t.trim(),t=t.substr(1,t.length-2);var r=t.split(" ");e=e||0;for(var o=1;o<r.length;++o)n.push(r[o]-0+e);return n}function m(t){if("M  V30 "!=t.slice(0,7))throw new Error("Prefix invalid");return t.slice(7)}function g(t){for(var e=[],n=0;n<t.length;++n)e.push(y.map[t[n].trim()]);return e}var b=t("../../util/vec2"),y=t("./../element"),v=t("./../struct/index"),w=t("./parseSGroup"),x=t("./utils");e.exports={parseCTabV3000:s,readRGroups3000:l,parseRxn3000:u}},{"../../util/vec2":200,"./../element":60,"./../struct/index":77,"./parseSGroup":65,"./utils":66}],69:[function(t,e,n){function r(t,e){for(var n,r,o=/^[^]+?\$\$\$\$$/gm,a=[];null!==(n=o.exec(t));){r=n[0].replace(/\r/g,""),r=r.trim();var s=r.indexOf("M  END");if(-1!=s){var l={},u=r.substr(s+7).trim().split(/^$\n?/m);l.struct=i.parse(r.substring(0,s+6),e),l.props=u.reduce(function(t,e){var n=e.match(/^> [ \d]*<(\S+)>/);if(n){var r=n[1],o=e.split("\n")[1].trim();t[r]=o}return t},{}),a.push(l)}}return a}function o(t,e){return t.reduce(function(t,n){t+=i.stringify(n.struct,e);for(var r in n.props)t+="> <"+r+">\n",t+=n.props[r]+"\n\n";return t+"$$$$"},"")}var i=t("./molfile");e.exports={stringify:o,parse:r}},{"./molfile":63}],70:[function(t,e,n){function r(t,e,n){this.molecule=t,this.bonds=new i,this.getNeighbors=e,this.context=n}function o(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}var i=t("../../util/map"),a=t("../../util/vec2"),s=t("../struct");r.PARITY={NONE:0,CIS:1,TRANS:2},r.prototype.each=function(t,e){this.bonds.each(t,e)},r.prototype.getParity=function(t){return this.bonds.get(t).parity},r.prototype.getSubstituents=function(t){return this.bonds.get(t).substituents},r.prototype.sameside=function(t,e,n,r){var o=a.diff(t,e),i=new a(-o.y,o.x);if(!i.normalize())return 0;var s=a.diff(n,t),l=a.diff(r,e);if(!s.normalize())return 0;if(!l.normalize())return 0;var u=a.dot(s,i),c=a.dot(l,i);return Math.abs(u)<.001||Math.abs(c)<.001?0:u*c>0?1:-1},r.prototype.samesides=function(t,e,n,r){return this.sameside(this.molecule.atoms.get(t).pp,this.molecule.atoms.get(e).pp,this.molecule.atoms.get(n).pp,this.molecule.atoms.get(r).pp)},r.prototype.sortSubstituents=function(t){var e=this.molecule.atoms.get(t[0]).pureHydrogen(),n=t[1]<0||this.molecule.atoms.get(t[1]).pureHydrogen(),r=this.molecule.atoms.get(t[2]).pureHydrogen(),i=t[3]<0||this.molecule.atoms.get(t[3]).pureHydrogen();return(!e||!n)&&((!r||!i)&&(n?t[1]=-1:e?(t[0]=t[1],t[1]=-1):t[0]>t[1]&&o(t,0,1),i?t[3]=-1:r?(t[2]=t[3],t[3]=-1):t[2]>t[3]&&o(t,2,3),!0))},r.prototype.isGeomStereoBond=function(t,e){var n=this.molecule.bonds.get(t);if(n.type!=s.Bond.PATTERN.TYPE.DOUBLE)return!1;var r=this.molecule.atoms.get(n.begin).label,o=this.molecule.atoms.get(n.end).label;if("C"!=r&&"N"!=r&&"Si"!=r&&"Ge"!=r)return!1;if("C"!=o&&"N"!=o&&"Si"!=o&&"Ge"!=o)return!1;var i=this.getNeighbors.call(this.context,n.begin),a=this.getNeighbors.call(this.context,n.end);if(i.length<2||i.length>3||a.length<2||a.length>3)return!1;e[0]=-1,e[1]=-1,e[2]=-1,e[3]=-1;var l,u;for(l=0;l<i.length;l++)if(u=i[l],u.bid!=t){if(this.molecule.bonds.get(u.bid).type!=s.Bond.PATTERN.TYPE.SINGLE)return!1;-1==e[0]?e[0]=u.aid:e[1]=u.aid}for(l=0;l<a.length;l++)if(u=a[l],u.bid!=t){if(this.molecule.bonds.get(u.bid).type!=s.Bond.PATTERN.TYPE.SINGLE)return!1;-1==e[2]?e[2]=u.aid:e[3]=u.aid}return(-1==e[1]||-1==this.samesides(n.begin,n.end,e[0],e[1]))&&(-1==e[3]||-1==this.samesides(n.begin,n.end,e[2],e[3]))},r.prototype.build=function(t){this.molecule.bonds.each(function(e,n){var o=this.bonds.set(e,{parity:0,substituents:new Array(4)});if((!Object.isArray(t)||!t[e])&&this.isGeomStereoBond(e,o.substituents)&&this.sortSubstituents(o.substituents)){var i=this.samesides(n.begin,n.end,o.substituents[0],o.substituents[2]);1==i?o.parity=r.PARITY.CIS:-1==i&&(o.parity=r.PARITY.TRANS)}},this)},e.exports=r},{"../../util/map":196,"../../util/vec2":200,"../struct":77}],71:[function(t,e,n){function r(t,e,n,o){this.molecule=t,this.atom_data=e,this.components=n,this.nComponentsInReactants=-1,this.nReactants=o,this.vertices=new Array(this.molecule.atoms.count()),this.molecule.atoms.each(function(t){this.vertices[t]=new r.VertexDesc},this),this.edges=new Array(this.molecule.bonds.count()),this.molecule.bonds.each(function(t){this.edges[t]=new r.EdgeDesc},this),this.v_seq=[]}var o=t("../../util/set");r.VertexDesc=function(){this.dfs_state=0,this.parent_vertex=0,this.parent_edge=0,this.branches=0},r.EdgeDesc=function(){this.opening_cycles=0,this.closing_cycle=0},r.SeqElem=function(t,e,n){this.idx=t,this.parent_vertex=e,this.parent_edge=n},r.prototype.walk=function(){for(var t,e,n=[],i=0,a=0;;){if(n.length<1){for(var s=-1,l=function(t){return 0==this.vertices[t].dfs_state&&(s=t,!0)};i<this.components.length&&-1==s;)s=o.find(this.components[i],l,this),null===s&&(s=-1,i++),i==this.nReactants&&(this.nComponentsInReactants=a);if(s<-1&&this.molecule.atoms.find(l,this),-1==s)break;this.vertices[s].parent_vertex=-1,this.vertices[s].parent_edge=-1,n.push(s),a++}var u=n.pop(),c=this.vertices[u].parent_vertex,p=new r.SeqElem(u,c,this.vertices[u].parent_edge);this.v_seq.push(p),this.vertices[u].dfs_state=2;var d=this.atom_data[u];for(t=0;t<d.neighbours.length;t++){var f=d.neighbours[t].aid,h=d.neighbours[t].bid;if(f!=c)if(2==this.vertices[f].dfs_state){for(this.edges[h].closing_cycle=1,e=u;-1!=e&&this.vertices[e].parent_vertex!=f;)e=this.vertices[e].parent_vertex;if(-1==e)throw new Error("cycle unwind error");this.edges[this.vertices[e].parent_edge].opening_cycles++,this.vertices[u].branches++,p=new r.SeqElem(f,u,h),this.v_seq.push(p)}else{if(1==this.vertices[f].dfs_state){if(-1==(e=n.indexOf(f)))throw new Error("internal: removing vertex from stack");n.splice(e,1);var m=this.vertices[f].parent_vertex;m>=0&&this.vertices[m].branches--}this.vertices[u].branches++,this.vertices[f].parent_vertex=u,this.vertices[f].parent_edge=h,this.vertices[f].dfs_state=1,n.push(f)}}}},r.prototype.edgeClosingCycle=function(t){return 0!=this.edges[t].closing_cycle},r.prototype.numBranches=function(t){return this.vertices[t].branches},r.prototype.numOpeningCycles=function(t){return this.edges[t].opening_cycles},r.prototype.toString=function(){var t="";return this.v_seq.each(function(e){t+=e.idx+" -> "}),t+="*"},e.exports=r},{"../../util/set":199}],72:[function(t,e,n){function r(){this.smiles="",this.writtenAtoms=[],this.writtenComponents=0,this.ignore_errors=!1}var o=t("../../util/set"),i=t("../struct"),a=t("./cis_trans"),s=t("./dfs"),l=t("./stereocenters");r._Atom=function(t){this.neighbours=[],this.aromatic=!1,this.lowercase=!1,this.chirality=0,this.branch_cnt=0,this.paren_written=!1,this.h_count=t,this.parent=-1},r.prototype.isBondInRing=function(t){return console.assert(this.inLoop,"Init this.inLoop prior to calling this method"),this.inLoop[t]},r.prototype.saveMolecule=function(t,e){var n,a,u;e||(this.ignore_errors=e),t=t.clone(),t.initHalfBonds(),t.initNeighbors(),t.sortNeighbors(),t.setImplicitHydrogen(),t.sgroups.each(function(e,n){if("MUL"==n.type)try{i.SGroup.prepareMulForSaving(n,t)}catch(t){throw{message:"Bad s-group ("+t.message+")"}}else if(!this.ignore_errors)throw new Error("SMILES data format doesn't support s-groups")},this),this.atoms=new Array(t.atoms.count()),t.atoms.each(function(t,e){this.atoms[t]=new r._Atom(e.implicitH)},this);var c=["B","C","N","O","P","S","Se","As"];t.bonds.each(function(e,n){n.type==i.Bond.PATTERN.TYPE.AROMATIC&&(this.atoms[n.begin].aromatic=!0,-1!=c.indexOf(t.atoms.get(n.begin).label)&&(this.atoms[n.begin].lowercase=!0),this.atoms[n.end].aromatic=!0,-1!=c.indexOf(t.atoms.get(n.end).label)&&(this.atoms[n.end].lowercase=!0)),this.atoms[n.begin].neighbours.push({aid:n.end,bid:e}),this.atoms[n.end].neighbours.push({aid:n.begin,bid:e})},this),this.inLoop=function(){t.prepareLoopStructure();var e=o.empty();t.loops.each(function(n,r){r.hbs.length<=6&&o.mergeIn(e,o.fromList(r.hbs.map(function(e){return t.halfBonds.get(e).bid})))});var n={};return o.each(e,function(t){n[t]=1},this),n}(),this.touchedCistransbonds=0,this.markCisTrans(t);var p=t.getComponents(),d=p.reactants.concat(p.products),f=new s(t,this.atoms,d,p.reactants.length);for(f.walk(),this.atoms.each(function(t){t.neighbours.clear()},this),n=0;n<f.v_seq.length;n++){var h=f.v_seq[n],m=h.idx,g=h.parent_edge,b=h.parent_vertex;if(g>=0){var y=this.atoms[m],v=f.numOpeningCycles(g);for(a=0;a<v;a++)this.atoms[b].neighbours.push({aid:-1,bid:-1});if(f.edgeClosingCycle(g)){for(u=0;u<y.neighbours.length;u++)if(-1==y.neighbours[u].aid){y.neighbours[u].aid=b,y.neighbours[u].bid=g;break}if(u==y.neighbours.length)throw new Error("internal: can not put closing bond to its place")}else y.neighbours.push({aid:b,bid:g}),y.parent=b;this.atoms[b].neighbours.push({aid:m,bid:g})}}try{var w=new l(t,function(t){return this.atoms[t].neighbours},this);w.buildFromBonds(this.ignore_errors),w.each(function(t,e){var n=-1;-1==e.pyramid[3]&&(n=3);var r=new Array(4),o=0,i=this.atoms[t];if(-1!=i.parent)for(u=0;u<4;u++)if(e.pyramid[u]==i.parent){r[o++]=u;break}for(-1!=n&&(r[o++]=n),a=0;a!=i.neighbours.length;a++)if(i.neighbours[a].aid!=i.parent)for(u=0;u<4;u++)if(i.neighbours[a].aid==e.pyramid[u]){if(o>=4)throw new Error("internal: pyramid overflow");r[o++]=u;break}if(4==o)o=r[0],r[0]=r[1],r[1]=r[2],r[2]=r[3],r[3]=o;else if(3!=o)throw new Error("cannot calculate chirality");l.isPyramidMappingRigid(r)?this.atoms[t].chirality=1:this.atoms[t].chirality=2},this)}catch(t){alert("Warning: "+t.message)}var x=[];x.push(0);var O=!0;for(n=0;n<f.v_seq.length;n++){h=f.v_seq[n],m=h.idx,g=h.parent_edge,b=h.parent_vertex;var S=!0;if(b>=0){for(f.numBranches(b)>1&&this.atoms[b].branch_cnt>0&&this.atoms[b].paren_written&&(this.smiles+=")"),v=f.numOpeningCycles(g),a=0;a<v;a++){for(u=1;u<x.length&&-1!=x[u];u++);u==x.length?x.push(b):x[u]=b,this.writeCycleNumber(u)}if(b>=0){var T=f.numBranches(b);if(T>1&&this.atoms[b].branch_cnt<T-1&&(f.edgeClosingCycle(g)?this.atoms[b].paren_written=!1:(this.smiles+="(",this.atoms[b].paren_written=!0)),++this.atoms[b].branch_cnt>T)throw new Error("unexpected branch")}var E=t.bonds.get(g),A=0;if(E.type==i.Bond.PATTERN.TYPE.SINGLE&&(A=this.calcBondDirection(t,g,b)),1==A&&m==E.end||2==A&&m==E.begin?this.smiles+="/":2==A&&m==E.end||1==A&&m==E.begin?this.smiles+="\\":E.type==i.Bond.PATTERN.TYPE.ANY?this.smiles+="~":E.type==i.Bond.PATTERN.TYPE.DOUBLE?this.smiles+="=":E.type==i.Bond.PATTERN.TYPE.TRIPLE?this.smiles+="#":E.type!=i.Bond.PATTERN.TYPE.AROMATIC||this.atoms[E.begin].lowercase&&this.atoms[E.end].lowercase&&this.isBondInRing(g)?E.type==i.Bond.PATTERN.TYPE.SINGLE&&this.atoms[E.begin].aromatic&&this.atoms[E.end].aromatic&&(this.smiles+="-"):this.smiles+=":",f.edgeClosingCycle(g)){for(a=1;a<x.length&&x[a]!=m;a++);if(a==x.length)throw new Error("cycle number not found");this.writeCycleNumber(a),x[a]=-1,S=!1}}else O||(this.smiles+=this.writtenComponents==f.nComponentsInReactants?">>":"."),O=!1,this.writtenComponents++;S&&(this.writeAtom(t,m,this.atoms[m].aromatic,this.atoms[m].lowercase,this.atoms[m].chirality),this.writtenAtoms.push(h.idx))}return this.comma=!1,this.writeRadicals(t),this.comma&&(this.smiles+="|"),this.smiles},r.prototype.writeCycleNumber=function(t){if(t>0&&t<10)this.smiles+=t;else if(t>=10&&t<100)this.smiles+="%"+t;else{if(!(t>=100&&t<1e3))throw new Error("bad cycle number: "+t);this.smiles+="%%"+t}},r.prototype.writeAtom=function(t,e,n,r,o){var i=t.atoms.get(e),a=!1,s=-1,l=0;if("A"==i.label)return void(this.smiles+="*");if("R"==i.label||"R#"==i.label)return void(this.smiles+="[*]");l=i.aam,"C"!=i.label&&"P"!=i.label&&"N"!=i.label&&"S"!=i.label&&"O"!=i.label&&"Cl"!=i.label&&"F"!=i.label&&"Br"!=i.label&&"B"!=i.label&&"I"!=i.label&&(a=!0),(i.explicitValence>=0||0!=i.radical||o>0||n&&"C"!=i.label&&"O"!=i.label||n&&"C"==i.label&&this.atoms[e].neighbours.length<3&&0==this.atoms[e].h_count)&&(s=this.atoms[e].h_count);var u=i.label;if(i.atomList&&!i.atomList.notList?(u=i.atomList.label(),a=!1):i.isPseudo()||i.atomList&&i.atomList.notList?(u="*",a=!0):(o||0!=i.charge||i.isotope>0||s>=0||l>0)&&(a=!0),a&&(-1==s&&(s=this.atoms[e].h_count),this.smiles+="["),i.isotope>0&&(this.smiles+=i.isotope),this.smiles+=r?u.toLowerCase():u,o>0&&(this.smiles+=1==o?"@":"@@",i.implicitH>1))throw new Error(i.implicitH+" implicit H near stereocenter");"H"!=i.label&&(s>1||0==s&&!a?this.smiles+="H"+s:1==s&&(this.smiles+="H")),i.charge>1?this.smiles+="+"+i.charge:i.charge<-1?this.smiles+=i.charge:1==i.charge?this.smiles+="+":-1==i.charge&&(this.smiles+="-"),l>0&&(this.smiles+=":"+l),a&&(this.smiles+="]")},r.prototype.markCisTrans=function(t){this.cis_trans=new a(t,function(t){return this.atoms[t].neighbours},this),this.cis_trans.build(),this.dbonds=new Array(t.bonds.count()),t.bonds.each(function(t){this.dbonds[t]={ctbond_beg:-1,ctbond_end:-1,saved:0}},this),this.cis_trans.each(function(e,n){var r=t.bonds.get(e);if(0!=n.parity&&!this.isBondInRing(e)){var o=this.atoms[r.begin].neighbours,a=this.atoms[r.end].neighbours,s=!0,l=!0;if(o.each(function(n){n.bid!=e&&t.bonds.get(n.bid).type==i.Bond.PATTERN.TYPE.SINGLE&&(s=!1)},this),a.each(function(n){n.bid!=e&&t.bonds.get(n.bid).type==i.Bond.PATTERN.TYPE.SINGLE&&(l=!1)},this),s||l)return;o.each(function(n){n.bid!=e&&(t.bonds.get(n.bid).begin==r.begin?this.dbonds[n.bid].ctbond_beg=e:this.dbonds[n.bid].ctbond_end=e)
},this),a.each(function(n){n.bid!=e&&(t.bonds.get(n.bid).begin==r.end?this.dbonds[n.bid].ctbond_beg=e:this.dbonds[n.bid].ctbond_end=e)},this)}},this)},r.prototype.updateSideBonds=function(t,e){var n=t.bonds.get(e),r=this.cis_trans.getSubstituents(e),o=this.cis_trans.getParity(e),i=[-1,-1,-1,-1];i[0]=t.findBondId(r[0],n.begin),-1!=r[1]&&(i[1]=t.findBondId(r[1],n.begin)),i[2]=t.findBondId(r[2],n.end),-1!=r[3]&&(i[3]=t.findBondId(r[3],n.end));var s=0,l=0,u=0,c=0;if(0!=this.dbonds[i[0]].saved&&(1==this.dbonds[i[0]].saved&&t.bonds.get(i[0]).begin==n.begin||2==this.dbonds[i[0]].saved&&t.bonds.get(i[0]).end==n.begin?s++:l++),-1!=i[1]&&0!=this.dbonds[i[1]].saved&&(2==this.dbonds[i[1]].saved&&t.bonds.get(i[1]).begin==n.begin||1==this.dbonds[i[1]].saved&&t.bonds.get(i[1]).end==n.begin?s++:l++),0!=this.dbonds[i[2]].saved&&(1==this.dbonds[i[2]].saved&&t.bonds.get(i[2]).begin==n.end||2==this.dbonds[i[2]].saved&&t.bonds.get(i[2]).end==n.end?u++:c++),-1!=i[3]&&0!=this.dbonds[i[3]].saved&&(2==this.dbonds[i[3]].saved&&t.bonds.get(i[3]).begin==n.end||1==this.dbonds[i[3]].saved&&t.bonds.get(i[3]).end==n.end?u++:c++),o==a.PARITY.CIS?(s+=u,l+=c):(s+=c,l+=u),s>0&&l>0)throw new Error("incompatible cis-trans configuration");return(0!=s||0!=l)&&(s>0&&(this.dbonds[i[0]].saved=t.bonds.get(i[0]).begin==n.begin?1:2,-1!=i[1]&&(this.dbonds[i[1]].saved=t.bonds.get(i[1]).begin==n.begin?2:1),this.dbonds[i[2]].saved=t.bonds.get(i[2]).begin==n.end==(o==a.PARITY.CIS)?1:2,-1!=i[3]&&(this.dbonds[i[3]].saved=t.bonds.get(i[3]).begin==n.end==(o==a.PARITY.CIS)?2:1)),l>0&&(this.dbonds[i[0]].saved=t.bonds.get(i[0]).begin==n.begin?2:1,-1!=i[1]&&(this.dbonds[i[1]].saved=t.bonds.get(i[1]).begin==n.begin?1:2),this.dbonds[i[2]].saved=t.bonds.get(i[2]).begin==n.end==(o==a.PARITY.CIS)?2:1,-1!=i[3]&&(this.dbonds[i[3]].saved=t.bonds.get(i[3]).begin==n.end==(o==a.PARITY.CIS)?1:2)),!0)},r.prototype.calcBondDirection=function(t,e,n){var r;if(-1==this.dbonds[e].ctbond_beg&&-1==this.dbonds[e].ctbond_end)return 0;if(t.bonds.get(e).type!=i.Bond.PATTERN.TYPE.SINGLE)throw new Error("internal: directed bond type "+t.bonds.get(e).type);for(;;){if(r=0,this.cis_trans.each(function(e,n){0==n.parity||this.isBondInRing(e)||this.updateSideBonds(t,e)&&r++},this),r==this.touchedCistransbonds)break;this.touchedCistransbonds=r}return 0==this.dbonds[e].saved&&(n==t.bonds.get(e).begin?this.dbonds[e].saved=1:this.dbonds[e].saved=2),this.dbonds[e].saved},r.prototype.writeRadicals=function(t){var e,n,r=new Array(this.writtenAtoms.length);for(e=0;e<this.writtenAtoms.length;e++)if(!r[e]){var o=t.atoms.get(this.writtenAtoms[e]).radical;if(0!=o)for(this.comma?this.smiles+=",":(this.smiles+=" |",this.comma=!0),o==i.Atom.PATTERN.RADICAL.SINGLET?this.smiles+="^3:":o==i.Atom.PATTERN.RADICAL.DOUPLET?this.smiles+="^1:":this.smiles+="^4:",this.smiles+=e,n=e+1;n<this.writtenAtoms.length;n++)t.atoms.get(this.writtenAtoms[n]).radical==o&&(r[n]=!0,this.smiles+=","+n)}},e.exports={stringify:function(t,e){var n=e||{};return(new r).saveMolecule(t,n.ignoreErrors)}}},{"../../util/set":199,"../struct":77,"./cis_trans":70,"./dfs":71,"./stereocenters":73}],73:[function(t,e,n){function r(t,e,n){this.molecule=t,this.atoms=new i,this.getNeighbors=e,this.context=n}function o(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}var i=t("../../util/map"),a=t("../../util/set"),s=t("../../util/vec2"),l=t("../struct");r.prototype.each=function(t,e){this.atoms.each(t,e)},r.prototype.buildFromBonds=function(t){var e=this.molecule.atoms,n=this.molecule.bonds,r=a.empty();e.each(function(t){var o=this.getNeighbors.call(this.context,t);if(2!=o.length)return!1;var i=o[0],s=o[1];if([t,i.aid,s.aid].findIndex(function(t){return["C","Si"].indexOf(e.get(t).label)<0},this)>=0)return!1;if([i.bid,s.bid].findIndex(function(t){return n.get(t).type!=l.Bond.PATTERN.TYPE.DOUBLE},this)>=0)return!1;var u=this.getNeighbors.call(this.context,i.aid).filter(function(e){return e.aid!=t}),c=this.getNeighbors.call(this.context,s.aid).filter(function(e){return e.aid!=t});return!(u.length<1||u.length>2||c.length<1||c.length>2)&&(!(u.concat(c).findIndex(function(t){return n.get(t.bid).type!=l.Bond.PATTERN.TYPE.SINGLE},this)>=0)&&(!(u.concat(c).findIndex(function(t){return n.get(t.bid).stereo==l.Bond.PATTERN.STEREO.EITHER},this)>=0)&&(a.add(r,i.aid),void a.add(r,s.aid))))},this),a.size(r)>0&&alert("This structure may contain allenes, which cannot be represented in the SMILES notation. Relevant stereo-information will be discarded."),e.each(function(t){if(!a.contains(r,t)){var e=this.getNeighbors.call(this.context,t),n=!1;e.find(function(e){var r=this.molecule.bonds.get(e.bid);return r.type==l.Bond.PATTERN.TYPE.SINGLE&&r.begin==t&&(r.stereo==l.Bond.PATTERN.STEREO.UP||r.stereo==l.Bond.PATTERN.STEREO.DOWN)&&(n=!0,!0)},this),n&&this.buildOneCenter(t)}},this)},r.allowed_stereocenters=[{elem:"C",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"C",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:4,n_double_bonds:2,implicit_degree:4},{elem:"S",charge:1,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:3,n_double_bonds:1,implicit_degree:3},{elem:"P",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"P",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"P",charge:0,degree:4,n_double_bonds:1,implicit_degree:4}],r.prototype.buildOneCenter=function(t){var e=this.molecule.atoms.get(t),n=this.getNeighbors.call(this.context,t),i=n.length,a=-1,u={group:0,type:0,pyramid:new Array(4)},c=0,p=new Array(4),d=0,f=0;u.pyramid[0]=-1,u.pyramid[1]=-1,u.pyramid[2]=-1,u.pyramid[3]=-1;var h=0;if(i>4)throw new Error("stereocenter with %d bonds are not supported"+i);if(n.each(function(t){var n=this.molecule.atoms.get(t.aid),r=this.molecule.bonds.get(t.bid);if(p[c]={edge_idx:t.bid,nei_idx:t.aid,rank:t.aid,vec:s.diff(n.pp,e.pp).yComplement()},n.pureHydrogen()?(h++,p[c].rank=1e4):"H"==n.label&&(p[c].rank=5e3),!p[c].vec.normalize())throw new Error("zero bond length");if(r.type==l.Bond.PATTERN.TYPE.TRIPLE)throw new Error("non-single bonds not allowed near stereocenter");if(r.type==l.Bond.PATTERN.TYPE.AROMATIC)throw new Error("aromatic bonds not allowed near stereocenter");r.type==l.Bond.PATTERN.TYPE.DOUBLE&&f++,c++},this),r.allowed_stereocenters.find(function(t){return t.elem==e.label&&t.charge==e.charge&&t.degree==i&&t.n_double_bonds==f&&(a=t.implicit_degree,!0)},this),-1==a)throw new Error("unknown stereocenter configuration: "+e.label+", charge "+e.charge+", "+i+" bonds ("+f+" double)");if(4==i&&h>1)throw new Error(h+" hydrogens near stereocenter");if(3==i&&4==a&&h>0)throw new Error("have hydrogen(s) besides implicit hydrogen near stereocenter");if(4==i){p[0].rank>p[1].rank&&o(p,0,1),p[1].rank>p[2].rank&&o(p,1,2),p[2].rank>p[3].rank&&o(p,2,3),p[1].rank>p[2].rank&&o(p,1,2),p[0].rank>p[1].rank&&o(p,0,1),p[1].rank>p[2].rank&&o(p,1,2);var m=-1,g=-1,b=-1,y=-1,v=0;for(c=0;c<4;c++){var w=this.getBondStereo(t,p[c].edge_idx);if(w==l.Bond.PATTERN.STEREO.UP||w==l.Bond.PATTERN.STEREO.DOWN){m=c,v=w;break}}if(-1==m)throw new Error("none of 4 bonds going from stereocenter is stereobond");var x,O;if(-1==g&&(x=r.xyzzy(p[m].vec,p[(m+1)%4].vec,p[(m+2)%4].vec),O=r.xyzzy(p[m].vec,p[(m+1)%4].vec,p[(m+3)%4].vec),x+O!=3&&x+O!=12||(g=(m+1)%4,b=(m+2)%4,y=(m+3)%4)),-1==g&&(x=r.xyzzy(p[m].vec,p[(m+2)%4].vec,p[(m+1)%4].vec),O=r.xyzzy(p[m].vec,p[(m+2)%4].vec,p[(m+3)%4].vec),x+O!=3&&x+O!=12||(g=(m+2)%4,b=(m+1)%4,y=(m+3)%4)),-1==g&&(x=r.xyzzy(p[m].vec,p[(m+3)%4].vec,p[(m+1)%4].vec),O=r.xyzzy(p[m].vec,p[(m+3)%4].vec,p[(m+2)%4].vec),x+O!=3&&x+O!=12||(g=(m+3)%4,b=(m+2)%4,y=(m+1)%4)),-1==g)throw new Error("internal error: can not find opposite bond");if(v==l.Bond.PATTERN.STEREO.UP&&this.getBondStereo(t,p[g].edge_idx)==l.Bond.PATTERN.STEREO.DOWN)throw new Error("stereo types of the opposite bonds mismatch");if(v==l.Bond.PATTERN.STEREO.DOWN&&this.getBondStereo(t,p[g].edge_idx)==l.Bond.PATTERN.STEREO.UP)throw new Error("stereo types of the opposite bonds mismatch");if(v==this.getBondStereo(t,p[b].edge_idx))throw new Error("stereo types of non-opposite bonds match");if(v==this.getBondStereo(t,p[y].edge_idx))throw new Error("stereo types of non-opposite bonds match");d=3==m||3==g?v:v==l.Bond.PATTERN.STEREO.UP?l.Bond.PATTERN.STEREO.DOWN:l.Bond.PATTERN.STEREO.UP,j=r.sign(p[0].vec,p[1].vec,p[2].vec),d==l.Bond.PATTERN.STEREO.UP&&j>0||d==l.Bond.PATTERN.STEREO.DOWN&&j<0?(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[1].nei_idx,u.pyramid[2]=p[2].nei_idx):(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[2].nei_idx,u.pyramid[2]=p[1].nei_idx),u.pyramid[3]=p[3].nei_idx}else if(3==i){p[0].rank>p[1].rank&&o(p,0,1),p[1].rank>p[2].rank&&o(p,1,2),p[0].rank>p[1].rank&&o(p,0,1);var S=this.getBondStereo(t,t[0].edge_idx),T=this.getBondStereo(t,t[1].edge_idx),E=this.getBondStereo(t,t[2].edge_idx),A=0,P=0;if(A+=S==l.Bond.PATTERN.STEREO.UP?1:0,A+=T==l.Bond.PATTERN.STEREO.UP?1:0,A+=E==l.Bond.PATTERN.STEREO.UP?1:0,P+=S==l.Bond.PATTERN.STEREO.DOWN?1:0,P+=T==l.Bond.PATTERN.STEREO.DOWN?1:0,P+=E==l.Bond.PATTERN.STEREO.DOWN?1:0,4==a){if(3==A)throw new Error("all 3 bonds up near stereoatom");if(3==P)throw new Error("all 3 bonds down near stereoatom");if(0==A&&0==P)throw new Error("no up/down bonds near stereoatom -- indefinite case");if(1==A&&1==P)throw new Error("one bond up, one bond down -- indefinite case");if(v=0,2==A)d=l.Bond.PATTERN.STEREO.DOWN;else if(2==P)d=l.Bond.PATTERN.STEREO.UP;else{for(m=-1,b=-1,y=-1,c=0;c<3;c++)if((_=this.getBondStereo(t,p[c].edge_idx))==l.Bond.PATTERN.STEREO.UP||_==l.Bond.PATTERN.STEREO.DOWN){m=c,v=_,b=(c+1)%3,y=(c+2)%3;break}if(-1==m)throw new Error("internal error: can not find up or down bond");var C=r.xyzzy(p[b].vec,p[y].vec,p[m].vec);if(3==C||4==C)throw new Error("degenerate case for 3 bonds near stereoatom");d=1==C?v:v==l.Bond.PATTERN.STEREO.UP?l.Bond.PATTERN.STEREO.DOWN:l.Bond.PATTERN.STEREO.UP}var j=r.sign(p[0].vec,p[1].vec,p[2].vec);d==l.Bond.PATTERN.STEREO.UP&&j>0||d==l.Bond.PATTERN.STEREO.DOWN&&j<0?(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[1].nei_idx,u.pyramid[2]=p[2].nei_idx):(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[2].nei_idx,u.pyramid[2]=p[1].nei_idx),u.pyramid[3]=-1}else{var _;if(P>0&&A>0)throw new Error("one bond up, one bond down -- indefinite case");if(0==P&&0==A)throw new Error("no up-down bonds attached to stereocenter");_=A>0?1:-1,1!=r.xyzzy(p[0].vec,p[1].vec,p[2].vec)&&1!=r.xyzzy(p[0].vec,p[2].vec,p[1].vec)&&1!=r.xyzzy(p[2].vec,p[1].vec,p[0].vec)||(_=-_),j=r.sign(p[0].vec,p[1].vec,p[2].vec),j==_?(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[2].nei_idx,u.pyramid[2]=p[1].nei_idx):(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[1].nei_idx,u.pyramid[2]=p[2].nei_idx),u.pyramid[3]=-1}}this.atoms.set(t,u)},r.prototype.getBondStereo=function(t,e){var n=this.molecule.bonds.get(e);return t!=n.begin?0:n.stereo},r.xyzzy=function(t,e,n){var r=s.cross(t,e),o=s.dot(t,e),i=s.cross(t,n),a=s.dot(t,n);if(Math.abs(r)<.001){if(Math.abs(i)<.001)throw new Error("degenerate case -- bonds overlap");return i>0?4:8}return r*i<-1e-6?2:a<o?2:1},r.sign=function(t,e,n){var r=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x);if(r>.001)return 1;if(r<-.001)return-1;throw new Error("degenerate triangle")},r.isPyramidMappingRigid=function(t){var e=t.clone(),n=!0;return e[0]>e[1]&&(o(e,0,1),n=!n),e[1]>e[2]&&(o(e,1,2),n=!n),e[2]>e[3]&&(o(e,2,3),n=!n),e[1]>e[2]&&(o(e,1,2),n=!n),e[0]>e[1]&&(o(e,0,1),n=!n),e[1]>e[2]&&(o(e,1,2),n=!n),n},e.exports=r},{"../../util/map":196,"../../util/set":199,"../../util/vec2":200,"../struct":77}],74:[function(t,e,n){function r(t){var e=r.attrGetDefault;console.assert(t||"label"in t,"label must be specified!"),this.label=t.label,this.fragment="fragment"in t?t.fragment:-1,this.pseudo=t.pseudo||a(t.label),i(this,t,"alias",e("alias")),i(this,t,"isotope",e("isotope")),i(this,t,"radical",e("radical")),i(this,t,"charge",e("charge")),i(this,t,"rglabel",e("rglabel")),i(this,t,"attpnt",e("attpnt")),i(this,t,"explicitValence",e("explicitValence")),this.valence=0,this.implicitH=0,this.pp=t.pp?new s(t.pp):new s,this.sgs={},i(this,t,"ringBondCount",e("ringBondCount")),i(this,t,"substitutionCount",e("substitutionCount")),i(this,t,"unsaturatedAtom",e("unsaturatedAtom")),i(this,t,"hCount",e("hCount")),i(this,t,"aam",e("aam")),i(this,t,"invRet",e("invRet")),i(this,t,"exactChangeFlag",e("exactChangeFlag")),i(this,t,"rxnFragmentType",-1),this.atomList=t.atomList?new u(t.atomList):null,this.neighbors=[],this.badConn=!1}function o(t){return(t-=0)==r.PATTERN.RADICAL.NONE?0:t==r.PATTERN.RADICAL.DOUPLET?1:t==r.PATTERN.RADICAL.SINGLET||t==r.PATTERN.RADICAL.TRIPLET?2:void console.assert(!1,"Unknown radical value")}function i(t,e,n,r){t[n]=void 0!==e[n]?e[n]:r}function a(t){return l.map[t]||"L"===t||"L#"===t||"R#"===t?null:t}var s=t("../../util/vec2"),l=t("../element"),u=t("./atomlist");r.getAttrHash=function(t){var e={};for(var n in r.attrlist)void 0!==t[n]&&(e[n]=t[n]);return e},r.attrGetDefault=function(t){if(t in r.attrlist)return r.attrlist[t];console.assert(!1,"Attribute unknown")},r.PATTERN={RADICAL:{NONE:0,SINGLET:1,DOUPLET:2,TRIPLET:3}},r.attrlist={alias:null,label:"C",pseudo:null,isotope:0,radical:0,charge:0,explicitValence:-1,ringBondCount:0,substitutionCount:0,unsaturatedAtom:0,hCount:0,atomList:null,invRet:0,exactChangeFlag:0,rglabel:null,attpnt:null,aam:0},r.prototype.clone=function(t){var e=new r(this);return t&&this.fragment in t&&(e.fragment=t[this.fragment]),e},r.prototype.isQuery=function(){return null!=this.atomList||"A"==this.label||this.attpnt||this.hCount},r.prototype.pureHydrogen=function(){return"H"==this.label&&0==this.isotope},r.prototype.isPlainCarbon=function(){return"C"==this.label&&0==this.isotope&&0==this.radical&&0==this.charge&&this.explicitValence<0&&0==this.ringBondCount&&0==this.substitutionCount&&0==this.unsaturatedAtom&&0==this.hCount&&!this.atomList},r.prototype.isPseudo=function(){return!this.atomList&&!this.rglabel&&!l.map[this.label]},r.prototype.hasRxnProps=function(){return!!(this.invRet||this.exactChangeFlag||null!=this.attpnt||this.aam)},r.prototype.calcValence=function(t){var e=this,n=e.charge,r=e.label;if(e.isQuery())return this.implicitH=0,!0;var i=l.map[r];if(null==i)return this.implicitH=0,!0;var a=l[i].group,s=o(e.radical),u=t,c=0,p=Math.abs(n);return 1==a?"H"!=r&&"Li"!=r&&"Na"!=r&&"K"!=r&&"Rb"!=r&&"Cs"!=r&&"Fr"!=r||(u=1,c=1-s-t-p):2==a?t+s+p==2||t+s+p==0?u=2:c=-1:3==a?"B"==r||"Al"==r||"Ga"==r||"In"==r?-1==n?(u=4,c=4-s-t):(u=3,c=3-s-t-p):"Tl"==r&&(-1==n?s+t<=2?(u=2,c=2-s-t):(u=4,c=4-s-t):-2==n?s+t<=3?(u=3,c=3-s-t):(u=5,c=5-s-t):s+t+p<=1?(u=1,c=1-s-t-p):(u=3,c=3-s-t-p)):4==a?"C"==r||"Si"==r||"Ge"==r?(u=4,c=4-s-t-p):"Sn"!=r&&"Pb"!=r||(t+s+p<=2?(u=2,c=2-s-t-p):(u=4,c=4-s-t-p)):5==a?"N"==r||"P"==r?1==n?(u=4,c=4-s-t):2==n?(u=3,c=3-s-t):"N"==r||s+t+p<=3?(u=3,c=3-s-t-p):(u=5,c=5-s-t-p):"Bi"!=r&&"Sb"!=r&&"As"!=r||(1==n?s+t<=2&&"As"!=r?(u=2,c=2-s-t):(u=4,c=4-s-t):2==n?(u=3,c=3-s-t):s+t<=3?(u=3,c=3-s-t-p):(u=5,c=5-s-t-p)):6==a?"O"==r?n>=1?(u=3,c=3-s-t):(u=2,c=2-s-t-p):"S"==r||"Se"==r||"Po"==r?1==n?t<=3?(u=3,c=3-s-t):(u=5,c=5-s-t):t+s+p<=2?(u=2,c=2-s-t-p):t+s+p<=4?(u=4,c=4-s-t-p):(u=6,c=6-s-t-p):"Te"==r&&(-1==n?t<=2&&(u=2,c=2-s-t-p):0!=n&&2!=n||(t<=2?(u=2,c=2-s-t-p):t<=4?(u=4,c=4-s-t-p):0==n&&t<=6?(u=6,c=6-s-t-p):c=-1)):7==a?"F"==r?(u=1,c=1-s-t-p):"Cl"!=r&&"Br"!=r&&"I"!=r&&"At"!=r||(1==n?t<=2?(u=2,c=2-s-t):(3==t||5==t||t>=7)&&(c=-1):0==n&&(t<=1?(u=1,c=1-s-t):2==t||4==t||6==t?1==s?(u=t,c=0):c=-1:t>7&&(c=-1))):8==a&&(t+s+p==0?u=1:c=-1),this.valence=u,this.implicitH=c,!(this.implicitH<0)||(this.valence=t,this.implicitH=0,this.badConn=!0,!1)},r.prototype.calcValenceMinusHyd=function(t){var e=this,n=e.charge,r=e.label,i=l.map[r];if(null==i&&console.assert("Element "+r+" unknown"),i<0)return this.implicitH=0,null;var a=l[i].group,s=o(e.radical);if(3==a){if(("B"==r||"Al"==r||"Ga"==r||"In"==r)&&-1==n&&s+t<=4)return s+t}else if(5==a){if("N"==r||"P"==r){if(1==n)return s+t;if(2==n)return s+t}else if("Sb"==r||"Bi"==r||"As"==r){if(1==n)return s+t;if(2==n)return s+t}}else if(6==a){if("O"==r){if(n>=1)return s+t}else if(("S"==r||"Se"==r||"Po"==r)&&1==n)return s+t}else if(7==a&&("Cl"==r||"Br"==r||"I"==r||"At"==r)&&1==n)return s+t;return s+t+Math.abs(n)},e.exports=r},{"../../util/vec2":200,"../element":60,"./atomlist":75}],75:[function(t,e,n){function r(t){console.assert(t&&"notList"in t&&"ids"in t,"'notList' and 'ids' must be specified!"),this.notList=t.notList,this.ids=t.ids}var o=t("../element");r.prototype.labelList=function(){for(var t=[],e=0;e<this.ids.length;++e)t.push(o[this.ids[e]].label);return t},r.prototype.label=function(){var t="["+this.labelList().join(",")+"]";return this.notList&&(t="!"+t),t},r.prototype.equals=function(t){return this.notList==t.notList&&(this.ids||[]).sort().toString()==(t.ids||[]).sort().toString()},e.exports=r},{"../element":60}],76:[function(t,e,n){function r(t){console.assert(t&&"begin"in t&&"end"in t&&"type"in t,"'begin', 'end' and 'type' properties must be specified!"),this.begin=t.begin,this.end=t.end,this.type=t.type,this.xxx=t.xxx||"",this.stereo=r.PATTERN.STEREO.NONE,this.topology=r.PATTERN.TOPOLOGY.EITHER,this.reactingCenterStatus=0,this.hb1=null,this.hb2=null,this.len=0,this.sb=0,this.sa=0,this.angle=0,t.stereo&&(this.stereo=t.stereo),t.topology&&(this.topology=t.topology),t.reactingCenterStatus&&(this.reactingCenterStatus=t.reactingCenterStatus),this.center=new o}var o=t("../../util/vec2");r.PATTERN={TYPE:{SINGLE:1,DOUBLE:2,TRIPLE:3,AROMATIC:4,SINGLE_OR_DOUBLE:5,SINGLE_OR_AROMATIC:6,DOUBLE_OR_AROMATIC:7,ANY:8},STEREO:{NONE:0,UP:1,EITHER:4,DOWN:6,CIS_TRANS:3},TOPOLOGY:{EITHER:0,RING:1,CHAIN:2},REACTING_CENTER:{NOT_CENTER:-1,UNMARKED:0,CENTER:1,UNCHANGED:2,MADE_OR_BROKEN:4,ORDER_CHANGED:8,MADE_OR_BROKEN_AND_CHANGED:12}},r.attrlist={type:r.PATTERN.TYPE.SINGLE,stereo:r.PATTERN.STEREO.NONE,topology:r.PATTERN.TOPOLOGY.EITHER,reactingCenterStatus:0},r.getAttrHash=function(t){var e={};for(var n in r.attrlist)void 0!==t[n]&&(e[n]=t[n]);return e},r.attrGetDefault=function(t){if(t in r.attrlist)return r.attrlist[t];console.error("Attribute unknown")},r.prototype.hasRxnProps=function(){return!!this.reactingCenterStatus},r.prototype.getCenter=function(t){var e=t.atoms.get(this.begin).pp,n=t.atoms.get(this.end).pp;return o.lc2(e,.5,n,.5)},r.prototype.getDir=function(t){var e=t.atoms.get(this.begin).pp;return t.atoms.get(this.end).pp.sub(e).normalized()},r.prototype.clone=function(t){var e=new r(this);return t&&(e.begin=t[e.begin],e.end=t[e.end]),e},r.prototype.findOtherEnd=function(t){return t==this.begin?this.end:t==this.end?this.begin:void console.error("bond end not found")},e.exports=r},{"../../util/vec2":200}],77:[function(t,e,n){function r(){this.atoms=new c,this.bonds=new c,this.sgroups=new c,this.halfBonds=new u,this.loops=new c,this.isChiral=!1,this.isReaction=!1,this.rxnArrows=new c,this.rxnPluses=new c,this.frags=new c,this.rgroups=new u,this.name="",this.sGroupForest=new v(this)}function o(t,e,n){console.assert(3==arguments.length,"Invalid parameter number!"),this.begin=t-0,this.end=e-0,this.bid=n-0,this.dir=new d,this.norm=new d,this.ang=0,this.p=new d,this.loop=-1,this.contra=-1,this.next=-1,this.leftSin=0,this.leftCos=0,this.leftNeighbor=0,this.rightSin=0,this.rightCos=0,this.rightNeighbor=0}function i(t,e,n){this.hbs=t,this.dblBonds=0,this.aromatic=!0,this.convex=n||!1,t.each(function(t){var n=e.bonds.get(e.halfBonds.get(t).bid);n.type!=g.PATTERN.TYPE.AROMATIC&&(this.aromatic=!1),n.type==g.PATTERN.TYPE.DOUBLE&&this.dblBonds++},this)}function a(t){t=t||{},this.pp=t.pp?new d(t.pp):new d}function s(t){t=t||{},this.pp=t.pp?new d(t.pp):new d}function l(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return!1;return t.push(e),!0}var u=t("../../util/map"),c=t("../../util/pool"),p=t("../../util/set"),d=t("../../util/vec2"),f=t("../element"),h=t("./atom"),m=t("./atomlist"),g=t("./bond"),b=t("./sgroup"),y=t("./rgroup"),v=t("./sgforest");r.prototype.hasRxnProps=function(){return this.atoms.find(function(t,e){return e.hasRxnProps()},this)>=0||this.bonds.find(function(t,e){return e.hasRxnProps()},this)>=0},r.prototype.hasRxnArrow=function(){return this.rxnArrows.count()>0},r.prototype.getSGroupsInAtomSet=function(t){var e={};t.forEach(function(t){p.list(this.atoms.get(t).sgs).each(function(t){e[t]=e[t]?e[t]+1:1},this)},this);var n=[];for(var r in e){var o=parseInt(r,10),i=this.sgroups.get(o),a=b.getAtoms(this,i);e[r]==a.length&&n.push(o)}return n},r.prototype.isBlank=function(){return 0===this.atoms.count()&&0===this.rxnArrows.count()&&0===this.rxnPluses.count()&&!this.isChiral},r.prototype.toLists=function(){var t={},e=[];this.atoms.each(function(n,r){t[n]=e.length,e.push(r)});var n=[];return this.bonds.each(function(e,r){var o=new g(r);o.begin=t[r.begin],o.end=t[r.end],n.push(o)}),{atoms:e,bonds:n}},r.prototype.clone=function(t,e,n,o){var i=new r;return this.mergeInto(i,t,e,n,!1,o)},r.prototype.getScaffold=function(){var t=p.empty();return this.atoms.each(function(e){p.add(t,e)},this),this.rgroups.each(function(e,n){n.frags.each(function(e,n){this.atoms.each(function(e,r){r.fragment==n&&p.remove(t,e)},this)},this)},this),this.clone(t)},r.prototype.getFragmentIds=function(t){var e=p.empty();return this.atoms.each(function(n,r){r.fragment==t&&p.add(e,n)},this),e},r.prototype.getFragment=function(t){return this.clone(this.getFragmentIds(t))},r.prototype.mergeInto=function(t,e,n,r,o,i){e=e||p.keySetInt(this.atoms),n=n||p.keySetInt(this.bonds),n=p.filter(n,function(t){var n=this.bonds.get(t);return p.contains(e,n.begin)&&p.contains(e,n.end)},this);var a={};this.atoms.each(function(t,n){p.contains(e,t)&&(a[n.fragment]=1)});var s={};this.frags.each(function(e,n){a[e]&&(s[e]=t.frags.add(Object.assign({},n)))});var l=[];this.rgroups.each(function(e,n){var r=o;if(r||(n.frags.each(function(t,e){l.push(e),a[e]&&(r=!0)}),r)){var i=t.rgroups.get(e);i?n.frags.each(function(t,e){l.push(e),a[e]&&i.frags.add(s[e])}):t.rgroups.set(e,n.clone(s))}}),void 0!==i&&null!==i||(i={}),this.atoms.each(function(n,r){p.contains(e,n)&&-1==l.indexOf(r.fragment)&&(i[n]=t.atoms.add(r.clone(s)))}),this.atoms.each(function(n,r){p.contains(e,n)&&-1!=l.indexOf(r.fragment)&&(i[n]=t.atoms.add(r.clone(s)))});var u={};return this.bonds.each(function(e,r){p.contains(n,e)&&(u[e]=t.bonds.add(r.clone(i)))}),this.sgroups.each(function(n,r){var o;for(o=0;o<r.atoms.length;++o)if(!p.contains(e,r.atoms[o]))return;r=b.clone(r,i,u);var a=t.sgroups.add(r);for(r.id=a,o=0;o<r.atoms.length;++o)p.add(t.atoms.get(r.atoms[o]).sgs,a);"DAT"==r.type?t.sGroupForest.insert(r.id,-1,[]):t.sGroupForest.insert(r.id)}),t.isChiral=this.isChiral,r||(t.isReaction=this.isReaction,this.rxnArrows.each(function(e,n){t.rxnArrows.add(n.clone())}),this.rxnPluses.each(function(e,n){t.rxnPluses.add(n.clone())})),t},r.prototype.findBondId=function(t,e){var n=-1;return this.bonds.find(function(r,o){return(o.begin==t&&o.end==e||o.begin==e&&o.end==t)&&(n=r,!0)},this),n},r.prototype.initNeighbors=function(){this.atoms.each(function(t,e){e.neighbors=[]}),this.bonds.each(function(t,e){var n=this.atoms.get(e.begin),r=this.atoms.get(e.end);n.neighbors.push(e.hb1),r.neighbors.push(e.hb2)},this)},r.prototype.bondInitHalfBonds=function(t,e){e=e||this.bonds.get(t),e.hb1=2*t,e.hb2=2*t+1,this.halfBonds.set(e.hb1,new o(e.begin,e.end,t)),this.halfBonds.set(e.hb2,new o(e.end,e.begin,t));var n=this.halfBonds.get(e.hb1),r=this.halfBonds.get(e.hb2);n.contra=e.hb2,r.contra=e.hb1},r.prototype.halfBondUpdate=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin).pp,r=this.atoms.get(e.end).pp,o=d.diff(r,n).normalized();e.dir=d.dist(r,n)>1e-4?o:new d(1,0),e.norm=e.dir.turnLeft(),e.ang=e.dir.oxAngle(),e.loop<0&&(e.loop=-1)},r.prototype.initHalfBonds=function(){this.halfBonds.clear(),this.bonds.each(this.bondInitHalfBonds,this)},r.prototype.setHbNext=function(t,e){this.halfBonds.get(this.halfBonds.get(t).contra).next=e},r.prototype.halfBondSetAngle=function(t,e){var n=this.halfBonds.get(t),r=this.halfBonds.get(e);r.rightCos=n.leftCos=d.dot(r.dir,n.dir),r.rightSin=n.leftSin=d.cross(r.dir,n.dir),n.leftNeighbor=e,r.rightNeighbor=t},r.prototype.atomAddNeighbor=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin),r=0;for(r=0;r<n.neighbors.length&&!(this.halfBonds.get(n.neighbors[r]).ang>e.ang);++r);n.neighbors.splice(r,0,t);var o=n.neighbors[(r+1)%n.neighbors.length],i=n.neighbors[(r+n.neighbors.length-1)%n.neighbors.length];this.setHbNext(i,t),this.setHbNext(t,o),this.halfBondSetAngle(t,i),this.halfBondSetAngle(o,t)},r.prototype.atomSortNeighbors=function(t){var e=this.atoms.get(t);e.neighbors=e.neighbors.sortBy(function(t){return this.halfBonds.get(t).ang},this);var n;for(n=0;n<e.neighbors.length;++n)this.halfBonds.get(this.halfBonds.get(e.neighbors[n]).contra).next=e.neighbors[(n+1)%e.neighbors.length];for(n=0;n<e.neighbors.length;++n)this.halfBondSetAngle(e.neighbors[(n+1)%e.neighbors.length],e.neighbors[n])},r.prototype.sortNeighbors=function(t){function e(t){this.atomSortNeighbors(t)}t?t.forEach(e,this):this.atoms.each(e,this)},r.prototype.atomUpdateHalfBonds=function(t){for(var e=this.atoms.get(t).neighbors,n=0;n<e.length;++n){var r=e[n];this.halfBondUpdate(r),this.halfBondUpdate(this.halfBonds.get(r).contra)}},r.prototype.updateHalfBonds=function(t){function e(t){this.atomUpdateHalfBonds(t)}t?t.forEach(e,this):this.atoms.each(e,this)},r.prototype.sGroupsRecalcCrossBonds=function(){this.sgroups.each(function(t,e){e.xBonds=[],e.neiAtoms=[]},this),this.bonds.each(function(t,e){var n=this.atoms.get(e.begin),r=this.atoms.get(e.end);p.each(n.sgs,function(n){if(!p.contains(r.sgs,n)){var o=this.sgroups.get(n);o.xBonds.push(t),l(o.neiAtoms,e.end)}},this),p.each(r.sgs,function(r){if(!p.contains(n.sgs,r)){var o=this.sgroups.get(r);o.xBonds.push(t),l(o.neiAtoms,e.begin)}},this)},this)},r.prototype.sGroupDelete=function(t){for(var e=this.sgroups.get(t),n=0;n<e.atoms.length;++n)p.remove(this.atoms.get(e.atoms[n]).sgs,t);this.sGroupForest.remove(t),this.sgroups.remove(t)},r.prototype.atomSetPos=function(t,e){this.atoms.get(t).pp=e},r.prototype.rxnPlusSetPos=function(t,e){this.rxnPluses.get(t).pp=e},r.prototype.rxnArrowSetPos=function(t,e){this.rxnArrows.get(t).pp=e},r.prototype.getCoordBoundingBox=function(t){function e(t){n?(n.min=d.min(n.min,t),n.max=d.max(n.max,t)):n={min:t,max:t}}var n=null,r=void 0===t;return this.atoms.each(function(n,o){(r||p.contains(t,n))&&e(o.pp)}),r&&(this.rxnPluses.each(function(t,n){e(n.pp)}),this.rxnArrows.each(function(t,n){e(n.pp)})),!n&&r&&(n={min:new d(0,0),max:new d(1,1)}),n},r.prototype.getCoordBoundingBoxObj=function(){function t(t){e?(e.min=d.min(e.min,t),e.max=d.max(e.max,t)):e={min:new d(t),max:new d(t)}}var e=null;return this.atoms.each(function(e,n){t(n.pp)}),e},r.prototype.getBondLengthData=function(){var t=0,e=0;return this.bonds.each(function(n,r){t+=d.dist(this.atoms.get(r.begin).pp,this.atoms.get(r.end).pp),e++},this),{cnt:e,totalLength:t}},r.prototype.getAvgBondLength=function(){var t=this.getBondLengthData();return t.cnt>0?t.totalLength/t.cnt:-1},r.prototype.getAvgClosestAtomDistance=function(){var t,e,n,r=0,o=0,i=this.atoms.keys();for(e=0;e<i.length;++e){for(t=-1,n=0;n<i.length;++n)n!=e&&(o=d.dist(this.atoms.get(i[n]).pp,this.atoms.get(i[e]).pp),(t<0||t>o)&&(t=o));r+=t}return i.length>0?r/i.length:-1},r.prototype.checkBondExists=function(t,e){var n=!1;return this.bonds.each(function(r,o){(o.begin==t&&o.end==e||o.end==t&&o.begin==e)&&(n=!0)},this),n},r.prototype.findConnectedComponent=function(t){for(var e={},n=[t],r=p.empty();n.length>0;)(function(){var t=n.pop();e[t]=1,p.add(r,t);for(var o=this.atoms.get(t),i=0;i<o.neighbors.length;++i){var a=this.halfBonds.get(o.neighbors[i]).end;p.contains(r,a)||n.push(a)}}).apply(this);return r},r.prototype.findConnectedComponents=function(t){this.halfBonds.count()||(this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(this.atoms.keys()),this.sortNeighbors(this.atoms.keys()));var e={};this.atoms.each(function(t){e[t]=-1},this);var n=[];return this.atoms.each(function(r,o){if((t||o.fragment<0)&&e[r]<0){var i=this.findConnectedComponent(r);n.push(i),p.each(i,function(t){e[t]=1},this)}},this),n},r.prototype.markFragment=function(t){var e={},n=this.frags.add(e);p.each(t,function(t){this.atoms.get(t).fragment=n},this)},r.prototype.markFragmentByAtomId=function(t){this.markFragment(this.findConnectedComponent(t))},r.prototype.markFragments=function(){for(var t=this.findConnectedComponents(),e=0;e<t.length;++e)this.markFragment(t[e])},r.prototype.scale=function(t){1!=t&&(this.atoms.each(function(e,n){n.pp=n.pp.scaled(t)},this),this.rxnPluses.each(function(e,n){n.pp=n.pp.scaled(t)},this),this.rxnArrows.each(function(e,n){n.pp=n.pp.scaled(t)},this),this.sgroups.each(function(e,n){n.pp=n.pp?n.pp.scaled(t):null},this))},r.prototype.rescale=function(){var t=this.getAvgBondLength();t<0&&!this.isReaction&&(t=this.getAvgClosestAtomDistance()),t<.001&&(t=1);var e=1/t;this.scale(e)},r.prototype.loopHasSelfIntersections=function(t){for(var e=0;e<t.length;++e)for(var n=this.halfBonds.get(t[e]),r=this.atoms.get(n.begin).pp,o=this.atoms.get(n.end).pp,i=p.fromList([n.begin,n.end]),a=e+2;a<t.length;++a){var s=this.halfBonds.get(t[a]);if(!p.contains(i,s.begin)&&!p.contains(i,s.end)){var l=this.atoms.get(s.begin).pp,u=this.atoms.get(s.end).pp;if(d.segmentIntersection(r,o,l,u))return!0}}return!1},r.prototype.partitionLoop=function(t){var e=[],n=!0;t:for(;n;){for(var r={},o=0;o<t.length;++o){var i=t[o],a=this.halfBonds.get(i).begin,s=this.halfBonds.get(i).end;if(s in r){var l=r[s],u=t.slice(l,o+1);e.push(u),o<t.length&&t.splice(l,o-l+1);continue t}r[a]=o}n=!1,e.push(t)}return e},r.prototype.halfBondAngle=function(t,e){var n=this.halfBonds.get(t),r=this.halfBonds.get(e);return Math.atan2(d.cross(n.dir,r.dir),d.dot(n.dir,r.dir))},r.prototype.loopIsConvex=function(t){for(var e=0;e<t.length;++e){if(this.halfBondAngle(t[e],t[(e+1)%t.length])>0)return!1}return!0},r.prototype.loopIsInner=function(t){for(var e=2*Math.PI,n=0;n<t.length;++n){var r=t[n],o=t[(n+1)%t.length],i=this.halfBonds.get(o),a=this.halfBondAngle(r,o);i.contra==t[n]?e+=Math.PI:e+=a}return Math.abs(e)<Math.PI},r.prototype.findLoops=function(){var t,e,n,r,o=[],a=p.empty();return this.halfBonds.each(function(s,l){if(-1==l.loop)for(t=s,e=0,n=[];e<=this.halfBonds.count();t=this.halfBonds.get(t).next,++e){if(e>0&&t==s){var u=this.partitionLoop(n);u.forEach(function(t){this.loopIsInner(t)&&!this.loopHasSelfIntersections(t)?(r=Math.min.apply(Math,t),this.loops.set(r,new i(t,this,this.loopIsConvex(t)))):r=-2,t.each(function(t){this.halfBonds.get(t).loop=r,p.add(a,this.halfBonds.get(t).bid)},this),r>=0&&o.push(r)},this);break}n.push(t)}},this),{newLoops:o,bondsToMark:p.list(a)}},r.prototype.prepareLoopStructure=function(){this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(this.atoms.keys()),this.sortNeighbors(this.atoms.keys()),this.findLoops()},r.prototype.atomAddToSGroup=function(t,e){b.addAtom(this.sgroups.get(t),e),p.add(this.atoms.get(e).sgs,t)},r.prototype.calcConn=function(t){for(var e=0,n=this.atoms.get(t),r=!1,o=!1,i=0;i<n.neighbors.length;++i){var a=this.halfBonds.get(n.neighbors[i]);switch(this.bonds.get(a.bid).type){case g.PATTERN.TYPE.SINGLE:e+=1;break;case g.PATTERN.TYPE.DOUBLE:e+=2;break;case g.PATTERN.TYPE.TRIPLE:e+=3;break;case g.PATTERN.TYPE.AROMATIC:e+=1,o=!0,this.loops.each(function(t,e){-1!=e.hbs.indexOf(n.neighbors[i])&&e.hbs.length%2==1&&(r=!0)},this);break;default:return-1}}return!o||n.hasImplicitH||r||(e+=1),e},r.prototype.calcImplicitHydrogen=function(t){var e=this.calcConn(t),n=this.atoms.get(t);if(n.badConn=!1,e<0||n.isQuery())return void(n.implicitH=0);if(n.explicitValence>=0){var r=f.map[n.label];n.implicitH=0,null!=r&&(n.implicitH=n.explicitValence-n.calcValenceMinusHyd(e),n.implicitH<0&&(n.implicitH=0,n.badConn=!0))
}else n.calcValence(e)},r.prototype.setImplicitHydrogen=function(t){function e(t){this.calcImplicitHydrogen(t)}this.sgroups.each(function(t,e){"MRV_IMPLICIT_H"==e.data.fieldName&&(this.atoms.get(e.atoms[0]).hasImplicitH=!0)},this),t?t.forEach(e,this):this.atoms.each(e,this)},r.prototype.getComponents=function(){var t=this.findConnectedComponents(!0),e=[],n=null;this.rxnArrows.each(function(t,e){n=e.pp.x}),this.rxnPluses.each(function(t,n){e.push(n.pp.x)}),null!=n&&e.push(n),e.sort(function(t,e){return t-e});var r,o=[];for(r=0;r<t.length;++r){for(var i=this.getCoordBoundingBox(t[r]),a=d.lc2(i.min,.5,i.max,.5),s=0;a.x>e[s];)++s;o[s]=o[s]||{},p.mergeIn(o[s],t[r])}var l=[],u=[],c=[];for(r=0;r<o.length;++r)o[r]?(i=this.getCoordBoundingBox(o[r]),a=d.lc2(i.min,.5,i.max,.5),a.x<n?u.push(o[r]):c.push(o[r])):l.push("");return{reactants:u,products:c}},a.prototype.clone=function(){return new a(this)},s.prototype.clone=function(){return new s(this)},e.exports=Object.assign(r,{Atom:h,AtomList:m,Bond:g,SGroup:b,RGroup:y,RxnPlus:a,RxnArrow:s})},{"../../util/map":196,"../../util/pool":197,"../../util/set":199,"../../util/vec2":200,"../element":60,"./atom":74,"./atomlist":75,"./bond":76,"./rgroup":78,"./sgforest":79,"./sgroup":80}],78:[function(t,e,n){function r(t){t=t||{},this.frags=new o,this.resth=t.resth||!1,this.range=t.range||"",this.ifthen=t.ifthen||0}var o=t("../../util/pool");r.prototype.getAttrs=function(){return{resth:this.resth,range:this.range,ifthen:this.ifthen}},r.findRGroupByFragment=function(t,e){var n;return t.each(function(t,r){r.frags.keyOf(e)&&(n=t)}),n},r.prototype.clone=function(t){var e=new r(this);return this.frags.each(function(n,r){e.frags.add(t?t[r]:r)}),e},e.exports=r},{"../../util/pool":197}],79:[function(t,e,n){function r(t){this.parent=new o,this.children=new o,this.children.set(-1,[]),this.molecule=t}var o=t("../../util/map"),i=t("../../util/set");r.prototype.getSGroupsBFS=function(){var t=[],e=[],n=-1;for(e=[].slice.call(this.children.get(-1));e.length>0;)n=e.shift(),e=e.concat(this.children.get(n)),t.push(n);return t},r.prototype.getAtomSets=function(){return this.molecule.sgroups.map(function(t,e){return i.fromList(e.atoms)})},r.prototype.getAtomSetRelations=function(t,e){var n=new o,r=new o,a=this.getAtomSets();a.unset(t),a.each(function(t,o){r.set(t,i.subset(e,o)),n.set(t,i.subset(o,e)&&!i.eq(o,e))},this);var s=a.findAll(function(t){return!!r.get(t)&&!(this.children.get(t).findIndex(function(t){return r.get(t)},this)>=0)},this);return console.assert(s.length<=1,"We are here"),{children:a.findAll(function(t){return n.get(t)&&!n.get(this.parent.get(t))},this),parent:0===s.length?-1:s[0]}},r.prototype.getPathToRoot=function(t){for(var e=[],n=t;n>=0;n=this.parent.get(n))console.assert(e.indexOf(n)<0,"SGroupForest: loop detected"),e.push(n);return e},r.prototype.validate=function(){var t=this.getAtomSets();this.molecule.sgroups.each(function(t){this.getPathToRoot(t)},this);var e=!0;return this.parent.each(function(n,r){r>=0&&!i.subset(t.get(n),t.get(r))&&(e=!1)},this),this.children.each(function(n){for(var r=this.children.get(n),o=0;o<r.length;++o)for(var a=o+1;a<r.length;++a){var s=r[o],l=r[a],u=this.molecule.sgroups.get(s),c=this.molecule.sgroups.get(l);i.disjoint(t.get(s),t.get(l))||"DAT"==u.type||"DAT"==c.type||(e=!1)}},this),e},r.prototype.insert=function(t,e,n){console.assert(!this.parent.has(t),"sgid already present in the forest"),console.assert(!this.children.has(t),"sgid already present in the forest"),console.assert(this.validate(),"s-group forest invalid");var r=this.getAtomSets(),o=i.fromList(this.molecule.sgroups.get(t).atoms);if(!e||!n){var a=this.getAtomSetRelations(t,o,r);e=a.parent,n=a.children}return n.forEach(function(e){var n=this.children.get(this.parent.get(e)),r=n.indexOf(e);console.assert(r>=0&&n.indexOf(e,r+1)<0,"Assertion failed"),n.splice(r,1),this.parent.set(e,t)},this),this.children.set(t,n),this.parent.set(t,e),this.children.get(e).push(t),console.assert(this.validate(),"s-group forest invalid"),{parent:e,children:n}},r.prototype.remove=function(t){console.assert(this.parent.has(t),"sgid is not in the forest"),console.assert(this.children.has(t),"sgid is not in the forest"),console.assert(this.validate(),"s-group forest invalid");var e=this.parent.get(t);this.children.get(t).forEach(function(t){this.parent.set(t,e),this.children.get(e).push(t)},this);var n=this.children.get(e),r=n.indexOf(t);console.assert(r>=0&&n.indexOf(t,r+1)<0,"Assertion failed"),n.splice(r,1),this.children.unset(t),this.parent.unset(t),console.assert(this.validate(),"s-group forest invalid")},e.exports=r},{"../../util/map":196,"../../util/set":199}],80:[function(t,e,n){function r(t){console.assert(t&&t in r.TYPES,"Invalid or unsupported s-group type"),this.type=t,this.id=-1,this.label=-1,this.bracketBox=null,this.bracketDir=new a(1,0),this.areas=[],this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null,this.atoms=[],this.patoms=[],this.bonds=[],this.xBonds=[],this.neiAtoms=[],this.pp=null,this.data={mul:1,connectivity:"ht",name:"",subscript:"n",attached:!1,absolute:!0,showUnits:!1,nCharsToDisplay:-1,tagChar:"",daspPos:1,fieldType:"F",fieldName:"",fieldValue:"",units:"",query:"",queryOp:""}}var o=t("../../util/box2abs"),i=t("../../util/set"),a=t("../../util/vec2"),s=t("./atom"),l=t("./bond");r.TYPES={MUL:1,SRU:2,SUP:3,DAT:4,GEN:5},r.prototype.getAttr=function(t){return this.data[t]},r.prototype.getAttrs=function(){var t={};for(var e in this.data)t[e]=this.data[e];return t},r.prototype.setAttr=function(t,e){var n=this.data[t];return this.data[t]=e,n},r.prototype.checkAttr=function(t,e){return this.data[t]==e},r.filterAtoms=function(t,e){for(var n=[],r=0;r<t.length;++r){var o=t[r];"number"!=typeof e[o]?n.push(o):e[o]>=0?n.push(e[o]):n.push(-1)}return n},r.removeNegative=function(t){for(var e=[],n=0;n<t.length;++n)t[n]>=0&&e.push(t[n]);return e},r.filter=function(t,e,n){e.atoms=r.removeNegative(r.filterAtoms(e.atoms,n))},r.clone=function(t,e){var n=new r(t.type);for(var o in t.data)n.data[o]=t.data[o];return n.atoms=t.atoms.map(function(t){return e[t]}),n.pp=t.pp,n.bracketBox=t.bracketBox,n.patoms=null,n.bonds=null,n.allAtoms=t.allAtoms,n},r.addAtom=function(t,e){t.atoms.push(e)},r.removeAtom=function(t,e){for(var n=0;n<t.atoms.length;++n)if(t.atoms[n]===e)return void t.atoms.splice(n,1);console.error("The atom is not found in the given s-group")},r.getCrossBonds=function(t,e,n,r){n.bonds.each(function(n,o){i.contains(r,o.begin)&&i.contains(r,o.end)?null!=t&&t.push(n):(i.contains(r,o.begin)||i.contains(r,o.end))&&null!=e&&e.push(n)},this)},r.bracketPos=function(t,e,n){var r=t.atoms;if(n&&2===n.length){var i=e.bonds.get(n[0]).getCenter(e),s=e.bonds.get(n[1]).getCenter(e);t.bracketDir=a.diff(s,i).normalized()}else t.bracketDir=new a(1,0);var l=t.bracketDir,u=null,c=[];r.forEach(function(t){var n=e.atoms.get(t),r=new a(n.pp),i=new a(.05*3,.05*3),s=new o(r,r).extend(i,i);c.push(s)},this),c.forEach(function(t){var e=null;[t.p0.x,t.p1.x].forEach(function(n){[t.p0.y,t.p1.y].forEach(function(t){var r=new a(n,t),i=new a(a.dot(r,l),a.dot(r,l.rotateSC(1,0)));e=null===e?new o(i,i):e.include(i)},this)},this),u=null===u?e:o.union(u,e)},this);var p=new a(.2,.4);null!==u&&(u=u.extend(p,p)),t.bracketBox=u},r.getBracketParameters=function(t,e,n,r,o,s){function l(t,e,n,r){this.c=t,this.d=e,this.n=e.rotateSC(1,0),this.w=n,this.h=r}var u=[];return e.length<2?function(){o=o||new a(1,0),s=s||o.rotateSC(1,0);var t=Math.min(.25,.3*r.sz().x),e=a.lc2(o,r.p0.x,s,.5*(r.p0.y+r.p1.y)),n=a.lc2(o,r.p1.x,s,.5*(r.p0.y+r.p1.y)),i=r.sz().y;u.push(new l(e,o.negated(),t,i),new l(n,o,t,i))}():2===e.length?function(){var n=t.bonds.get(e[0]),r=t.bonds.get(e[1]),o=n.getCenter(t),i=r.getCenter(t),s=a.diff(i,o).normalized(),c=s.negated();u.push(new l(o.addScaled(c,0),c,.25,1.5),new l(i.addScaled(s,0),s,.25,1.5))}():function(){for(var r=0;r<e.length;++r){var o=t.bonds.get(e[r]),a=o.getCenter(t),s=i.contains(n,o.begin)?o.getDir(t):o.getDir(t).negated();u.push(new l(a,s,.2,1))}}(),u},r.getObjBBox=function(t,e){console.assert(0!=t.length,"Atom list is empty");for(var n=e.atoms.get(t[0]).pp,r=new o(n,n),i=1;i<t.length;++i){var a=t[i],s=e.atoms.get(a),l=s.pp;r=r.include(l)}return r},r.getAtoms=function(t,e){if(!e.allAtoms)return e.atoms;var n=[];return t.atoms.each(function(t){n.push(t)}),n},r.getBonds=function(t,e){var n=r.getAtoms(t,e),o=[];return t.bonds.each(function(t,e){n.indexOf(e.begin)>=0&&n.indexOf(e.end)>=0&&o.push(t)}),o},r.prepareMulForSaving=function(t,e){var n;t.atoms.sort(),t.atomSet=i.fromList(t.atoms),t.parentAtomSet=i.clone(t.atomSet);var r=[],o=[];if(e.bonds.each(function(e,n){i.contains(t.parentAtomSet,n.begin)&&i.contains(t.parentAtomSet,n.end)?r.push(e):(i.contains(t.parentAtomSet,n.begin)||i.contains(t.parentAtomSet,n.end))&&o.push(e)},t),0!=o.length&&2!=o.length)throw{id:t.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};var a=-1,u=-1,c=null;if(2==o.length){var p=e.bonds.get(o[0]);a=i.contains(t.parentAtomSet,p.begin)?p.begin:p.end;var d=e.bonds.get(o[1]);u=i.contains(t.parentAtomSet,d.begin)?d.begin:d.end,c=d}var f=null,h=a,m=[];for(n=0;n<t.data.mul-1;++n)if(f={},t.atoms.forEach(function(n){var r=e.atoms.get(n),o=e.atoms.add(new s(r));m.push(o),t.atomSet[o]=1,f[n]=o}),r.forEach(function(t){var n=e.bonds.get(t),r=new l(n);r.begin=f[r.begin],r.end=f[r.end],e.bonds.add(r)}),null!=c){var g=new l(c);g.begin=h,g.end=f[u],e.bonds.add(g),h=f[a]}if(m.forEach(function(n){e.sGroupForest.getPathToRoot(t.id).reverse().forEach(function(t){e.atomAddToSGroup(t,n)})}),h>=0){var b=e.bonds.get(o[0]);b.begin==a?b.begin=h:b.end=h}t.bonds=o},r.getMassCentre=function(t,e){for(var n=new a,r=0;r<e.length;++r)n=n.addScaled(t.atoms.get(e[r]).pp,1/e.length);return n},e.exports=r},{"../../util/box2abs":195,"../../util/set":199,"../../util/vec2":200,"./atom":74,"./bond":76}],81:[function(t,e,n){function r(){this.operations=[]}function o(t,e,n){var r=Z(e,n);return r.length>0&&(r.each(function(e){t.addOp(new ot.SGroupAtomRemove(e,n))}),!0)}function i(t,e,n){var r=e.molecule,o={};n.each(function(t){Z(e,t).each(function(t){o[t]=o[t]?o[t]+1:1})});for(var i in o){var a=parseInt(i),s=e.sgroups.get(a).item;if(at.SGroup.getAtoms(e.molecule,s).length==o[a]){var l=r.sgroups.get(a);t.mergeWith(I(a,l.getAttrs())),t.addOp(new ot.SGroupRemoveFromHierarchy(a)),t.addOp(new ot.SGroupDelete(a))}}}function a(t,e,n){n=new rt(n);var o,i=new r,a=t.molecule,s=[],l=nt.empty(),u=nt.empty();if(e.atoms){var c=nt.fromList(e.atoms);for(t.bonds.each(function(t,e){nt.contains(c,e.b.begin)&&nt.contains(c,e.b.end)?(s.push(t),["hb1","hb2"].forEach(function(t){var n=a.halfBonds.get(e.b[t]).loop;n>=0&&nt.add(l,n)},this)):nt.contains(c,e.b.begin)?nt.add(u,e.b.begin):nt.contains(c,e.b.end)&&nt.add(u,e.b.end)},this),o=0;o<s.length;++o)i.addOp(new ot.BondMove(s[o],n));for(nt.each(l,function(e){t.reloops.get(e)&&t.reloops.get(e).visel&&i.addOp(new ot.LoopMove(e,n))},this),o=0;o<e.atoms.length;++o){var p=e.atoms[o];i.addOp(new ot.AtomMove(p,n,!nt.contains(u,p)))}}if(e.rxnArrows)for(o=0;o<e.rxnArrows.length;++o)i.addOp(new ot.RxnArrowMove(e.rxnArrows[o],n,!0));if(e.rxnPluses)for(o=0;o<e.rxnPluses.length;++o)i.addOp(new ot.RxnPlusMove(e.rxnPluses[o],n,!0));if(e.sgroupData)for(o=0;o<e.sgroupData.length;++o)i.addOp(new ot.SGroupDataMove(e.sgroupData[o],n));if(e.chiralFlags)for(o=0;o<e.chiralFlags.length;++o)i.addOp(new ot.ChiralFlagMove(n));return i.perform(t)}function s(t,e,n,o){var i=new r;return("number"==typeof e?[e]:e).each(function(t){for(var e in at.Atom.attrlist){var r;if(e in n)r=n[e];else{if(!o)continue;r=at.Atom.attrGetDefault(e)}i.addOp(new ot.AtomAttr(t,e,r))}!o&&"label"in n&&null!=n.label&&"L#"!=n.label&&!n.atomList&&i.addOp(new ot.AtomAttr(t,"atomList",null))},this),i.perform(t)}function l(t,e,n,o,i){var a=new r;for(var s in at.Bond.attrlist){var l;if(s in n)l=n[s];else{if(!i)continue;l=at.Bond.attrGetDefault(s)}a.addOp(new ot.BondAttr(e,s,l))}return o&&a.mergeWith(S(t.molecule,e)),a.perform(t)}function u(t,e,n){n=Object.assign({},n);var o=new r;return n.fragment=o.addOp((new ot.FragmentAdd).perform(t)).frid,o.addOp(new ot.AtomAdd(n,e).perform(t)),o}function c(t,e,n,r){var o=e.molecule;if(r!=n&&"number"==typeof r){void 0!==at.RGroup.findRGroupByFragment(o.rgroups,r)&&t.mergeWith(D(e,null,r)),o.atoms.each(function(o,i){i.fragment==r&&t.addOp(new ot.AtomAttr(o,"fragment",n).perform(e))}),t.addOp(new ot.FragmentDelete(r).perform(e))}}function p(t,e){var n=[],r=J(t,e);K(t,e).each(function(e){var o=J(t,e.aid);rt.dist(r,o)<.1||n.push({id:e.aid,v:rt.diff(o,r)})}),n.sort(function(t,e){return Math.atan2(t.v.y,t.v.x)-Math.atan2(e.v.y,e.v.x)});var o,i,a=0,s=0;for(o=0;o<n.length;o++)i=rt.angle(n[o].v,n[(o+1)%n.length].v),i<0&&(i+=2*Math.PI),i>s&&(a=o,s=i);var l=new rt(1,0);if(n.length>0){if(1==n.length){s=-4*Math.PI/3;var u=K(t,e)[0];if(Y(t,u.aid)>1){var c=[],p=J(t,u.aid),d=rt.diff(r,p),f=Math.atan2(d.y,d.x);K(t,u.aid).each(function(e){var n=J(t,e.aid);if(!(e.bid==u.bid||rt.dist(p,n)<.1)){var r=rt.diff(n,p),o=Math.atan2(r.y,r.x)-f;o<0&&(o+=2*Math.PI),c.push(o)}}),c.sort(function(t,e){return t-e}),c[0]<=1.01*Math.PI&&c[c.length-1]<=1.01*Math.PI&&(s*=-1)}}i=s/2+Math.atan2(n[a].v.y,n[a].v.x),l=l.rotate(i)}l.add_(r);var h=st.atom(t,l,null,.1);return h=null==h?{label:"C"}:h.id,{atom:h,pos:l}}function d(t,e,n,o,i,a){if(void 0===o){var s=p(t,n);o=s.atom,i=s.pos}var l=new r,u=null;if("number"!=typeof n)"number"==typeof o&&(u=$(t,o,"fragment"));else if(u=$(t,n,"fragment"),"number"==typeof o){var d=$(t,o,"fragment");c(l,t,u,d)}null==u&&(u=l.addOp((new ot.FragmentAdd).perform(t)).frid),"number"!=typeof n?(n.fragment=u,n=l.addOp(new ot.AtomAdd(n,i).perform(t)).data.aid,i=a):"*"==$(t,n,"label")&&l.addOp(new ot.AtomAttr(n,"label","C").perform(t)),"number"!=typeof o?(o.fragment=u,o=l.addOp(new ot.AtomAdd(o,i).perform(t)).data.aid,"number"==typeof n&&Z(t,n).each(function(e){l.addOp(new ot.SGroupAtomAdd(e,o).perform(t))},this)):"*"==$(t,o,"label")&&l.addOp(new ot.AtomAttr(o,"label","C").perform(t));var f=l.addOp(new ot.BondAdd(n,o,e).perform(t)).data.bid;return l.operations.reverse(),[l,n,o,f]}function f(t,e){var n=new r;return t.molecule.rxnArrows.count()<1&&n.addOp(new ot.RxnArrowAdd(e).perform(t)),n}function h(t,e){var n=new r;return n.addOp(new ot.RxnArrowDelete(e)),n.perform(t)}function m(t){var e=new r;return e.addOp(new ot.ChiralFlagDelete),e.perform(t)}function g(t,e){var n=new r;return n.addOp(new ot.RxnPlusAdd(e).perform(t)),n}function b(t,e){var n=new r;return n.addOp(new ot.RxnPlusDelete(e)),n.perform(t)}function y(t,e){var n=new r,a=[],s=t.molecule.atoms.get(e).fragment;return K(t,e).each(function(e){n.addOp(new ot.BondDelete(e.bid)),1==Y(t,e.aid)&&(o(n,t,e.aid)&&a.push(e.aid),n.addOp(new ot.AtomDelete(e.aid)))},this),o(n,t,e)&&a.push(e),n.addOp(new ot.AtomDelete(e)),i(n,t,a),n=n.perform(t),n.mergeWith(new w(t,s)),n}function v(t,e){var n=new r,a=t.molecule.bonds.get(e),s=t.molecule.atoms.get(a.begin).fragment,l=[];return n.addOp(new ot.BondDelete(e)),1==Y(t,a.begin)&&(o(n,t,a.begin)&&l.push(a.begin),n.addOp(new ot.AtomDelete(a.begin))),1==Y(t,a.end)&&(o(n,t,a.end)&&l.push(a.end),n.addOp(new ot.AtomDelete(a.end))),i(n,t,l),n=n.perform(t),n.mergeWith(new w(t,s)),n}function w(t,e){var n=new r,o=at.RGroup.findRGroupByFragment(t.molecule.rgroups,e);return t.molecule.atoms.each(function(r,i){if(i.fragment==e){var a=n.addOp((new ot.FragmentAdd).perform(t)).frid,s=function(r){n.addOp(new ot.AtomAttr(r,"fragment",a).perform(t)),K(t,r).each(function(n){t.molecule.atoms.get(n.aid).fragment==e&&s(n.aid)})};s(r),o&&n.mergeWith(D(t,o,a))}}),-1!=e&&(n.mergeWith(D(t,0,e)),n.addOp(new ot.FragmentDelete(e).perform(t))),n}function x(t,e){console.assert(!!e);var n=new r,a=[],s=[];e={atoms:e.atoms||[],bonds:e.bonds||[],rxnPluses:e.rxnPluses||[],rxnArrows:e.rxnArrows||[],sgroupData:e.sgroupData||[],chiralFlags:e.chiralFlags||[]};var l=new r;for(e.sgroupData.each(function(e){l.mergeWith(M(t,e))},this),e.atoms.each(function(n){K(t,n).each(function(t){-1==e.bonds.indexOf(t.bid)&&(e.bonds=e.bonds.concat([t.bid]))},this)},this),e.bonds.each(function(r){n.addOp(new ot.BondDelete(r));var i=t.molecule.bonds.get(r),l=t.molecule.atoms.get(i.begin).fragment;s.indexOf(l)<0&&s.push(l),-1==e.atoms.indexOf(i.begin)&&1==Y(t,i.begin)&&(o(n,t,i.begin)&&a.push(i.begin),n.addOp(new ot.AtomDelete(i.begin))),-1==e.atoms.indexOf(i.end)&&1==Y(t,i.end)&&(o(n,t,i.end)&&a.push(i.end),n.addOp(new ot.AtomDelete(i.end)))},this),e.atoms.each(function(e){var r=t.molecule.atoms.get(e).fragment;s.indexOf(r)<0&&s.push(r),o(n,t,e)&&a.push(e),n.addOp(new ot.AtomDelete(e))},this),i(n,t,a),e.rxnArrows.each(function(t){n.addOp(new ot.RxnArrowDelete(t))},this),e.rxnPluses.each(function(t){n.addOp(new ot.RxnPlusDelete(t))},this),e.chiralFlags.each(function(t){n.addOp(new ot.ChiralFlagDelete(t))},this),n=n.perform(t);s.length>0;)n.mergeWith(new w(t,s.pop()));return n.mergeWith(l),n}function O(t,e,n){var a=new r,s=$(t,e,"fragment"),l=$(t,n,"fragment");s!=l&&c(a,t,s,l);var u=new r;K(t,e).each(function(e){var r,o,i=t.molecule.bonds.get(e.bid);i.begin==e.aid?(r=e.aid,o=n):(r=n,o=e.aid),n!=i.begin&&n!=i.end&&-1==t.molecule.findBondId(r,o)&&u.addOp(new ot.BondAdd(r,o,i)),u.addOp(new ot.BondDelete(e.bid))},this);var p=at.Atom.getAttrHash(t.molecule.atoms.get(e));1==Y(t,e)&&"*"==p.label&&(p.label="C");for(var d in p)u.addOp(new ot.AtomAttr(n,d,p[d]));var f=o(u,t,e);return u.addOp(new ot.AtomDelete(e)),f&&i(u,t,[e]),u.perform(t).mergeWith(a)}function S(t,e){var n=t.bonds.get(e),o=new r;return o.addOp(new ot.BondDelete(e)),o.addOp(new ot.BondAdd(n.end,n.begin,n)).data.bid=e,o}function T(t,e){return S(t.molecule,e).perform(t)}function E(t,e,n,o){var i=new r,a=o.molecule,s=(new ot.FragmentAdd).perform(t),l={};return a.atoms.each(function(r,a){var u,c=at.Atom.getAttrHash(a);c.fragment=s.frid,i.addOp(u=new ot.AtomAdd(c,rt.diff(a.pp,o.xy0).rotate(n).add(e)).perform(t)),l[r]=u.data.aid}),a.bonds.each(function(e,n){i.addOp(new ot.BondAdd(l[n.begin],l[n.end],n).perform(t))}),i.operations.reverse(),i.addOp(s),i}function A(t,e,n){var o=new r;return e.forEach(function(e){o.addOp(new ot.SGroupAtomAdd(e,n).perform(t))},this),o}function P(t,e,n,o,i){var a=new r,l=i.molecule,u=t.molecule,c=u.atoms.get(e),f=e,h=null,m=Z(t,e),g=$(t,e,"fragment"),b={},y=l.atoms.get(i.aid).pp;if(o){if(null==n){var v=p(t,e),w=d(t,{type:1},e,v.atom,v.pos.get_xy0());a=w[0],a.operations.reverse(),h=e=w[2]}else{var x;a.addOp(x=new ot.AtomAdd({label:"C",fragment:g},new rt(1,0).rotate(n).add(c.pp).get_xy0()).perform(t)),a.addOp(new ot.BondAdd(e,x.data.aid,{type:1}).perform(t)),h=e=x.data.aid,a.mergeWith(A(t,m,e))}var O=c;c=u.atoms.get(e);var S=it.calcAngle(O.pp,c.pp)-i.angle0}else null==n&&(v=p(t,e),n=it.calcAngle(c.pp,v.pos)),S=n-i.angle0;return l.atoms.each(function(n,r){var o=at.Atom.getAttrHash(r);if(o.fragment=g,n==i.aid)a.mergeWith(s(t,e,o,!0)),b[n]=e;else{var l;l=rt.diff(r.pp,y).rotate(S).add(c.pp),a.addOp(x=new ot.AtomAdd(o,l.get_xy0()).perform(t)),b[n]=x.data.aid}b[n]-0!=f-0&&b[n]-0!=h-0&&a.mergeWith(A(t,m,b[n]))}),l.bonds.each(function(e,n){a.addOp(new ot.BondAdd(b[n.begin],b[n.end],n).perform(t))}),a.operations.reverse(),a}function C(t,e,n,o){var i,a,u=new r,c=n.molecule,p=t.molecule,d=p.bonds.get(e),f=p.atoms.get(d.begin),h=p.atoms.get(d.end),m=nt.list(nt.intersection(nt.fromList(Z(t,d.begin)),nt.fromList(Z(t,d.end)))),g=c.bonds.get(n.bid),b=$(t,d.begin,"fragment"),y={};o?(i=c.atoms.get(g.end),a=c.atoms.get(g.begin),y[g.end]=d.begin,y[g.begin]=d.end):(i=c.atoms.get(g.begin),a=c.atoms.get(g.end),y[g.begin]=d.begin,y[g.end]=d.end);var v=it.calcAngle(f.pp,h.pp)-it.calcAngle(i.pp,a.pp),w=rt.dist(f.pp,h.pp)/rt.dist(i.pp,a.pp);return c.atoms.each(function(e,n){var r=at.Atom.getAttrHash(n);if(r.fragment=b,e==g.begin||e==g.end)return void u.mergeWith(s(t,y[e],r,!0));var o;o=rt.diff(n.pp,i.pp).rotate(v).scaled(w).add(f.pp);var a=st.atom(t,o,null,.1);if(null==a){var l;u.addOp(l=new ot.AtomAdd(r,o).perform(t)),y[e]=l.data.aid,u.mergeWith(A(t,m,y[e]))}else y[e]=a.id,u.mergeWith(s(t,y[e],r,!0))}),c.bonds.each(function(e,n){var r=p.findBondId(y[n.begin],y[n.end]);-1==r?u.addOp(new ot.BondAdd(y[n.begin],y[n.end],n).perform(t)):u.mergeWith(l(t,r,g,!1,!0))}),u.operations.reverse(),u}function j(t,e,n,o,i){var a,s=Math.cos(Math.PI/6),l=Math.sin(Math.PI/6),u=new r;a=null!=i?$(t,i,"fragment"):u.addOp((new ot.FragmentAdd).perform(t)).frid;var c=-1;c=null!=i?i:u.addOp(new ot.AtomAdd({label:"C",fragment:a},e).perform(t)).data.aid,u.operations.reverse();for(var p=0;p<o;p++){var f=new rt(s*(p+1),1&p?0:l).rotate(n).add(e),h=st.atom(t,f,null,.1),m=d(t,{},c,h?h.id:{},f);u=m[0].mergeWith(u),c=m[2]}return u}function _(t,e){var n=new r;return n.addOp(new ot.CanvasLoad(e)),n.perform(t)}function N(t,e,n){var o=t.sgroups.get(e).item,i=o.type;if(n&&n!=i){var a=[].slice.call(at.SGroup.getAtoms(t.molecule,o)),s=o.getAttrs(),l=M(t,e);return B(t,n,a,s,e).mergeWith(l)}return new r}function R(t,e,n){var o=new r;for(var i in n)o.addOp(new ot.SGroupAttr(e,i,n[i]));return o.perform(t)}function I(t,e){var n=new r;for(var o in e)n.addOp(new ot.SGroupAttr(t,o,e[o]));return n}function M(t,e){var n=new r,o=t.molecule,i=t.sgroups.get(e).item;if("SRU"==i.type){o.sGroupsRecalcCrossBonds();i.neiAtoms.each(function(e){"*"==$(t,e,"label")&&n.addOp(new ot.AtomAttr(e,"label","C"))},this)}var a=o.sgroups.get(e),s=at.SGroup.getAtoms(o,a),l=a.getAttrs();n.addOp(new ot.SGroupRemoveFromHierarchy(e));for(var u=0;u<s.length;++u)n.addOp(new ot.SGroupAtomRemove(e,s[u]));return n.addOp(new ot.SGroupDelete(e)),n=n.perform(t),n.mergeWith(I(e,l)),n}function B(t,e,n,o,i,a){var s,l=new r;for(i=i-0===i?i:t.molecule.sgroups.newId(),l.addOp(new ot.SGroupCreate(i,e,a)),s=0;s<n.length;s++)l.addOp(new ot.SGroupAtomAdd(i,n[s]));if(l.addOp("DAT"!=e?new ot.SGroupAddToHierarchy(i):new ot.SGroupAddToHierarchy(i,-1,[])),l=l.perform(t),"SRU"==e){t.molecule.sGroupsRecalcCrossBonds();var u=new r;t.sgroups.get(i).item.neiAtoms.each(function(e){var n=t.atoms.get(e).a.isPlainCarbon();1==Y(t,e)&&n&&u.addOp(new ot.AtomAttr(e,"label","*"))},this),u=u.perform(t),u.mergeWith(l),l=u}return R(t,i,o).mergeWith(l)}function k(t,e,n){var o=new r;for(var i in n)o.addOp(new ot.RGroupAttr(e,i,n[i]));return o.perform(t)}function D(t,e,n){var o=new r;return o.addOp(new ot.RGroupFragment(e,n)),o.perform(t)}function L(t){if(t.atoms.length){for(var e=1e50,n=e,r=-e,o=-n,i=0;i<t.atoms.length;i++)e=Math.min(e,t.atoms[i].pp.x),n=Math.min(n,t.atoms[i].pp.y),r=Math.max(r,t.atoms[i].pp.x),o=Math.max(o,t.atoms[i].pp.y);return new rt((e+r)/2,(n+o)/2)}return t.rxnArrows.length?t.rxnArrows[0].pp:t.rxnPluses.length?t.rxnPluses[0].pp:t.chiralFlags.length?t.chiralFlags[0].pp:null}function F(t){console.assert(!t.isBlank(),"Empty struct");var e=V(t),n={atoms:[],bonds:[],sgroups:[],rxnArrows:[],rxnPluses:[],chiralFlags:[],rgmap:{},rgroups:{}},r={};e.atoms.each(function(e){var o=new at.Atom(t.atoms.get(e));o.pos=o.pp,r[e]=n.atoms.push(new at.Atom(o))-1}),e.bonds.each(function(e){var o=new at.Bond(t.bonds.get(e));o.begin=r[o.begin],o.end=r[o.end],n.bonds.push(new at.Bond(o))}),t.getSGroupsInAtomSet(e.atoms).forEach(function(e){for(var o=t.sgroups.get(e),i=at.SGroup.getAtoms(t,o),a={type:o.type,attrs:o.getAttrs(),atoms:[].slice.call(i),pp:o.pp},s=0;s<a.atoms.length;s++)a.atoms[s]=r[a.atoms[s]];n.sgroups.push(a)},this),e.rxnArrows.each(function(e){var r=new at.RxnArrow(t.rxnArrows.get(e));r.pos=r.pp,n.rxnArrows.push(r)}),e.rxnPluses.each(function(e){var r=new at.RxnPlus(t.rxnPluses.get(e));r.pos=r.pp,n.rxnPluses.push(r)});var o={},i=nt.empty();e.atoms.each(function(e){var n=t.atoms.get(e),r=n.fragment;o[e]=r,nt.add(i,r)});var a=nt.empty();return nt.each(i,function(e){for(var r=W(t,e),i=0;i<r.length;++i)if(!nt.contains(o,r[i]))return;var s=at.RGroup.findRGroupByFragment(t.rgroups,e);n.rgmap[e]=s,nt.add(a,s)},this),nt.each(a,function(e){n.rgroups[e]=t.rgroups.get(e).getAttrs()},this),n}function G(t,e,n){for(var o=F(e),i=n?rt.diff(n,L(o)):new rt,a=new r,s={},l={},u=0;u<o.atoms.length;u++){var c=Object.assign({},o.atoms[u]);c.fragment in l||(l[c.fragment]=a.addOp((new ot.FragmentAdd).perform(t)).frid),c.fragment=l[c.fragment],s[u]=a.addOp(new ot.AtomAdd(c,c.pp.add(i)).perform(t)).data.aid}var p=[];for(var d in o.rgroups)t.molecule.rgroups.has(d)||p.push(d);for(var f in o.rgmap)a.addOp(new ot.RGroupFragment(o.rgmap[f],l[f]).perform(t));for(var h=0;h<p.length;++h)a.mergeWith(k(t,p[h],o.rgroups[p[h]]));for(var m=0;m<o.bonds.length;m++){var g=Object.assign({},o.bonds[m]);a.addOp(new ot.BondAdd(s[g.begin],s[g.end],g).perform(t))}for(var b=0;b<o.sgroups.length;b++){for(var y=o.sgroups[b],v=y.atoms,w=[],x=0;x<v.length;x++)w.push(s[v[x]]);for(var O=t.molecule.sgroups.newId(),S=B(t,y.type,w,y.attrs,O,y.pp?y.pp.add(i):null),T=S.operations.length-1;T>=0;T--)a.addOp(S.operations[T])}if(t.rxnArrows.count()<1)for(var E=0;E<o.rxnArrows.length;E++)a.addOp(new ot.RxnArrowAdd(o.rxnArrows[E].pp.add(i)).perform(t));for(var A=0;A<o.rxnPluses.length;A++)a.addOp(new ot.RxnPlusAdd(o.rxnPluses[A].pp.add(i)).perform(t));if(e.isChiral){var P=e.getCoordBoundingBox(),C=new rt(P.max.x,P.min.y-1);a.addOp(new ot.ChiralFlagAdd(C.add(i))).perform(t)}return a.operations.reverse(),a}function U(t,e,n){var o,i=t.molecule,a=new r,s={};if(e||(e=V(i)),e.atoms){for(o=0;o<e.atoms.length;o++){var l=e.atoms[o],u=i.atoms.get(l);u.fragment in s?s[u.fragment].push(l):s[u.fragment]=[l]}if(Object.keys(s).find(function(t){return!nt.eq(i.getFragmentIds(t),nt.fromList(s[t]))}))return a;if(Object.keys(s).forEach(function(t){var e=nt.fromList(s[t]),r=i.getCoordBoundingBox(e);nt.each(e,function(t){var e=i.atoms.get(t),o=new rt;"horizontal"==n?o.x=r.min.x+r.max.x-2*e.pp.x:o.y=r.min.y+r.max.y-2*e.pp.y,a.addOp(new ot.AtomMove(t,o))})}),e.bonds)for(o=0;o<e.bonds.length;o++){var c=e.bonds[o],p=i.bonds.get(c);p.type==at.Bond.PATTERN.TYPE.SINGLE&&(p.stereo==at.Bond.PATTERN.STEREO.UP?a.addOp(new ot.BondAttr(c,"stereo",at.Bond.PATTERN.STEREO.DOWN)):p.stereo==at.Bond.PATTERN.STEREO.DOWN&&a.addOp(new ot.BondAttr(c,"stereo",at.Bond.PATTERN.STEREO.UP)))}}return a.perform(t)}function H(t,e,n,o){var i=t.molecule,a=new r;return e||(e=V(i)),e.atoms&&e.atoms.each(function(t){var e=i.atoms.get(t);a.addOp(new ot.AtomMove(t,q(e.pp,n,o)))}),e.rxnArrows&&e.rxnArrows.each(function(t){var e=i.rxnArrows.get(t);a.addOp(new ot.RxnArrowMove(t,q(e.pp,n,o)))}),e.rxnPluses&&e.rxnPluses.each(function(t){var e=i.rxnPluses.get(t);a.addOp(new ot.RxnPlusMove(t,q(e.pp,n,o)))}),e.sgroupData&&e.sgroupData.each(function(t){var e=i.sgroups.get(t);a.addOp(new ot.SGroupDataMove(t,q(e.pp,n,o)))}),e.chiralFlags&&e.chiralFlags.each(function(t){var e=i.chiralFlags.get(t);a.addOp(new ot.ChiralFlagMove(t,q(e.pp,n,o)))}),a.perform(t)}function z(t,e,n){var r=t.molecule,o=r.bonds.get(e),i=r.atoms.get(o.begin),a=r.atoms.get(o.end),s=i.pp.add(a.pp).scaled(.5),l=it.calcAngle(i.pp,a.pp),u=W(r,i.fragment);return l="horizontal"==n?-l:Math.PI/2-l,H(t,{atoms:u},s,l)}function V(t){return["atoms","bonds","frags","sgroups","rgroups","rxnArrows","rxnPluses"].reduce(function(e,n){return e[n]=t[n].keys(),e},{})}function W(t,e){var n=[];return t.atoms.each(function(t,r){r.fragment==e&&n.push(t)}),n}function q(t,e,n){var r=t.sub(e);return r=r.rotate(n),r.add_(e),r.sub(t)}function $(t,e,n){return t.molecule.atoms.get(e)[n]}function Y(t,e){return t.atoms.get(e).a.neighbors.length}function K(t,e){for(var n=t.atoms.get(e),r=[],o=0;o<n.a.neighbors.length;++o){var i=t.molecule.halfBonds.get(n.a.neighbors[o]);r.push({aid:i.end-0,bid:i.bid-0})}return r}function Z(t,e){var n=t.atoms.get(e);return nt.list(n.a.sgs)}function J(t,e){return t.molecule.atoms.get(e).pp}function X(t,e,n){return n.reduce(function(n,r){return n.action=n.action.mergeWith(B(t,e.type,[r],e.attrs,t.molecule.sgroups.newId())),n},{action:new r,selection:{atoms:n,bonds:[]}})}function Q(t,e,n,o){return Object.keys(n.reduce(function(e,n){return e[t.atoms.get(n).a.fragment]=!0,e},{})).map(Number).reduce(function(n,r){var i=o.filter(function(e){var n=t.atoms.get(e).a;return r===n.fragment}).map(Number),a=et(t,i);return n.action=n.action.mergeWith(B(t,e.type,i,e.attrs,t.molecule.sgroups.newId())),n.selection.atoms=n.selection.atoms.concat(i),n.selection.bonds=n.selection.bonds.concat(a),n},{action:new r,selection:{atoms:[],bonds:[]}})}function tt(t,e,n,o){var i=et(t,n);return o.bonds&&(i=i.concat(o.bonds)),i.reduce(function(n,r){var o=t.bonds.get(r).b;return 1===o.type&&0===o.stereo&&(n.action=n.action.mergeWith(B(t,e.type,[o.begin,o.end],e.attrs,t.molecule.sgroups.newId())),n.selection.bonds.push(r)),n},{action:new r,selection:{atoms:n,bonds:[]}})}function et(t,e){return t.bonds.keys().filter(function(n){var r=t.bonds.get(n).b;return e.includes(r.begin)&&e.includes(r.end)}).map(Number)}var nt=t("../util/set"),rt=t("../util/vec2"),ot=t("./op"),it=t("./tool/utils"),at=t("../chem/struct"),st=t("./closest");r.prototype.addOp=function(t,e){return e&&t.isDummy(e)||this.operations.push(t),t},r.prototype.mergeWith=function(t){return this.operations=this.operations.concat(t.operations),this},r.prototype.perform=function(t){var e=new r;return this.operations.each(function(n){e.addOp(n.perform(t))},this),e.operations.reverse(),e},r.prototype.isDummy=function(t){return null==this.operations.find(function(e){return!t||!e.isDummy(t)})},e.exports=Object.assign(r,{fromMultipleMove:a,fromAtomAddition:u,fromArrowAddition:f,fromArrowDeletion:h,fromChiralFlagDeletion:m,fromPlusAddition:g,fromPlusDeletion:b,fromAtomDeletion:y,fromBondDeletion:v,fromFragmentDeletion:x,fromAtomMerge:O,fromBondFlipping:T,fromTemplateOnCanvas:E,fromTemplateOnAtom:P,fromTemplateOnBond:C,fromAtomsAttrs:s,fromBondAttrs:l,fromChain:j,fromBondAddition:d,fromNewCanvas:_,fromSgroupType:N,fromSgroupDeletion:M,fromSgroupAttrs:R,fromRGroupFragment:D,fromPaste:G,fromRGroupAttrs:k,fromSgroupAddition:B,fromFlip:U,fromRotate:H,fromBondAlign:z,fromAtomAction:X,fromGroupAction:Q,fromSBAction:tt})},{"../chem/struct":77,"../util/set":199,"../util/vec2":200,"./closest":82,"./op":84,"./tool/utils":105}],82:[function(t,e,n){function r(t,e,n,r){var o=null,i=h,a=n&&"atoms"==n.map?n.id:null;return r=r||i,r=Math.min(r,i),t.atoms.each(function(t,n){if(t!==a){var i=f.dist(e,n.a.pp);i<r&&(o=t,r=i)}}),null!==o?{id:o,dist:r}:null}function o(t,e,n,r,o){var i=null,a=null,s=h;r=r||s,r=Math.min(r,s);var l=r;return t.bonds.each(function(n,r){var o=t.atoms.get(r.b.begin).a.pp,i=t.atoms.get(r.b.end).a.pp,s=f.lc2(o,.5,i,.5),u=f.dist(e,s);u<l&&(l=u,a=n)}),t.bonds.each(function(n,o){var a=t.molecule.halfBonds.get(o.b.hb1),s=a.dir,l=a.norm,u=t.atoms.get(o.b.begin).a.pp,c=t.atoms.get(o.b.end).a.pp;if(f.dot(e.sub(u),s)*f.dot(e.sub(c),s)<0){var p=Math.abs(f.dot(e.sub(u),l));p<r&&(i=n,r=p)}}),null!==a?{id:a,dist:l}:null!==i&&r>h*o?{id:i,dist:r}:null}function i(t,e){var n,r=null;return t.chiralFlags.each(function(t,o){var i=o.pp;if(Math.abs(e.x-i.x)<1){var a=Math.abs(e.y-i.y);a<.3&&(!r||a<n)&&(n=a,r={id:t,dist:n})}}),r}function a(t,e){var n=null,r=null;return t.sgroupData.each(function(t,o){if("DAT"!=o.sgroup.type)throw new Error("Data group expected");if("MRV_IMPLICIT_H"!=o.sgroup.data.fieldName){var i=o.sgroup.dataArea,a=i.p0.y<e.y&&i.p1.y>e.y&&i.p0.x<e.x&&i.p1.x>e.x,s=Math.min(Math.abs(i.p0.x-e.x),Math.abs(i.p1.x-e.x));a&&(null==r||s<n)&&(r={id:t,dist:s},n=s)}}),r}function s(t,e,n,r){r=Math.min(r||h,h);var o=null,i=n&&"frags"==n.map?n.id:null;return t.frags.each(function(n,a){if(n!=i){var s=a.calcBBox(t,n);if(s.p0.y<e.y&&s.p1.y>e.y&&s.p0.x<e.x&&s.p1.x>e.x){var l=Math.min(Math.abs(s.p0.x-e.x),Math.abs(s.p1.x-e.x));(!o||l<r)&&(r=l,o={id:n,dist:r})}}}),o}function l(t,e,n,r){r=Math.min(r||h,h);var o=null;return t.rgroups.each(function(t,i){if(t!=n&&i.labelBox&&i.labelBox.contains(e,.5)){var a=f.dist(i.labelBox.centre(),e);(!o||a<r)&&(r=a,o={id:t,dist:r})}}),o}function u(t,e){var n,r=null;return t.rxnArrows.each(function(t,o){var i=o.item.pp;if(Math.abs(e.x-i.x)<1){var a=Math.abs(e.y-i.y);a<.3&&(!r||a<n)&&(n=a,r={id:t,dist:n})}}),r}function c(t,e){var n,r=null;return t.rxnPluses.each(function(t,o){
var i=o.item.pp,a=Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y));a<.3&&(!r||a<n)&&(n=a,r={id:t,dist:n})}),r}function p(t,e){var n=null,r=h;return t.molecule.sgroups.each(function(t,o){for(var i=o.bracketDir,a=i.rotateSC(1,0),s=new f(f.dot(e,i),f.dot(e,a)),l=0;l<o.areas.length;++l){var u=o.areas[l],c=u.p0.y<s.y&&u.p1.y>s.y&&u.p0.x<s.x&&u.p1.x>s.x,p=Math.min(Math.abs(u.p0.x-s.x),Math.abs(u.p1.x-s.x));c&&(null==n||p<r)&&(n=t,r=p)}}),null!=n?{id:n,dist:r}:null}function d(t,e,n,r,o){return n=n||Object.keys(m),n.reduce(function(n,i){var a=n?n.dist:null,s=m[i](t,e,r,a,o);return null!==s&&(null===n||s.dist<n.dist)?{map:i,id:s.id,dist:s.dist}:n},null)}var f=t("../util/vec2"),h=.4,m={atoms:r,bonds:o,chiralFlags:i,sgroupData:a,sgroups:p,rxnArrows:u,rxnPluses:c,frags:s,rgroups:l};e.exports={atom:r,item:d}},{"../util/vec2":200}],83:[function(t,e,n){(function(n){function r(t,e){this.render=new p(t,Object.assign({scale:m},e)),this._selection=null,this._tool=null,this.historyStack=[],this.historyPtr=0,this.event={message:new l.Subscription,elementEdit:new l.PipelineSubscription,bondEdit:new l.PipelineSubscription,rgroupEdit:new l.PipelineSubscription,sgroupEdit:new l.PipelineSubscription,sdataEdit:new l.PipelineSubscription,quickEdit:new l.PipelineSubscription,attachEdit:new l.PipelineSubscription,change:new l.PipelineSubscription,selectionChange:new l.PipelineSubscription},o(this,t)}function o(t,e){["click","dblclick","mousedown","mousemove","mouseup","mouseleave"].forEach(function(n){var r=t.event[n]=new l.DOMSubscription;e.addEventListener(n,r.dispatch.bind(r)),r.add(function(e){return t.lastEvent=e,n in t.tool()&&t.tool()[n](e),!0},-1)})}function i(t,e){console.assert(e,"Reference point not specified"),t.render.setScrollOffset(0,0)}function a(t,e){var n=t.getVBoxObj(e||{});return c.lc2(n.p0,.5,n.p1,.5)}function s(t){var e=0,n=0;do{e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent}while(t);return new c(n,e)}var l=t("subscription"),u=t("../util/set"),c=t("../util/vec2"),p=t("../render"),d=t("./action"),f=t("./closest"),h={rgroupatom:t("./tool/rgroupatom"),select:t("./tool/select"),sgroup:t("./tool/sgroup"),eraser:t("./tool/eraser"),atom:t("./tool/atom"),bond:t("./tool/bond"),chain:t("./tool/chain"),template:t("./tool/template"),charge:t("./tool/charge"),rgroupfragment:t("./tool/rgroupfragment"),apoint:t("./tool/apoint"),attach:t("./tool/attach"),reactionarrow:t("./tool/reactionarrow"),reactionplus:t("./tool/reactionplus"),reactionmap:t("./tool/reactionmap"),reactionunmap:t("./tool/reactionunmap"),paste:t("./tool/paste"),rotate:t("./tool/rotate")},m=40,g=["atoms","bonds","frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"];r.prototype.tool=function(t,e){if(arguments.length>0){this._tool&&this._tool.cancel&&this._tool.cancel();var n=h[t](this,e);if(!n)return null;this._tool=n}return this._tool},r.prototype.struct=function(t){return arguments.length>0&&(this.selection(null),this.update(d.fromNewCanvas(this.render.ctab,t)),i(this,a(this.render.ctab))),this.render.ctab.molecule},r.prototype.options=function(t){if(arguments.length>0){var e=this.render.ctab.molecule,n=this.render.options.zoom;this.render.clientArea.innerHTML="",this.render=new p(this.render.clientArea,Object.assign({scale:m},t)),this.render.setMolecule(e),this.render.setZoom(n),this.render.update()}return this.render.options},r.prototype.zoom=function(t){return arguments.length>0&&(this.render.setZoom(t),i(this,a(this.render.ctab,this.selection())),this.render.update()),this.render.options.zoom},r.prototype.selection=function(t){if(arguments.length>0){if(this._selection=null,"all"==t){var e=this.render.ctab;t=g.reduce(function(t,n){return t[n]=e[n].ikeys(),t},{})}if(t){var n={};for(var r in t)t[r].length>0&&(n[r]=t[r].slice());0!=Object.keys(n)&&(this._selection=n)}this.render.ctab.setSelection(this._selection),this.event.selectionChange.dispatch(this._selection),this.render.update()}return this._selection},r.prototype.hover=function(t){var e=this._tool;"ci"in e&&(!t||e.ci.map!==t.map||e.ci.id!==t.id)&&(this.highlight(e.ci,!1),delete e.ci),t&&this.highlight(t,!0)&&(e.ci=t)},r.prototype.highlight=function(t,e){if(-1===["atoms","bonds","rxnArrows","rxnPluses","chiralFlags","frags","rgroups","sgroups","sgroupData"].indexOf(t.map))return!1;var n=this.render,r=n.ctab[t.map].get(t.id);if(null===r)return!0;if("sgroups"===t.map&&"DAT"===r.item.type||"sgroupData"===t.map){var o=n.ctab.sgroups.get(t.id),i=n.ctab.sgroupData.get(t.id);o&&o.setHighlight(e,n),i&&i.setHighlight(e,n)}else r.setHighlight(e,n);return!0},r.prototype.update=function(t,e){!0===t?this.render.update(!0):(e||t.isDummy()||(this.historyStack.splice(this.historyPtr,33,t),this.historyStack.length>32&&this.historyStack.shift(),this.historyPtr=this.historyStack.length,this.event.change.dispatch(t)),this.render.update())},r.prototype.historySize=function(){return{undo:this.historyPtr,redo:this.historyStack.length-this.historyPtr}},r.prototype.undo=function(){if(0==this.historyPtr)throw new Error("Undo stack is empty");this.tool()&&this.tool().cancel&&this.tool().cancel(),this.selection(null),this.historyPtr--;var t=this.historyStack[this.historyPtr].perform(this.render.ctab);this.historyStack[this.historyPtr]=t,this.event.change.dispatch(t),this.render.update()},r.prototype.redo=function(){if(this.historyPtr==this.historyStack.length)throw new Error("Redo stack is empty");this.tool()&&this.tool().cancel&&this.tool().cancel(),this.selection(null);var t=this.historyStack[this.historyPtr].perform(this.render.ctab);this.historyStack[this.historyPtr]=t,this.historyPtr++,this.event.change.dispatch(t),this.render.update()},r.prototype.on=function(t,e){this.event[t].add(e)},r.prototype.findItem=function(t,e,r){var o=n._ui_editor?new c(this.render.page2obj(t)):new c(t.pageX,t.pageY).sub(s(this.render.clientArea)),i=this.render.options;return f.item(this.render.ctab,o,e,r,i.scale)},r.prototype.explicitSelected=function(){var t=this.selection()||{},e=g.reduce(function(e,n){return e[n]=t[n]?t[n].slice():[],e},{}),n=this.render.ctab.molecule;return"bonds"in e&&e.bonds.forEach(function(t){var r=n.bonds.get(t);e.atoms=e.atoms||[],e.atoms.indexOf(r.begin)<0&&e.atoms.push(r.begin),e.atoms.indexOf(r.end)<0&&e.atoms.push(r.end)}),"atoms"in e&&"bonds"in e&&n.bonds.each(function(t){if(!("bonds"in e)||e.bonds.indexOf(t)<0){var r=n.bonds.get(t);e.atoms.indexOf(r.begin)>=0&&e.atoms.indexOf(r.end)>=0&&(e.bonds=e.bonds||[],e.bonds.push(t))}}),e},r.prototype.structSelected=function(){var t=this.render.ctab.molecule,e=this.explicitSelected(),n=t.clone(u.fromList(e.atoms),u.fromList(e.bonds),!0);return t.rxnArrows.each(function(t,r){-1!=e.rxnArrows.indexOf(t)&&n.rxnArrows.add(r.clone())}),t.rxnPluses.each(function(t,r){-1!=e.rxnPluses.indexOf(t)&&n.rxnPluses.add(r.clone())}),n.isChiral=e.chiralFlags.length>0,n.isReaction=t.isReaction&&(n.rxnArrows.count()||n.rxnPluses.count()),n},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../render":108,"../util/set":199,"../util/vec2":200,"./action":81,"./closest":82,"./tool/apoint":85,"./tool/atom":86,"./tool/attach":87,"./tool/bond":88,"./tool/chain":89,"./tool/charge":90,"./tool/eraser":91,"./tool/paste":94,"./tool/reactionarrow":95,"./tool/reactionmap":96,"./tool/reactionplus":97,"./tool/reactionunmap":98,"./tool/rgroupatom":99,"./tool/rgroupfragment":100,"./tool/rotate":101,"./tool/select":102,"./tool/sgroup":103,"./tool/template":104,subscription:57}],84:[function(t,e,n){function r(){this.type="OpBase",this.execute=function(){throw new Error("Operation.execute() is not implemented")},this.invert=function(){throw new Error("Operation.invert() is not implemented")},this.perform=function(t){return this.execute(t),this._inverted||(this._inverted=this.invert(),this._inverted._inverted=this),this._inverted},this.isDummy=function(t){return!!this._isDummy&&this._isDummy(t)}}function o(t,e){this.data={aid:null,atom:t,pos:e},this.execute=function(t){var e=t.molecule,n={};if(this.data.atom)for(var r in this.data.atom)n[r]=this.data.atom[r];n.label=n.label||"C","number"!=typeof this.data.aid?this.data.aid=e.atoms.add(new H.Atom(n)):e.atoms.set(this.data.aid,new H.Atom(n));var o=new z.Atom(t.molecule.atoms.get(this.data.aid));o.component=t.connectedComponents.add(G.single(this.data.aid)),t.atoms.set(this.data.aid,o),t.markAtom(this.data.aid,1),e.atomSetPos(this.data.aid,new F(this.data.pos))},this.invert=function(){var t=new i;return t.data=this.data,t}}function i(t){this.data={aid:t,atom:null,pos:null},this.execute=function(t){var e=t.molecule;this.data.atom||(this.data.atom=e.atoms.get(this.data.aid),this.data.pos=this.data.atom.pp);var n=t.atoms.get(this.data.aid),r=t.connectedComponents.get(n.component);G.remove(r,this.data.aid),0==G.size(r)&&t.connectedComponents.remove(n.component),t.clearVisel(n.visel),t.atoms.unset(this.data.aid),t.markItemRemoved(),e.atoms.remove(this.data.aid)},this.invert=function(){var t=new o;return t.data=this.data,t}}function a(t,e,n){this.data={aid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.molecule.atoms.get(this.data.aid);this.data2||(this.data2={aid:this.data.aid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,B(t,this.data.aid)},this._isDummy=function(t){return t.molecule.atoms.get(this.data.aid)[this.data.attribute]==this.data.value},this.invert=function(){var t=new a;return t.data=this.data2,t.data2=this.data,t}}function s(t,e,n){this.data={aid:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.aid,r=this.data.d;e.atoms.get(n).pp.add_(r),t.atoms.get(n).visel.translate(U.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||B(t,n,1)},this._isDummy=function(){return 0==this.data.d.x&&0==this.data.d.y},this.invert=function(){var t=new s;return t.data=this.data,t}}function l(t,e){this.data={bid:t,d:e},this.execute=function(t){t.bonds.get(this.data.bid).visel.translate(U.obj2scaled(this.data.d,t.render.options)),this.data.d=this.data.d.negated()},this.invert=function(){var t=new l;return t.data=this.data,t}}function u(t,e){this.data={id:t,d:e},this.execute=function(t){t.reloops.get(this.data.id)&&t.reloops.get(this.data.id).visel&&t.reloops.get(this.data.id).visel.translate(U.obj2scaled(this.data.d,t.render.options)),this.data.d=this.data.d.negated()},this.invert=function(){var t=new u;return t.data=this.data,t}}function c(t,e){this.type="OpSGroupAtomAdd",this.data={aid:e,sgid:t},this.execute=function(t){var e=t.molecule,n=this.data.aid,r=this.data.sgid,o=e.atoms.get(n);if(e.sgroups.get(r).atoms.indexOf(n)>=0)throw new Error("The same atom cannot be added to an S-group more than once");if(!o)throw new Error("OpSGroupAtomAdd: Atom "+n+" not found");e.atomAddToSGroup(r,n),B(t,n)},this.invert=function(){var t=new p;return t.data=this.data,t}}function p(t,e){this.type="OpSGroupAtomRemove",this.data={aid:e,sgid:t},this.execute=function(t){var e=this.data.aid,n=this.data.sgid,r=t.molecule,o=r.atoms.get(e),i=r.sgroups.get(n);H.SGroup.removeAtom(i,e),G.remove(o.sgs,n),B(t,e)},this.invert=function(){var t=new c;return t.data=this.data,t}}function d(t,e,n){this.type="OpSGroupAttr",this.data={sgid:t,attr:e,value:n},this.execute=function(t){var e=t.molecule,n=this.data.sgid,r=e.sgroups.get(n);"DAT"==r.type&&t.sgroupData.has(n)&&(t.clearVisel(t.sgroupData.get(n).visel),t.sgroupData.unset(n)),this.data.value=r.setAttr(this.data.attr,this.data.value)},this.invert=function(){var t=new d;return t.data=this.data,t}}function f(t,e,n){this.type="OpSGroupCreate",this.data={sgid:t,type:e,pp:n},this.execute=function(t){var e=t.molecule,n=new H.SGroup(this.data.type),r=this.data.sgid;n.id=r,e.sgroups.set(r,n),this.data.pp&&(e.sgroups.get(r).pp=new F(this.data.pp)),t.sgroups.set(r,new z.SGroup(e.sgroups.get(r))),this.data.sgid=r},this.invert=function(){var t=new h;return t.data=this.data,t}}function h(t){this.type="OpSGroupDelete",this.data={sgid:t},this.execute=function(t){var e=t.molecule,n=this.data.sgid,r=t.sgroups.get(n);if(this.data.type=r.item.type,this.data.pp=r.item.pp,"DAT"==r.item.type&&t.sgroupData.has(n)&&(t.clearVisel(t.sgroupData.get(n).visel),t.sgroupData.unset(n)),t.clearVisel(r.visel),0!=r.item.atoms.length)throw new Error("S-Group not empty!");t.sgroups.unset(n),e.sgroups.remove(n)},this.invert=function(){var t=new f;return t.data=this.data,t}}function m(t,e,n){this.type="OpSGroupAddToHierarchy",this.data={sgid:t,parent:e,children:n},this.execute=function(t){var r=t.molecule,o=this.data.sgid,i=r.sGroupForest.insert(o,e,n);this.data.parent=i.parent,this.data.children=i.children},this.invert=function(){var t=new g;return t.data=this.data,t}}function g(t){this.type="OpSGroupRemoveFromHierarchy",this.data={sgid:t},this.execute=function(t){var e=t.molecule,n=this.data.sgid;this.data.parent=e.sGroupForest.parent.get(n),this.data.children=e.sGroupForest.children.get(n),e.sGroupForest.remove(n)},this.invert=function(){var t=new m;return t.data=this.data,t}}function b(t,e,n){this.data={bid:null,bond:n,begin:t,end:e},this.execute=function(t){var e=t.molecule;if(this.data.begin==this.data.end)throw new Error("Distinct atoms expected");if(V.debug&&this.molecule.checkBondExists(this.data.begin,this.data.end))throw new Error("Bond already exists");B(t,this.data.begin,1),B(t,this.data.end,1);var n={};if(this.data.bond)for(var r in this.data.bond)n[r]=this.data.bond[r];n.type=n.type||H.Bond.PATTERN.TYPE.SINGLE,n.begin=this.data.begin,n.end=this.data.end,"number"!=typeof this.data.bid?this.data.bid=e.bonds.add(new H.Bond(n)):e.bonds.set(this.data.bid,new H.Bond(n)),e.bondInitHalfBonds(this.data.bid),e.atomAddNeighbor(e.bonds.get(this.data.bid).hb1),e.atomAddNeighbor(e.bonds.get(this.data.bid).hb2),t.bonds.set(this.data.bid,new z.Bond(t.molecule.bonds.get(this.data.bid))),t.markBond(this.data.bid,1)},this.invert=function(){var t=new y;return t.data=this.data,t}}function y(t){this.data={bid:t,bond:null,begin:null,end:null},this.execute=function(t){var e=t.molecule;this.data.bond||(this.data.bond=e.bonds.get(this.data.bid),this.data.begin=this.data.bond.begin,this.data.end=this.data.bond.end),D(t,this.data.bid);var n=t.bonds.get(this.data.bid);[n.b.hb1,n.b.hb2].each(function(e){var n=t.molecule.halfBonds.get(e);n.loop>=0&&t.loopRemove(n.loop)},t),t.clearVisel(n.visel),t.bonds.unset(this.data.bid),t.markItemRemoved();var r=e.bonds.get(this.data.bid);[r.hb1,r.hb2].each(function(t){var n=e.halfBonds.get(t),r=e.atoms.get(n.begin),o=r.neighbors.indexOf(t),i=(o+r.neighbors.length-1)%r.neighbors.length,a=(o+1)%r.neighbors.length;e.setHbNext(r.neighbors[i],r.neighbors[a]),r.neighbors.splice(o,1)},this),e.halfBonds.unset(r.hb1),e.halfBonds.unset(r.hb2),e.bonds.remove(this.data.bid)},this.invert=function(){var t=new b;return t.data=this.data,t}}function v(t,e,n){this.data={bid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.molecule.bonds.get(this.data.bid);this.data2||(this.data2={bid:this.data.bid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,D(t,this.data.bid),"type"==this.data.attribute&&k(t,this.data.bid)},this._isDummy=function(t){return t.molecule.bonds.get(this.data.bid)[this.data.attribute]==this.data.value},this.invert=function(){var t=new v;return t.data=this.data2,t.data2=this.data,t}}function w(t){this.frid=void 0===t?null:t,this.execute=function(t){var e=t.molecule,n={};null==this.frid?this.frid=e.frags.add(n):e.frags.set(this.frid,n),t.frags.set(this.frid,new z.Frag(n))},this.invert=function(){return new x(this.frid)}}function x(t){this.frid=t,this.execute=function(t){var e=t.molecule;L(t,"frags",this.frid,1),t.frags.unset(this.frid),e.frags.remove(this.frid)},this.invert=function(){return new w(this.frid)}}function O(t,e,n){this.data={rgid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.molecule.rgroups.get(this.data.rgid);this.data2||(this.data2={rgid:this.data.rgid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,L(t,"rgroups",this.data.rgid)},this._isDummy=function(t){return t.molecule.rgroups.get(this.data.rgid)[this.data.attribute]==this.data.value},this.invert=function(){var t=new O;return t.data=this.data2,t.data2=this.data,t}}function S(t,e,n){this.rgid_new=t,this.rg_new=n,this.rgid_old=null,this.rg_old=null,this.frid=e,this.execute=function(t){var e=t.molecule;if(this.rgid_old=this.rgid_old||H.RGroup.findRGroupByFragment(e.rgroups,this.frid),this.rg_old=this.rgid_old?e.rgroups.get(this.rgid_old):null,this.rg_old&&(this.rg_old.frags.remove(this.rg_old.frags.keyOf(this.frid)),t.clearVisel(t.rgroups.get(this.rgid_old).visel),0==this.rg_old.frags.count()?(t.rgroups.unset(this.rgid_old),e.rgroups.unset(this.rgid_old),t.markItemRemoved()):t.markItem("rgroups",this.rgid_old,1)),this.rgid_new){var n=e.rgroups.get(this.rgid_new);n?t.markItem("rgroups",this.rgid_new,1):(n=this.rg_new||new H.RGroup,e.rgroups.set(this.rgid_new,n),t.rgroups.set(this.rgid_new,new z.RGroup(n))),n.frags.add(this.frid)}},this.invert=function(){return new S(this.rgid_old,this.frid,this.rg_old)}}function T(t){this.data={arid:null,pos:t},this.execute=function(t){var e=t.molecule;"number"!=typeof this.data.arid?this.data.arid=e.rxnArrows.add(new H.RxnArrow):e.rxnArrows.set(this.data.arid,new H.RxnArrow),t.rxnArrows.set(this.data.arid,new z.RxnArrow(t.molecule.rxnArrows.get(this.data.arid))),e.rxnArrowSetPos(this.data.arid,new F(this.data.pos)),L(t,"rxnArrows",this.data.arid,1)},this.invert=function(){var t=new E;return t.data=this.data,t}}function E(t){this.data={arid:t,pos:null},this.execute=function(t){var e=t.molecule;this.data.pos||(this.data.pos=e.rxnArrows.get(this.data.arid).pp),t.markItemRemoved(),t.clearVisel(t.rxnArrows.get(this.data.arid).visel),t.rxnArrows.unset(this.data.arid),e.rxnArrows.remove(this.data.arid)},this.invert=function(){var t=new T;return t.data=this.data,t}}function A(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.id,r=this.data.d;e.rxnArrows.get(n).pp.add_(r),t.rxnArrows.get(n).visel.translate(U.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||L(t,"rxnArrows",n,1)},this.invert=function(){var t=new A;return t.data=this.data,t}}function P(t){this.data={plid:null,pos:t},this.execute=function(t){var e=t.molecule;"number"!=typeof this.data.plid?this.data.plid=e.rxnPluses.add(new H.RxnPlus):e.rxnPluses.set(this.data.plid,new H.RxnPlus),t.rxnPluses.set(this.data.plid,new z.RxnPlus(t.molecule.rxnPluses.get(this.data.plid))),e.rxnPlusSetPos(this.data.plid,new F(this.data.pos)),L(t,"rxnPluses",this.data.plid,1)},this.invert=function(){var t=new C;return t.data=this.data,t}}function C(t){this.data={plid:t,pos:null},this.execute=function(t){var e=t.molecule;this.data.pos||(this.data.pos=e.rxnPluses.get(this.data.plid).pp),t.markItemRemoved(),t.clearVisel(t.rxnPluses.get(this.data.plid).visel),t.rxnPluses.unset(this.data.plid),e.rxnPluses.remove(this.data.plid)},this.invert=function(){var t=new P;return t.data=this.data,t}}function j(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.id,r=this.data.d;e.rxnPluses.get(n).pp.add_(r),t.rxnPluses.get(n).visel.translate(U.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||L(t,"rxnPluses",n,1)},this.invert=function(){var t=new j;return t.data=this.data,t}}function _(t,e){this.data={id:t,d:e},this.execute=function(t){t.molecule.sgroups.get(this.data.id).pp.add_(this.data.d),this.data.d=this.data.d.negated(),L(t,"sgroupData",this.data.id,1)},this.invert=function(){var t=new _;return t.data=this.data,t}}function N(t){this.data={struct:t},this.execute=function(t){var e=t.molecule;t.clearVisels(),t.render.setMolecule(this.data.struct),this.data.struct=e},this.invert=function(){var t=new N;return t.data=this.data,t}}function R(t){this.data={pos:t},this.execute=function(e){var n=e.molecule;e.chiralFlags.count()>0&&(e.clearVisel(e.chiralFlags.get(0).visel),e.chiralFlags.unset(0)),e.chiralFlags.set(0,new z.ChiralFlag(t)),n.isChiral=!0,L(e,"chiralFlags",0,1)},this.invert=function(){var t=new I;return t.data=this.data,t}}function I(){this.data={pos:null},this.execute=function(t){var e=t.molecule;if(t.chiralFlags.count()<1)throw new Error("Cannot remove chiral flag");t.clearVisel(t.chiralFlags.get(0).visel),this.data.pos=t.chiralFlags.get(0).pp,t.chiralFlags.unset(0),e.isChiral=!1},this.invert=function(){var t=new R(this.data.pos);return t.data=this.data,t}}function M(t){this.data={d:t},this.execute=function(t){t.chiralFlags.get(0).pp.add_(this.data.d),this.data.d=this.data.d.negated(),L(t,"chiralFlags",0,1)},this.invert=function(){var t=new M;return t.data=this.data,t}}function B(t,e,n){var r=t.atoms.get(e);t.markAtom(e,n?1:0);for(var o=t.molecule.halfBonds,i=0;i<r.a.neighbors.length;++i){var a=r.a.neighbors[i];if(o.has(a)){var s=o.get(a);t.markBond(s.bid,1),t.markAtom(s.end,0),n&&k(t,s.bid)}}}function k(t,e){var n=t.bonds.get(e),r=t.molecule.halfBonds.get(n.b.hb1).loop,o=t.molecule.halfBonds.get(n.b.hb2).loop;r>=0&&t.loopRemove(r),o>=0&&t.loopRemove(o)}function D(t,e){var n=t.bonds.get(e);k(t,e),B(t,n.b.begin,0),B(t,n.b.end,0)}function L(t,e,n,r){"atoms"==e?B(t,n,r):"bonds"==e?(D(t,n),r>0&&k(t,n)):t.markItem(e,n,r)}var F=t("../util/vec2"),G=t("../util/set"),U=t("../util/scale"),H=t("../chem/struct"),z=t("../render/restruct"),V={debug:!1,logcnt:0,logmouse:!1,hl:!1};V.logMethod=function(){},o.prototype=new r,i.prototype=new r,a.prototype=new r,s.prototype=new r,l.prototype=new r,u.prototype=new r,c.prototype=new r,p.prototype=new r,d.prototype=new r,f.prototype=new r,h.prototype=new r,m.prototype=new r,g.prototype=new r,b.prototype=new r,y.prototype=new r,v.prototype=new r,w.prototype=new r,x.prototype=new r,O.prototype=new r,S.prototype=new r,T.prototype=new r,E.prototype=new r,A.prototype=new r,P.prototype=new r,C.prototype=new r,j.prototype=new r,_.prototype=new r,N.prototype=new r,R.prototype=new r,I.prototype=new r,M.prototype=new r,e.exports={AtomAdd:o,AtomDelete:i,AtomAttr:a,AtomMove:s,BondMove:l,LoopMove:u,SGroupAtomAdd:c,SGroupAtomRemove:p,SGroupAttr:d,SGroupCreate:f,SGroupDelete:h,SGroupAddToHierarchy:m,SGroupRemoveFromHierarchy:g,BondAdd:b,BondDelete:y,BondAttr:v,FragmentAdd:w,FragmentDelete:x,RGroupAttr:O,RGroupFragment:S,RxnArrowAdd:T,RxnArrowDelete:E,RxnArrowMove:A,RxnPlusAdd:P,RxnPlusDelete:C,RxnPlusMove:j,SGroupDataMove:_,CanvasLoad:N,ChiralFlagAdd:R,ChiralFlagDelete:I,ChiralFlagMove:M}},{"../chem/struct":77,"../render/restruct":110,"../util/scale":198,"../util/set":199,"../util/vec2":200}],85:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);this.editor=t,this.editor.selection(null)}var o=t("../action");r.prototype.mousemove=function(t){this.editor.hover(this.editor.findItem(t,["atoms"]))},r.prototype.mouseup=function(t){var e=this.editor,n=e.render.ctab.molecule,r=e.findItem(t,["atoms"]);if(r&&"atoms"==r.map){this.editor.hover(null);var i=n.atoms.get(r.id),a=e.event.elementEdit.dispatch({attpnt:i.attpnt});return Promise.resolve(a).then(function(t){if(i.attpnt!=t.attpnt){var n=o.fromAtomsAttrs(e.render.ctab,r.id,t);e.update(n)}}),!0}},e.exports=r},{"../action":81}],86:[function(t,e,n){function r(t,e){if(!(this instanceof r)){if(!t.selection()||!t.selection().atoms)return new r(t,e);var n=i.fromAtomsAttrs(t.render.ctab,t.selection().atoms,e,!0);return t.update(n),t.selection(null),null}this.editor=t,this.atomProps=e,this.bondProps={type:1,stereo:o.Bond.PATTERN.STEREO.NONE}}var o=t("../../chem/struct"),i=t("../action"),a=t("./utils");r.prototype.mousedown=function(t){this.editor.hover(null);var e=this.editor.findItem(t,["atoms"]);e?"atoms"===e.map&&(this.dragCtx={item:e}):this.dragCtx={}},r.prototype.mousemove=function(t){var e=this.editor.render;if(!this.dragCtx||!this.dragCtx.item)return void this.editor.hover(this.editor.findItem(t,["atoms"]));var n=this.dragCtx,r=this.editor.findItem(t,["atoms"]);if(r&&"atoms"===r.map&&r.id===n.item.id)return void this.editor.hover(this.editor.findItem(t,["atoms"]));var o=e.ctab.molecule.atoms.get(n.item.id),s=a.calcNewAtomPos(o.pp,e.page2obj(t));n.action&&n.action.perform(e.ctab),n.action=i.fromBondAddition(e.ctab,this.bondProps,n.item.id,Object.assign({},this.atomProps),s,s)[0],this.editor.update(n.action,!0)},r.prototype.mouseup=function(t){if(this.dragCtx){var e=this.dragCtx,n=this.editor.render;this.editor.update(e.action||(e.item?i.fromAtomsAttrs(n.ctab,e.item.id,this.atomProps,!0):i.fromAtomAddition(n.ctab,n.page2obj(t),this.atomProps))),delete this.dragCtx}},e.exports=r},{"../../chem/struct":77,"../action":81,"./utils":105}],87:[function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);this.attach=e||{},this.editor=t,this.editor.selection({atoms:[this.attach.atomid]||[],bonds:[this.attach.bondid]||[]})}var o=t("../../chem/element");r.prototype.mousemove=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms","bonds"]),r=e.ctab.molecule;return n&&("atoms"==n.map&&o.map[r.atoms.get(n.id).label]||"bonds"==n.map)?this.editor.hover(n):this.editor.hover(null),!0},r.prototype.mouseup=function(t){var e=this.editor,n=e.render,r=n.ctab.molecule,i=e.findItem(t,["atoms","bonds"]);return i&&("atoms"==i.map&&o.map[r.atoms.get(i.id).label]||"bonds"==i.map)&&("atoms"==i.map?this.attach.atomid=i.id:this.attach.bondid=i.id,this.editor.selection({atoms:[this.attach.atomid],bonds:[this.attach.bondid]}),this.editor.event.attachEdit.dispatch(this.attach)),!0},e.exports=r},{"../../chem/element":60}],88:[function(t,e,n){function r(t,e){if(!(this instanceof r))return t.selection(null),new r(t,e);this.editor=t,this.atomProps={label:"C"},this.bondProps=e}function o(t,e,n,r){if(r.stereo!==s.Bond.PATTERN.STEREO.NONE&&r.type===s.Bond.PATTERN.TYPE.SINGLE&&n.type===r.type&&n.stereo===r.stereo)return l.fromBondFlipping(t,e);var o=c.indexOf(r.type)>=0?c:null;return r.stereo===s.Bond.PATTERN.STEREO.NONE&&r.type===s.Bond.PATTERN.TYPE.SINGLE&&n.stereo===s.Bond.PATTERN.STEREO.NONE&&o&&(r.type=o[(o.indexOf(n.type)+1)%o.length]),l.fromBondAttrs(t,e,r,i(t.molecule,n,r))}function i(t,e,n){return n.type==s.Bond.PATTERN.TYPE.SINGLE&&e.stereo==s.Bond.PATTERN.STEREO.NONE&&n.stereo!=s.Bond.PATTERN.STEREO.NONE&&t.atoms.get(e.begin).neighbors.length<t.atoms.get(e.end).neighbors.length}var a=t("../../util/vec2"),s=t("../../chem/struct"),l=t("../action"),u=t("./utils");r.prototype.mousedown=function(t){var e=this.editor.render;return this.editor.hover(null),this.dragCtx={xy0:e.page2obj(t),item:this.editor.findItem(t,["atoms","bonds"])},this.dragCtx.item||delete this.dragCtx.item,!0},r.prototype.mousemove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this){var r=this.dragCtx;if(!("item"in r)||"atoms"==r.item.map){"action"in r&&r.action.perform(n.ctab);var o,i,s,c;"item"in r&&"atoms"==r.item.map?(o=r.item.id,i=e.findItem(t,["atoms"],r.item)):(o=this.atomProps,s=r.xy0,i=e.findItem(t,["atoms"]));var p=Number.MAX_VALUE;if(i&&"atoms"==i.map)i=i.id;else{i=this.atomProps;var d=n.page2obj(t);if(p=a.dist(r.xy0,d),s)c=u.calcNewAtomPos(s,d);else{var f=n.ctab.molecule.atoms.get(o);s=u.calcNewAtomPos(f.pp.get_xy0(),d)}}return p>.3?r.action=l.fromBondAddition(n.ctab,this.bondProps,o,i,s,c)[0]:delete r.action,this.editor.update(r.action,!0),!0}}return this.editor.hover(this.editor.findItem(t,["atoms","bonds"])),!0},r.prototype.mouseup=function(t){if("dragCtx"in this){var e=this.dragCtx,n=this.editor.render,r=n.ctab.molecule;if("action"in e)this.editor.update(e.action);else if("item"in e){if("atoms"==e.item.map)this.editor.update(l.fromBondAddition(n.ctab,this.bondProps,e.item.id)[0]);else if("bonds"==e.item.map){var i=Object.assign({},this.bondProps),u=r.bonds.get(e.item.id);this.editor.update(o(n.ctab,e.item.id,u,i))}}else{var c=n.page2obj(t),p=new a(.5,0).rotate(this.bondProps.type==s.Bond.PATTERN.TYPE.SINGLE?-Math.PI/6:0),d=l.fromBondAddition(n.ctab,this.bondProps,{label:"C"},{label:"C"},a.diff(c,p),a.sum(c,p));this.editor.update(d[0])}delete this.dragCtx}return!0};var c=[s.Bond.PATTERN.TYPE.SINGLE,s.Bond.PATTERN.TYPE.DOUBLE,s.Bond.PATTERN.TYPE.TRIPLE];e.exports=Object.assign(r,{bondChangingAction:o})},{"../../chem/struct":77,"../../util/vec2":200,"../action":81,"./utils":105}],89:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);this.editor=t,this.editor.selection(null)}function o(t,e,n){var r=t.editor,o=e.ctab.molecule.atoms.get(n);t.dragCtx.timeout=setTimeout(function(){delete t.dragCtx,r.selection(null);var i=r.event.quickEdit.dispatch(o);Promise.resolve(i).then(function(t){r.update(s.fromAtomsAttrs(e.ctab,n,t))})},750),t.dragCtx.stopTapping=function(){t.dragCtx.timeout&&(clearTimeout(t.dragCtx.timeout),delete t.dragCtx.timeout)}}var i=t("../../util/vec2"),a=t("../../chem/struct"),s=t("../action"),l=t("./utils"),u=t("./bond");r.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms","bonds"]);return this.editor.hover(null),this.dragCtx={xy0:e.page2obj(t),item:n},n&&"atoms"===n.map&&(this.editor.selection({atoms:[n.id]}),o(this,e,n.id)),this.dragCtx.item||delete this.dragCtx.item,!0},r.prototype.mousemove=function(t){var e=this.editor,n=e.render;if(this.dragCtx){"stopTapping"in this.dragCtx&&this.dragCtx.stopTapping(),this.editor.selection(null);var r=this.dragCtx;if(!("item"in r)||"atoms"===r.item.map){"action"in r&&r.action.perform(n.ctab);var o=n.ctab.molecule.atoms,a=r.item?o.get(r.item.id).pp:r.xy0,u=n.page2obj(t),c=Math.ceil(i.diff(u,a).length()),p=t.ctrlKey?l.calcAngle(a,u):l.fracAngle(a,u);return r.action=s.fromChain(n.ctab,a,p,c,r.item?r.item.id:null),e.event.message.dispatch({info:c+" sectors"}),this.editor.update(r.action,!0),!0}}return this.editor.hover(this.editor.findItem(t,["atoms","bonds"])),!0},r.prototype.mouseup=function(){var t=this.editor.render,e=t.ctab.molecule;if(this.dragCtx){"stopTapping"in this.dragCtx&&this.dragCtx.stopTapping();var n=this.dragCtx,r=n.action;if(!r&&n.item&&"bonds"===n.item.map){var o=e.bonds.get(n.item.id);r=u.bondChangingAction(t.ctab,n.item.id,o,{type:a.Bond.PATTERN.TYPE.SINGLE,stereo:a.Bond.PATTERN.STEREO.NONE})}delete this.dragCtx,r&&this.editor.update(r)}return!0},r.prototype.cancel=r.prototype.mouseleave=r.prototype.mouseup,e.exports=Object.assign(r,{atomLongtapEvent:o})},{"../../chem/struct":77,"../../util/vec2":200,"../action":81,"./bond":88,"./utils":105}],90:[function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);this.editor=t,this.editor.selection(null),this.charge=e}var o=t("../action"),i=t("../../chem/element");r.prototype.mousemove=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]),r=e.ctab.molecule;return n&&"atoms"==n.map&&i.map[r.atoms.get(n.id).label]?this.editor.hover(n):this.editor.hover(null),!0},r.prototype.mouseup=function(t){var e=this.editor,n=e.render,r=n.ctab.molecule,a=e.findItem(t,["atoms"]);return a&&"atoms"==a.map&&i.map[r.atoms.get(a.id).label]&&(this.editor.hover(null),this.editor.update(o.fromAtomsAttrs(n.ctab,a.id,{charge:r.atoms.get(a.id).charge+this.charge}))),!0},e.exports=r},{"../../chem/element":60,"../action":81}],91:[function(t,e,n){function r(t,e){if(!(this instanceof r)){if(!t.selection())return new r(t,e);var n=o.fromFragmentDeletion(t.render.ctab,t.selection());return t.update(n),t.selection(null),null}this.editor=t,this.maps=["atoms","bonds","rxnArrows","rxnPluses","sgroups","sgroupData","chiralFlags"],this.lassoHelper=new i(e||0,t)}var o=t("../action"),i=t("./helper/lasso");r.prototype.mousedown=function(t){this.editor.findItem(t,this.maps)||this.lassoHelper.begin(t)},r.prototype.mousemove=function(t){this.lassoHelper.running()?this.editor.selection(this.lassoHelper.addPoint(t)):this.editor.hover(this.editor.findItem(t,this.maps))},r.prototype.mouseup=function(t){var e=this.editor.render
;if(this.lassoHelper.running())this.editor.update(o.fromFragmentDeletion(e.ctab,this.lassoHelper.end(t))),this.editor.selection(null);else{var n=this.editor.findItem(t,this.maps);if(n){if(this.editor.hover(null),"atoms"==n.map)this.editor.update(o.fromAtomDeletion(e.ctab,n.id));else if("bonds"==n.map)this.editor.update(o.fromBondDeletion(e.ctab,n.id));else if("sgroups"==n.map||"sgroupData"==n.map)this.editor.update(o.fromSgroupDeletion(e.ctab,n.id));else if("rxnArrows"==n.map)this.editor.update(o.fromArrowDeletion(e.ctab,n.id));else if("rxnPluses"==n.map)this.editor.update(o.fromPlusDeletion(e.ctab,n.id));else{if("chiralFlags"!=n.map)return void console.error("EraserTool: unable to delete the object "+n.map+"["+n.id+"]");this.editor.update(o.fromChiralFlagDeletion(e.ctab))}this.editor.selection(null)}}},e.exports=r},{"../action":81,"./helper/lasso":92}],92:[function(t,e,n){function r(t,e,n){this.mode=t,this.fragment=n,this.editor=e}var o=t("./locate"),i=t("../../../render/draw"),a=t("../../../util/scale");r.prototype.getSelection=function(){var t=this.editor.render;if(0==this.mode)return o.inPolygon(t.ctab,this.points);if(1==this.mode)return o.inRectangle(t.ctab,this.points[0],this.points[1]);throw new Error("Selector mode unknown")},r.prototype.begin=function(t){var e=this.editor.render;this.points=[e.page2obj(t)],1==this.mode&&this.points.push(this.points[0])},r.prototype.running=function(){return!!this.points},r.prototype.addPoint=function(t){if(this.points){var e=this.editor.render;return 0==this.mode?this.points.push(e.page2obj(t)):1==this.mode&&(this.points=[this.points[0],e.page2obj(t)]),this.update(),this.getSelection()}return null},r.prototype.update=function(){if(this.selection&&(this.selection.remove(),this.selection=null),this.points&&this.points.length>1){var t=this.editor.render,e=this.points.map(function(e){return a.obj2scaled(e,t.options).add(t.options.offset)});this.selection=0==this.mode?i.selectionPolygon(t.paper,e,t.options):i.selectionRectangle(t.paper,e[0],e[1],t.options)}},r.prototype.end=function(){var t=this.getSelection();return this.points=null,this.update(null),t},e.exports=r},{"../../../render/draw":107,"../../../util/scale":198,"./locate":93}],93:[function(t,e,n){function r(t,e,n){var r=[],o=[],i=Math.min(e.x,n.x),s=Math.max(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.y,n.y);t.bonds.each(function(e,n){var o=a.lc2(t.atoms.get(n.b.begin).a.pp,.5,t.atoms.get(n.b.end).a.pp,.5);o.x>i&&o.x<s&&o.y>l&&o.y<u&&r.push(e)}),t.atoms.each(function(t,e){e.a.pp.x>i&&e.a.pp.x<s&&e.a.pp.y>l&&e.a.pp.y<u&&o.push(t)});var c=[],p=[];t.rxnArrows.each(function(t,e){e.item.pp.x>i&&e.item.pp.x<s&&e.item.pp.y>l&&e.item.pp.y<u&&c.push(t)}),t.rxnPluses.each(function(t,e){e.item.pp.x>i&&e.item.pp.x<s&&e.item.pp.y>l&&e.item.pp.y<u&&p.push(t)});var d=[];t.chiralFlags.each(function(t,e){e.pp.x>i&&e.pp.x<s&&e.pp.y>l&&e.pp.y<u&&d.push(t)});var f=[];return t.sgroupData.each(function(t,e){e.sgroup.pp.x>i&&e.sgroup.pp.x<s&&e.sgroup.pp.y>l&&e.sgroup.pp.y<u&&f.push(t)}),{atoms:o,bonds:r,rxnArrows:c,rxnPluses:p,chiralFlags:d,sgroupData:f}}function o(t,e){for(var n=[],r=[],o=[],s=0;s<e.length;++s)o[s]=new a(e[s].x,e[s].y);t.bonds.each(function(e,r){var s=a.lc2(t.atoms.get(r.b.begin).a.pp,.5,t.atoms.get(r.b.end).a.pp,.5);i(o,s)&&n.push(e)}),t.atoms.each(function(t,e){i(o,e.a.pp)&&r.push(t)});var l=[],u=[];t.rxnArrows.each(function(t,e){i(o,e.item.pp)&&l.push(t)}),t.rxnPluses.each(function(t,e){i(o,e.item.pp)&&u.push(t)});var c=[];t.chiralFlags.each(function(t,e){i(o,e.pp)&&c.push(t)});var p=[];return t.sgroupData.each(function(t,e){i(o,e.sgroup.pp)&&p.push(t)}),{atoms:r,bonds:n,rxnArrows:l,rxnPluses:u,chiralFlags:c,sgroupData:p}}function i(t,e){for(var n=new a(0,1),r=n.rotate(Math.PI/2),o=a.diff(t[t.length-1],e),i=a.dot(r,o),s=a.dot(n,o),l=null,u=0,c=!1,p=!1,d=0;d<t.length;++d){var f=a.diff(t[d],e),h=a.diff(f,o),m=a.dot(r,f),g=a.dot(n,f);c=!1,m*i<0&&(g*s>-1e-5?s>-1e-5&&(c=!0):(Math.abs(i)*Math.abs(g)-Math.abs(m)*Math.abs(s))*g>0&&(c=!0)),c&&p&&a.dot(h,r)*a(l,r)>=0&&(c=!1),c&&u++,o=f,i=m,s=g,l=h,p=c}return u%2!=0}var a=t("../../../util/vec2");e.exports={inRectangle:r,inPolygon:o}},{"../../../util/vec2":200}],94:[function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);this.editor=t,this.editor.selection(null),this.struct=e;var n=t.render,i=t.lastEvent?n.page2obj(t.lastEvent):null;this.action=o.fromPaste(n.ctab,this.struct,i),this.editor.update(this.action,!0)}var o=t("../action");r.prototype.mousemove=function(t){var e=this.editor.render;this.action&&this.action.perform(e.ctab),this.action=o.fromPaste(e.ctab,this.struct,e.page2obj(t)),this.editor.update(this.action,!0)},r.prototype.mouseup=function(){if(this.action){var t=this.action;delete this.action,this.editor.update(t)}},r.prototype.cancel=r.prototype.mouseleave=function(){var t=this.editor.render;this.action&&(this.action.perform(t.ctab),delete this.action)},e.exports=r},{"../action":81}],95:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);this.editor=t,this.editor.selection(null)}var o=t("../action");r.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["rxnArrows"]);n&&"rxnArrows"==n.map&&(this.editor.hover(null),this.editor.selection({rxnArrows:[n.id]}),this.dragCtx={xy0:e.page2obj(t)})},r.prototype.mousemove=function(t){var e=this.editor.render;"dragCtx"in this?(this.dragCtx.action&&this.dragCtx.action.perform(e.ctab),this.dragCtx.action=o.fromMultipleMove(e.ctab,this.editor.selection()||{},e.page2obj(t).sub(this.dragCtx.xy0)),this.editor.update(this.dragCtx.action,!0)):this.editor.hover(this.editor.findItem(t,["rxnArrows"]))},r.prototype.mouseup=function(t){var e=this.editor.render;this.dragCtx?(this.editor.update(this.dragCtx.action),delete this.dragCtx):e.ctab.molecule.rxnArrows.count()<1&&this.editor.update(o.fromArrowAddition(e.ctab,e.page2obj(t)))},e.exports=r},{"../action":81}],96:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);this.editor=t,this.editor.selection(null),this.rcs=this.editor.render.ctab.molecule.getComponents()}function o(t,e,n){for(var r,o,a=0;(!r||!o)&&a<t.reactants.length;a++){var s=i.list(t.reactants[a]);!r&&s.indexOf(e)>=0&&(r="r"),!o&&s.indexOf(n)>=0&&(o="r")}for(var l=0;(!r||!o)&&l<t.products.length;l++){var u=i.list(t.products[l]);!r&&u.indexOf(e)>=0&&(r="p"),!o&&u.indexOf(n)>=0&&(o="p")}return r&&o&&r!=o}var i=t("../../util/set"),a=t("../../util/scale"),s=t("../action"),l=t("../../render/draw");r.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);n&&"atoms"==n.map&&(this.editor.hover(null),this.dragCtx={item:n,xy0:e.page2obj(t)})},r.prototype.mousemove=function(t){var e=this.editor.render;if("dragCtx"in this){var n=this.editor.findItem(t,["atoms"],this.dragCtx.item),r=e.ctab.molecule.atoms;n&&"atoms"==n.map&&o(this.rcs,this.dragCtx.item.id,n.id)?(this.editor.hover(n),this.updateLine(r.get(this.dragCtx.item.id).pp,r.get(n.id).pp)):(this.editor.hover(null),this.updateLine(r.get(this.dragCtx.item.id).pp,e.page2obj(t)))}else this.editor.hover(this.editor.findItem(t,["atoms"]))},r.prototype.updateLine=function(t,e){if(this.line&&(this.line.remove(),this.line=null),t&&e){var n=this.editor.render;this.line=l.selectionLine(n.paper,a.obj2scaled(t,n.options).add(n.options.offset),a.obj2scaled(e,n.options).add(n.options.offset),n.options)}},r.prototype.mouseup=function(t){if("dragCtx"in this){var e=this.editor.render,n=this.editor.findItem(t,["atoms"],this.dragCtx.item);if(n&&"atoms"==n.map&&o(this.rcs,this.dragCtx.item.id,n.id)){var r=new s,i=e.ctab.molecule.atoms,a=i.get(this.dragCtx.item.id),l=i.get(n.id),u=a.aam,c=l.aam;if(!u||u!=c){if((u&&u!=c||!u&&c)&&i.each(function(t,n){t!=this.dragCtx.item.id&&(u&&n.aam==u||c&&n.aam==c)&&r.mergeWith(s.fromAtomsAttrs(e.ctab,t,{aam:0}))},this),u)r.mergeWith(s.fromAtomsAttrs(e.ctab,n.id,{aam:u}));else{var p=0;i.each(function(t,e){p=Math.max(p,e.aam||0)}),r.mergeWith(s.fromAtomsAttrs(e.ctab,this.dragCtx.item.id,{aam:p+1})),r.mergeWith(s.fromAtomsAttrs(e.ctab,n.id,{aam:p+1}))}this.editor.update(r)}}this.updateLine(null),delete this.dragCtx}this.editor.hover(null)},e.exports=r},{"../../render/draw":107,"../../util/scale":198,"../../util/set":199,"../action":81}],97:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);this.editor=t,this.editor.selection(null)}var o=t("../action");r.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["rxnPluses"]);n&&"rxnPluses"==n.map&&(this.editor.hover(null),this.editor.selection({rxnPluses:[n.id]}),this.dragCtx={xy0:e.page2obj(t)})},r.prototype.mousemove=function(t){var e=this.editor.render;"dragCtx"in this?(this.dragCtx.action&&this.dragCtx.action.perform(e.ctab),this.dragCtx.action=o.fromMultipleMove(e.ctab,this.editor.selection()||{},e.page2obj(t).sub(this.dragCtx.xy0)),this.editor.update(this.dragCtx.action,!0)):this.editor.hover(this.editor.findItem(t,["rxnPluses"]))},r.prototype.mouseup=function(t){var e=this.editor.render;this.dragCtx?(this.editor.update(this.dragCtx.action),delete this.dragCtx):this.editor.update(o.fromPlusAddition(e.ctab,e.page2obj(t)))},e.exports=r},{"../action":81}],98:[function(t,e,n){function r(t){if(!(this instanceof r))return new r(t);this.editor=t,this.editor.selection(null)}var o=t("../action");r.prototype.mousemove=function(t){var e=this.editor.findItem(t,["atoms"]);e&&"atoms"==e.map?this.editor.hover(this.editor.render.ctab.molecule.atoms.get(e.id).aam?e:null):this.editor.hover(null)},r.prototype.mouseup=function(t){var e=this.editor.findItem(t,["atoms"]),n=this.editor.render.ctab.molecule.atoms;if(e&&"atoms"==e.map&&n.get(e.id).aam){var r=new o,i=n.get(e.id).aam;n.each(function(t,e){e.aam==i&&r.mergeWith(o.fromAtomsAttrs(this.editor.render.ctab,t,{aam:0}))},this),this.editor.update(r)}this.editor.hover(null)},e.exports=r},{"../action":81}],99:[function(t,e,n){function r(t){if(!(this instanceof r))return t.selection(null),new r(t);this.editor=t}function o(t,e,n){var r=t.render.ctab.molecule,o=e?r.atoms.get(e):null,s=o?o.rglabel:0,l=o?o.label:"R#",u=t.event.elementEdit.dispatch({label:"R#",rglabel:s});Promise.resolve(u).then(function(r){r=Object.assign({},i.Atom.attrlist,r),!e&&r.rglabel?t.update(a.fromAtomAddition(t.render.ctab,n,r)):s==r.rglabel&&"R#"==l||(r.aam=o.aam,t.update(a.fromAtomsAttrs(t.render.ctab,e,r)))})}var i=t("../../chem/struct"),a=t("../action");r.prototype.mousemove=function(t){this.editor.hover(this.editor.findItem(t,["atoms"]))},r.prototype.mouseup=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);return n?"atoms"==n.map?(this.editor.hover(null),o(this.editor,n.id),!0):void 0:(this.editor.hover(null),o(this.editor,null,e.page2obj(t)),!0)},e.exports=r},{"../../chem/struct":77,"../action":81}],100:[function(t,e,n){function r(t){if(!(this instanceof r))return t.selection(null),new r(t);this.editor=t}var o=t("../../chem/struct"),i=t("../action");r.prototype.mousemove=function(t){this.editor.hover(this.editor.findItem(t,["frags","rgroups"]))},r.prototype.mouseup=function(t){var e=this.editor,n=e.render.ctab.molecule,r=e.findItem(t,["frags","rgroups"]);if(r){this.editor.hover(null);var a="rgroups"==r.map?r.id:o.RGroup.findRGroupByFragment(n.rgroups,r.id)||null,s=Object.assign({label:a},"frags"==r.map?null:n.rgroups.get(r.id)),l=e.event.rgroupEdit.dispatch(s);return Promise.resolve(l).then(function(t){var n="rgroups"==r.map?i.fromRGroupAttrs(e.render.ctab,r.id,t):i.fromRGroupFragment(e.render.ctab,t.label,r.id);e.update(n)}),!0}},e.exports=r},{"../../chem/struct":77,"../action":81}],101:[function(t,e,n){function r(t,e){if(!(this instanceof r)){if(!e)return new r(t);var n=t.render.ctab,o=t.selection(),a=o&&o.bonds&&1==Object.keys(o).length&&1==o.bonds.length,s=a?i.fromBondAlign(n,o.bonds[0],e):i.fromFlip(n,o,e);return t.update(s),null}this.editor=t,t.selection()&&t.selection().atoms||this.editor.selection(null)}var o=t("../../util/vec2"),i=t("../action"),a=t("./utils");r.prototype.mousedown=function(t){var e=new o,n=this.editor.selection(),r=this.editor.render,i=r.ctab.molecule;if(n&&n.atoms){console.assert(n.atoms.length>0);var s=null,l=!1;n.atoms.each(function(t){var r=i.atoms.get(t);e.add_(r.pp),l||r.neighbors.find(function(e){var r=i.halfBonds.get(e);if(-1==n.atoms.indexOf(r.end)){if(r.loop>=0){if(!i.atoms.get(t).neighbors.find(function(t){var e=i.halfBonds.get(t);return e.loop>=0&&-1!=n.atoms.indexOf(e.end)}))return l=!0,!0}if(null==s)s=t;else if(s!=t)return l=!0,!0}return!1})}),e=l||null==s?e.scaled(1/n.atoms.length):i.atoms.get(s).pp}else i.atoms.each(function(t,n){e.add_(n.pp)}),e=e.scaled(1/i.atoms.count());return this.dragCtx={xy0:e,angle1:a.calcAngle(e,r.page2obj(t))},!0},r.prototype.mousemove=function(t){if("dragCtx"in this){var e=this.editor.render,n=this.dragCtx,r=e.page2obj(t),o=a.calcAngle(n.xy0,r)-n.angle1;t.ctrlKey||(o=a.fracAngle(o));var s=a.degrees(o);if("angle"in n&&n.angle==s)return!0;"action"in n&&n.action.perform(e.ctab),n.angle=s,n.action=i.fromRotate(e.ctab,this.editor.selection(),n.xy0,o),s>180?s-=360:s<=-180&&(s+=360),this.editor.event.message.dispatch({info:s+"º"}),this.editor.update(n.action,!0)}return!0},r.prototype.mouseup=function(){if(this.dragCtx){var t=this.dragCtx.action;delete this.dragCtx,t?this.editor.update(t):this.editor.selection(null)}return!0},r.prototype.cancel=r.prototype.mouseleave=r.prototype.mouseup,e.exports=r},{"../../util/vec2":200,"../action":81,"./utils":105}],102:[function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);this.editor=t,this.lassoHelper=new p("lasso"==e?0:1,t,"fragment"==e)}function o(t){var e={};return e[t.map]=[t.id],e}function i(t,e){if(e)for(var n in e)t[n]?t[n]=a(t[n],e[n]):t[n]=e[n].slice();return t}function a(t,e){for(var n=0;n<e.length;n++)t.indexOf(e[n])<0&&t.push(e[n]);return t}function s(t,e,n){if(!e)return!1;var r=t.ctab;if("frags"==n.map||"rgroups"==n.map){var o="frags"==n.map?r.frags.get(n.id).fragGetAtoms(t,n.id):r.rgroups.get(n.id).getAtoms(t);return!!e.atoms&&l.subset(l.fromList(o),l.fromList(e.atoms))}return!!e[n.map]&&e[n.map].indexOf(n.id)>-1}var l=t("../../util/set"),u=t("../action"),c=t("../../chem/struct"),p=t("./helper/lasso"),d=t("./sgroup"),f=t("./chain");r.prototype.mousedown=function(t){var e=this.editor.render,n=e.ctab,r=n.molecule;this.editor.hover(null);var a=this.lassoHelper.fragment||t.ctrlKey,l=this.editor.findItem(t,a?["frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]:["atoms","bonds","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]);if(l){if(this.editor.hover(null),!s(e,this.editor.selection(),l)){var u=o(l);if("frags"==l.map){var p=n.frags.get(l.id);u={atoms:p.fragGetAtoms(e,l.id),bonds:p.fragGetBonds(e,l.id)}}else if("sgroups"==l.map){var d=n.sgroups.get(l.id).item;u={atoms:c.SGroup.getAtoms(r,d),bonds:c.SGroup.getBonds(r,d)}}else if("rgroups"==l.map){var h=n.rgroups.get(l.id);u={atoms:h.getAtoms(e),bonds:h.getBonds(e)}}this.editor.selection(t.shiftKey?i(u,this.editor.selection()):u)}this.dragCtx={item:l,xy0:e.page2obj(t)},"atoms"===l.map&&f.atomLongtapEvent(this,e,l.id)}else this.lassoHelper.fragment||this.lassoHelper.begin(t);return!0},r.prototype.mousemove=function(t){var e=this.editor.render;if("dragCtx"in this){if("stopTapping"in this.dragCtx&&this.dragCtx.stopTapping(),this.dragCtx.action&&(this.dragCtx.action.perform(e.ctab),this.editor.update(this.dragCtx.action,!0)),this.dragCtx.action=u.fromMultipleMove(e.ctab,this.editor.explicitSelected(),e.page2obj(t).sub(this.dragCtx.xy0)),["atoms"].indexOf(this.dragCtx.item.map)>=0){var n=this.editor.findItem(t,[this.dragCtx.item.map],this.dragCtx.item);this.editor.hover(n&&n.map==this.dragCtx.item.map?n:null)}this.editor.update(this.dragCtx.action,!0)}else if(this.lassoHelper.running()){var r=this.lassoHelper.addPoint(t);this.editor.selection(t.shiftKey?i(r,this.editor.selection()):r)}else this.editor.hover(this.editor.findItem(t,this.lassoHelper.fragment||t.ctrlKey?["frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]:["atoms","bonds","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]));return!0},r.prototype.mouseup=function(t){if("dragCtx"in this){if("stopTapping"in this.dragCtx&&this.dragCtx.stopTapping(),["atoms"].indexOf(this.dragCtx.item.map)>=0){var e=this.editor.findItem(t,[this.dragCtx.item.map],this.dragCtx.item);if(e&&e.map==this.dragCtx.item.map){var n=this.editor.render.ctab;this.editor.hover(null),this.editor.selection(null),this.dragCtx.action=this.dragCtx.action?u.fromAtomMerge(n,this.dragCtx.item.id,e.id).mergeWith(this.dragCtx.action):u.fromAtomMerge(n,this.dragCtx.item.id,e.id)}}this.dragCtx.action&&this.editor.update(this.dragCtx.action),delete this.dragCtx}else if(this.lassoHelper.running()){var r=this.lassoHelper.end();this.editor.selection(t.shiftKey?i(r,this.editor.selection()):r)}else this.lassoHelper.fragment&&this.editor.selection(null);return!0},r.prototype.dblclick=function(t){var e=this.editor,n=this.editor.render,r=this.editor.findItem(t,["atoms","bonds","sgroups"]),i=n.ctab.molecule;if("atoms"==r.map){this.editor.selection(o(r));var a=i.atoms.get(r.id),s=e.event.elementEdit.dispatch(a);Promise.resolve(s).then(function(t){e.update(u.fromAtomsAttrs(n.ctab,r.id,t))})}else if("bonds"==r.map){this.editor.selection(o(r));var l=n.ctab.bonds.get(r.id).b,c=e.event.bondEdit.dispatch(l);Promise.resolve(c).then(function(t){e.update(u.fromBondAttrs(n.ctab,r.id,t))})}else"sgroups"==r.map&&(this.editor.selection(o(r)),d.dialog(this.editor,r.id));return!0},r.prototype.cancel=r.prototype.mouseleave=function(){if("dragCtx"in this){this.dragCtx.stopTapping&&this.dragCtx.stopTapping();var t=this.dragCtx.action;delete this.dragCtx,this.editor.update(t)}else this.lassoHelper.running()&&this.editor.selection(this.lassoHelper.end());this.editor.hover(null)},e.exports=r},{"../../chem/struct":77,"../../util/set":199,"../action":81,"./chain":89,"./helper/lasso":92,"./sgroup":103}],103:[function(t,e,n){function r(t,e){if(!(this instanceof r)){var n=t.selection()||{};if(!n.atoms&&!n.bonds)return new r(t,e);var i=t.render.ctab.molecule.sgroups,a=JSON.stringify(t.selection().atoms),s=i.find(function(t,e){return JSON.stringify(e.atoms)===a},this);return o(t,void 0!==s?s:null,e),t.selection(null),null}this.editor=t,this.type=e,this.lassoHelper=new l(1,t),this.editor.selection(null)}function o(t,e,n){var r=t.render.ctab,o=r.molecule,l=t.selection()||{},c=null!=e&&o.sgroups.get(e),p=c?c.type:n,d="DAT"==p?"sdataEdit":"sgroupEdit";if(!l.atoms&&!l.bonds&&!c)return void console.info("There is no selection or sgroup");var f=t.event[d].dispatch({type:p,attrs:c?c.getAttrs():{context:i(r,l)}});Promise.resolve(f).then(function(n){if("DAT"!=n.type&&s(o,l.atoms||[]))t.event.message.dispatch({error:"Partial S-group overlapping is not allowed."});else{var i=null!==e&&c.getAttrs().context===n.attrs.context?u.fromSgroupType(r,e,n.type).mergeWith(u.fromSgroupAttrs(r,e,n.attrs)):a(e,t,n,l);t.update(i)}}).catch(function(t){console.info("rejected",t)})}function i(t,e){if(e.atoms&&!e.bonds)return"Atom";if(!e.atoms&&e.bonds){return e.bonds.every(function(e){var n=t.bonds.get(e).b;return 1===n.type&&0===n.stereo})?"Single Bond":"Group"}var n=e.atoms.reduce(function(t,e){return t[e]=e,t},{});return t.connectedComponents.values().every(function(t){var e=Object.keys(t),r=e.reduce(function(t,e){return t+(void 0===n[e])},0);return console.info("count",r),console.info("component",e.length),0===r||r===e.length})?"Fragment":"Group"}function a(t,e,n,r){var o,i=e.render.ctab,a=i.molecule,s=null!==t&&a.sgroups.get(t),l=s&&s.atoms||r.atoms||[],c=n.attrs.context;switch(c){case"Fragment":o=u.fromGroupAction(i,n,l,i.atoms.keys());break;case"Group":o=u.fromGroupAction(i,n,l,l);break;case"Single Bond":o=u.fromSBAction(i,n,l,r);break;case"Atom":o=u.fromAtomAction(i,n,l);break;default:return u.fromSgroupAddition(i,n.type,l,n.attrs,a.sgroups.newId())}return e.selection(o.selection),null===t?o.action:o.action.mergeWith(u.fromSgroupDeletion(i,t))}function s(t,e){var n={},r={};return e.each(function(t){r[t]=!0}),0<=e.findIndex(function(o){var i=t.atoms.get(o);return 0<=p.list(i.sgs).findIndex(function(o){var i=t.sgroups.get(o);if("DAT"==i.type||o in n)return!1;var a=c.SGroup.getAtoms(t,i);if(a.length<e.length){if(0<=a.findIndex(function(t){return!(t in r)}))return!0}else if(0<=e.findIndex(function(t){return-1==a.indexOf(t)}))return!0;return!1})})}var l=t("./helper/lasso"),u=t("../action"),c=t("../../chem/struct"),p=t("../../util/set"),d=["atoms","bonds","sgroups","sgroupData"];r.prototype.mousedown=function(t){this.editor.findItem(t,d)||this.lassoHelper.begin(t)},r.prototype.mousemove=function(t){this.lassoHelper.running()?this.editor.selection(this.lassoHelper.addPoint(t)):this.editor.hover(this.editor.findItem(t,d))},r.prototype.mouseup=function(t){var e=null,n=null;if(this.lassoHelper.running())n=this.lassoHelper.end(t);else{var r=this.editor.findItem(t,d);if(!r)return;if(this.editor.hover(null),"atoms"==r.map)n={atoms:[r.id]};else if("bonds"==r.map){var i=this.editor.render.ctab.bonds.get(r.id);n={atoms:[i.b.begin,i.b.end]}}else{if("sgroups"!=r.map)return;e=r.id}}(null!=e||n&&n.atoms)&&o(this.editor,e,this.type)},e.exports=Object.assign(r,{dialog:o})},{"../../chem/struct":77,"../../util/set":199,"../action":81,"./helper/lasso":92}],104:[function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);this.editor=t,this.editor.selection(null),this.template={aid:(e.aid||1)-1,bid:(e.bid||1)-1};var n=e.struct;n.rescale();var i=new a;n.atoms.each(function(t,e){i.add_(e.pp)}),this.template.molecule=n,this.template.xy0=i.scaled(1/n.atoms.count()),this.template.angle0=l.calcAngle(n.atoms.get(this.template.aid).pp,this.template.xy0);var s=n.bonds.get(this.template.bid);this.template.sign=o(n,s,this.template.xy0)}function o(t,e,n){var r=t.atoms.get(e.begin).pp,o=t.atoms.get(e.end).pp,i=a.cross(a.diff(r,o),a.diff(n,o));return i>0?1:i<0?-1:0}var i=t("../../util/set"),a=t("../../util/vec2"),s=t("../action"),l=t("./utils");r.prototype.mousedown=function(t){var e=this.editor,n=e.render;this.editor.hover(null),this.dragCtx={xy0:n.page2obj(t),item:e.findItem(t,["atoms","bonds"])};var r=this.dragCtx,s=r.item;if(s){if("bonds"==s.map){var l=n.ctab.molecule,u=new a,c=l.bonds.get(s.id),p=l.atoms.get(c.begin).fragment,d=l.getFragmentIds(p),f=0,h=l.halfBonds.get(c.hb1).loop;if(h<0&&(h=l.halfBonds.get(c.hb2).loop),h>=0){var m=l.loops.get(h).hbs;m.each(function(t){u.add_(l.atoms.get(l.halfBonds.get(t).begin).pp),f++})}else i.each(d,function(t){u.add_(l.atoms.get(t).pp),f++});r.v0=u.scaled(1/f);var g=o(l,c,r.v0);r.sign1=g||1,r.sign2=this.template.sign}}else delete r.item;return!0},r.prototype.mousemove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this){var r,i,u,c=this.dragCtx,p=c.item,d=n.page2obj(t);c.mouse_moved=!0;var f=n.ctab.molecule;if(p){if("atoms"==p.map)r=f.atoms.get(p.id).pp,u=a.dist(r,d)>1;else if("bonds"==p.map){var h=f.bonds.get(p.id),m=o(f,h,d);return c.sign1*this.template.sign>0&&(m=-m),m==c.sign2&&c.action||("action"in c&&c.action.perform(n.ctab),c.sign2=m,c.action=s.fromTemplateOnBond(n.ctab,p.id,this.template,c.sign1*c.sign2>0),this.editor.update(c.action,!0)),!0}}else r=c.xy0;i=l.calcAngle(r,d),t.ctrlKey||(i=l.fracAngle(i));var g=l.degrees(i);if("angle"in c&&c.angle==g){if(!("extra_bond"in c))return!0;if(c.extra_bond==u)return!0}return"action"in c&&c.action.perform(n.ctab),c.angle=g,p?"atoms"==p.map&&(c.action=s.fromTemplateOnAtom(n.ctab,p.id,i,u,this.template),c.extra_bond=u):c.action=s.fromTemplateOnCanvas(n.ctab,r,i,this.template),this.editor.update(c.action,!0),!0}return this.editor.hover(this.editor.findItem(t,["atoms","bonds"])),!0},r.prototype.mouseup=function(t){var e=this.editor,n=e.render;if(this.dragCtx){var r=this.dragCtx,o=r.item,i=n.ctab,a=i.molecule;if(!r.action){if(o)if("atoms"==o.map){var u=i.atoms.get(o.id).a.neighbors.length;if(u>1)r.action=s.fromTemplateOnAtom(i,o.id,null,!0,this.template);else if(1==u){var c=a.halfBonds.get(a.atoms.get(o.id).neighbors[0]).end,p=a.atoms.get(o.id),d=a.atoms.get(c),f=l.calcAngle(d.pp,p.pp);r.action=s.fromTemplateOnAtom(i,o.id,t.ctrlKey?f:l.fracAngle(f),!1,this.template)}else r.action=s.fromTemplateOnAtom(i,o.id,0,!1,this.template)}else"bonds"==o.map&&(r.action=s.fromTemplateOnBond(i,o.id,this.template,r.sign1*r.sign2>0));else r.action=s.fromTemplateOnCanvas(n.ctab,r.xy0,0,this.template);this.editor.update(r.action,!0)}var h=this.dragCtx.action;delete this.dragCtx,h&&!h.isDummy()&&this.editor.update(h)}},r.prototype.cancel=r.prototype.mouseleave=r.prototype.mouseup,e.exports=r},{"../../util/set":199,"../../util/vec2":200,"../action":81,"./utils":105}],105:[function(t,e,n){function r(t){u=Math.PI/180*t}function o(t,e){var n=l.diff(e,t);return Math.atan2(n.y,n.x)}function i(t){return arguments.length>1&&(t=o(arguments[0],arguments[1])),Math.round(t/u)*u}function a(t,e){var n=new l(1,0).rotate(i(t,e));return n.add_(t),n}function s(t){return Math.round(t/Math.PI*180)}var l=t("../../util/vec2"),u=Math.PI/12;e.exports={calcAngle:o,fracAngle:i,calcNewAtomPos:a,degrees:s,setFracAngle:r}},{"../../util/vec2":200}],106:[function(t,e,n){(function(n){var r="undefined"!=typeof window?window.Raphael:void 0!==n?n.Raphael:null,o=t("./util/vec2");r.el.translateAbs=function(t,e){this.delta=this.delta||new o,this.delta.x+=t-0,this.delta.y+=e-0,this.transform("t"+this.delta.x.toString()+","+this.delta.y.toString())},r.st.translateAbs=function(t,e){this.forEach(function(n){n.translateAbs(t,e)})},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util/vec2":200}],107:[function(t,e,n){function r(t,e,n,r){return t.path("M{0},{1}L{2},{3}L{4},{5}M{2},{3}L{4},{6}",N(e.x),N(e.y),N(n.x),N(n.y),N(n.x-7),N(n.y-5),N(n.y+5)).attr(r.lineattr)}function o(t,e,n){var r=n.scale/5;return t.path("M{0},{4}L{0},{5}M{2},{1}L{3},{1}",N(e.x),N(e.y),N(e.x-r),N(e.x+r),N(e.y-r),N(e.y+r)).attr(n.lineattr)}function i(t,e,n,r){var o=e.p,i=n.p;return t.path(T(o,i)).attr(r.lineattr)}function a(t,e,n,r,o){return t.path("M{0},{1}L{2},{3}L{4},{5}Z",N(e.x),N(e.y),N(n.x),N(n.y),N(r.x),N(r.y)).attr(o.lineattr).attr({fill:"#000"})}function s(t,e,n,r,o,i){return t.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}Z",N(e.x),N(e.y),N(n.x),N(n.y),N(r.x),N(r.y),N(o.x),N(o.y)).attr(i.lineattr).attr({stroke:"#000",fill:"#000"})}function l(t,e,n,r,o){return t.set([e,t.path("M{0},{1}L{2},{3}",N(n.x),N(n.y),N(r.x),N(r.y)).attr(o.lineattr)])}function u(t,e,n,r,o,i){for(var a,s,l,u=e.p,c=e.norm,p=.7*i.stereoBond,d="",f=0;f<r;++f)l=u.addScaled(n,o*f),a=l.addScaled(c,p*(f+.5)/(r-.5)),s=l.addScaled(c,-p*(f+.5)/(r-.5)),d+=T(a,s);return t.path(d).attr(i.lineattr)}function c(t,e,n,r,o,i){for(var a=e.p,s=e.norm,l=.7*i.stereoBond,u="M"+N(a.x)+","+N(a.y),c=a,p=0;p<r;++p)c=a.addScaled(n,o*(p+.5)).addScaled(s,(1&p?-1:1)*l*(p+.5)/(r-.5)),u+="L"+N(c.x)+","+N(c.y);return t.path(u).attr(i.lineattr)}function p(t,e,n,r,o,i,a){return t.path(i?"M{0},{1}L{6},{7}M{4},{5}L{2},{3}":"M{0},{1}L{2},{3}M{4},{5}L{6},{7}",N(e.x),N(e.y),N(r.x),N(r.y),N(n.x),N(n.y),N(o.x),N(o.y)).attr(a.lineattr)}function d(t,e,n,r,o){for(var i,a=e.p,s=n.p,l=e.norm,u=o.bondSpace/2,c="",p=a,d=1;d<=r;++d)i=j.lc2(a,(r-d)/r,s,d/r),1&d?c+=T(p,i):(c+=T(p.addScaled(l,u),i.addScaled(l,u)),c+=T(p.addScaled(l,-u),i.addScaled(l,-u))),p=i;return t.path(c).attr(o.lineattr)}function f(t,e,n,r){var o=e.p,i=n.p,a=e.norm,s=o.addScaled(a,r.bondSpace),l=i.addScaled(a,r.bondSpace),u=o.addScaled(a,-r.bondSpace),c=i.addScaled(a,-r.bondSpace);return t.path(T(o,i)+T(s,l)+T(u,c)).attr(r.lineattr)}function h(t,e,n,r){var o=t.path(e[0]).attr(r.lineattr),i=t.path(e[1]).attr(r.lineattr);return n&&(n>0?o:i).attr({"stroke-dasharray":"- "}),t.set([o,i])}function m(t,e,n,r){var o=e.p,i=n.p;return t.path(T(o,i)).attr(r.lineattr).attr({"stroke-dasharray":"- "})}function g(t,e,n){for(var r="",o=0;o<e.length/2;++o)r+=T(e[2*o],e[2*o+1]);return t.path(r).attr(n.lineattr)}function b(t,e,n,r){var o=t.text(e.x,e.y,n).attr({font:r.font,"font-size":r.fontszsub,fill:"#000"});return P(o,C.relBox(o.getBBox())),o}function y(t,e,n){var r=.9*n.lineWidth,o=r,i=2*r;return t.path("M{0},{1}L{2},{3}L{4},{5}",N(e.x-o),N(e.y+i),N(e.x),N(e.y),N(e.x+o),N(e.y+i)).attr({stroke:"#000","stroke-width":.7*n.lineWidth,"stroke-linecap":"square","stroke-linejoin":"miter"})}function v(t,e,n){return t.circle(N(e.x),N(e.y),n.lineWidth).attr({stroke:null,fill:"#000"})}function w(t,e,n,r,o,i,a){o=o||.25,i=i||1;var s=r.addScaled(n,-.5*i),l=r.addScaled(n,.5*i),u=s.addScaled(e,-o),c=l.addScaled(e,-o);return t.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}",N(u.x),N(u.y),N(s.x),N(s.y),N(l.x),N(l.y),N(c.x),N(c.y)).attr(a.sgroupBracketStyle)}function x(t,e,n,r){return t.rect(N(Math.min(e.x,n.x)),N(Math.min(e.y,n.y)),N(Math.abs(n.x-e.x)),N(Math.abs(n.y-e.y))).attr(r.lassoStyle)}function O(t,e,n){for(var r=e[e.length-1],o="M"+N(r.x)+","+N(r.y),i=0;i<e.length;++i)o+="L"+N(e[i].x)+","+N(e[i].y);return t.path(o).attr(n.lassoStyle)}function S(t,e,n,r){return t.path(T(e,n)).attr(r.lassoStyle)}function T(t,e){return"M"+N(t.x)+","+N(t.y)+"L"+N(e.x)+","+N(e.y)+"\t"}function E(t,e,n){for(var r=0,o=j.dist(t,e),i=j.diff(e,t).normalized(),a=!0,s="",l=0;r<o;){var u=n[l%n.length],c=r+Math.min(u,o-r);a&&(s+="M "+t.addScaled(i,r).coordStr()+" L "+t.addScaled(i,c).coordStr()),r+=u,a=!a,l++}return s}function A(t,e,n,r,o,i){return[i&&1&o?E(t,n,i):T(t,n),i&&2&o?E(e,r,i):T(e,r)]}function P(t,e){if(_.vml){console.assert(null,"Souldn't go here!");var n=.16*e.height;t.translateAbs(0,n),e.y+=n}}var C=t("./util"),j=t("../util/vec2"),_=t("../raphael-ext"),N=C.tfx;e.exports={recenterText:P,arrow:r,plus:o,aromaticBondPaths:A,bondSingle:i,bondSingleUp:a,bondSingleStereoBold:s,bondDoubleStereoBold:l,bondSingleDown:u,bondSingleEither:c,bondDouble:p,bondSingleOrDouble:d,bondTriple:f,bondAromatic:h,bondAny:m,reactingCenter:g,topologyMark:b,radicalCap:y,radicalBullet:v,bracket:w,selectionRectangle:x,selectionPolygon:O,selectionLine:S}},{"../raphael-ext":106,"../util/vec2":200,"./util":123}],108:[function(t,e,n){function r(t,e){this.userOpts=e,this.useOldZoom=Prototype.Browser.IE,this.clientArea=t=$(t),this.paper=new i(t),this.dirty=!0,this.ctab=new c(new u,this),this.options=p(this.userOpts)}function o(t,e,n,r,o){var i=e<0?-e:0,a=n<0?-n:0;return t.x<r&&(i+=r-t.x),t.y<o&&(a+=o-t.y),new s(i,a)}var i=t("../raphael-ext"),a=t("../util/box2abs"),s=t("../util/vec2"),l=t("../util/scale"),u=t("../chem/struct"),c=t("./restruct"),p=t("./options"),d={debug:!1,logcnt:0,logmouse:!1,hl:!1};d.logMethod=function(){},r.prototype.view2obj=function(t,e){var n=this.scrollPos();return this.useOldZoom||(t=t.scaled(1/this.options.zoom),n=n.scaled(1/this.options.zoom)),t=e?t:t.add(n).sub(this.options.offset),l.scaled2obj(t,this.options)},r.prototype.obj2view=function(t,e){var n=l.obj2scaled(t,this.options);return n=e?n:n.add(this.options.offset).sub(this.scrollPos().scaled(1/this.options.zoom)),this.useOldZoom||(n=n.scaled(this.options.zoom)),n},r.prototype.scrollPos=function(){return new s(this.clientArea.scrollLeft,this.clientArea.scrollTop)},r.prototype.page2obj=function(t){var e=this.clientArea.cumulativeOffset(),n=new s(t.pageX-e.left,t.pageY-e.top);return this.view2obj(n)},r.prototype.setPaperSize=function(t){d.logMethod("setPaperSize"),this.sz=t,this.paper.setSize(t.x*this.options.zoom,t.y*this.options.zoom),this.setViewBox(this.options.zoom)},r.prototype.setOffset=function(t){d.logMethod("setOffset");var e=new s(t.x-this.options.offset.x,t.y-this.options.offset.y);this.clientArea.scrollLeft+=e.x,this.clientArea.scrollTop+=e.y,this.options.offset=t},r.prototype.setZoom=function(t){console.info("set zoom",t),this.options.zoom=t,this.paper.setSize(this.sz.x*t,this.sz.y*t),this.setViewBox(t)},r.prototype.setScrollOffset=function(t,e){var n=this.clientArea,r=n.clientWidth,i=n.clientHeight,a=o(this.sz.scaled(this.options.zoom),t,e,r+t,i+e).scaled(1/this.options.zoom);if(a.x>0||a.y>0){
this.setPaperSize(this.sz.add(a));var l=new s(t<0?-t:0,e<0?-e:0).scaled(1/this.options.zoom);(l.x>0||l.y>0)&&(this.ctab.translate(l),this.setOffset(this.options.offset.add(l)))}n.scrollLeft=t,n.scrollTop=e,this.update(!1)},r.prototype.setScale=function(t){this.options.offset&&(this.options.offset=this.options.offset.scaled(1/t).scaled(t)),this.userOpts.scale*=t,this.options=null,this.update(!0)},r.prototype.setViewBox=function(t){this.useOldZoom?this.setScale(t):this.paper.canvas.setAttribute("viewBox","0 0 "+this.sz.x+" "+this.sz.y)},r.prototype.setMolecule=function(t){d.logMethod("setMolecule"),this.paper.clear(),this.ctab=new c(t,this),this.options.offset=new s,this.update(!1)},r.prototype.update=function(t,e){if(e=e||new s(this.clientArea.clientWidth||100,this.clientArea.clientHeight||100),console.info("update"),this.dirty){if(this.options.autoScale){var n=this.ctab.molecule.getCoordBoundingBox(),r=n.max.y-n.min.y>0?.8*e.y/(n.max.y-n.min.y):100,o=n.max.x-n.min.x>0?.8*e.x/(n.max.x-n.min.x):100;this.userOpts.scale=Math.min(r,o),this.options.maxBondLength>0&&this.userOpts.scale>this.options.maxBondLength&&(this.userOpts.scale=this.options.maxBondLength)}this.options=p(this.userOpts),this.dirty=!1,t=!0}var i=(new Date).getTime(),u=this.ctab.update(t);this.ctab.setSelection();var c=(new Date).getTime()-i;if(t&&$("log")&&($("log").innerHTML=c.toString()+"\n"),u){var d=this.options.scale,f=this.ctab.getVBoxObj().transform(l.obj2scaled,this.options).translate(this.options.offset||new s);if(this.options.autoScale){var h=f.sz(),m=this.options.autoScaleMargin,g=new s(m,m),b=e;if(b.x<2*m+1||b.y<2*m+1)throw new Error("View box too small for the given margin");var y=Math.max(h.x/(b.x-2*m),h.y/(b.y-2*m));this.options.maxBondLength/y>1&&(y=1);var v=h.add(g.scaled(2*y));this.paper.setViewBox(f.pos().x-m*y-(b.x*y-v.x)/2,f.pos().y-m*y-(b.y*y-v.y)/2,b.x*y,b.y*y)}else{var w=s.UNIT.scaled(d),x=f.sz().length()>0?f.extend(w,w):f,O=new a(this.scrollPos(),e.scaled(1/this.options.zoom).sub(s.UNIT.scaled(20))),S=a.union(O,x);this.oldCb||(this.oldCb=new a);var T=S.sz().floor(),E=this.oldCb.p0.sub(S.p0).ceil();this.oldBb=f,this.sz&&T.x==this.sz.x&&T.y==this.sz.y||this.setPaperSize(T),this.options.offset=this.options.offset||new s,0==E.x&&0==E.y||(this.setOffset(this.options.offset.add(E)),this.ctab.translate(E))}}},e.exports=r},{"../chem/struct":77,"../raphael-ext":106,"../util/box2abs":195,"../util/scale":198,"../util/vec2":200,"./options":109,"./restruct":110}],109:[function(t,e,n){function r(t){var e=t.scale||100;t.rotationStep&&o.setFracAngle(t.rotationStep);var n=Math.ceil(e/6*1.9),r=Math.ceil(.7*n),a={showAtomIds:!1,showBondIds:!1,showHalfBondIds:!1,showLoopIds:!1,hideChiralFlag:!1,showValenceWarnings:!0,autoScale:!1,autoScaleMargin:0,maxBondLength:0,atomColoring:!0,hideImplicitHydrogen:!1,hideTerminalLabels:!1,carbonExplicitly:!1,showCharge:!0,showHydrogenLabels:"on",showValence:!0,aromaticCircle:!0,scale:e,zoom:1,offset:new i,lineWidth:e/20,bondSpace:t.doubleBondWidth||e/7,stereoBond:t.stereoBondWidth||e/7,subFontSize:r,font:"30px Arial",fontsz:n,fontszsub:r,fontRLabel:1.2*n,fontRLogic:.7*n,lineattr:{stroke:"#000","stroke-width":t.bondThickness||e/20,"stroke-linecap":"round","stroke-linejoin":"round"},selectionStyle:{fill:"#7f7",stroke:"none"},highlightStyle:{stroke:"#0c0","stroke-width":.6*e/20},sgroupBracketStyle:{stroke:"darkgray","stroke-width":.5*e/20},lassoStyle:{stroke:"gray","stroke-width":"1px"},atomSelectionPlateRadius:1.2*n};return Object.assign({},a,t)}var o=t("../editor/tool/utils"),i=t("../util/vec2");e.exports=r},{"../editor/tool/utils":105,"../util/vec2":200}],110:[function(t,e,n){function r(t,e){this.render=e,this.atoms=new l,this.bonds=new l,this.reloops=new l,this.rxnPluses=new l,this.rxnArrows=new l,this.frags=new l,this.rgroups=new l,this.sgroups=new l,this.sgroupData=new l,this.chiralFlags=new l,this.molecule=t||new h,this.initialized=!1,this.layers=[],this.initLayers(),this.connectedComponents=new u,this.ccFragmentType=new l;for(var n in r.maps)this[n+"Changed"]={};if(this.structChanged=!1,t.atoms.each(function(t,e){this.atoms.set(t,new m(e))},this),t.bonds.each(function(t,e){this.bonds.set(t,new g(e))},this),t.loops.each(function(t,e){this.reloops.set(t,new T(e))},this),t.rxnPluses.each(function(t,e){this.rxnPluses.set(t,new b(e))},this),t.rxnArrows.each(function(t,e){this.rxnArrows.set(t,new y(e))},this),t.frags.each(function(t,e){this.frags.set(t,new v(e))},this),t.rgroups.each(function(t,e){this.rgroups.set(t,new w(e))},this),t.sgroups.each(function(t,e){this.sgroups.set(t,new S(e)),"DAT"!=e.type||e.data.attached||this.sgroupData.set(t,new x(e))},this),t.isChiral&&!this.render.options.hideChiralFlag){var o=t.getCoordBoundingBox();this.chiralFlags.set(0,new O(new p(o.max.x,o.min.y-1)))}}function o(t){if(t)for(var e in r.maps)if(t[e]&&t[e].length>0)return!1;return!0}function i(t,e){if("set"==t.type)for(var n=0;n<t.length;++n)i(t[n],e);else void 0!==t.attrs&&("font-size"in t.attrs?t.attr("font-size",t.attrs["font-size"]*e):"stroke-width"in t.attrs&&t.attr("stroke-width",t.attrs["stroke-width"]*e)),t.scale(e,e,0,0)}function a(t,e){for(var n=0;n<t.paths.length;++n)i(t.paths[n],e)}var s=t("../../util/box2abs"),l=t("../../util/map"),u=t("../../util/pool"),c=t("../../util/set"),p=t("../../util/vec2"),d=t("../../util/scale"),f=t("../util"),h=t("../../chem/struct"),m=t("./reatom"),g=t("./rebond"),b=t("./rerxnplus"),y=t("./rerxnarrow"),v=t("./refrag"),w=t("./rergroup"),x=t("./redatasgroupdata"),O=t("./rechiralflag"),S=t("./resgroup"),T=t("./reloop"),E={background:0,selectionPlate:1,highlighting:2,warnings:3,data:4,indices:5};r.prototype.connectedComponentRemoveAtom=function(t,e){if(e=e||this.atoms.get(t),!(e.component<0)){var n=this.connectedComponents.get(e.component);c.remove(n,t),c.size(n)<1&&this.connectedComponents.remove(e.component),e.component=-1}},r.prototype.clearConnectedComponents=function(){this.connectedComponents.clear(),this.atoms.each(function(t,e){e.component=-1})},r.prototype.getConnectedComponent=function(t,e){for(var n="number"==typeof t.length?[].slice.call(t):[t],r=c.empty();n.length>0;)(function(){var t=n.pop();c.add(r,t);var o=this.atoms.get(t);o.component>=0&&c.add(e,o.component);for(var i=0;i<o.a.neighbors.length;++i){var a=this.molecule.halfBonds.get(o.a.neighbors[i]).end;c.contains(r,a)||n.push(a)}}).apply(this);return r},r.prototype.addConnectedComponent=function(t){var e=this.connectedComponents.add(t),n=c.empty(),r=this.getConnectedComponent(c.list(t),n);c.remove(n,e);var o=-1;return c.each(r,function(t){var n=this.atoms.get(t);if(n.component=e,-1!=n.a.rxnFragmentType){if(-1!=o&&n.a.rxnFragmentType!=o)throw new Error("reaction fragment type mismatch");o=n.a.rxnFragmentType}},this),this.ccFragmentType.set(e,o),e},r.prototype.removeConnectedComponent=function(t){return c.each(this.connectedComponents.get(t),function(t){this.atoms.get(t).component=-1},this),this.connectedComponents.remove(t)},r.prototype.connectedComponentMergeIn=function(t,e){c.each(e,function(e){this.atoms.get(e).component=t},this),c.mergeIn(this.connectedComponents.get(t),e)},r.prototype.assignConnectedComponents=function(){this.atoms.each(function(t,e){if(!(e.component>=0)){var n=c.empty(),r=this.getConnectedComponent(t,n);c.each(n,function(t){this.removeConnectedComponent(t)},this),this.addConnectedComponent(r)}},this)},r.prototype.connectedComponentGetBoundingBox=function(t,e,n){return e=e||this.connectedComponents.get(t),n=n||{min:null,max:null},c.each(e,function(t){var e=d.obj2scaled(this.atoms.get(t).a.pp,this.render.options);null==n.min?n.min=n.max=e:(n.min=n.min.min(e),n.max=n.max.max(e))},this),n},r.prototype.initLayers=function(){for(var t in E)this.layers[E[t]]=this.render.paper.rect(0,0,10,10).attr({class:t+"Layer",fill:"#000",opacity:"0.0"}).toFront()},r.prototype.addReObjectPath=function(t,e,n,r,o){if(n){var i=this.render.options.offset,a=o?s.fromRelBox(f.relBox(n.getBBox())):null,l=r&&a?a.translate(r.negated()):null;null!==i&&(n.translateAbs(i.x,i.y),a=a?a.translate(i):null),e.add(n,a,l),n.insertBefore(this.layers[E[t]])}},r.prototype.clearMarks=function(){for(var t in r.maps)this[t+"Changed"]={};this.structChanged=!1},r.prototype.markItemRemoved=function(){this.structChanged=!0},r.prototype.markBond=function(t,e){this.markItem("bonds",t,e)},r.prototype.markAtom=function(t,e){this.markItem("atoms",t,e)},r.prototype.markItem=function(t,e,n){var r=this[t+"Changed"];r[e]=void 0!==r[e]?Math.max(n,r[e]):n,this[t].has(e)&&this.clearVisel(this[t].get(e).visel)},r.prototype.clearVisel=function(t){for(var e=0;e<t.paths.length;++e)t.paths[e].remove();t.clear()},r.prototype.eachItem=function(t,e){for(var n in r.maps)this[n].each(function(n,r){t.call(e,r)})},r.prototype.getVBoxObj=function(t){if(t=t||{},o(t))for(var e in r.maps)t[e]=this[e].keys();var n=null;for(e in r.maps)t[e]&&t[e].forEach(function(t){var r=this[e].get(t).getVBoxObj(this.render);r&&(n=n?s.union(n,r):r.clone())},this);return n=n||new s(0,0,0,0)},r.prototype.translate=function(t){this.eachItem(function(e){e.visel.translate(t)})},r.prototype.scale=function(t){this.eachItem(function(e){a(e.visel,t)})},r.prototype.clearVisels=function(){this.eachItem(function(t){this.clearVisel(t.visel)},this)},r.prototype.update=function(t){t=t||!this.initialized;var e;t?function(){for(var t in r.maps){var e=this[t+"Changed"];this[t].each(function(t){e[t]=1},this)}}.call(this):function(){for(var t in r.maps){var n=this[t+"Changed"];for(e in n)this[t].has(e)||delete n[e]}}.call(this);for(e in this.atomsChanged)this.connectedComponentRemoveAtom(e);for(var n=this.frags.findAll(function(t,e){return!e.calcBBox(this.render.ctab,t,this.render)},this),o=0;o<n.length;++o){var i=n[o];this.clearVisel(this.frags.get(i).visel),this.frags.unset(i),this.molecule.frags.remove(i)}(function(){for(var t in r.maps){var n=this[t+"Changed"];for(e in n)this.clearVisel(this[t].get(e).visel),this.structChanged|=n[e]>0}}).call(this),this.sgroups.each(function(t,e){this.clearVisel(e.visel),e.highlighting=null,e.selectionPlate=null},this),this.frags.each(function(t,e){this.clearVisel(e.visel)},this),this.rgroups.each(function(t,e){this.clearVisel(e.visel)},this),t&&(this.clearConnectedComponents(),this.molecule.initHalfBonds(),this.molecule.initNeighbors()),this.molecule.updateHalfBonds(new l(this.atomsChanged).findAll(function(t,e){return e>=0},this)),this.molecule.sortNeighbors(new l(this.atomsChanged).findAll(function(t,e){return e>=1},this)),this.assignConnectedComponents(),this.setImplicitHydrogen(),this.initialized=!0,this.verifyLoops();var a=t||this.structChanged;return a&&this.updateLoops(),this.showLabels(),this.showBonds(),a&&this.showLoops(),this.showReactionSymbols(),this.showSGroups(),this.showFragments(),this.showRGroups(),this.chiralFlags.each(function(t,e){e.show(this,t,this.render.options)},this),this.clearMarks(),!0},r.prototype.updateLoops=function(){this.reloops.each(function(t,e){this.clearVisel(e.visel)},this);var t=this.molecule.findLoops();t.bondsToMark.forEach(function(t){this.markBond(t,1)},this),t.newLoops.forEach(function(t){this.reloops.set(t,new T(this.molecule.loops.get(t)))},this)},r.prototype.showLoops=function(){var t=this.render.options;this.reloops.each(function(e,n){n.show(this,e,t)},this)},r.prototype.showReactionSymbols=function(){var t,e,n=this.render.options;for(e in this.rxnArrowsChanged)t=this.rxnArrows.get(e),t.show(this,e,n);for(e in this.rxnPlusesChanged)t=this.rxnPluses.get(e),t.show(this,e,n)},r.prototype.showSGroups=function(){var t=this.render.options;this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach(function(e){this.sgroups.get(e).show(this,e,t)},this)},r.prototype.showFragments=function(){this.frags.each(function(t,e){var n=e.draw(this.render,t);n&&this.addReObjectPath("data",e.visel,n,null,!0)},this)},r.prototype.showRGroups=function(){var t=this.render.options;this.rgroups.each(function(e,n){n.show(this,e,t)},this)},r.prototype.eachCC=function(t,e,n){this.connectedComponents.each(function(r,o){e&&this.ccFragmentType.get(r)!=e||t.call(n||this,r,o)},this)},r.prototype.getGroupBB=function(t){var e={min:null,max:null};return this.eachCC(function(t,n){e=this.connectedComponentGetBoundingBox(t,n,e)},t,this),e},r.prototype.setImplicitHydrogen=function(){this.molecule.setImplicitHydrogen(Object.keys(this.atomsChanged))},r.prototype.loopRemove=function(t){if(this.reloops.has(t)){var e=this.reloops.get(t);this.clearVisel(e.visel);for(var n=[],r=0;r<e.loop.hbs.length;++r){var o=e.loop.hbs[r];if(this.molecule.halfBonds.has(o)){var i=this.molecule.halfBonds.get(o);i.loop=-1,this.markBond(i.bid,1),this.markAtom(i.begin,1),n.push(i.bid)}}this.reloops.unset(t),this.molecule.loops.remove(t)}},r.prototype.verifyLoops=function(){var t=[];this.reloops.each(function(e,n){n.isValid(this.molecule,e)||t.push(e)},this);for(var e=0;e<t.length;++e)this.loopRemove(t[e])},r.prototype.showLabels=function(){var t=this.render.options;for(var e in this.atomsChanged){this.atoms.get(e).show(this,e,t)}},r.prototype.showBonds=function(){var t=this.render.options;for(var e in this.bondsChanged){this.bonds.get(e).show(this,e,t)}},r.prototype.setSelection=function(t){var e=0==arguments.length;for(var n in r.maps)r.maps[n].isSelectable()&&this[n].each(function(r,o){var i=e?o.selected:t&&t[n]&&t[n].indexOf(r)>-1;this.showItemSelection(o,i)},this)},r.prototype.showItemSelection=function(t,e){var n=null!=t.selectionPlate&&!t.selectionPlate.removed;if(t.selected=e,t instanceof x&&(t.sgroup.selected=e),e){if(!n){var r=this.render,o=r.options,i=r.paper;t.selectionPlate=t.makeSelectionPlate(this,i,o),this.addReObjectPath("selectionPlate",t.visel,t.selectionPlate)}t.selectionPlate&&t.selectionPlate.show()}else n&&t.selectionPlate&&t.selectionPlate.hide()},r.maps={atoms:m,bonds:g,rxnPluses:b,rxnArrows:y,frags:v,rgroups:w,sgroupData:x,chiralFlags:O,sgroups:S,reloops:T},e.exports=Object.assign(r,{Atom:m,Bond:g,RxnPlus:b,RxnArrow:y,Frag:v,RGroup:w,ChiralFlag:O,SGroup:S})},{"../../chem/struct":77,"../../util/box2abs":195,"../../util/map":196,"../../util/pool":197,"../../util/scale":198,"../../util/set":199,"../../util/vec2":200,"../util":123,"./reatom":111,"./rebond":112,"./rechiralflag":113,"./redatasgroupdata":114,"./refrag":115,"./reloop":116,"./rergroup":118,"./rerxnarrow":119,"./rerxnplus":120,"./resgroup":121}],111:[function(t,e,n){function r(t){this.init("atom"),this.a=t,this.showLabel=!1,this.hydrogenOnTheLeft=!1,this.color="#000000",this.component=-1}function o(t,e,n){var r="off"!==e.showHydrogenLabels&&"Hetero"!==e.showHydrogenLabels;if(0==n.a.neighbors.length||n.a.neighbors.length<2&&r||e.carbonExplicitly||"c"!=n.a.label.toLowerCase()||n.a.badConn&&e.showValenceWarnings||0!=n.a.isotope||0!=n.a.radical||0!=n.a.charge||n.a.explicitValence>=0||null!=n.a.atomList||null!=n.a.rglabel||n.a.alias)return!0;if(2==n.a.neighbors.length){var o=n.a.neighbors[0],i=n.a.neighbors[1],a=t.molecule.halfBonds.get(o),s=t.molecule.halfBonds.get(i),l=t.bonds.get(a.bid),u=t.bonds.get(s.bid);if(l.b.type==u.b.type&&l.b.stereo==C.Bond.PATTERN.STEREO.NONE&&u.b.stereo==C.Bond.PATTERN.STEREO.NONE&&Math.abs(P.cross(a.dir,s.dir))<.2)return!0}return!1}function i(t,e){return!!("on"==t||"Terminal"==t&&e.a.neighbors.length<2||"Hetero"==t&&"c"!=e.label.text.toLowerCase()||"Terminal and Hetero"==t&&(e.a.neighbors.length<2||"c"!=e.label.text.toLowerCase()))}function a(t,e){if(0===e.a.neighbors.length){var n=T.map[e.a.label];return!n||!!T[n].leftH}for(var r=1,o=1,i=0,a=0,s=0;s<e.a.neighbors.length;++s){var l=t.halfBonds.get(e.a.neighbors[s]).dir;l.x<=0?(r=Math.min(r,Math.abs(l.y)),i++):(o=Math.min(o,Math.abs(l.y)),a++)}return r<.51||o<.51?o<r:a>i}function s(t,e,n,r){var o={};if(t.color="black",null!=t.a.atomList)o.text=t.a.atomList.label();else if(t.a.pseudo)o.text=t.a.pseudo;else if(t.a.alias)o.text=t.a.alias;else if("R#"==t.a.label&&null!=t.a.rglabel){o.text="";for(var i=0;i<32;i++)t.a.rglabel&1<<i&&(o.text+="R"+(i+1).toString());""==o.text&&(o="R#")}else{o.text=t.a.label;var a=T.map[o.text];r.atomColoring&&a&&(t.color=T[a].color||"#000")}return o.path=e.text(n.x,n.y,o.text).attr({font:r.font,"font-size":r.fontsz,fill:t.color,"font-style":t.a.pseudo?"italic":""}),o.rbb=A.relBox(o.path.getBBox()),E.recenterText(o.path,o.rbb),null!=t.a.atomList&&y(o.path,o.rbb,(t.hydrogenOnTheLeft?-1:1)*(o.rbb.width-o.rbb.height)/2,0),t.label=o,o}function l(t,e,n,r){var o=S.obj2scaled(t.a.pp,e.options),i=e.options,a=.5*i.lineWidth,s={};return s.text=(n+1).toString(),s.path=e.paper.text(o.x,o.y,s.text).attr({font:i.font,"font-size":i.fontszsub,fill:t.color}),s.rbb=A.relBox(s.path.getBBox()),E.recenterText(s.path,s.rbb),y(s.path,s.rbb,r+.5*s.rbb.width+a,.2*t.label.rbb.height),s}function u(t,e){var n,r=S.obj2scaled(t.a.pp,e.options),o=e.options,i=e.paper,a={};switch(t.a.radical){case 1:a.path=i.set(),n=1.6*o.lineWidth,a.path.push(E.radicalBullet(i,r.add(new P(-n,0)),o),E.radicalBullet(i,r.add(new P(n,0)),o)),a.path.attr("fill",t.color);break;case 2:a.path=i.set(),a.path.push(E.radicalBullet(i,r,o)),a.path.attr("fill",t.color);break;case 3:a.path=i.set(),n=1.6*o.lineWidth,a.path.push(E.radicalCap(i,r.add(new P(-n,0)),o),E.radicalCap(i,r.add(new P(n,0)),o)),a.path.attr("stroke",t.color)}a.rbb=A.relBox(a.path.getBBox());var s=-.5*(t.label.rbb.height+a.rbb.height);return 3===t.a.radical&&(s-=o.lineWidth/2),y(a.path,a.rbb,0,s),a}function c(t,e,n){var r=S.obj2scaled(t.a.pp,e.options),o=e.options,i=.5*o.lineWidth,a={};return a.text=t.a.isotope.toString(),a.path=e.paper.text(r.x,r.y,a.text).attr({font:o.font,"font-size":o.fontszsub,fill:t.color}),a.rbb=A.relBox(a.path.getBBox()),E.recenterText(a.path,a.rbb),y(a.path,a.rbb,n-.5*a.rbb.width-i,-.3*t.label.rbb.height),a}function p(t,e,n){var r=S.obj2scaled(t.a.pp,e.options),o=e.options,i=.5*o.lineWidth,a={};a.text="";var s=Math.abs(t.a.charge);return 1!=s&&(a.text=s.toString()),t.a.charge<0?a.text+="–":a.text+="+",a.path=e.paper.text(r.x,r.y,a.text).attr({font:o.font,"font-size":o.fontszsub,fill:t.color}),a.rbb=A.relBox(a.path.getBBox()),E.recenterText(a.path,a.rbb),y(a.path,a.rbb,n+.5*a.rbb.width+i,-.3*t.label.rbb.height),a}function d(t,e,n){var r={0:"0",1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII",8:"VIII",9:"IX",10:"X",11:"XI",12:"XII",13:"XIII",14:"XIV"},o=S.obj2scaled(t.a.pp,e.options),i=e.options,a=.5*i.lineWidth,s={};if(s.text=r[t.a.explicitValence],!s.text)throw new Error("invalid valence "+t.a.explicitValence.toString());return s.text="("+s.text+")",s.path=e.paper.text(o.x,o.y,s.text).attr({font:i.font,"font-size":i.fontszsub,fill:t.color}),s.rbb=A.relBox(s.path.getBBox()),E.recenterText(s.path,s.rbb),y(s.path,s.rbb,n+.5*s.rbb.width+a,-.3*t.label.rbb.height),s}function f(t,e,n,r){var o=r.hydroIndex,i=t.hydrogenOnTheLeft,a=S.obj2scaled(t.a.pp,e.options),s=e.options,l=.5*s.lineWidth,u=r.hydrogen;return u.text="H",u.path=e.paper.text(a.x,a.y,u.text).attr({font:s.font,"font-size":s.fontsz,fill:t.color}),u.rbb=A.relBox(u.path.getBBox()),E.recenterText(u.path,u.rbb),i||(y(u.path,u.rbb,r.rightMargin+.5*u.rbb.width+l,0),r.rightMargin+=u.rbb.width+l),n>1&&(o={},o.text=n.toString(),o.path=e.paper.text(a.x,a.y,o.text).attr({font:s.font,"font-size":s.fontszsub,fill:t.color}),o.rbb=A.relBox(o.path.getBBox()),E.recenterText(o.path,o.rbb),i||(y(o.path,o.rbb,r.rightMargin+.5*o.rbb.width+l,.2*t.label.rbb.height),r.rightMargin+=o.rbb.width+l)),i&&(null!=o&&(y(o.path,o.rbb,r.leftMargin-.5*o.rbb.width-l,.2*t.label.rbb.height),r.leftMargin-=o.rbb.width+l),y(u.path,u.rbb,r.leftMargin-.5*u.rbb.width-l,0),r.leftMargin-=u.rbb.width+l),Object.assign(r,{hydrogen:u,hydroIndex:o})}function h(t,e,n,r){var o=S.obj2scaled(t.a.pp,e.options),i=.5*e.options.lineWidth,a=A.tfx,s={},l=o.y+t.label.rbb.height/2+i;return s.path=e.paper.path("M{0},{1}L{2},{3}",a(o.x+n),a(l),a(o.x+r),a(l)).attr(e.options.lineattr).attr({stroke:"#F00"}),s.rbb=A.relBox(s.path.getBBox()),s}function m(t,e,n,r){var o,i,a=Prototype.Browser.IE?"*":"∗",s=S.obj2scaled(t.a.pp,e.options),l=e.options,u=A.tfx;for(o=0,0;o<4;++o){var c="";if(t.a.attpnt&1<<o){for(c.length>0&&(c+=" "),c+=a,i=0;i<(0==o?0:o+1);++i)c+="'";var p=new P(s),d=s.addScaled(n,.7*l.scale),f=e.paper.text(d.x,d.y,c).attr({font:l.font,"font-size":l.fontsz,fill:t.color}),h=A.relBox(f.getBBox());E.recenterText(f,h);var m=n.negated();d=d.addScaled(m,P.shiftRayBox(d,m,x.fromRelBox(h))+l.lineWidth/2),p=w(t,p,n,l.lineWidth);var g=n.rotateSC(1,0),b=d.addScaled(g,.05*l.scale).addScaled(m,.09*l.scale),y=d.addScaled(g,-.05*l.scale).addScaled(m,.09*l.scale),v=e.paper.set();v.push(f,e.paper.path("M{0},{1}L{2},{3}M{4},{5}L{2},{3}L{6},{7}",u(p.x),u(p.y),u(d.x),u(d.y),u(b.x),u(b.y),u(y.x),u(y.y)).attr(e.options.lineattr).attr({"stroke-width":l.lineWidth/2})),r("indices",t.visel,v,s),n=n.rotate(Math.PI/6)}}}function g(t){var e="";if(t.a.aam>0&&(e+=t.a.aam),t.a.invRet>0)if(e.length>0&&(e+=","),1==t.a.invRet)e+="Inv";else{if(2!=t.a.invRet)throw new Error("Invalid value for the invert/retain flag");e+="Ret"}if(t.a.exactChangeFlag>0){if(e.length>0&&(e+=","),1!=t.a.exactChangeFlag)throw new Error("Invalid value for the exact change flag");e+="ext"}return e}function b(t){var e="";if(0!=t.a.ringBondCount)if(t.a.ringBondCount>0)e+="rb"+t.a.ringBondCount.toString();else if(-1==t.a.ringBondCount)e+="rb0";else{if(-2!=t.a.ringBondCount)throw new Error("Ring bond count invalid");e+="rb*"}if(0!=t.a.substitutionCount)if(e.length>0&&(e+=","),t.a.substitutionCount>0)e+="s"+t.a.substitutionCount.toString();else if(-1==t.a.substitutionCount)e+="s0";else{if(-2!=t.a.substitutionCount)throw new Error("Substitution count invalid");e+="s*"}if(t.a.unsaturatedAtom>0){if(e.length>0&&(e+=","),1!=t.a.unsaturatedAtom)throw new Error("Unsaturated atom invalid value");e+="u"}return t.a.hCount>0&&(e.length>0&&(e+=","),e+="H"+(t.a.hCount-1).toString()),e}function y(t,e,n,r){t.translateAbs(n,r),e.x+=n,e.y+=r}function v(t,e){var n=[];t.a.neighbors.each(function(t){var r=e.halfBonds.get(t);n.push(r.ang)}),n=n.sort(function(t,e){return t-e});for(var r=[],o=0;o<n.length-1;++o)r.push(n[(o+1)%n.length]-n[o]);r.push(n[0]-n[n.length-1]+2*Math.PI);var i=0,a=-Math.PI/2;for(o=0;o<n.length;++o)r[o]>i&&(i=r[o],a=n[o]+r[o]/2);return new P(Math.cos(a),Math.sin(a))}function w(t,e,n,r){for(var o=0,i=t.visel,a=0;a<i.exts.length;++a){var s=i.exts[a].translate(e);o=Math.max(o,P.shiftRayBox(e,n,s))}return o>0&&(e=e.addScaled(n,o+r)),e}var x=t("../../util/box2abs"),O=t("./reobject"),S=t("../../util/scale"),T=t("../../chem/element"),E=t("../draw"),A=t("../util"),P=t("../../util/vec2"),C=t("../../chem/struct");r.prototype=new O,r.isSelectable=function(){return!0},r.prototype.getVBoxObj=function(t){return this.visel.boundingBox?O.prototype.getVBoxObj.call(this,t):new x(this.a.pp,this.a.pp)},r.prototype.drawHighlight=function(t){var e=this.makeHighlightPlate(t);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeHighlightPlate=function(t){var e=t.paper,n=t.options,r=S.obj2scaled(this.a.pp,n);return e.circle(r.x,r.y,n.atomSelectionPlateRadius).attr(n.highlightStyle)},r.prototype.makeSelectionPlate=function(t,e,n){var r=S.obj2scaled(this.a.pp,t.render.options);return e.circle(r.x,r.y,n.atomSelectionPlateRadius).attr(n.selectionStyle)},r.prototype.show=function(t,e,n){var r=t.render,w=S.obj2scaled(this.a.pp,r.options);if(this.hydrogenOnTheLeft=a(t.molecule,this),this.showLabel=o(t,r.options,this),this.showLabel){var O=s(this,r.paper,w,n),C=.5*n.lineWidth,j=O.rbb.width/2,_=-O.rbb.width/2,N=Math.floor(this.a.implicitH),R="H"==O.text;t.addReObjectPath("data",this.visel,O.path,w,!0);var I=null;if(n.showAtomIds&&(I={},I.text=e.toString(),I.path=r.paper.text(w.x,w.y,I.text).attr({font:n.font,"font-size":n.fontszsub,fill:"#070"}),I.rbb=A.relBox(I.path.getBBox()),E.recenterText(I.path,I.rbb),t.addReObjectPath("indices",this.visel,I.path,w)),this.setHighlight(this.highlight,r),this.a.alias||this.a.pseudo)return;var M=null;if(R&&N>0&&(M=l(this,r,N,j),j+=M.rbb.width+C,t.addReObjectPath("data",this.visel,M.path,w,!0)),0!=this.a.radical){var B=u(this,r);t.addReObjectPath("data",this.visel,B.path,w,!0)}if(0!=this.a.isotope){var k=c(this,r,_);_-=k.rbb.width+C,t.addReObjectPath("data",this.visel,k.path,w,!0)}if(!R&&N>0&&i(n.showHydrogenLabels,this)){var D=f(this,r,N,{hydrogen:{},hydroIndex:M,rightMargin:j,leftMargin:_}),L=D.hydrogen;M=D.hydroIndex,j=D.rightMargin,_=D.leftMargin,t.addReObjectPath("data",this.visel,L.path,w,!0),null!=M&&t.addReObjectPath("data",this.visel,M.path,w,!0)}if(0!=this.a.charge&&n.showCharge){var F=p(this,r,j);j+=F.rbb.width+C,t.addReObjectPath("data",this.visel,F.path,w,!0)}if(this.a.explicitValence>=0&&n.showValence){var G=d(this,r,j);j+=G.rbb.width+C,t.addReObjectPath("data",this.visel,G.path,w,!0)}if(this.a.badConn&&n.showValenceWarnings){var U=h(this,r,_,j);t.addReObjectPath("warnings",this.visel,U.path,w,!0)}I&&y(I.path,I.rbb,-.5*O.rbb.width-.5*I.rbb.width-C,.3*O.rbb.height)}if(this.a.attpnt){m(this,r,v(this,t.molecule),t.addReObjectPath.bind(t))}var H=g(this),z=b(this);if(H=(z.length>0?z+"\n":"")+(H.length>0?"."+H+".":""),H.length>0){var V=T.map[this.a.label],W=r.paper.text(w.x,w.y,H).attr({font:n.font,"font-size":n.fontszsub,fill:n.atomColoring&&V&&T[V].color?T[V].color:"#000"}),q=A.relBox(W.getBBox());E.recenterText(W,q);for(var $=v(this,t.molecule),Y=this.visel,K=3,Z=0;Z<Y.exts.length;++Z)K=Math.max(K,P.shiftRayBox(w,$,Y.exts[Z].translate(w)));K+=P.shiftRayBox(w,$.negated(),x.fromRelBox(q)),$=$.scaled(8+K),y(W,q,$.x,$.y),t.addReObjectPath("data",this.visel,W,w,!0)}},e.exports=r},{"../../chem/element":60,"../../chem/struct":77,"../../util/box2abs":195,"../../util/scale":198,"../../util/vec2":200,"../draw":107,"../util":123,"./reobject":117}],112:[function(t,e,n){function r(t){this.init("bond"),this.b=t,this.doubleBondShift=0}function o(t,e,n,r){return t.neighbors.findIndex(function(t){var o=r.molecule.halfBonds.get(t),i=o.bid;if(i===e)return!1;var a=r.bonds.get(i);return a.b.type===C.Bond.PATTERN.TYPE.SINGLE&&a.b.stereo===C.Bond.PATTERN.STEREO.UP?a.b.end===o.begin||a.boldStereo&&n:!(a.b.type!==C.Bond.PATTERN.TYPE.DOUBLE||a.b.stereo!==C.Bond.PATTERN.STEREO.NONE||!n||!a.boldStereo)})}function i(t,e,n){var r=[e.b.begin,e.b.end].map(function(e){var r=n.molecule.atoms.get(e),i=o(r,t,!0,n);return i<0?-1:r.neighbors[i]},this);console.assert(2===r.length),e.neihbid1=n.atoms.get(e.b.begin).showLabel?-1:r[0],e.neihbid2=n.atoms.get(e.b.end).showLabel?-1:r[1]}function a(t,e,n){var r=[e.b.begin,e.b.end].map(function(e){var r=n.molecule.atoms.get(e),i=o(r,t,!1,n);return i<0?-1:r.neighbors[i]},n);console.assert(2===r.length),e.boldStereo=r[0]>=0&&r[1]>=0}function s(t,e,n,r){var o=null,a=t.render,s=t.molecule,p=!t.atoms.get(n.begin).showLabel,d=!t.atoms.get(r.begin).showLabel;switch(e.b.type){case C.Bond.PATTERN.TYPE.SINGLE:switch(e.b.stereo){case C.Bond.PATTERN.STEREO.UP:i(n.bid,e,t),o=e.boldStereo&&e.neihbid1>=0&&e.neihbid2>=0?u(a,n,r,e,s):l(a,n,r,e,s);break;case C.Bond.PATTERN.STEREO.DOWN:o=f(a,n,r);break;case C.Bond.PATTERN.STEREO.EITHER:o=h(a,n,r);break;default:o=j.bondSingle(a.paper,n,r,a.options)}break;case C.Bond.PATTERN.TYPE.DOUBLE:i(n.bid,e,t),o=e.b.stereo===C.Bond.PATTERN.STEREO.NONE&&e.boldStereo&&e.neihbid1>=0&&e.neihbid2>=0?c(a,n,r,e,s,p,d):m(a,n,r,e,p,d);break;case C.Bond.PATTERN.TYPE.TRIPLE:o=j.bondTriple(a.paper,n,r,a.options);break;case C.Bond.PATTERN.TYPE.AROMATIC:o=n.loop>=0&&s.loops.get(n.loop).aromatic||r.loop>=0&&s.loops.get(r.loop).aromatic?j.bondSingle(a.paper,n,r,a.options):b(a,n,r,e,p,d);break;case C.Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE:o=g(a,n,r);break;case C.Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC:case C.Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC:o=b(a,n,r,e,p,d);break;case C.Bond.PATTERN.TYPE.ANY:o=j.bondAny(a.paper,n,r,a.options);break;default:throw new Error("Bond type "+e.b.type+" not supported")}return o}function l(t,e,n,r,o){var i=e.p,a=n.p,s=e.norm,l=t.options,u=.7*l.stereoBond,c=a.addScaled(s,u),p=a.addScaled(s,-u);if(r.neihbid2>=0){var f=d(n,r.neihbid2,l.stereoBond,o);c=f[0],p=f[1]}return j.bondSingleUp(t.paper,i,c,p,l)}function u(t,e,n,r,o){var i=t.options,a=d(e,r.neihbid1,i.stereoBond,o),s=d(n,r.neihbid2,i.stereoBond,o),l=a[0],u=a[1],c=s[0],p=s[1];return j.bondSingleStereoBold(t.paper,l,u,c,p,i)}function c(t,e,n,r,o,i,a){var s=e.p,l=n.p,c=e.norm,d=r.doubleBondShift,f=1.5*t.options.stereoBond,h=s.addScaled(c,f*d),m=l.addScaled(c,f*d);d>0?(i&&(h=h.addScaled(e.dir,f*p(e.rightCos,e.rightSin))),a&&(m=m.addScaled(e.dir,-f*p(n.leftCos,n.leftSin)))):d<0&&(i&&(h=h.addScaled(e.dir,f*p(e.leftCos,e.leftSin))),a&&(m=m.addScaled(e.dir,-f*p(n.rightCos,n.rightSin))));var g=u(t,e,n,r,o);return j.bondDoubleStereoBold(t.paper,g,h,m,t.options)}function p(t,e){return e<0||Math.abs(t)>.9?0:e/(1-t)}function d(t,e,n,r){var o=r.halfBonds.get(e),i=_.dot(t.dir,o.dir),a=_.cross(t.dir,o.dir),s=Math.sqrt(.5*(1-i)),l=o.dir.rotateSC((a>=0?-1:1)*s,Math.sqrt(.5*(1+i))),u=t.p.addScaled(l,.7*n/(s+.3)),c=t.p.addScaled(l.negated(),.7*n/(s+.3));return a>0?[u,c]:[c,u]}function f(t,e,n){var r=e.p,o=n.p,i=t.options,a=o.sub(r),s=a.length()+.2;a=a.normalized();var l=1.2*i.lineWidth,u=Math.max(Math.floor((s-i.lineWidth)/(i.lineWidth+l)),0)+2,c=s/(u-1);return j.bondSingleDown(t.paper,e,a,u,c,i)}function h(t,e,n){var r=e.p,o=n.p,i=t.options,a=o.sub(r),s=a.length();a=a.normalized();var l=.6*i.lineWidth,u=Math.max(Math.floor((s-i.lineWidth)/(i.lineWidth+l)),0)+2,c=s/(u-.5);return j.bondSingleEither(t.paper,e,a,u,c,i)}function m(t,e,n,r,o,i){var a=r.b.stereo===C.Bond.PATTERN.STEREO.CIS_TRANS,s=e.p,l=n.p,u=e.norm,c=a?0:r.doubleBondShift,d=t.options,f=d.bondSpace/2,h=f+c*f,m=c*f-f,g=s.addScaled(u,h),b=l.addScaled(u,h),y=s.addScaled(u,m),v=l.addScaled(u,m);return c>0?(o&&(g=g.addScaled(e.dir,d.bondSpace*p(e.rightCos,e.rightSin))),i&&(b=b.addScaled(e.dir,-d.bondSpace*p(n.leftCos,n.leftSin)))):c<0&&(o&&(y=y.addScaled(e.dir,d.bondSpace*p(e.leftCos,e.leftSin))),i&&(v=v.addScaled(e.dir,-d.bondSpace*p(n.rightCos,n.rightSin)))),j.bondDouble(t.paper,g,y,b,v,a,d)}function g(t,e,n){var r=e.p,o=n.p,i=t.options,a=(_.dist(r,o)/(i.bondSpace+i.lineWidth)).toFixed()-0;return 1&a||(a+=1),j.bondSingleOrDouble(t.paper,e,n,a,i)}function b(t,e,n,r,o,i){var a=[.125,.125,.005,.125],s=null,l=null,u=t.options,c=r.doubleBondShift;r.b.type==C.Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC&&(s=c>0?1:2,l=a.map(function(t){return t*u.scale})),r.b.type==C.Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC&&(s=3,l=a.map(function(t){return t*u.scale}));var p=y(e,n,c,o,i,u.bondSpace,s,l);return j.bondAromatic(t.paper,p,c,u)}function y(t,e,n,r,o,i,a,s){var l=t.p,u=e.p,c=t.norm,d=i/2,f=d+n*d,h=n*d-d,m=l.addScaled(c,f),g=u.addScaled(c,f),b=l.addScaled(c,h),y=u.addScaled(c,h);return n>0?(r&&(m=m.addScaled(t.dir,i*p(t.rightCos,t.rightSin))),o&&(g=g.addScaled(t.dir,-i*p(e.leftCos,e.leftSin)))):n<0&&(r&&(b=b.addScaled(t.dir,i*p(t.leftCos,t.leftSin))),o&&(y=y.addScaled(t.dir,-i*p(e.rightCos,e.rightSin)))),j.aromaticBondPaths(m,b,g,y,a,s)}function v(t,e,n,r){var o=n.p,i=r.p,a=i.add(o).scaled(.5),s=i.sub(o).normalized(),l=s.rotateSC(1,0),u=[],c=t.options.lineWidth,p=t.options.bondSpace/2,d=c,f=2*c,h=1.5*p,m=1.5*p,g=3*p;switch(e.b.reactingCenterStatus){case C.Bond.PATTERN.REACTING_CENTER.NOT_CENTER:u.push(a.addScaled(l,g).addScaled(s,.2*g)),u.push(a.addScaled(l,-g).addScaled(s,-.2*g)),u.push(a.addScaled(l,g).addScaled(s,-.2*g)),u.push(a.addScaled(l,-g).addScaled(s,.2*g));break;case C.Bond.PATTERN.REACTING_CENTER.CENTER:u.push(a.addScaled(l,g).addScaled(s,.2*g).addScaled(s,d)),u.push(a.addScaled(l,-g).addScaled(s,-.2*g).addScaled(s,d)),u.push(a.addScaled(l,g).addScaled(s,.2*g).addScaled(s,-d)),u.push(a.addScaled(l,-g).addScaled(s,-.2*g).addScaled(s,-d)),u.push(a.addScaled(s,h).addScaled(l,m)),u.push(a.addScaled(s,-h).addScaled(l,m)),u.push(a.addScaled(s,h).addScaled(l,-m)),u.push(a.addScaled(s,-h).addScaled(l,-m));break;case C.Bond.PATTERN.REACTING_CENTER.MADE_OR_BROKEN:u.push(a.addScaled(l,g).addScaled(s,f)),u.push(a.addScaled(l,-g).addScaled(s,f)),u.push(a.addScaled(l,g).addScaled(s,-f)),u.push(a.addScaled(l,-g).addScaled(s,-f));break;case C.Bond.PATTERN.REACTING_CENTER.ORDER_CHANGED:
u.push(a.addScaled(l,g)),u.push(a.addScaled(l,-g));break;case C.Bond.PATTERN.REACTING_CENTER.MADE_OR_BROKEN_AND_CHANGED:u.push(a.addScaled(l,g).addScaled(s,f)),u.push(a.addScaled(l,-g).addScaled(s,f)),u.push(a.addScaled(l,g).addScaled(s,-f)),u.push(a.addScaled(l,-g).addScaled(s,-f)),u.push(a.addScaled(l,g)),u.push(a.addScaled(l,-g));break;default:return null}return j.reactingCenter(t.paper,u,t.options)}function w(t,e,n,r){var o=t.options,i=null;if(e.b.topology==C.Bond.PATTERN.TOPOLOGY.RING)i="rng";else{if(e.b.topology!=C.Bond.PATTERN.TOPOLOGY.CHAIN)return null;i="chn"}var a=n.p,s=r.p,l=s.add(a).scaled(.5),u=s.sub(a).normalized(),c=u.rotateSC(1,0),p=o.lineWidth;e.doubleBondShift>0?c=c.scaled(-e.doubleBondShift):0==e.doubleBondShift&&(p+=o.bondSpace/2);var d=new _(2,1).scaled(o.bondSpace);e.b.type==C.Bond.PATTERN.TYPE.TRIPLE&&(p+=o.bondSpace);var f=l.add(new _(c.x*(d.x+p),c.y*(d.y+p)));return j.topologyMark(t.paper,f,i,o)}function x(t,e,n,r,o,i,a,s){var l=_.lc(n.p,i,r.p,a,s,o),u=e.text(l.x,l.y,t.toString()),c=N.relBox(u.getBBox());return j.recenterText(u,c),u}function O(t,e){var n,r;if(n=e.halfBonds.get(t.b.hb1).loop,r=e.halfBonds.get(t.b.hb2).loop,n>=0&&r>=0){var o=e.loops.get(n).dblBonds,i=e.loops.get(r).dblBonds,a=e.loops.get(n).hbs.length,s=e.loops.get(r).hbs.length;t.doubleBondShift=E(a,s,o,i)}else t.doubleBondShift=n>=0?-1:r>=0?1:A(e,t)}function S(t,e,n){var r=e.render,o=e.atoms.get(t.b.begin),i=e.atoms.get(t.b.end),a=R.obj2scaled(o.a.pp,r.options),s=R.obj2scaled(i.a.pp,r.options),l=e.molecule.halfBonds.get(t.b.hb1),u=e.molecule.halfBonds.get(t.b.hb2);l.p=T(o,a,l.dir,2*n.lineWidth),u.p=T(i,s,u.dir,2*n.lineWidth),t.b.center=_.lc2(o.a.pp,.5,i.a.pp,.5),t.b.len=_.dist(a,s),t.b.sb=5*n.lineWidth,t.b.sa=Math.max(t.b.sb,t.b.len/2-2*n.lineWidth),t.b.angle=180*Math.atan2(l.dir.y,l.dir.x)/Math.PI}function T(t,e,n,r){for(var o=0,i=t.visel,a=0;a<i.exts.length;++a){var s=i.exts[a].translate(e);o=Math.max(o,_.shiftRayBox(e,n,s))}return o>0&&(e=e.addScaled(n,o+r)),e}function E(t,e,n,r){return 6==t&&6!=e&&(n>1||1==r)?-1:6==e&&6!=t&&(r>1||1==n)?1:e*n>t*r?-1:e*n<t*r?1:e>t?-1:1}function A(t,e){var n=t.halfBonds.get(e.b.hb1),r=t.halfBonds.get(e.b.hb2),o=(n.leftSin>.3?1:0)+(r.rightSin>.3?1:0),i=(r.leftSin>.3?1:0)+(n.rightSin>.3?1:0);return o>i?-1:o<i?1:(n.leftSin>.3?1:0)+(n.rightSin>.3?1:0)==1?1:0}var P=t("./reobject"),C=t("../../chem/struct"),j=t("../draw"),_=t("../../util/vec2"),N=t("../util"),R=t("../../util/scale");r.prototype=new P,r.isSelectable=function(){return!0},r.prototype.drawHighlight=function(t){var e=this.makeHighlightPlate(t);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeHighlightPlate=function(t){var e=t.options;S(this,t.ctab,e);var n=R.obj2scaled(this.b.center,e);return t.paper.circle(n.x,n.y,.8*e.atomSelectionPlateRadius).attr(e.highlightStyle)},r.prototype.makeSelectionPlate=function(t,e,n){S(this,t,n);var r=R.obj2scaled(this.b.center,n);return e.circle(r.x,r.y,.8*n.atomSelectionPlateRadius).attr(n.selectionStyle)},r.prototype.show=function(t,e,n){var r=t.render,o=t.molecule,i=r.paper,l=o.halfBonds.get(this.b.hb1),u=o.halfBonds.get(this.b.hb2);a(e,this,t),S(this,t,n),O(this,o),this.path=s(t,this,l,u),this.rbb=N.relBox(this.path.getBBox()),t.addReObjectPath("data",this.visel,this.path,null,!0);var c={};c.path=v(r,this,l,u),c.path&&(c.rbb=N.relBox(c.path.getBBox()),t.addReObjectPath("data",this.visel,c.path,null,!0));var p={};p.path=w(r,this,l,u),p.path&&(p.rbb=N.relBox(p.path.getBBox()),t.addReObjectPath("data",this.visel,p.path,null,!0)),this.setHighlight(this.highlight,r);var d=null,f=.6*n.subFontSize;n.showBondIds&&(d=x(e,i,l,u,f,.5,.5,l.norm),t.addReObjectPath("indices",this.visel,d)),n.showHalfBondIds&&(d=x(this.b.hb1,i,l,u,f,.8,.2,l.norm),t.addReObjectPath("indices",this.visel,d),d=x(this.b.hb2,i,l,u,f,.2,.8,u.norm),t.addReObjectPath("indices",this.visel,d)),n.showLoopIds&&!n.showBondIds&&(d=x(l.loop,i,l,u,f,.5,.5,u.norm),t.addReObjectPath("indices",this.visel,d),d=x(u.loop,i,l,u,f,.5,.5,l.norm),t.addReObjectPath("indices",this.visel,d))},e.exports=r},{"../../chem/struct":77,"../../util/scale":198,"../../util/vec2":200,"../draw":107,"../util":123,"./reobject":117}],113:[function(t,e,n){function r(t){this.init("chiralFlag"),this.pp=t}var o=t("../../util/box2abs"),i=t("../../util/scale"),a=t("./reobject");r.prototype=new a,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=o.fromRelBox(this.path.getBBox()),n=e.p1.sub(e.p0),r=e.p0.sub(t.options.offset);return t.paper.rect(r.x,r.y,n.x,n.y)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},r.prototype.show=function(t,e,n){var r=t.render;if(!(t.chiralFlagsChanged[e]<=0)){var o=r.paper,a=i.obj2scaled(this.pp,n);this.path=o.text(a.x,a.y,"Chiral").attr({font:n.font,"font-size":n.fontsz,fill:"#000"}),r.ctab.addReObjectPath("data",this.visel,this.path,null,!0)}},e.exports=r},{"../../util/box2abs":195,"../../util/scale":198,"./reobject":117}],114:[function(t,e,n){function r(t){this.init("sgroupData"),this.sgroup=t}var o=t("./reobject"),i=t("../../util/scale");r.prototype=new o,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=this.sgroup.dataArea,n=i.obj2scaled(e.p0,t.options),r=i.obj2scaled(e.p1,t.options).sub(n);return t.paper.rect(n.x,n.y,r.x,r.y)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},e.exports=r},{"../../util/scale":198,"./reobject":117}],115:[function(t,e,n){(function(n){function r(t){this.init("frag"),this.item=t}var o=t("../../util/box2abs"),i=t("../../util/vec2"),a=t("./reobject"),s=t("../../util/scale");r.prototype=new a,r.isSelectable=function(){return!1},r.prototype.fragGetAtoms=function(t,e){var n=[];return t.ctab.atoms.each(function(t,r){r.a.fragment==e&&n.push(t)},this),n},r.prototype.fragGetBonds=function(t,e){var n=[];return t.ctab.bonds.each(function(r,o){t.ctab.atoms.get(o.b.begin).a.fragment==e&&t.ctab.atoms.get(o.b.end).a.fragment==e&&n.push(r)},this),n},r.prototype.calcBBox=function(t,e,r){var a;return t.atoms.each(function(t,l){if(l.a.fragment==e){var u=l.visel.boundingBox;if(u)r||(console.warn("No boundingBox fragment precalc"),r=n._ui_editor.render),u=u.translate((r.options.offset||new i).negated()).transform(s.scaled2obj,r.options);else{u=new o(l.a.pp,l.a.pp);var c=new i(.05*3,.05*3);u=u.extend(c,c)}a=a?o.union(a,u):u}}),a},r.prototype._draw=function(t,e,n){var r=this.calcBBox(t.ctab,e,t);if(r){var o=s.obj2scaled(new i(r.p0.x,r.p0.y),t.options),a=s.obj2scaled(new i(r.p1.x,r.p1.y),t.options);return t.paper.rect(o.x,o.y,a.x-o.x,a.y-o.y,0).attr(n)}console.assert(null,"Empty fragment")},r.prototype.draw=function(t){return null},r.prototype.drawHighlight=function(t){},r.prototype.setHighlight=function(t,e){var n=e.ctab.frags.keyOf(this);void 0!==n&&(e.ctab.atoms.each(function(r,o){o.a.fragment==n&&o.setHighlight(t,e)},this),e.ctab.bonds.each(function(r,o){e.ctab.atoms.get(o.b.begin).a.fragment==n&&o.setHighlight(t,e)},this))},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/box2abs":195,"../../util/scale":198,"../../util/vec2":200,"./reobject":117}],116:[function(t,e,n){function r(t){this.loop=t,this.visel=new i("loop"),this.centre=new o,this.radius=new o}var o=t("../../util/vec2"),i=t("./visel"),a=t("./reobject"),s=t("../../util/scale"),l=t("../util"),u=t("../../chem/struct"),c=l.tfx;r.prototype=new a,r.isSelectable=function(){return!1},r.prototype.show=function(t,e,n){var r=t.render,i=r.paper,a=t.molecule,l=this.loop;this.centre=new o,l.hbs.each(function(e){var r=a.halfBonds.get(e),o=t.bonds.get(r.bid),i=s.obj2scaled(t.atoms.get(r.begin).a.pp,n);o.b.type!=u.Bond.PATTERN.TYPE.AROMATIC&&(l.aromatic=!1),this.centre.add_(i)},this),l.convex=!0;for(var p=0;p<this.loop.hbs.length;++p){var d=a.halfBonds.get(l.hbs[p]),f=a.halfBonds.get(l.hbs[(p+1)%l.hbs.length]),h=Math.atan2(o.cross(d.dir,f.dir),o.dot(d.dir,f.dir));h>0&&(l.convex=!1)}if(this.centre=this.centre.scaled(1/l.hbs.length),this.radius=-1,l.hbs.each(function(e){var r=a.halfBonds.get(e),i=s.obj2scaled(t.atoms.get(r.begin).a.pp,n),l=s.obj2scaled(t.atoms.get(r.end).a.pp,n),u=o.diff(l,i).rotateSC(1,0).normalized(),c=o.dot(o.diff(i,this.centre),u);this.radius=this.radius<0?c:Math.min(this.radius,c)},this),this.radius*=.7,l.aromatic){var m=null;if(l.convex&&n.aromaticCircle)m=i.circle(this.centre.x,this.centre.y,this.radius).attr({stroke:"#000","stroke-width":n.lineattr["stroke-width"]});else{var g="";for(p=0;p<l.hbs.length;++p){d=a.halfBonds.get(l.hbs[p]),f=a.halfBonds.get(l.hbs[(p+1)%l.hbs.length]),h=Math.atan2(o.cross(d.dir,f.dir),o.dot(d.dir,f.dir));var b=(Math.PI-h)/2,y=f.dir.rotate(b),v=s.obj2scaled(t.atoms.get(f.begin).a.pp,n),w=Math.sin(b);Math.abs(w)<.1&&(w=.1*w/Math.abs(w));var x=n.bondSpace/w,O=v.addScaled(y,-x);g+=0==p?"M":"L",g+=c(O.x)+","+c(O.y)}g+="Z",m=i.path(g).attr({stroke:"#000","stroke-width":n.lineattr["stroke-width"],"stroke-dasharray":"- "})}t.addReObjectPath("data",this.visel,m,null,!0)}},r.prototype.isValid=function(t,e){var n=t.halfBonds,r=this.loop,o=!1;return r.hbs.each(function(t){n.has(t)&&n.get(t).loop===e||(o=!0)},this),!o},e.exports=r},{"../../chem/struct":77,"../../util/scale":198,"../../util/vec2":200,"../util":123,"./reobject":117,"./visel":122}],117:[function(t,e,n){function r(){}var o=t("./visel"),i=t("../../util/scale");r.prototype.init=function(t){this.visel=new o(t),this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null},r.prototype.getVBoxObj=function(t){var e=this.visel.boundingBox;return null===e?null:(t.options.offset&&(e=e.translate(t.options.offset.negated())),e.transform(i.scaled2obj,t.options))},r.prototype.setHighlight=function(t,e){if(t){var n="highlighting"in this&&null!=this.highlighting;n&&(n="set"==this.highlighting.type?!this.highlighting[0].removed:!this.highlighting.removed),n?this.highlighting.show():(e.paper.setStart(),this.drawHighlight(e),this.highlighting=e.paper.setFinish())}else this.highlighting&&this.highlighting.hide();this.highlight=t},r.prototype.drawHighlight=function(){console.assert("ReObject.drawHighlight is not overridden")},r.prototype.makeSelectionPlate=function(){console.assert(null,"ReObject.makeSelectionPlate is not overridden")},e.exports=r},{"../../util/scale":198,"./visel":122}],118:[function(t,e,n){function r(t){this.init("rgroup"),this.labelBox=null,this.item=t}function o(t,e,n,r){r=u.obj2scaled(r||new a(1,0),e.options);var o=Math.min(.25,.3*n.sz().x),i=n.p1.y-n.p0.y,s=.5*(n.p1.y+n.p0.y),c=l.bracket(e.paper,r.negated(),r.negated().rotateSC(1,0),u.obj2scaled(new a(n.p0.x,s),e.options),o,i,e.options),p=l.bracket(e.paper,r,r.rotateSC(1,0),u.obj2scaled(new a(n.p1.x,s),e.options),o,i,e.options);return t.push(c,p)}var i=t("../../util/box2abs"),a=t("../../util/vec2"),s=t("../util"),l=t("../draw"),u=t("../../util/scale"),c=t("./reobject"),p=new a(.05*3,.05*3);r.prototype=new c,r.isSelectable=function(){return!1},r.prototype.getAtoms=function(t){var e=[];return this.item.frags.each(function(n,r){e=e.concat(t.ctab.frags.get(r).fragGetAtoms(t,r))}),e},r.prototype.getBonds=function(t){var e=[];return this.item.frags.each(function(n,r){e=e.concat(t.ctab.frags.get(r).fragGetBonds(t,r))}),e},r.prototype.calcBBox=function(t){var e;return this.item.frags.each(function(n,r){var o=t.ctab.frags.get(r).calcBBox(t.ctab,r,t);o&&(e=e?i.union(e,o):o)}),e=e.extend(p,p)},r.prototype.draw=function(t,e){var n=this.calcBBox(t);if(n){var r={data:[]},a=u.obj2scaled(n.p0,e),l=u.obj2scaled(n.p1,e),c=t.paper.set();o(c,t,n),r.data.push(c);var p=t.ctab.rgroups.keyOf(this),d=t.paper.set(),f=t.paper.text(a.x,(a.y+l.y)/2,"R"+p+"=").attr({font:e.font,"font-size":e.fontRLabel,fill:"black"}),h=s.relBox(f.getBBox());f.translateAbs(-h.width/2-e.lineWidth,0),d.push(f);var m={font:e.font,"font-size":e.fontRLogic,fill:"black"},g=[];g.push((this.item.ifthen>0?"IF ":"")+"R"+p.toString()+(this.item.range.length>0?this.item.range.startsWith(">")||this.item.range.startsWith("<")||this.item.range.startsWith("=")?this.item.range:"="+this.item.range:">0")+(this.item.resth?" (RestH)":"")+(this.item.ifthen>0?"\nTHEN R"+this.item.ifthen.toString():""));for(var b=h.height/2+e.lineWidth/2,y=0;y<g.length;++y){var v=t.paper.text(a.x,(a.y+l.y)/2,g[y]).attr(m),w=s.relBox(v.getBBox());b+=w.height/2,v.translateAbs(-w.width/2-6*e.lineWidth,b),b+=w.height/2+e.lineWidth/2,r.data.push(v),d.push(v)}return r.data.push(f),this.labelBox=i.fromRelBox(d.getBBox()).transform(u.scaled2obj,t.options),r}return{}},r.prototype._draw=function(t,e,n){var r=this.getVBoxObj(t).extend(p,p);if(r){var o=u.obj2scaled(r.p0,t.options),i=u.obj2scaled(r.p1,t.options);return t.paper.rect(o.x,o.y,i.x-o.x,i.y-o.y,0).attr(n)}},r.prototype.drawHighlight=function(t){var e=t.ctab.rgroups.keyOf(this);if(void 0!==e){var n=this._draw(t,e,t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,n),this.item.frags.each(function(e,n){t.ctab.frags.get(n).drawHighlight(t)},this),n}},r.prototype.show=function(t,e,n){var r=this.draw(t.render,n);for(var o in r)for(;r[o].length>0;)t.addReObjectPath(o,this.visel,r[o].shift(),null,!0)},e.exports=r},{"../../util/box2abs":195,"../../util/scale":198,"../../util/vec2":200,"../draw":107,"../util":123,"./reobject":117}],119:[function(t,e,n){function r(t){this.init("rxnArrow"),this.item=t}var o=t("./reobject"),i=t("../../util/box2abs"),a=t("../../util/vec2"),s=t("../draw"),l=t("../util"),u=t("../../util/scale");r.prototype=new o,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=u.obj2scaled(this.item.pp,t.options),n=t.options.scale;return t.paper.rect(e.x-n,e.y-n/4,2*n,n/2,n/8)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},r.prototype.show=function(t,e,n){var r=t.render,o=u.obj2scaled(this.item.pp,n),c=s.arrow(r.paper,new a(o.x-n.scale,o.y),new a(o.x+n.scale,o.y),n),p=n.offset;null!=p&&c.translateAbs(p.x,p.y),this.visel.add(c,i.fromRelBox(l.relBox(c.getBBox())))},e.exports=r},{"../../util/box2abs":195,"../../util/scale":198,"../../util/vec2":200,"../draw":107,"../util":123,"./reobject":117}],120:[function(t,e,n){function r(t){this.init("rxnPlus"),this.item=t}var o=t("./reobject"),i=t("../../util/box2abs"),a=t("../draw"),s=t("../util"),l=t("../../util/scale");r.prototype=new o,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=l.obj2scaled(this.item.pp,t.options),n=t.options.scale;return t.paper.rect(e.x-n/4,e.y-n/4,n/2,n/2,n/8)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},r.prototype.show=function(t,e,n){var r=t.render,o=l.obj2scaled(this.item.pp,n),u=a.plus(r.paper,o,n),c=n.offset;null!=c&&u.translateAbs(c.x,c.y),this.visel.add(u,i.fromRelBox(s.relBox(u.getBBox())))},e.exports=r},{"../../util/box2abs":195,"../../util/scale":198,"../draw":107,"../util":123,"./reobject":117}],121:[function(t,e,n){function r(t){this.init("sgroup"),this.item=t}function o(t,e,n,r,o,i,a,s,c,h){function g(n,r){var o=f.obj2scaled(O.c.addScaled(O.n,r*O.h),e.options),i=e.paper.text(o.x,o.y,n).attr({font:e.options.font,"font-size":e.options.fontszsub});h&&i.attr(h);var a=u.fromRelBox(d.relBox(i.getBBox())),s=Math.max(p.shiftRayBox(o,O.d.negated(),a),3)+2;i.translateAbs(s*O.d.x,s*O.d.y),t.push(i)}for(var b=l(e.ctab.molecule,r,o,i,a,e,n.id),y=-1,v=0;v<b.length;++v){var w=b[v],x=m.bracket(e.paper,f.obj2scaled(w.d,e.options),f.obj2scaled(w.n,e.options),f.obj2scaled(w.c,e.options),w.w,w.h,e.options);t.push(x),(y<0||b[y].d.x<w.d.x||b[y].d.x==w.d.x&&b[y].d.y>w.d.y)&&(y=v)}var O=b[y];s&&g(s,.5),c&&g(c,-.5)}function i(t,e,n,r){var o=t.text(e.x,e.y,n.data.fieldValue).attr({font:r.font,"font-size":r.fontsz}),i=o.getBBox(),a=t.rect(i.x-1,i.y-1,i.width+2,i.height+2,3,3);a=n.selected?a.attr(r.selectionStyle):a.attr({fill:"#fff",stroke:"#fff"});var s=t.set();return s.push(a,o.toFront()),s}function a(t,e){var n,r=t.render,o=r.options,a=r.paper,l=a.set(),c=h.SGroup.getAtoms(t,e);s(e,r,t.molecule),e.areas=e.bracketBox?[e.bracketBox]:[],null==e.pp&&(e.pp=e.bracketBox.p1.add(new p(.5,.5)));var m=e.pp.scaled(o.scale);if(e.data.attached)for(n=0;n<c.length;++n){var b=t.atoms.get(c[n]),y=f.obj2scaled(b.a.pp,o),v=b.visel.boundingBox;null!=v&&(y.x=Math.max(y.x,v.p1.x)),y.x+=o.lineWidth;var w=i(a,y,e,o),x=d.relBox(w.getBBox());w.translateAbs(.5*x.width,-.3*x.height),l.push(w);var O=u.fromRelBox(d.relBox(w.getBBox()));O=O.transform(f.scaled2obj,r.options),e.areas.push(O)}else{var S=i(a,m,e,o),T=d.relBox(S.getBBox());S.translateAbs(.5*T.width,-.5*T.height),l.push(S);var E=u.fromRelBox(d.relBox(S.getBBox()));e.dataArea=E.transform(f.scaled2obj,r.options),t.sgroupData.has(e.id)||t.sgroupData.set(e.id,new g(e))}return l}function s(t,e,n,r){var o=t.atoms;if(r&&2===r.length){var i=n.bonds.get(r[0]).getCenter(n),a=n.bonds.get(r[1]).getCenter(n);t.bracketDir=p.diff(a,i).normalized()}else t.bracketDir=new p(1,0);var s=t.bracketDir,l=null,c=[];o.forEach(function(t){var r=n.atoms.get(t),o=e?e.ctab.atoms.get(t).visel.boundingBox:null;if(o)o=o.translate((e.options.offset||new p).negated()).transform(f.scaled2obj,e.options);else{var i=new p(r.pp),a=new p(.05*3,.05*3);o=new u(i,i).extend(a,a)}c.push(o)},this),n.sGroupForest.children.get(t.id).forEach(function(t){var n=e.ctab.sgroups.get(t).visel.boundingBox;n=n.translate((e.options.offset||new p).negated()).transform(f.scaled2obj,e.options),c.push(n)},this),c.forEach(function(t){var e=null;[t.p0.x,t.p1.x].forEach(function(n){[t.p0.y,t.p1.y].forEach(function(t){var r=new p(n,t),o=new p(p.dot(r,s),p.dot(r,s.rotateSC(1,0)));e=null===e?new u(o,o):e.include(o)},this)},this),l=null===l?e:u.union(l,e)},this);var d=new p(.2,.4);null!==l&&(l=l.extend(d,d)),t.bracketBox=l}function l(t,e,n,r,o,i,a){function s(t,e,n,r){this.c=t,this.d=e,this.n=e.rotateSC(1,0),this.w=n,this.h=r}var l=[],u=o.rotateSC(1,0);return e.length<2?function(){o=o||new p(1,0),u=u||o.rotateSC(1,0);var t=Math.min(.25,.3*r.sz().x),e=p.lc2(o,r.p0.x,u,.5*(r.p0.y+r.p1.y)),n=p.lc2(o,r.p1.x,u,.5*(r.p0.y+r.p1.y)),i=r.sz().y;l.push(new s(e,o.negated(),t,i),new s(n,o,t,i))}():2===e.length?function(){var n=t.bonds.get(e[0]),r=t.bonds.get(e[1]),o=n.getCenter(t),u=r.getCenter(t),c=-1,d=-1,h=-1,m=-1,g=p.centre(o,u),b=p.diff(u,o).normalized(),y=b.negated(),v=b.rotateSC(1,0),w=v.negated();t.sGroupForest.children.get(a).forEach(function(t){var e=i.ctab.sgroups.get(t).visel.boundingBox;e=e.translate((i.options.offset||new p).negated()).transform(f.scaled2obj,i.options),c=Math.max(c,p.shiftRayBox(o,y,e)),d=Math.max(d,p.shiftRayBox(u,b,e)),h=Math.max(h,p.shiftRayBox(g,v,e)),m=Math.max(m,p.shiftRayBox(g,w,e))},this),c=Math.max(c+.2,0),d=Math.max(d+.2,0),h=Math.max(Math.max(h,m)+.1,0);var x=1.5+h;l.push(new s(o.addScaled(y,c),y,.25,x),new s(u.addScaled(b,d),b,.25,x))}():function(){for(var r=0;r<e.length;++r){var o=t.bonds.get(e[r]),i=o.getCenter(t),a=c.contains(n,o.begin)?o.getDir(t):o.getDir(t).negated();l.push(new s(i,a,.2,1))}}(),l}var u=t("../../util/box2abs"),c=t("../../util/set"),p=t("../../util/vec2"),d=t("../util"),f=t("../../util/scale"),h=t("../../chem/struct"),m=t("../draw"),g=t("./redatasgroupdata"),b=t("./reobject"),y=d.tfx;r.prototype=new b,r.isSelectable=function(){return!1},r.prototype.draw=function(t,e){var n=t.render,r=n.paper.set(),i=[],l=[],u=c.fromList(e.atoms);h.SGroup.getCrossBonds(i,l,t.molecule,u),s(e,n,t.molecule,l);var p=e.bracketBox,d=e.bracketDir;switch(e.areas=[p],e.type){case"MUL":new o(r,n,e,l,u,p,d,e.data.mul);break;case"SRU":var f=e.data.connectivity||"eu";"ht"==f&&(f="");new o(r,n,e,l,u,p,d,e.data.subscript||"n",f);break;case"SUP":new o(r,n,e,l,u,p,d,e.data.name,null,{"font-style":"italic"});break;case"GEN":new o(r,n,e,l,u,p,d);break;case"DAT":r=a(t,e)}return r},r.prototype.drawHighlight=function(t){var e=t.options,n=t.paper,r=this.item,o=r.bracketBox.transform(f.obj2scaled,e),i=e.lineWidth,a=new p(4*i,6*i);o=o.extend(a,a);var s=r.bracketDir,l=s.rotateSC(1,0),u=p.lc2(s,o.p0.x,l,o.p0.y),c=p.lc2(s,o.p0.x,l,o.p1.y),d=p.lc2(s,o.p1.x,l,o.p0.y),m=p.lc2(s,o.p1.x,l,o.p1.y),g=n.set();r.highlighting=n.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}L{0},{1}",y(u.x),y(u.y),y(c.x),y(c.y),y(m.x),y(m.y),y(d.x),y(d.y)).attr(e.highlightStyle),g.push(r.highlighting),h.SGroup.getAtoms(t.ctab.molecule,r).each(function(e){g.push(t.ctab.atoms.get(e).makeHighlightPlate(t))},this),h.SGroup.getBonds(t.ctab.molecule,r).each(function(e){g.push(t.ctab.bonds.get(e).makeHighlightPlate(t))},this),t.ctab.addReObjectPath("highlighting",this.visel,g)},r.prototype.show=function(t){var e=t.render,n=this.item;if("MRV_IMPLICIT_H"!=n.data.fieldName){var r=e.ctab,o=this.draw(r,n);t.addReObjectPath("data",this.visel,o,null,!0),this.setHighlight(this.highlight,e)}},e.exports=r},{"../../chem/struct":77,"../../util/box2abs":195,"../../util/scale":198,"../../util/set":199,"../../util/vec2":200,"../draw":107,"../util":123,"./redatasgroupdata":114,"./reobject":117}],122:[function(t,e,n){function r(t){this.type=t,this.paths=[],this.boxes=[],this.boundingBox=null}var o=t("../../util/box2abs"),i=t("../../util/vec2");r.prototype.add=function(t,e,n){this.paths.push(t),e&&(this.boxes.push(e),this.boundingBox=null==this.boundingBox?e:o.union(this.boundingBox,e)),n&&this.exts.push(n)},r.prototype.clear=function(){this.paths=[],this.boxes=[],this.exts=[],this.boundingBox=null},r.prototype.translate=function(t,e){if(arguments.length>2)throw new Error("One vector or two scalar arguments expected");if(void 0===e)this.translate(t.x,t.y);else{for(var n=new i(t,e),r=0;r<this.paths.length;++r)this.paths[r].translateAbs(t,e);for(var o=0;o<this.boxes.length;++o)this.boxes[o]=this.boxes[o].translate(n);null!==this.boundingBox&&(this.boundingBox=this.boundingBox.translate(n))}},e.exports=r},{"../../util/box2abs":195,"../../util/vec2":200}],123:[function(t,e,n){function r(t){return(t-0).toFixed(8)}function o(t){return{x:t.x,y:t.y,width:t.width,height:t.height}}e.exports={tfx:r,relBox:o}},{}],124:[function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){return{type:"CHANGE_ANALYSE_ROUND",payload:r({},t,e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.changeRound=o},{}],125:[function(t,e,n){"use strict";function r(t,e){return{type:"INIT_ATTACH",payload:{name:t,atomid:e.atomid,bondid:e.bondid}}}function o(t){return{type:"SET_ATTACH_POINTS",payload:{atomid:t.atomid,bondid:t.bondid}}}function i(t){return{type:"SET_TMPL_NAME",payload:{name:t}}}Object.defineProperty(n,"__esModule",{value:!0}),n.initAttach=r,n.setAttachPoints=o,n.setTmplName=i},{}],126:[function(t,e,n){"use strict";function r(t,e,n){e({types:n}).then(function(e){return t({type:"CHECK_ERRORS",payload:{moleculeErrors:e}})}).catch(console.error)}Object.defineProperty(n,"__esModule",{value:!0}),n.checkErrors=r},{}],127:[function(t,e,n){"use strict";function r(t,e){return{type:o[t],payload:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.updateFormState=r;var o={"attach-points":"UPDATE_ATTACH_POINTS_FORM",atom:"UPDATE_ATOM_FORM",automap:"UPDATE_AUTOMAP_FORM",bond:"UPDATE_BOND_FORM",check:"UPDATE_CHECK_FORM","label-edit":"UPDATE_LABEL_EDIT_FORM","rgroup-logic":"UPDATE_RGROUP_LOGIC_FORM",settings:"UPDATE_SETTINGS_FORM",sgroup:"UPDATE_SGROUP_FORM",sgroupSpecial:"UPDATE_SGROUPSPEC_FORM"}},{}],128:[function(t,e,n){"use strict";function r(t){return{type:"SET_RECOGNIZE_STRUCT",payload:{structStr:t}}}function o(t){return{type:"CHANGE_RECOGNIZE_FILE",payload:{file:t,structStr:null}}}function i(t){return{type:"IS_FRAGMENT_RECOGNIZE",payload:{fragment:t}}}Object.defineProperty(n,"__esModule",{value:!0}),n.setStruct=r,n.changeImage=o,n.shouldFragment=i},{}],129:[function(t,e,n){"use strict";function r(){return Object.keys(a.settings.properties).reduce(function(t,e){return t[e]=a.settings.properties[e].default,t},{})}function o(){return{type:"SET_DEFAULT_SETTINGS",payload:{stateForm:r(),valid:!0,errors:{}}}}function i(){return{type:"CANCEL_SETTINGS",payload:{stateForm:JSON.parse(localStorage.getItem("ketcher-opts"))||r(),valid:!0,errors:{}}}}Object.defineProperty(n,"__esModule",{value:!0}),n.defaultOpts=r,n.setDefaultSettings=o,n.cancelChanges=i;var a=t("../settings-options.es")},{"../settings-options.es":187}],130:[function(t,e,n){function r(t){var e=document.queryCommandSupported(t);if(e)try{e=document.execCommand(t)}catch(t){e=!1}return e}function o(t,e){var n=new Element("div",{contenteditable:!0,class:"cliparea",autofocus:!0});t.insert(n),t.on("mouseup",function(t){e.focused()&&u(n)}),t.on("copy",function(t){if(e.focused()){var n=e.onCopy();n&&i(t.clipboardData,n),t.preventDefault()}}),t.on("cut",function(t){if(e.focused()){var n=e.onCut();n&&i(t.clipboardData,n),t.preventDefault()}}),t.on("paste",function(t){if(e.focused()){var n=a(t.clipboardData,e.formats);n&&e.onPaste(n),t.preventDefault()}})}function i(t,e){if(!t&&s)s.setData("text",e["text/plain"]);else{t.setData("text/plain",e["text/plain"]);try{Object.keys(e).forEach(function(n){t.setData(n,e[n])})}catch(t){console.info("Could not write exact type",t)}}}function a(t,e){var n={};return!t&&s?n["text/plain"]=s.getData("text"):(n["text/plain"]=t.getData("text/plain"),n=e.reduce(function(e,n){var r=t.getData(n);return r&&(e[n]=r),e},n)),n}var s=window.clipboardData,l=["cut","copy","paste"],u=function(t){return t.value=" ",t.focus(),t.select(),!0};e.exports=Object.assign(o,{exec:r,actions:l})},{}],131:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("preact"),u=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state.active=t.active?t.active:{},n}return a(e,t),s(e,[{key:"onActive",value:function(t,e){var n={};n[e]=!this.state.active[e],this.setState({active:Object.assign(this.state.active,n)}),this.props.onActive&&this.props.onActive()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.captions,i=r(e,["children","captions"]);return(0,l.h)("ul",i,o.map(function(e,r){return(0,l.h)("li",{className:"tab"},(0,l.h)("a",{className:t.state.active[r]?"active":"",onClick:function(e){return t.onActive(e,r)}},e),t.state.active[r]?n[r]:null)}))}}]),e}(l.Component);n.default=u},{preact:28}],132:[function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){return["atom-"+t.label.toLowerCase(),p.indexOf(t.type)>=0?t.type+" metal":t.type||"unknown-props",t.state||"unknown-state",t.origin]}function a(t){var e=t.el,n=t.className,a=o(t,["el","className"]);return(0,l.h)("button",s({title:e.title,className:[].concat(r(i(e)),[n]).join(" "),value:c.default.map[e.label]},a),e.label)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=t("preact"),u=t("../../chem/element"),c=function(t){return t&&t.__esModule?t:{default:t}}(u),p=["alkali","alkaline-earth","transition","post-transition"];n.default=a},{"../../chem/element":60,preact:28}],133:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("preact"),l=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={suggestsHidden:!0},n.click=n.click.bind(n),n.blur=n.blur.bind(n),n.updateInput=n.updateInput.bind(n),n}return i(e,t),a(e,[{key:"updateInput",value:function(t){var e=t.target.value||t.target.textContent;this.setState({suggestsHidden:!0}),this.props.onChange(e)}},{key:"click",value:function(t){0!==t.detail&&this.setState({suggestsHidden:!1})}},{key:"blur",value:function(){this.setState({suggestsHidden:!0})}},{key:"render",value:function(t){var e=this,n=t.value,r=t.type,o=void 0===r?"text":r,i=t.schema,a=i.enumNames.filter(function(t){return t!==n}).map(function(t){return(0,s.h)("li",{onMouseDown:e.updateInput},t)});return(0,s.h)("div",null,(0,s.h)("input",{type:o,value:n,onClick:this.click,onBlur:this.blur,onInput:this.updateInput,autocomplete:"off"}),0!=a.length?(0,s.h)("ui",{className:"suggestList",style:"display: "+(this.state.suggestsHidden?"none":"block")},a):"")}}]),e}(s.Component);n.default=l},{preact:28}],134:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,
"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("preact"),c=t("w3c-keyname"),p=function(t){return t&&t.__esModule?t:{default:t}}(c),d=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),l(e,[{key:"exit",value:function(t){var e=this.props,n=e.params,r=e.result,o=void 0===r?function(){return null}:r,i=e.valid,a=void 0===i?function(){return!!o()}:i,s="OK"==t?"onOk":"onCancel";n&&s in n&&("onOk"!=s||a())&&n[s](o())}},{key:"keyDown",value:function(t){var e=(0,p.default)(t),n=document.activeElement,r=n&&"TEXTAREA"==n.tagName;(e.startsWith("Esc")||"Enter"==e&&!r)&&(this.exit("Enter"==e?"OK":"Cancel"),t.preventDefault()),t.stopPropagation()}},{key:"componentDidMount",value:function(){var t=this.base.querySelector(["input:not([type=checkbox]):not([type=button])","textarea","[contenteditable]","select"].join(","))||this.base.querySelector(["button.close"].join(","));console.assert(t,"No active buttons"),t.focus&&t.focus()}},{key:"render",value:function(){var t=this;console.info("dialog render");var e=this.props,n=e.children,o=e.title,i=e.params,a=void 0===i?{}:i,l=e.result,c=void 0===l?function(){return null}:l,p=e.valid,d=void 0===p?function(){return!!c()}:p,f=e.buttons,h=void 0===f?["Cancel","OK"]:f,m=r(e,["children","title","params","result","valid","buttons"]);return(0,u.h)("form",s({role:"dialog",onSubmit:function(t){return t.preventDefault()},onKeyDown:function(e){return t.keyDown(e)}},m),(0,u.h)("header",null,o,a.onCancel&&o&&(0,u.h)("button",{className:"close",onClick:function(){return t.exit("Cancel")}},"×")),n,(0,u.h)("footer",null,h.map(function(e){return"string"!=typeof e?e:(0,u.h)("input",{type:"button",value:e,disabled:"OK"==e&&!d(),onClick:function(){return t.exit(e)}})})))}}]),e}(u.Component);n.default=d},{preact:28,"w3c-keyname":58}],135:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t){var e=t.labelPos,n=t.title,r=t.children,o=i(t,["labelPos","title","children"]);return(0,x.h)("label",o,n&&"after"!=e?n+":":"",r,n&&"after"==e?n:"")}function c(t,e){var n=e.customValid,r=e.serialize,o=void 0===r?{}:r,i=e.deserialize,a=void 0===i?{}:i,s=new w.default.Validator;return n&&(t=Object.assign({},t),t.properties=Object.keys(n).reduce(function(t,e){return s.customFormats[e]=n[e],t[e]=b({format:e},t[e]),t},t.properties)),{key:t.key||"",serialize:function(e){return s.validate(e,t,{rewrite:p.bind(null,o)})},deserialize:function(e){return s.validate(e,t,{rewrite:d.bind(null,a)})}}}function p(t,e,n){var r={};if("object"!=(void 0===e?"undefined":g(e))||!n.properties)return void 0!==e?e:n.default;for(var o in n.properties)o in e&&(r[o]=e[o]);return r}function d(t,e,n){return e}function f(t){var e={},n=void 0;return t.forEach(function(t){n=t.property.split(".")[1],e[n]||(e[n]=t.message)}),e}function h(t,e){var n=t.properties[e];return n.constant||n.enum[0]}function m(t,e){return console.assert(t.oneOf),t.oneOf.reduce(function(t,n){return t[h(n,e)]=n,t},{})}Object.defineProperty(n,"__esModule",{value:!0}),n.mapOf=n.SelectOneOf=n.Field=n.form=void 0;var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},y=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),v=t("jsonschema"),w=r(v),x=t("preact"),O=t("preact-redux"),S=t("./input"),T=r(S),E=t("../actions/form-action.es"),A=function(t){function e(t){var n=t.onUpdate,r=t.schema,o=t.init,l=i(t,["onUpdate","schema","init"]);a(this,e);var u=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.schema=c(r,l),o&&n(u.schema.serialize(o).instance,!0,{}),u}return l(e,t),y(e,[{key:"updateState",value:function(t){var e=this.schema.serialize(t),n=e.instance,r=e.valid,o=e.errors,i=f(o);this.props.onUpdate(n,r,i)}},{key:"getChildContext",value:function(){return{schema:this.props.schema,stateStore:this}}},{key:"field",value:function(t,e){var n=this.props,r=n.stateForm,i=n.errors,a=r[t],s=this;return{dataError:i&&i[t]||!1,value:a,onChange:function(n){var r=Object.assign({},s.props.stateForm,o({},t,n));s.updateState(r),e&&e(n)}}}},{key:"render",value:function(){var t=this.props,e=t.stateForm,n=t.children,r=t.schema,o=i(t,["stateForm","children","schema"]);return r.key&&r.key!==this.schema.key&&(this.schema=c(r,o),this.schema.serialize(e),this.updateState(e)),(0,x.h)("form",o,n)}}]),e}(x.Component),P=(0,O.connect)(function(t,e){return{stateForm:t[e.storeName].stateForm,errors:t[e.storeName].errors}},function(t,e){return{onUpdate:function(n,r,o){t((0,E.updateFormState)(e.storeName,{stateForm:n,valid:r,errors:o}))}}})(A),C=function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),y(e,[{key:"render",value:function(){var t=this.props,e=t.name,n=t.onChange,r=t.className,o=t.component,a=i(t,["name","onChange","className","component"]),s=this.context,l=s.schema,c=s.stateStore,p=a.schema||l.properties[e],d=c.field(e,n),f=d.dataError,h=i(d,["dataError"]);return(0,x.h)(u,{className:r,"data-error":f,title:a.title||p.title},o?(0,x.h)(o,b({},h,a)):(0,x.h)(T.default,b({name:e,schema:p},h,a)))}}]),e}(x.Component),j=function(t){var e=t.title,n=t.name,r=t.schema,o=i(t,["title","name","schema"]),a={title:e,enum:[],enumNames:[]};return Object.keys(r).forEach(function(t){a.enum.push(t),a.enumNames.push(r[t].title||t)}),(0,x.h)(C,b({name:n,schema:a},o))};n.form=P,n.Field=C,n.SelectOneOf=j,n.mapOf=m},{"../actions/form-action.es":127,"./input":136,jsonschema:20,preact:28,"preact-redux":27}],136:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function s(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function l(t){var e=t.value,n=t.onChange,r=t.type,o=void 0===r?"text":r,i=s(t,["value","onChange","type"]);return(0,S.h)("input",O({type:o,value:e,onInput:n},i))}function u(t){var e=t.value,n=t.onChange,r=s(t,["value","onChange"]);return(0,S.h)("textarea",O({value:e,onInput:n},r))}function c(t){var e=t.value,n=t.onChange,r=s(t,["value","onChange"]);return(0,S.h)("input",O({type:"checkbox",checked:e,onClick:n},r))}function p(t){var e=t.schema,n=t.value,r=t.selected,o=t.onSelect,i=s(t,["schema","value","selected","onSelect"]);return(0,S.h)("select",O({onChange:o},i),f(e,function(t,e){return(0,S.h)("option",{selected:r(e,n),value:"object"!=(void 0===e?"undefined":x(e))&&e},t)}))}function d(t){var e=t.schema,n=t.value,r=t.selected,o=t.onSelect,i=t.type,a=void 0===i?"radio":i,l=s(t,["schema","value","selected","onSelect","type"]);return(0,S.h)("fieldset",{onClick:o,className:"radio"},f(e,function(t,e){return(0,S.h)("label",null,(0,S.h)("input",O({type:a,checked:r(e,n),value:"object"!=(void 0===e?"undefined":x(e))&&e},l)),t)}))}function f(t,e){var n=Array.isArray(t);if(!n&&t.items&&(t=t.items),"function"==typeof e)return(n?t:t.enum).map(function(r,o){var i=n?r.title:t.enumNames&&t.enumNames[o];return e(void 0!==i?i:r,void 0!==r.value?r.value:r)});if(!n)return t.enum[e];var r=t[e];return void 0!==r.value?r.value:r}function h(t,e,n){var r={};return e&&("number"!=e.type&&"integer"!=e.type||(r={type:"number"})),O({onChange:function(r){var o=t.val?t.val(r,e):r;n(o)}},r)}function m(t,e,n){return{selected:function(t,e){return e===t},onSelect:function(r,o){var i=t.val?t.val(r,e):r;void 0!==i&&n(i)}}}function g(t,e,n){return{multiple:!0,selected:function(t,e){return e&&e.indexOf(t)>=0},onSelect:function(r,o){if(t.val){var i=t.val(r,e);void 0!==i&&n(i)}else{var s=o?o.indexOf(r):-1;n(s<0?o?[r].concat(a(o)):[r]:[].concat(a(o.slice(0,s)),a(o.slice(s+1))))}}}}function b(t,e){var n=e.schema,r=e.multiple,o=e.onChange;return n&&(n.enum||n.items||Array.isArray(n))&&"string"!==n.type?r||"array"==n.type?g(t,n,o):m(t,n,o):h(t,n,o)}function y(t){var e=t.schema,n=t.type,r=t.multiple;return e&&(e.enum||e.items||Array.isArray(e))?r||"array"==e.type?"checkbox"==n?d:p:"radio"==n?d:p:"checkbox"==n||e&&"boolean"==e.type?c:"textarea"==n?u:l}function v(t,e){for(var n in t)if(!(n in e))return!0;for(var r in e)if(t[r]!==e[r])return!0;return!1}Object.defineProperty(n,"__esModule",{value:!0});var w=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},S=t("preact");l.val=function(t,e){var n=t.target;return"number"!=n.type&&"range"!=n.type&&(!e||"number"!=e.type&&"integer"!=e.type)||isNaN(n.value-0)?n.value:n.value-0},u.val=function(t){return t.target.value},c.val=function(t){return t.stopPropagation(),!!t.target.checked},p.val=function(t,e){var n=t.target;return n.multiple?[].reduce.call(n.options,function(t,n,r){return n.selected?[f(e,r)].concat(a(t)):t},[]):f(e,n.selectedIndex)},d.val=function(t,e){var n=t.target;if("INPUT"!==t.target.tagName)return void t.stopPropagation();var r=n.parentNode.parentNode,o=[].reduce.call(r.querySelectorAll("input"),function(t,n,r){return n.checked?[f(e,r)].concat(a(t)):t},[]);return"radio"==n.type?o[0]:o};var T=function(t){function e(t){var n=t.component,i=s(t,["component"]);r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return a.component=n||y(i),a.ctrl=b(a.component,i),a}return i(e,t),w(e,[{key:"shouldComponentUpdate",value:function(t){var e=(t.children,t.onChange,s(t,["children","onChange"])),n=this.props;n.children,n.onChange;return v(s(n,["children","onChange"]),e)}},{key:"render",value:function(){var t=this.props,e=(t.children,t.onChange,s(t,["children","onChange"]));return(0,S.h)(this.component,O({},this.ctrl,e))}}]),e}(S.Component);n.default=T},{preact:28}],137:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e,n){if(!t&&0!==t)return null;var r={px:1,cm:37.795278,pt:1.333333,inch:96};return"px"===n||"pt"===n?(t*r[e]/r[n]).toFixed()-0:(t*r[e]/r[n]).toFixed(3)-0}Object.defineProperty(n,"__esModule",{value:!0});var l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=t("preact"),p=t("./input"),d=function(t){return t&&t.__esModule?t:{default:t}}(p),f=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={meas:"px"},n}return a(e,t),u(e,[{key:"handleChange",value:function(t,e){var n=s(t,this.state.meas,"px");this.state.cust=t,e(n)}},{key:"render",value:function(){var t=this,e=this.state,n=e.meas,o=e.cust,i=this.props,a=i.schema,u=i.value,p=i.onChange,f=r(i,["schema","value","onChange"]);return s(o,n,"px")!==u&&this.setState({meas:"px",cust:u}),(0,c.h)("div",l({style:"display: inline-flex;"},f),(0,c.h)(d.default,{schema:a,step:"px"===n||"pt"===n?"1":"0.001",style:"width: 75%;",value:o,onChange:function(e){return t.handleChange(e,p)}}),(0,c.h)(d.default,{schema:{enum:["cm","px","pt","inch"]},style:"width: 25%;",value:n,onChange:function(e){return t.setState({meas:e,cust:s(t.state.cust,t.state.meas,e)})}}))}}]),e}(c.Component);n.default=f},{"./input":136,preact:28}],138:[function(t,e,n){(function(e){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return new Promise(function(n,r){if(e.FileReader)n(l);else if(e.ActiveXObject)try{var o=new ActiveXObject("Scripting.FileSystemObject");n(function(t){return Promise.resolve(u(o,t))})}catch(t){r(t)}else t?n(t.then(function(){throw"Server doesn't still support echo method"})):r(new Error("Your browser does not support opening files locally"))})}function l(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(n){var o=r.result;t.msClose&&t.msClose(),e(o)},r.onerror=function(t){n(t)},r.readAsText(t,"UTF-8")})}function u(t,e){var n=t.OpenTextFile(e.name,1),r=n.ReadAll();return n.Close(),r}Object.defineProperty(n,"__esModule",{value:!0});var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),d=t("preact"),f=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return s(t.server).then(function(t){n.setState({opener:t})}),n}return a(e,t),p(e,[{key:"open",value:function(t){var e=t.target.files,n=function(){return null},r=this.props,o=r.onLoad,i=void 0===o?n:o,a=r.onError,s=void 0===a?n:a;this.state.opener&&e.length&&this.state.opener(e[0]).then(i,s),t.preventDefault()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.type,i=r(e,["children","type"]);return(0,d.h)("label",c({disabled:!this.state.opener},i),n,(0,d.h)("input",{onChange:function(e){return t.open(e)},accept:o,type:"file"}))}}]),e}(d.Component);n.default=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{preact:28}],139:[function(t,e,n){(function(e){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return new Promise(function(n,r){e.Blob&&d.default.saveAs?n(function(t,e,n){var r=new Blob([t],{type:n});d.default.saveAs(r,e)}):t?n(t.then(function(){throw"Server doesn't still support echo method"})):r(new Error("Your browser does not support opening files locally"))})}Object.defineProperty(n,"__esModule",{value:!0});var l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=t("preact"),p=t("filesaver.js"),d=function(t){return t&&t.__esModule?t:{default:t}}(p),f=function(t){function e(t){var n=t.filename,a=void 0===n?"unnamed":n,u=t.type,c=void 0===u?"text/plain":u,p=t.className,d=void 0===p?"":p,f=r(t,["filename","type","className"]);o(this,e);var h=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l({filename:a,type:c,className:d},f)));return s(f.server).then(function(t){h.setState({saver:t})}),h}return a(e,t),u(e,[{key:"save",value:function(t){var e=function(){return null},n=this.props,r=n.filename,o=n.data,i=n.type,a=n.onSave,s=void 0===a?e:a,l=n.onError,u=void 0===l?e:l;if(this.state.saver&&o)try{this.state.saver(o,r,i),s()}catch(t){u(t)}t.preventDefault()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.filename,i=e.data,a=e.className,s=r(e,["children","filename","data","className"]);return this.state.saver&&i||(a="disabled "+a),(0,c.h)("a",l({download:o,onClick:function(e){return t.save(e)},className:a},s),n)}}]),e}(c.Component);n.default=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"filesaver.js":8,preact:28}],140:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=(t.children,t.options),n=t.onChange,o=t.value,s=r(t,["children","options","onChange","value"]);return(0,a.h)("ul",i({},s,{tabindex:"0"}),e.map(function(t,e){return(0,a.h)("li",{onClick:function(){return n(t,e)},className:t==o?"selected":""},t)}))}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=t("preact");n.default=o},{preact:28}],141:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=r(t,[]);return(0,a.h)("div",i({className:"spinner"},e))}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=t("preact");n.default=o},{preact:28}],142:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t){var o=new b.default(t,c({},r));if(n.prerender)t.innerHTML=n.prerender;else{var i=o.render;i.setMolecule(n),i.update()}return o.tool(e.name,Object.assign({},e.opts)),o}return null}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=t("preact"),d=t("../../chem/struct"),f=r(d),h=t("../../chem/molfile"),m=r(h),g=t("../../editor"),b=r(g),y=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(!(t.struct instanceof f.default))try{n.props.struct=m.default.parse(t.struct)}catch(t){alert("Could not parse structure\n"+t),n.props.struct=null}return n}return s(e,t),u(e,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){var t=this,e=this.refs?this.refs.base:this.base,n=this.props,r=n.struct,o=n.tool,i=n.options;this.editor=l(e,o,r,i);for(var a in this.editor.event)!function(e){t.editor.on(e,function(n){return t.props.onEvent(e,n)})}(a)}},{key:"render",value:function(){var t=this.props,e=t.struct,n=t.Tag,r=void 0===n?"div":n,i=o(t,["struct","Tag"]);return(0,p.h)(r,i,e?null:"No molecule")}}]),e}(p.Component);n.default=y},{"../../chem/molfile":63,"../../chem/struct":77,"../../editor":83,preact:28}],143:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)if(e.prerender)t.innerHTML=e.prerender;else{console.info("render!",t.clientWidth,t.clientWidth);var r=new b.default(t,c({autoScale:!0},n));r.setMolecule(e),r.update()}}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=t("preact"),d=t("../../chem/struct"),f=r(d),h=t("../../chem/molfile"),m=r(h),g=t("../../render"),b=r(g),y=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(!(t.struct instanceof f.default))try{n.props.struct=m.default.parse(t.struct)}catch(t){alert("Could not parse structure\n"+t),n.props.struct=null}return n}return s(e,t),u(e,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){var t=this.refs?this.refs.base:this.base,e=this.props;l(t,e.struct,e.options)}},{key:"render",value:function(){var t=this.props,e=t.struct,n=t.Tag,r=void 0===n?"div":n,i=o(t,["struct","Tag"]);return(0,p.h)(r,i,e?null:"No molecule")}}]),e}(p.Component);n.default=y},{"../../chem/molfile":63,"../../chem/struct":77,"../../render":108,preact:28}],144:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(){var t=b.map(function(t){return new h.default(t).check().then(function(){return t},function(){return null})});return Promise.all(t)}function u(t){return t.substring(t.indexOf("px ")+3)}Object.defineProperty(n,"__esModule",{value:!0});var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),d=t("preact"),f=t("font-face-observer"),h=r(f),m=t("./input"),g=r(m),b=["Arial","Arial Black","Comic Sans MS","Courier New","Georgia","Impact","Charcoal","Lucida Console","Monaco","Palatino Linotype","Book Antiqua","Palatino","Tahoma","Geneva","Times New Roman","Times","Verdana","Symbol","MS Serif","MS Sans Serif","New York","Droid Sans","Droid Serif","Droid Sans Mono","Roboto"],y=null,v=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={availableFonts:[u(t.value)]},n.setAvailableFonts(),n}return s(e,t),p(e,[{key:"setAvailableFonts",value:function(){var t=this;y?this.setState({availableFonts:y}):l().then(function(e){y=e.filter(function(t){return null!==t}),t.setState({availableFonts:y})})}},{key:"render",value:function(){var t=o(this.props,[]),e={enum:[],enumNames:[]};return this.state.availableFonts.forEach(function(t){e.enum.push("30px "+t),e.enumNames.push(t)}),1!==e.enum.length?(0,d.h)(g.default,c({schema:e},t)):(0,d.h)("select",null,(0,d.h)("option",null,e.enumNames[0]))}}]),e}(d.Component);n.default=v},{"./input":136,"font-face-observer":16,preact:28}],145:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("preact"),u=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state.tabIndex=t.tabIndex||0,n.props.changeTab(n.state.tabIndex),n}return a(e,t),s(e,[{key:"changeTab",value:function(t,e){this.setState({tabIndex:e}),this.props.changeTab&&this.props.changeTab(e)}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.captions,i=r(e,["children","captions"]);return(0,l.h)("ul",i,(0,l.h)("li",{className:"tabs"},o.map(function(e,n){return(0,l.h)("a",{className:t.state.tabIndex===n?"active":"",onClick:function(e){return t.changeTab(e,n)}},e)})),(0,l.h)("li",{className:"tabs-content"},n[this.state.tabIndex]))}}]),e}(l.Component);n.default=u},{preact:28}],146:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("preact"),c=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.resize=function(t,e){var r=n.base.offsetHeight;n.state.height!==r&&n.setState({height:r}),e&&(n.setState({offset:0}),n.base.scrollTop=0)},n.handleScroll=function(){n.setState({offset:n.base.scrollTop}),n.props.sync&&n.forceUpdate()},n.state={offset:0,height:0},n}return a(e,t),l(e,[{key:"componentDidUpdate",value:function(t){var e=t.data,n=e.length==this.props.data.length&&this.props.data.every(function(t,n){return t===e[n]});this.resize(null,!n)}},{key:"componentDidMount",value:function(){this.resize(),addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){removeEventListener("resize",this.resize)}},{key:"render",
value:function(){var t=this.props,e=t.data,n=t.rowHeight,o=t.children,i=t.Tag,a=void 0===i?"div":i,l=t.overscanCount,c=void 0===l?1:l,p=(t.sync,r(t,["data","rowHeight","children","Tag","overscanCount","sync"])),d=this.state,f=d.offset,h=d.height,m=f/n||0,g=o[0],b=h/n||0;c&&(m=Math.max(0,m-m%c),b+=c);var y=m+1+b,v=e.slice(m,y);return(0,u.h)("div",s({onScroll:this.handleScroll},p),(0,u.h)("div",{style:"position:relative; overflow:hidden; width:100%; min-height:100%; height:"+e.length*n+"px;"},(0,u.h)(a,{style:"position:absolute; top:0; left:0; height:100%; width:100%; overflow:visible; top:"+m*n+"px;"},v.map(function(t,e){return g(t,m+e)}))))}}]),e}(u.Component);n.default=c},{preact:28}],147:[function(t,e,n){(function(n){function r(t,e){var r=$$("[role=application]")[0]||$$("body")[0];G=r.select("[role=toolbar]")[0],H=e||Promise.reject("Standalone mode!"),z=Object.assign({},JSON.parse(localStorage.getItem("ketcher-opts")),t),W=n._ui_editor=new J($("canvas"),z),p(G),P(),o(W),i(r),v(),y(null),w(!0),H.then(function(){w()},function(t){}),u("template-lib").disabled=!0,tt.templates.init("",$$(".cellar")[0]).then(function(t){ot=t,u("template-lib").disabled=!1}),V="editor";var a=g(G);return r.on("keydown",function(t){"editor"==V&&b(G,a,t)}),h("select-lasso"),addEventListener("resize",function(){$$("menu").filter(function(t){return parseFloat(t.style.marginTop)<0}).each(function(t){t.style.marginTop=0}),f(G)}),{editor:W,load:R}}function o(t){t.on("elementEdit",function(t){var e=rt.fromElement(t),n=null;return n=Y.map[e.label]?x(tt.atomProps,e):1==Object.keys(e).length&&"ap"in e?x(tt.attachmentPoints,e.ap).then(function(t){return{ap:t}}):"list"==e.type||"not-list"==e.type?M(e):"rlabel"==e.type?x(tt.rgroup,e):x(tt.periodTable,e),n.then(function(t){return rt.toElement(t)})}),t.on("bondEdit",function(t){return x(tt.bondProps,rt.fromBond(t)).then(function(t){return rt.toBond(t)})}),t.on("rgroupEdit",function(e){if(Object.keys(e).length>1){var n=[];return t.struct().rgroups.each(function(t){n.push(t)}),e.range||(e.range=">0"),x(tt.rgroupLogic,Object.assign({rgroupLabels:n},e))}return x(tt.rgroup,e)}),t.on("sgroupEdit",function(t){return x(tt.sgroup,rt.fromSgroup(t)).then(function(t){return rt.toSgroup(t)})}),t.on("sdataEdit",function(t){return x("DAT"===t.type?tt.sgroupSpecial:tt.sgroup,rt.fromSgroup(t)).then(rt.toSgroup)}),t.on("quickEdit",function(t){return x(tt.labelEdit,t)}),t.on("message",function(t){if(t.error)alert(t.error);else{var e=Object.keys(t)[0];console[e](t[e])}}),t.on("change",function(){z.resetToSelect&&h(null),v()}),t.on("selectionChange",y),t.on("mousedown",function(t){if(V="editor",d(G))return!0})}function i(t){var e=Object.keys(nt.map).map(function(t){return nt.map[t].mime});return et(t,{formats:e,focused:function(){return"editor"==V},onCut:function(){var t=a(W);return h("erase"),t},onCopy:function(){var t=a(W);return W.selection(null),t},onPaste:function(t){var e=t["chemical/x-mdl-molfile"]||t["chemical/x-mdl-rxnfile"]||t["text/plain"];e&&R(e,{fragment:!0})}})}function a(t){var e={},n=t.structSelected();if(n.isBlank())return null;var r=n.isReaction?"chemical/x-mdl-molfile":"chemical/x-mdl-rxnfile";return e["text/plain"]=e[r]=Z.stringify(n),e}function s(){if(at.storage.length>0){var t="<menu>"+at.storage.reduce(function(t,e){return t+'<li id="atom-'+e.toLowerCase()+'"><button data-number="'+Y.map[e]+'">'+e+"</button></li>"},"")+"</menu>",e=G.select("#freq-atoms")[0];if(!e){var n=G.select("#atom")[0];n.insert({after:'<li id="freq-atoms"/>'}),e=n.nextElementSibling}e.update(t),p(e)}}function l(t){var e=/Mac/.test(navigator.platform);return t.replace(/Mod/g,e?"⌘":"Ctrl").replace(/-(?!$)/g,"+").replace(/\+?([^+]+)$/,function(t){return 1==t.length?t.toUpperCase():t})}function u(t){return $(t).children[0]}function c(t,e){e=e||document.body;for(var n=t.parentNode;"hidden"!=n.getStyle("overflow");){if(n==e)return null;n=n.parentNode}return n}function p(t){t.select("li").each(function(e){e.on("click",function(e){"BUTTON"==e.target.tagName&&e.target.parentNode==this&&(this.hasClassName("selected")||e.stop(),h(this.id)),"hidden"==this.getStyle("overflow")&&(d(t,this),e.stop())})})}function d(t,e){var n=t.select(".opened")[0];return n&&n.removeClassName("opened"),e&&e!=n&&e.addClassName("opened"),!!n&&!e}function f(t,e){var n=e?$(e):t.select(".selected")[0],r=n&&c(n);if(r){var o=u(r);o.style.marginTop=-n.offsetTop+o.offsetTop+"px"}}function h(t){t=t||U;var e=$(t),n=[].slice.call(arguments,1);if(console.assert(t.startsWith,"id is not a string",t),d(G),console.info("action",t),-1!=et.actions.indexOf(t)&&0==n.length)return et.exec(t)||m(t);if(!e||!u(e).disabled){n.unshift(t);var r=D.apply(null,n);if(r&&!r.then){var o=G.select(".selected")[0];e==o&&e||(t.startsWith("select-")&&(U=t),e&&(e.addClassName("selected"),f(G,e)),o&&o.removeClassName("selected"))}return r}return null}function m(t){var e=u(t),n=e.dataset?e.dataset.keys:e.getAttribute("data-keys");alert("These action is unavailble via menu.\nInstead, use "+l(n)+" to "+t+".")}function g(t){var e={a:["atom-any"],"Mod-a":["select-all"],"Mod-Shift-a":["deselect-all"],"Ctrl-Shift-r":["force-update"],"Alt-Shift-r":["qs-serialize"]};return t.select("button").each(function(t){var n=t.textContent||t.innerText,r=t.dataset?t.dataset.keys:t.getAttribute("data-keys");if(r){var o=r.split(",").map(function(t){return t.trim()}),i=l(o[0]),a=t.parentNode.id;t.title=(t.title||n)+" ("+i+")",t.innerHTML+=" <kbd>"+i+"</kbd>",o.forEach(function(t){Array.isArray(e[t])?e[t].push(a):e[t]=[a]})}else t.title=t.title||n}),q(e)}function b(t,e,n){var r,o=q(n),i=W.selection()&&W.selection().atoms;if(1==o.length&&i&&o.match(/\w/))console.assert(i.length>0),x(tt.labelEdit,{letter:o}).then(function(t){h("atom",t)}),n.preventDefault();else if(r=q.lookup(e,n)){var a=r.index||0,s=t.select(".selected")[0];1!=r.length&&-1!=r.indexOf(s&&s.id)&&(r.index=a=(a+1)%r.length);var l=r[a];-1==et.actions.indexOf(l)&&(h(l),n.preventDefault())}}function y(t){var e=t&&(Object.keys(t).length>1||!t.sgroupData);u("copy").disabled=u("cut").disabled=!e}function v(){u("undo").disabled=0==W.historySize().undo,u("redo").disabled=0==W.historySize().redo}function w(t){it.forEach(function(e){$(e)&&(u(e).disabled=!!t)})}function x(t,e,n){function r(t,e){V="editor",i.style.display="none",i.lastChild.remove(),console.info("output",e),t&&t(e)}function o(n,o){t(Object.assign({},e,{onOk:function(t){r(e&&e.onOk,t),n(t)},onCancel:function(t){r(e&&e.onCancel,t),o(t)}}))}var i=$$(".overlay")[0];return i.style.display="",V="modal",new Promise(function(t,r){console.info("input",e),!1===n?Q.animate(i,"show").then(o.bind(null,t,r)):o(t,r)})}function O(){h(null),W.struct().isBlank()||W.struct(new K)}function S(){x(tt.open).then(function(t){R(t.structStr,{badHeaderRecover:!0,fragment:t.fragment})})}function T(){x(tt.save,{server:H,struct:W.struct()}).then(function(t){if(t&&"saveTmpl"===t.event){k({struct:Z.parse(t.tmpl),props:{group:"User"}},(JSON.parse(localStorage["ketcher-tmpl"]||"null")||[]).length).then(function(){return!0})}return!0})}function E(t,e,n){if(!n){var r={};n=W.struct().clone(null,null,!1,r);var o=W.explicitSelected().atoms||[];o=o.map(function(t){return r[t]})}var i=H.then(function(){return H[t](Object.assign({struct:Z.stringify(n,{ignoreErrors:!0})},o&&o.length>0?{selected:o}:null,e))});return i.catch(function(t){alert(t)}).then(function(t){}),i}function A(t,e,n){return E(t,e,n).then(function(e){return R(e.struct,{rescale:"layout"==t})})}function P(){var t=u("zoom-list");t.on("focus",function(){V="zoom"}),t.on("blur",function(){V="editor"}),t.on("change",_),_()}function C(){u("zoom-list").selectedIndex++,_(!0)}function j(){u("zoom-list").selectedIndex--,_(!0)}function _(t){var e=u("zoom-list"),n=e.selectedIndex,r=e.length;console.assert(0<=n&&n<r,"Zoom out of range"),u("zoom-in").disabled=n==r-1,u("zoom-out").disabled=0==n;var o=parseFloat(e.value)/100;t&&W.zoom(o)}function N(){if(W.struct().hasRxnArrow())return x(tt.automap).then(function(t){A("automap",t)});alert("Auto-Mapping can only be applied to reactions")}function R(t,e){e=e||{};var n=nt.fromString(t,e,H);return n.catch(function(t){alert("Can't parse molecule!")}),n.then(function(t){return console.assert(t,"No molecule to update"),e.rescale&&t.rescale(),e.fragment&&!t.isBlank()?h("paste",t):W.struct(t),t},function(t){alert(t)})}function I(t){for(var e=[],n=0;n<10;n++){var r=G.select("#atom")[0].select("li")[n].id.substr(5);r=r.charAt(0).toUpperCase()+r.slice(1),e.push(r)}e.indexOf(t)<0&&(at.current>=at.capacity&&(at.current=0),at.storage[at.current]=t,s(),at.current++)}function M(t){return x(tt.periodTable,t).then(function(t){return t.type&&"atom"!=t.type||I(t.label),t})}function B(t,e,n){var r=JSON.parse(localStorage["ketcher-tmpl"]||"null")||[],o=r.map(function(t){return""==t.props&&(t.props={}),t.props.group="User",{struct:Z.parse(t.struct),props:t.props}});null!==n&&(t=o[n]),x(tt.templates,{tmpls:ot,userTmpls:o,selected:t,group:e},!0).then(function(t){return"attachEdit"==t.event?k(t.tmpl,t.index).then(function(){return B(t.tmpl,t.tmpl.props.group,"User"==t.tmpl.props.group?t.index:null),!0}):"chooseTmpl"==t.event&&h("template-custom",t.tmpl),!0},function(){console.info("cancel")})}function k(t,e){var n=t.struct.name,r=t.props.group;return x(tt.attach,{userOpts:JSON.parse(localStorage.getItem("ketcher-opts")),tmpl:t}).then(function(o){if("User"!=r)ot=ot.map(function(t){return t.struct.name==n&&(t.struct.name=o.name,t.props=Object.assign(t.props||{},o.attach)),t});else{var i=JSON.parse(localStorage["ketcher-tmpl"]||"null")||[];t.struct.name=o.name,i[e]||(i[e]={}),i[e].struct=Z.stringify(t.struct),i[e].props=Object.assign({},i[e].props,o.attach),localStorage["ketcher-tmpl"]=JSON.stringify(i)}},function(){console.info("cancel")})}function D(t){console.assert(t,"The null tool");var e=[].slice.call(arguments,1);if(st[t])return st[t].apply(null,e);var n=L.apply(null,arguments);return n?W.tool(n.tool,n.opts):null}function L(t){var e=[].slice.call(arguments,1);return"select-lasso"==t?{tool:"select",opts:"lasso"}:"select-rectangle"==t?{tool:"select",opts:"rectangle"}:"select-fragment"==t?{tool:"select",opts:"fragment"}:"erase"==t?{tool:"eraser",opts:1}:"paste"==t?{tool:"paste",opts:e[0]}:t.startsWith("atom")?{tool:"atom",opts:e[0]||F(t)}:t.startsWith("bond-")?{tool:"bond",opts:rt.toBondType(t.substr(5))}:"chain"==t?{tool:"chain"}:t.startsWith("template")?{tool:"template",opts:e[0]||{struct:Z.parse(X[parseInt(t.split("-")[1])])}}:"charge-plus"==t?{tool:"charge",opts:1}:"charge-minus"==t?{tool:"charge",opts:-1}:"sgroup"==t?{tool:"sgroup"}:"sgroup-data"==t?{tool:"sgroup",opts:"DAT"}:"reaction-arrow"==t?{tool:"reactionarrow"}:"reaction-plus"==t?{tool:"reactionplus"}:"reaction-map"==t?{tool:"reactionmap"}:"reaction-unmap"==t?{tool:"reactionunmap"}:"rgroup-label"==t?{tool:"rgroupatom"}:"rgroup-fragment"==t?{tool:"rgroupfragment"}:"rgroup-attpoints"==t?{tool:"apoint"}:t.startsWith("transform-")?/flip/.test(t)?{tool:"rotate",opts:t.endsWith("h")?"horizontal":"vertical"}:{tool:"rotate"}:null}function F(t){var e=t.substr(5);switch(e){case"any":return{label:"A"};default:return e=e[0].toUpperCase()+e.slice(1).toLowerCase(),console.assert(Y.map[e],"No such atom exist"),{label:e}}}var G,U,H,z,V,W,q=(t("preact"),t("./keynorm")),Y=t("../chem/element"),K=t("../chem/struct"),Z=t("../chem/molfile"),J=t("../editor"),X=t("./templates"),Q=t("./utils"),tt=t("./modal"),et=t("./cliparea"),nt=t("./structformat"),rt=t("./structconv"),ot=null,it=["layout","clean","arom","dearom","cip","reaction-automap","recognize","check","analyse","miew"],at={storage:[],capacity:7,current:0},st={new:O,open:S,save:T,undo:function(){W.undo()},redo:function(){W.redo()},"zoom-in":C,"zoom-out":j,"period-table":function(){M().then(function(t){h("atom",rt.toElement(t))})},"template-lib":B,layout:function(){return A("layout")},clean:function(){return A("clean")},arom:function(){return A("aromatize")},dearom:function(){return A("dearomatize")},cip:function(){return A("calculateCip")},about:function(){var t=x.bind(null,tt.about);H.then(function(e){return t(Object.assign(e,z),!0)},function(){return t(z,!0)})},"select-all":function(){W.selection("all"),h(null)},"deselect-all":function(){W.selection(null)},"force-update":function(){W.update(!0)},"qs-serialize":function(){var t=Z.stringify(W.struct()),e="mol="+encodeURIComponent(t).replace(/%20/g,"+"),n=document.location.search;document.location.search=n?-1==n.search("mol=")?n+"&"+e:n.replace(/mol=[^&$]*/,e):"?"+e},"reaction-automap":N,recognize:function(){x(tt.recognize,{server:H}).then(function(t){R(t.structStr,{rescale:!0,fragment:t.fragment})})},check:function(){x(tt.check,{check:E.bind(null,"check")})},analyse:function(){E("calculate",{properties:["molecular-weight","most-abundant-mass","monoisotopic-mass","gross","mass-composition"]}).then(function(t){return x(tt.analyse,t,!0)})},settings:function(){x(tt.settings,{server:H}).then(function(t){localStorage.setItem("ketcher-opts",JSON.stringify(t)),z=Object.assign(z,t),W.options(z)})},help:function(){x(tt.help)},miew:function(){nt.toString(W.struct(),"cml",H).then(function(t){x(tt.miew,{structStr:t},!0).then(function(t){t.structStr&&R(t.structStr)})})}};e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../chem/element":60,"../chem/molfile":63,"../chem/struct":77,"../editor":83,"./cliparea":130,"./keynorm":148,"./modal":159,"./structconv":190,"./structformat":191,"./templates":193,"./utils":194,preact:28}],148:[function(t,e,n){"use strict";function r(t){var e=t.split(/-(?!$)/),n=e[e.length-1];"Space"==n&&(n=" ");for(var r=void 0,o=void 0,i=void 0,a=void 0,s=0;s<e.length-1;s++){var l=e[s];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))i=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);d?a=!0:o=!0}}return r&&(n="Alt-"+n),o&&(n="Ctrl-"+n),a&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function o(t){var e=Object.create(null);for(var n in t)e[r(n)]=t[n];return e}function i(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==n&&e.shiftKey&&(t="Shift-"+t),t}function a(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,p.default)(t),r=1==n.length&&" "!=n;return r&&!e?i(n,t,!r):i(p.default.base[t.keyCode],t,!0)}function s(t){return t instanceof KeyboardEvent?a.apply(void 0,arguments):"object"==(void 0===t?"undefined":u(t))?o(t):r(t)}function l(t,e){var n=(0,p.default)(e),r=1==n.length&&" "!=n,o=t[i(n,e,!r)],a=void 0;return!o&&e.shiftKey&&r&&(a=p.default.base[e.keyCode])&&(o=t[i(a,e,!0)]),o}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=t("w3c-keyname"),p=function(t){return t&&t.__esModule?t:{default:t}}(c),d="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);s.lookup=l,e.exports=s},{"w3c-keyname":58}],149:[function(t,e,n){"use strict";function r(t){return(0,o.h)(a.default,{title:"About",className:"about",params:t,buttons:["Close"]},(0,o.h)("a",{href:"http://lifescience.opensource.epam.com/ketcher/",target:"_blank"},(0,o.h)("img",{src:"logo.jpg"})),(0,o.h)("dl",null,(0,o.h)("dt",null,(0,o.h)("a",{href:"http://lifescience.opensource.epam.com/ketcher/help.html",target:"_blank"},"Ketcher")),(0,o.h)("dd",null,"version ",(0,o.h)("var",null,t.version)),t.buildNumber?(0,o.h)("dd",null,"build #",(0,o.h)("var",null,t.buildNumber)," at ",(0,o.h)("time",null,t.buildDate)):null,t.indigoVersion?(0,o.h)("div",null,(0,o.h)("dt",null,(0,o.h)("a",{href:"http://lifescience.opensource.epam.com/indigo/",target:"_blank"},"Indigo Toolkit")),(0,o.h)("dd",null,"version ",(0,o.h)("var",null,t.indigoVersion))):(0,o.h)("dd",null,"standalone"),(0,o.h)("dt",null,(0,o.h)("a",{href:"http://lifescience.opensource.epam.com/",target:"_blank"},"EPAM Life Sciences")),(0,o.h)("dd",null,(0,o.h)("a",{href:"http://lifescience.opensource.epam.com/ketcher/#feedback",target:"_blank"},"Feedback"))))}Object.defineProperty(n,"__esModule",{value:!0});var o=t("preact"),i=t("../component/dialog"),a=function(t){return t&&t.__esModule?t:{default:t}}(i);n.default=r},{"../component/dialog":134,preact:28}],150:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){var e=t.value;return(0,c.h)("input",{type:"text",spellcheck:"false",value:e,onKeyDown:function(t){return s(t)}})}function i(t){for(var e,n=t.value,r=[],o=/\b([A-Z][a-z]{0,3})(\d*)\s*\b/g,i=0;e=o.exec(n);)r.push(n.substring(i,e.index)+e[1]),e[2].length>0&&r.push((0,c.h)("sub",null,e[2])),i=e.index+e[0].length;return 0==i?r.push(n):r.push(n.substring(i,n.length)),(0,c.h)("div",{className:"chem-input",spellcheck:"false",contenteditable:"true",onKeyDown:function(t){return s(t)}},r)}function a(t){return(0,c.h)(g.default,{title:"Calculated Values",className:"analyse",buttons:["Close"],params:t},(0,c.h)("ul",null,[{name:"Chemical Formula",key:"gross"},{name:"Molecular Weight",key:"molecular-weight",round:"roundWeight"},{name:"Exact Mass",key:"monoisotopic-mass",round:"roundMass"},{name:"Elemental Analysis",key:"mass-composition"}].map(function(e){return(0,c.h)("li",null,(0,c.h)("label",null,e.name,":"),"gross"===e.key?(0,c.h)(i,{value:t[e.key]}):(0,c.h)(o,{value:l(t[e.key],t[e.round])}),e.round?(0,c.h)(y.default,{schema:{enum:u(8),enumNames:u(8).map(function(t){return t+" decimal places"})},value:t[e.round],onChange:function(n){return t.dispatch((0,h.changeRound)(e.round,n))}}):null)})))}function s(t){var e=["Tab","ArrowLeft","ArrowRight","Home","End"],n=(0,f.default)(t);-1===e.indexOf(n)&&t.preventDefault()}function l(t,e){return"number"==typeof t?t.toFixed(e):t.replace(/[0-9]*\.[0-9]+/g,function(t){return(+t).toFixed(e)})}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.apply(null,{length:t-e}).map(function(t,n){return n+e})}Object.defineProperty(n,"__esModule",{value:!0});var c=t("preact"),p=t("preact-redux"),d=t("w3c-keyname"),f=r(d),h=t("../actions/analyse-action.es"),m=t("../component/dialog"),g=r(m),b=t("../component/input"),y=r(b);n.default=(0,p.connect)(function(t){return{roundWeight:t.analyse.roundWeight,roundMass:t.analyse.roundMass}})(a)},{"../actions/analyse-action.es":124,"../component/dialog":134,"../component/input":136,preact:28,"preact-redux":27,"w3c-keyname":58}],151:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){var n=e.stateStore,r=n.props.stateForm;return(0,u.h)("label",null,"Number:",(0,u.h)("input",{className:"number",type:"text",readonly:"readonly",value:g.default.map[r.label]||""}))}function a(t){var e=t.result,n=t.valid,r=o(t,["result","valid"]);return(0,u.h)(h.default,{title:"Atom Properties",className:"atom-props",result:function(){return e},valid:function(){return n},params:r},(0,u.h)(d.form,{storeName:"atom",schema:p.atom,customValid:{label:function(t){return l(t)}},init:r},(0,u.h)("fieldset",{className:"main"},(0,u.h)(d.Field,{name:"label"}),(0,u.h)(d.Field,{name:"alias"}),(0,u.h)(i,null),(0,u.h)(d.Field,{name:"charge",maxlength:"5"}),(0,u.h)(d.Field,{name:"explicitValence"}),(0,u.h)(d.Field,{name:"isotope"}),(0,u.h)(d.Field,{name:"radical"})),(0,u.h)("fieldset",{className:"query"},(0,u.h)("legend",null,"Query specific"),(0,u.h)(d.Field,{name:"ringBondCount"}),(0,u.h)(d.Field,{name:"hCount"}),(0,u.h)(d.Field,{name:"substitutionCount"}),(0,u.h)(d.Field,{name:"unsaturatedAtom"})),(0,u.h)("fieldset",{className:"reaction"},(0,u.h)("legend",null,"Reaction flags"),(0,u.h)(d.Field,{name:"invRet"}),(0,u.h)(d.Field,{name:"exactChangeFlag"}))))}function s(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()}function l(t){return t&&!!g.default.map[s(t)]}Object.defineProperty(n,"__esModule",{value:!0});var u=t("preact"),c=t("preact-redux"),p=t("../structschema"),d=t("../component/form"),f=t("../component/dialog"),h=r(f),m=t("../../chem/element"),g=r(m);n.default=(0,c.connect)(function(t){return{result:t.atom.stateForm,valid:t.atom.valid}})(a)},{"../../chem/element":60,"../component/dialog":134,"../component/form":135,"../structschema":192,preact:28,"preact-redux":27}],152:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=t.result,n=t.valid,o=r(t,["result","valid"]);return(0,i.h)(c.default,{title:"Attachment Points",className:"attach-points",result:function(){return e},valid:function(){return n},params:o},(0,i.h)(l.form,{storeName:"attach-points",schema:s.attachmentPoints,init:o},(0,i.h)(l.Field,{name:"primary"}),(0,i.h)(l.Field,{name:"secondary"})))}Object.defineProperty(n,"__esModule",{value:!0});var i=t("preact"),a=t("preact-redux"),s=t("../structschema"),l=t("../component/form"),u=t("../component/dialog"),c=function(t){return t&&t.__esModule?t:{default:t}}(u);n.default=(0,a.connect)(function(t){return{result:t["attach-points"].stateForm,valid:t["attach-points"].valid}})(o)},{"../component/dialog":134,"../component/form":135,"../structschema":192,preact:28,"preact-redux":27}],153:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t){var e={struct:t.struct.clone(),props:{atomid:+t.props.atomid||0,bondid:+t.props.bondid||0}};e.struct.name=t.struct.name;var n=u(e.struct),r=3.7/(n+5.4/n)*100;return Object.assign(e,{scale:r})}function u(t){var e=new w.default(t.atoms.get(0).pp),n=new w.default(t.atoms.get(0).pp);return t.atoms.each(function(t,r){r.pp.x<e.x&&(e.x=r.pp.x),r.pp.y<e.y&&(e.y=r.pp.y),r.pp.x>n.x&&(n.x=r.pp.x),r.pp.y>n.y&&(n.y=r.pp.y)}),t.atoms.each(function(t,n){n.pp=w.default.diff(n.pp,e)}),n=w.default.diff(n,e),n.x>n.y?n.x:n.y}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),p=t("preact"),d=t("preact-redux"),f=t("../component/dialog"),h=r(f),m=t("../component/input"),g=r(m),b=t("../component/structeditor"),y=r(b),v=t("../../util/vec2"),w=r(v),x=t("../actions/attach-action.es"),O={selectionStyle:{fill:"#47b3ec",stroke:"none"},highlightStyle:{stroke:"#304ff7","stroke-width":1.2}},S=function(t){function e(t){var n=t.dispatch,r=o(t,["dispatch"]);i(this,e);var s=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return s.tmpl=l(r.tmpl),n((0,x.initAttach)(s.tmpl.struct.name,s.tmpl.props)),s}return s(e,t),c(e,[{key:"render",value:function(){var t=this,e=this.props,n=e.name,r=e.atomid,i=e.bondid,a=e.userOpts,s=e.dispatch,l=o(e,["name","atomid","bondid","userOpts","dispatch"]),u=Object.assign(O,{scale:this.tmpl.scale}),c=function(){return n!==t.tmpl.struct.name||r!==t.tmpl.props.atomid||i!==t.tmpl.props.bondid?{name:n,attach:{atomid:r,bondid:i}}:null};return(0,p.h)(h.default,{title:"Template Edit",className:"attach",result:c,params:l,buttons:["Cancel","OK"]},(0,p.h)("label",null,"Template Name:",(0,p.h)(g.default,{type:"text",value:n,onChange:function(t){return s((0,x.setTmplName)(t))},placeholder:"tmpl"})),(0,p.h)("label",null,"Choose attachment atom and bond:"),(0,p.h)(y.default,{className:"struct-editor",struct:this.tmpl.struct,opts:a,onEvent:function(t,e){return"attachEdit"===t?s((0,x.setAttachPoints)(e)):null},tool:{name:"attach",opts:this.tmpl.props},options:u}),(0,p.h)("label",null,(0,p.h)("b",null,"{ atomid: ",r,"; bondid: ",i," }")))}}]),e}(p.Component);n.default=(0,d.connect)(function(t){return{name:t.attach.name,atomid:t.attach.atomid,bondid:t.attach.bondid}})(S)},{"../../util/vec2":200,"../actions/attach-action.es":125,"../component/dialog":134,"../component/input":136,"../component/structeditor":142,preact:28,"preact-redux":27}],154:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=t.result,n=t.valid,o=r(t,["result","valid"]);return(0,i.h)(u.default,{title:"Reaction Auto-Mapping",className:"automap",result:function(){return e},valid:function(){return n},params:o},(0,i.h)(s.form,{storeName:"automap",schema:c,params:o},(0,i.h)(s.Field,{name:"mode"})))}Object.defineProperty(n,"__esModule",{value:!0}),n.automapSchema=void 0;var i=t("preact"),a=t("preact-redux"),s=t("../component/form"),l=t("../component/dialog"),u=function(t){return t&&t.__esModule?t:{default:t}}(l),c=n.automapSchema={title:"Reaction Auto-Mapping",type:"object",required:["mode"],properties:{mode:{title:"Mode",enum:["discard","keep","alter","clear"],enumNames:["Discard","Keep","Alter","Clear"],default:"discard"}}};n.default=(0,a.connect)(function(t){return{result:t.automap.stateForm,valid:t.automap.valid}})(o)},{"../component/dialog":134,"../component/form":135,preact:28,"preact-redux":27}],155:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=t.result,n=t.valid,o=r(t,["result","valid"]);return(0,i.h)(c.default,{title:"Bond Properties",className:"bond",result:function(){return e},valid:function(){return n},params:o},(0,i.h)(l.form,{storeName:"bond",schema:s.bond,init:t},(0,i.h)(l.Field,{name:"type"}),(0,i.h)(l.Field,{name:"topology"}),(0,i.h)(l.Field,{name:"center"})))}Object.defineProperty(n,"__esModule",{value:!0});var i=t("preact"),a=t("preact-redux"),s=t("../structschema"),l=t("../component/form"),u=t("../component/dialog"),c=function(t){return t&&t.__esModule?t:{default:t}}(u);n.default=(0,a.connect)(function(t){return{result:t.bond.stateForm,valid:t.bond.valid}})(o)},{"../component/dialog":134,"../component/form":135,"../structschema":192,preact:28,"preact-redux":27}],156:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){var e=g.properties.checkOptions.items;return e.enumNames[e.enum.indexOf(t)]}function a(t){var e=["Check","Settings"],n=t.result,r=t.moleculeErrors,i=t.check,a=o(t,["result","moleculeErrors","check"]);return(0,l.h)(p.default,{title:"Structure Check",className:"check",result:function(){return n},params:a},(0,l.h)(h.form,{storeName:"check",schema:g},(0,l.h)(f.default,{className:"tabs",captions:e,changeTab:function(e){return 0===e?(0,m.checkErrors)(t.dispatch,i,n.checkOptions):null}},(0,l.h)(s,{moleculeErrors:r}),(0,l.h)(h.Field,{name:"checkOptions",multiple:!0,type:"checkbox"}))))}function s(t){var e=t.moleculeErrors,n=Object.keys(e);return(0,l.h)("fieldset",t,0===n.length?(0,l.h)("dt",null,"No errors found"):n.map(function(t){return(0,l.h)("div",null,(0,l.h)("dt",null,i(t)," error :"),(0,l.h)("dd",null,e[t]))}))}Object.defineProperty(n,"__esModule",{value:!0});var l=t("preact"),u=t("preact-redux"),c=t("../component/dialog"),p=r(c),d=t("../component/tabs"),f=r(d),h=t("../component/form"),m=t("../actions/check-action.es"),g={title:"Check",type:"object",properties:{checkOptions:{type:"array",items:{type:"string",enum:["valence","radicals","pseudoatoms","stereo","query","overlapping_atoms","overlapping_bonds","rgroups","chiral","3d"],enumNames:["Valence","Radical","Pseudoatom","Stereochemistry","Query","Overlapping Atoms","Overlapping Bonds","R-Groups","Chirality","3D Structure"]}}}};n.default=(0,u.connect)(function(t){return{result:t.check.stateForm,moleculeErrors:t.check.moleculeErrors}})(a)},{"../actions/check-action.es":126,"../component/dialog":134,"../component/form":135,"../component/tabs":145,preact:28,"preact-redux":27}],157:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=t.labels,n=t.caption,o=void 0===n?"":n,i=t.selected,a=t.onSelect,s=r(t,["labels","caption","selected","onSelect"]);return(0,l.h)("fieldset",s,e.map(function(t){return(0,l.h)("button",{onClick:function(e){return a(t)},className:i(t)?"selected":""},t)}),o?(0,l.h)("legend",null,o):null)}function i(t){var e=t.gen,n=t.key,r=t.path,a=t.selected,s=t.onSelect,u=e[n],c=r?r+"/"+n:n,d=p[c];return d&&d.caption?(0,l.h)("fieldset",{className:n},(0,l.h)("legend",null,d.caption),u.labels?(0,l.h)(o,{labels:u.labels,selected:a,onSelect:s}):null,d.order.map(function(t){return(0,l.h)(i,{gen:u,key:t,path:c,selected:a,onSelect:s})})):(0,l.h)(o,{labels:u.labels,caption:d||n,className:n,selected:a,onSelect:s})}function a(t){var e=t.selected,n=t.onSelect,o=r(t,["selected","onSelect"]);return(0,l.h)("div",s({summary:"Generic Groups"},o),(0,l.h)("div",{className:"col"},(0,l.h)(i,{gen:c.default,key:"atom",selected:function(t){return e(t)},onSelect:function(t){return n(t)}}),(0,l.h)(i,{gen:c.default,key:"special",selected:function(t){return e(t)},onSelect:function(t){return n(t)}})),(0,l.h)("div",{className:"col"},(0,l.h)(i,{gen:c.default,key:"group",selected:function(t){return e(t)},onSelect:function(t){return n(t)}})))}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=t("preact"),u=t("../../chem/generics"),c=function(t){return t&&t.__esModule?t:{default:t}}(u),p={atom:{caption:"Atom Generics",order:["any","no-carbon","metal","halogen"]},group:{caption:"Group Generics",order:["acyclic","cyclic"]},special:{caption:"Special Nodes",order:[]},"group/acyclic":{caption:"Acyclic",order:["carbo","hetero"]},"group/cyclic":{caption:"Cyclic",order:["no-carbon","carbo","hetero"]},"group/acyclic/carbo":{caption:"Carbo",order:["alkynyl","alkyl","alkenyl"]},"group/acyclic/hetero":{caption:"Hetero",order:["alkoxy"]},"group/cyclic/carbo":{caption:"Carbo",order:["aryl","cycloalkyl","cycloalkenyl"]},"group/cyclic/hetero":{caption:"Hetero",order:["aryl"]},"atom/any":"any atom","atom/no-carbon":"except C or H","atom/metal":"any metal","atom/halogen":"any halogen","group/cyclic/no-carbon":"no carbon","group/cyclic/hetero/aryl":"hetero aryl"};n.default=a},{"../../chem/generics":61,preact:28}],158:[function(t,e,n){"use strict";function r(t){return(0,o.h)(a.default,{title:"Help",className:"help",params:t,buttons:["Close"]},(0,o.h)("iframe",{className:"help",src:"doc/help.html"}))}Object.defineProperty(n,"__esModule",{value:!0});var o=t("preact"),i=t("../component/dialog"),a=function(t){return t&&t.__esModule?t:{default:t}}(i);n.default=r},{"../component/dialog":134,preact:28}],159:[function(t,e,n){
var r=t("./render-modal").default,o=t("./open").default,i=t("./save").default,a=t("./template-lib"),s=t("./rgroup").default,l=t("./miew").default,u=t("./about").default,c=t("./attach").default,p=t("./analyse").default,d=t("./help").default,f=t("./period-table").default,h=t("./recognize").default,m=t("./atom").default,g=t("./attach-points").default,b=t("./automap").default,y=t("./bond").default,v=t("./check").default,w=t("./labeledit").default,x=t("./rgroup-logic").default,O=t("./settings").default,S=t("./sgroup").default,T=t("./sgroup-special").default;a.default.init=a.init,e.exports={periodTable:r(f),rgroup:s,attachmentPoints:r(g),atomProps:r(m),bondProps:r(y),automap:r(b),rgroupLogic:r(x),sgroup:r(S),sgroupSpecial:r(T),open:o,save:i,templates:a.default,labelEdit:r(w),about:r(u),recognize:r(h),check:r(v),analyse:r(p),settings:r(O),help:r(d),miew:l,attach:r(c)}},{"./about":149,"./analyse":150,"./atom":151,"./attach":153,"./attach-points":152,"./automap":154,"./bond":155,"./check":156,"./help":158,"./labeledit":160,"./miew":161,"./open":162,"./period-table":163,"./recognize":164,"./render-modal":165,"./rgroup":167,"./rgroup-logic":166,"./save":168,"./settings":169,"./sgroup":171,"./sgroup-special":170,"./template-lib":172}],160:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){var e=Math.abs(t.charge),n=["",":",".","^^"][t.radical]||"",r="";return e&&(r=t.charge<0?"-":"+"),(t.isotope||"")+t.label+n+(e>1?e:"")+r}function a(t){var e=t.match(/^(\d+)?([a-z*]{1,3})(\.|:|\^\^)?(\d+[-+]|[-+])?$/i);if(e){var n="*"==e[2]?"A":l(e[2]),r=0,o=0,i=0;if(e[1]&&(o=parseInt(e[1])),e[3]&&(i={":":1,".":2,"^^":3}[e[3]]),e[4]&&(r=parseInt(e[4]),isNaN(r)&&(r=1),e[4].endsWith("-")&&(r=-r)),"A"==n||"Q"==n||"X"==n||"M"==n||d.default.map[n])return{label:n,charge:r,isotope:o,radical:i}}return null}function s(t){var e={label:t.letter||i(t)},n=t.result,r=t.valid,s=o(t,["result","valid"]);return(0,u.h)(h.default,{title:"Label Edit",className:"labeledit",valid:function(){return r},result:function(){return a(n.label)},params:s},(0,u.h)(m.form,{storeName:"label-edit",schema:g,customValid:{label:function(t){return a(t)}},init:e},(0,u.h)(m.Field,{name:"label",maxlength:"20",size:"10"})))}function l(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()}Object.defineProperty(n,"__esModule",{value:!0}),n.labelEditSchema=void 0;var u=t("preact"),c=t("preact-redux"),p=t("../../chem/element"),d=r(p),f=t("../component/dialog"),h=r(f),m=t("../component/form"),g=n.labelEditSchema={title:"Label Edit",type:"object",required:["label"],properties:{label:{title:"Atom",default:""}}};n.default=(0,c.connect)(function(t){return{result:t["label-edit"].stateForm,valid:t["label-edit"].valid}})(s)},{"../../chem/element":60,"../component/dialog":134,"../component/form":135,preact:28,"preact-redux":27}],161:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(){var t=JSON.parse(localStorage.getItem("ketcher-opts"));if(!t)return v;var e=v;return t.miewTheme&&(e.settings.theme=p(t.miewTheme)),t.miewAtomLabel&&(e.settings.atomLabel=p(t.miewAtomLabel)),t.miewMode&&(e.reps[0].mode=x[p(t.miewMode)]),e}function s(t){var e=t;return e.href||(e=document.createElement("a"),e.href=t),e.origin?e.origin:(e.hostname||(e=document.location),e.protocol+"//"+e.hostname+(e.port?":"+e.port:""))}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&";return Array.isArray(t)?t.reduce(function(t,e){var n=l(e);return null!==n&&t.push(n),t},[]).join(e):"object"==(void 0===t?"undefined":m(t))?Object.keys(t).reduce(function(e,n){var r=t[n];return e.push("object"==(void 0===r?"undefined":m(r))?l(r):encodeURIComponent(n)+"="+encodeURIComponent(r)),e},[]).join(e):null}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,o){addEventListener("message",function o(i){if(i.origin==s(e)&&"miewLoadComplete"==i.data){window.removeEventListener("message",o);var a=t.MIEWS[0];a._opts.load=!1,a._menuDisabled=!0,a.init()&&(a.setOptions(n),a.benchmarkGfx().then(function(){a.run(),setTimeout(function(){return r(a)},10)}))}})})}function c(t,e){return t.saveData(),new Promise(function(t,n){addEventListener("message",function n(r){r.origin==s(e)&&r.data.startsWith("CML:")&&(window.removeEventListener("message",n),t(atob(r.data.slice(4))))})})}function p(t){return t.replace(/\s(.)/g,function(t){return t.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(t){return t.toLowerCase()})}function d(t){var e=$$(".overlay")[0];return(0,g.render)((0,g.h)(O,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.default=d;var g=t("preact"),b=t("../component/dialog"),y=function(t){return t&&t.__esModule?t:{default:t}}(b),v={preset:"small",settings:{theme:"light",atomLabel:"bright",autoPreset:!1,inversePanning:!0},reps:[{mode:"LN",colorer:"AT",selector:"all"}]},w={location:"no",menubar:"no",toolbar:"no",directories:"no",modal:"yes",alwaysRaised:"yes"},x={lines:"LN",ballsAndSticks:"BS",licorice:"LC"},O=function(t){function e(t){r(this,e),console.info("init");var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.opts=a(),n}return i(e,t),h(e,[{key:"load",value:function(t){var e=this,n=u(t.target.contentWindow,"null",this.opts);this.setState({miew:n}),this.state.miew.then(function(t){t.parse(e.props.structStr,{fileType:"cml",loaded:!0}),e.setState({miew:t})})}},{key:"save",value:function(t){var e=this;if(this.props.onOk){var n=c(this.state.miew,"null");this.setState({structStr:n}),this.state.structStr.then(function(t){e.props.onOk({structStr:t})})}}},{key:"window",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=f({},this.opts,{load:"CML:"+btoa(this.props.structStr),sourceType:"message"}),e=this.base.getBoundingClientRect(),n=f({},w,{top:Math.round(e.top),left:Math.round(e.left),width:Math.round(e.width),height:Math.round(e.height)}),r=window.open("null?"+l(t),"miew",l(n,","));r&&(this.props.onCancel&&this.props.onCancel(),r.onload=function(){console.info("windowed")})})},{key:"render",value:function(t){var e=this,n=this.state,r=n.miew,o=n.structStr;return(0,g.h)(y.default,{title:"3D View",className:"miew",params:t,buttons:["Close",(0,g.h)("button",{disabled:r instanceof Promise||o instanceof Promise,onClick:function(t){return e.save(t)}},"Apply"),(0,g.h)("button",{className:"window",disabled:/MSIE|rv:11/i.test(navigator.userAgent),onClick:function(t){return e.window()}},"Detach to new window")]},(0,g.h)("iframe",{id:"miew-iframe",src:"null",onLoad:function(t){return e.load(t)}}))}}]),e}(g.Component)},{"../component/dialog":134,preact:28}],162:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(){return Object.keys(d.map).reduce(function(t,e){return t.concat.apply(t,[d.map[e].mime].concat(o(d.map[e].ext)))},[]).join(",")}function u(t){var e=$$(".overlay")[0];return(0,p.render)((0,p.h)(b,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=u;var p=t("preact"),d=t("../structformat"),f=t("../component/dialog"),h=r(f),m=t("../component/openbutton"),g=r(m),b=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={structStr:"",fragment:!1},n}return s(e,t),c(e,[{key:"result",value:function(){var t=this.state,e=t.structStr,n=t.fragment;return e?{structStr:e,fragment:n}:null}},{key:"changeStructStr",value:function(t){this.setState({structStr:t})}},{key:"changeFragment",value:function(t){this.setState({fragment:t.checked})}},{key:"render",value:function(){var t=this,e=this.state,n=e.structStr,r=e.fragment;return(0,p.h)(h.default,{title:"Open Structure",className:"open",result:function(){return t.result()},params:this.props,buttons:[(0,p.h)(g.default,{className:"open",server:this.props.server,type:l(),onLoad:function(e){return t.changeStructStr(e)}},"Open From File…"),"Cancel","OK"]},(0,p.h)("textarea",{value:n,onInput:function(e){return t.changeStructStr(e.target.value)}}),(0,p.h)("label",null,(0,p.h)("input",{type:"checkbox",checked:r,onClick:function(e){return t.changeFragment(e.target)}}),"Load as a fragment"))}}]),e}(p.Component)},{"../component/dialog":134,"../component/openbutton":138,"../structformat":191,preact:28}],163:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function l(){return(0,g.h)("tr",null,f(19).map(function(t){return(0,g.h)("th",null,t||"")}))}function u(t){var e=t.value,n=t.onChange,r=s(t,["value","onChange"]);return(0,g.h)("fieldset",null,P.map(function(t){return(0,g.h)("label",null,(0,g.h)("input",m({type:"radio",value:t.value,checked:t.value==e,onClick:function(e){return n(t.value)}},r)),t.title)}))}function c(t){var e=t.row,n=t.caption,r=t.ref,o=t.selected,i=t.onSelect,a=t.curEvents;return(0,g.h)("tr",null,(0,g.h)("th",null,n),e.map(function(t){return"number"!=typeof t?(0,g.h)("td",null,(0,g.h)(O.default,m({el:t,className:o(t.label)?"selected":"",onClick:function(e){return i(t.label)}},a(t)))):r(t)?(0,g.h)("td",{className:"ref"},r(t)):(0,g.h)("td",{colspan:t})}))}function p(t){var e=t.row,n=t.caption,r=t.selected,o=t.onSelect,i=t.curEvents;return(0,g.h)("tr",null,(0,g.h)("th",{colspan:"3",className:"ref"},n),e.map(function(t){return(0,g.h)("td",null,(0,g.h)(O.default,m({el:t,className:r(t.label)?"selected":"",onClick:function(e){return o(t.label)}},i(t))))}),(0,g.h)("td",null))}function d(t){var e=t.el,n=t.isInfo,r={color:e.color||"black","font-size":"1.2em"},o={color:e.color||"black","font-weight":"bold","font-size":"2em"};return(0,g.h)("div",{className:"atom-info "+(n?"":"none")},(0,g.h)("div",{style:r},y.default.map[e.label]),(0,g.h)("span",{style:o},e.label),(0,g.h)("br",null),e.title,(0,g.h)("br",null),e.atomic_mass)}function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.apply(null,{length:t-e}).map(function(t,n){return n+e})}Object.defineProperty(n,"__esModule",{value:!0});var h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},g=t("preact"),b=t("../../chem/element"),y=r(b),v=t("../component/dialog"),w=r(v),x=t("../component/atom"),O=r(x),S=t("../component/tabs"),T=r(S),E=t("./generic-groups"),A=r(E),P=[{title:"Single",value:"atom"},{title:"List",value:"list"},{title:"Not List",value:"not-list"}],C={He:16,B:10,Al:10,Hf:1,Rf:1},j=function(t){return t.reduce(function(t,e,n){var r=t[e.period-1];return r?(C[e.label]&&r.push(C[e.label]),r.push(e)):t.push([e]),t},[])}(y.default.filter(function(t){return t&&"actinide"!=t.type&&"lanthanide"!=t.type})),_=y.default.filter(function(t){return t&&"lanthanide"==t.type}),N=y.default.filter(function(t){return t&&"actinide"==t.type}),R=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n.curEvents=function(t){return{onMouseEnter:function(){return n.setState({cur:t,isInfo:!0})},onMouseLeave:function(){return n.setState({isInfo:!1})}}};var r=n.props.pseudo?"gen":null;return n.state={type:t.type||r||"atom",value:t.values||t.label||null,cur:y.default[2],isInfo:!1},n.firstType=!0,n}return a(e,t),h(e,[{key:"changeType",value:function(t){if(this.firstType)return this.firstType=!1;var e="list"===this.state.type||"not-list"===this.state.type;"list"!==t&&"not-list"!==t||!e?this.setState({type:t,value:"atom"===t||"gen"===t?null:[]}):this.setState({type:t})}},{key:"selected",value:function(t){var e=this.state,n=e.type,r=e.value;return"atom"===n||"gen"===n?r==t:r.includes(t)}},{key:"onSelect",value:function(t){var e=this.state,n=e.type,r=e.value;if("atom"===n||"gen"===n)this.setState({value:t});else{var o=r.indexOf(t);o<0?r.push(t):r.splice(o,1),this.setState({value:r})}}},{key:"result",value:function(){var t=this.state,e=t.type,n=t.value;return"atom"===e?n?{label:n,pseudo:null}:null:"gen"===e?n?{type:e,label:n,pseudo:n}:null:n.length?{type:e,values:n}:null}},{key:"render",value:function(){var t=this,e=["Table","Extended"],n=this.state.type;return(0,g.h)(w.default,{title:"Periodic table",className:"elements-table",params:this.props,result:function(){return t.result()}},(0,g.h)(T.default,{className:"tabs",captions:e,tabIndex:"gen"!==n?0:1,changeTab:function(e){return t.changeType(0===e?"atom":"gen")}},(0,g.h)("div",{className:"period-table"},(0,g.h)("table",{summary:"Periodic table of the chemical elements"},(0,g.h)(l,null),(0,g.h)(d,{el:this.state.cur,isInfo:this.state.isInfo}),j.map(function(e,n){return(0,g.h)(c,{row:e,caption:n+1,ref:function(t){return 1==t&&(5==n?"*":"**")},curEvents:t.curEvents,selected:function(e){return t.selected(e)},onSelect:function(e){return t.onSelect(e)}})}),(0,g.h)(p,{row:_,caption:"*",curEvents:this.curEvents,selected:function(e){return t.selected(e)},onSelect:function(e){return t.onSelect(e)}}),(0,g.h)(p,{row:N,caption:"**",curEvents:this.curEvents,selected:function(e){return t.selected(e)},onSelect:function(e){return t.onSelect(e)}})),(0,g.h)(u,{value:n,onChange:function(e){return t.changeType(e)}})),(0,g.h)(A.default,{className:"generic-groups",selected:this.selected.bind(this),onSelect:this.onSelect.bind(this)})))}}]),e}(g.Component);n.default=R},{"../../chem/element":60,"../component/atom":132,"../component/dialog":134,"../component/tabs":145,"./generic-groups":157,preact:28}],164:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e,n){var r=t.recognize(e).then(function(t){n((0,c.setStruct)(t.struct))},function(t){n((0,c.setStruct)(null)),setTimeout(function(){return alert("Error! The picture isn't recognized.")},200)});n((0,c.setStruct)(r))}function a(t){var e=t.file,n=t.structStr,r=t.fragment,a=t.dispatch,u=o(t,["file","structStr","fragment","dispatch"]),p=function(){return!n||n instanceof Promise?null:{structStr:n,fragment:r}};return(0,l.h)(d.default,{title:"Import From Image",className:"recognize",params:u,result:function(){return p()},buttons:[(0,l.h)("label",{className:"open"},"Choose file…",(0,l.h)("input",{type:"file",onChange:function(t){return a((0,c.changeImage)(t.target.files[0]))},accept:"image/*"})),(0,l.h)("span",{className:"open-filename"},e?e.name:null),e&&!n?(0,l.h)("button",{onClick:function(){return i(u.server,e,a)}},"Recognize"):null,"Cancel","OK"]},(0,l.h)("div",{className:"picture"},e?(0,l.h)("img",{id:"pic",src:s(e)||"",onError:function(){a((0,c.changeImage)(null)),alert("Error, it isn't a picture")}}):null),(0,l.h)("div",{className:"output"},n?n instanceof Promise?(0,l.h)(y.default,null):(0,l.h)(g.default,{className:"struct",struct:n}):null),(0,l.h)("label",null,(0,l.h)(h.default,{type:"checkbox",value:r,onChange:function(t){return a((0,c.shouldFragment)(t))}}),"Load as a fragment"))}function s(t){if(!t)return null;var e=window.URL||window.webkitURL;return e?e.createObjectURL(t):"No preview"}Object.defineProperty(n,"__esModule",{value:!0});var l=t("preact"),u=t("preact-redux"),c=t("../actions/recognize-action.es"),p=t("../component/dialog"),d=r(p),f=t("../component/input"),h=r(f),m=t("../component/structrender"),g=r(m),b=t("../component/spin"),y=r(b);n.default=(0,u.connect)(function(t){return{file:t.recognize.file,structStr:t.recognize.structStr,fragment:t.recognize.fragment}})(a)},{"../actions/recognize-action.es":128,"../component/dialog":134,"../component/input":136,"../component/spin":141,"../component/structrender":143,preact:28,"preact-redux":27}],165:[function(t,e,n){"use strict";function r(t){return function(e){var n=$$(".overlay")[0];return(0,o.render)((0,o.h)(i.Provider,{store:s.default},(0,o.h)(t,e)),n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o=t("preact"),i=t("preact-redux"),a=t("../store.es"),s=function(t){return t&&t.__esModule?t:{default:t}}(a)},{"../store.es":189,preact:28,"preact-redux":27}],166:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){var n=e.schema,r=t.name,o=t.rgids,i={title:n.properties[r].title,enum:[0],enumNames:["Always"]};return o.forEach(function(e){t.label!==e&&(i.enum.push(e),i.enumNames.push("IF R"+t.label+" THEN R"+e))}),(0,l.h)(p.Field,s({name:r,schema:i},t))}function i(t){var e=t.result,n=t.valid,i=t.label,s=t.rgroupLabels,u=r(t,["result","valid","label","rgroupLabels"]);return(0,l.h)(f.default,{title:"R-Group Logic",className:"rgroup-logic",result:function(){return e},valid:function(){return n},params:u},(0,l.h)(p.form,{storeName:"rgroup-logic",schema:c.rgroup,customValid:{range:function(t){return a(t)}},init:t},(0,l.h)(p.Field,{name:"range"}),(0,l.h)(p.Field,{name:"resth"}),(0,l.h)(o,{name:"ifthen",className:"cond",label:i,rgids:s})))}function a(t){return t.replace(/\s*/g,"").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"").split(",").all(function(t){return t.match(/^[>,<,=]?[0-9]+$/g)||t.match(/^[0-9]+\-[0-9]+$/g)})}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=t("preact"),u=t("preact-redux"),c=t("../structschema"),p=t("../component/form"),d=t("../component/dialog"),f=function(t){return t&&t.__esModule?t:{default:t}}(d);n.default=(0,u.connect)(function(t){return{result:t["rgroup-logic"].stateForm,valid:t["rgroup-logic"].valid}})(i)},{"../component/dialog":134,"../component/form":135,"../structschema":192,preact:28,"preact-redux":27}],167:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function s(t){var e=t.selected,n=t.onSelect,r=t.result,o=a(t,["selected","onSelect","result"]);return(0,d.h)(h.default,{title:"R-Group",className:"rgroup",params:o,result:function(){return r()}},(0,d.h)("ul",null,l(33,1).map(function(t){return(0,d.h)("li",null,(0,d.h)("button",{className:e(t)?"selected":"",onClick:function(e){return n(t)}},"R"+t))})))}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.apply(null,{length:t-e}).map(function(t,n){return n+e})}function u(t){var e=$$(".overlay")[0];return(0,d.render)("rlabel"==t.type?(0,d.h)(g,t):(0,d.h)(m,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=u;var d=t("preact"),f=t("../component/dialog"),h=function(t){return t&&t.__esModule?t:{default:t}}(f),m=function(t){function e(t){var n=t.label;r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.state.label=n||null,i}return i(e,t),p(e,[{key:"onSelect",value:function(t){this.setState({label:t!==this.state.label?t:null})}},{key:"selected",value:function(t){return t===this.state.label}},{key:"result",value:function(){return{label:this.state.label}}},{key:"render",value:function(){var t=this;return(0,d.h)(s,c({selected:function(e){return t.selected(e)},onSelect:function(e){return t.onSelect(e)},result:function(){return t.result()}},this.props))}}]),e}(d.Component),g=function(t){function e(t){var n=t.values;r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.state.values=n||[],i}return i(e,t),p(e,[{key:"onSelect",value:function(t){var e=this.state.values,n=e.indexOf(t);n<0?e.push(t):e.splice(n,1),this.setState({values:e})}},{key:"selected",value:function(t){return this.state.values.includes(t)}},{key:"result",value:function(){return{type:"rlabel",values:this.state.values}}},{key:"render",value:function(){var t=this;return(0,d.h)(s,c({selected:function(e){return t.selected(e)},onSelect:function(e){return t.onSelect(e)},result:function(){return t.result()}},this.props))}}]),e}(d.Component)},{"../component/dialog":134,preact:28}],168:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=$$(".overlay")[0];return(0,u.render)((0,u.h)(g,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=s;var u=t("preact"),c=t("../structformat"),p=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(c),d=t("../component/dialog"),f=r(d),h=t("../component/savebutton"),m=r(h),g=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={type:t.struct.hasRxnArrow()?"rxn":"mol"},n.changeType().catch(t.onCancel),n}return a(e,t),l(e,[{key:"changeType",value:function(t){var e=this,n=this.state.type;return t&&(n=t.target.value,t.preventDefault()),p.toString(this.props.struct,n,this.props.server).then(function(t){return e.setState({type:n,structStr:t})},function(t){alert(t)})}},{key:"saveTemplate",value:function(t){this.props.onOk({event:"saveTmpl",tmpl:this.state.structStr})}},{key:"render",value:function(){var t=this,e=this.state,n=e.type,r=e.structStr,o=p.map[n];return console.assert(o,"Unknown chemical file type"),(0,u.h)(f.default,{title:"Save Structure",className:"save",params:this.props,buttons:[(0,u.h)(m.default,{className:"save",data:r,filename:"ketcher"+o.ext[0],type:o.mime,server:this.props.server,onSave:function(){return t.props.onOk()}},"Save To File…"),(0,u.h)("button",{className:"save-tmpl",onClick:function(e){return t.saveTemplate(e)}},"Save to Templates"),"Close"]},(0,u.h)("label",null,"Format:",(0,u.h)("select",{value:n,onChange:function(e){return t.changeType(e)}},[this.props.struct.hasRxnArrow()?"rxn":"mol","smiles","smarts","cml","inchi"].map(function(t){return(0,u.h)("option",{value:t},p.map[t].name)}))),(0,u.h)("textarea",{className:n,value:r,readonly:!0,ref:function(t){return t&&t.select()}}))}}]),e}(u.Component)},{"../component/dialog":134,"../component/savebutton":139,"../structformat":191,preact:28}],169:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){var e=t.server,n=t.stateForm,r=t.valid,i=t.onOpenFile,l=t.onReset,c=o(t,["server","stateForm","valid","onOpenFile","onReset"]),p=["Rendering customization options","Atoms","Bonds","3D Viewer","Options for debugging"],d={0:!0,1:!1,2:!1,3:!1,4:!1};return(0,u.h)(g.default,{title:"Settings",className:"settings",result:function(){return n},valid:function(){return r},params:c,buttons:[(0,u.h)(T.default,{className:"open",server:e,onLoad:i},"Open From File…"),(0,u.h)(O.default,{className:"save",data:JSON.stringify(n),filename:"ketcher-settings"},"Save To File…"),(0,u.h)("button",{onClick:l},"Reset"),"OK","Cancel"]},(0,u.h)(h.form,{storeName:"settings",schema:f.settings},(0,u.h)(y.default,{className:"accordion",captions:p,active:d},(0,u.h)("fieldset",{className:"render"},(0,u.h)(a,{name:"resetToSelect"}),(0,u.h)(h.Field,{name:"rotationStep"}),(0,u.h)(a,{name:"showValenceWarnings"}),(0,u.h)(a,{name:"atomColoring"}),(0,u.h)(a,{name:"hideChiralFlag"}),(0,u.h)(h.Field,{name:"font",component:w.default}),(0,u.h)(s,{name:"fontsz"}),(0,u.h)(s,{name:"fontszsub"})),(0,u.h)("fieldset",{className:"atoms"},(0,u.h)(a,{name:"carbonExplicitly"}),(0,u.h)(a,{name:"showCharge"}),(0,u.h)(a,{name:"showValence"}),(0,u.h)(h.Field,{name:"showHydrogenLabels"})),(0,u.h)("fieldset",{className:"bonds"},(0,u.h)(a,{name:"aromaticCircle"}),(0,u.h)(s,{name:"doubleBondWidth"}),(0,u.h)(s,{name:"bondThickness"}),(0,u.h)(s,{name:"stereoBondWidth"})),(0,u.h)("fieldset",{className:"3dView"},(0,u.h)(h.Field,{name:"miewMode"}),(0,u.h)(h.Field,{name:"miewTheme"}),(0,u.h)(h.Field,{name:"miewAtomLabel"})),(0,u.h)("fieldset",{className:"debug"},(0,u.h)(a,{name:"showAtomIds"}),(0,u.h)(a,{name:"showBondIds"}),(0,u.h)(a,{name:"showHalfBondIds"}),(0,u.h)(a,{name:"showLoopIds"})))))}function a(t,e){var n=e.schema,r={title:n.properties[t.name].title,enum:[!0,!1],enumNames:["on","off"]};return(0,u.h)(h.Field,l({schema:r},t))}function s(t,e){var n=e.schema;return(0,u.h)(h.Field,l({schema:n.properties[t.name],component:A.default},t))}Object.defineProperty(n,"__esModule",{value:!0});var l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=t("preact"),c=t("preact-redux"),p=t("../actions/form-action.es"),d=t("../actions/settings-action.es"),f=t("../settings-options.es"),h=t("../component/form"),m=t("../component/dialog"),g=r(m),b=t("../component/accordion"),y=r(b),v=t("../component/systemfonts"),w=r(v),x=t("../component/savebutton"),O=r(x),S=t("../component/openbutton"),T=r(S),E=t("../component/measure-input"),A=r(E);n.default=(0,c.connect)(function(t){return{stateForm:t.settings.stateForm,valid:t.settings.valid}},function(t,e){return{onOpenFile:function(e){try{t((0,p.updateFormState)("settings",{stateForm:JSON.parse(e)}))}catch(t){console.info("Bad file")}},onReset:function(){return t((0,d.setDefaultSettings)())},onCancel:function(){t((0,d.cancelChanges)()),e.onCancel()}}})(i)},{"../actions/form-action.es":127,"../actions/settings-action.es":129,"../component/accordion":131,"../component/dialog":134,"../component/form":135,"../component/measure-input":137,"../component/openbutton":138,"../component/savebutton":139,"../component/systemfonts":144,"../settings-options.es":187,preact:28,"preact-redux":27}],170:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){var e=t.title,n=t.name,r=t.schema,i=o(t,["title","name","schema"]),a=Object.keys(r).reduce(function(t,e){return t.enum.push(e),t.enumNames.push(r[e].title||e),t},{title:e,type:"string",default:"",minLength:1,enum:[],enumNames:[]});return(0,l.h)(c.Field,s({name:n,schema:a,component:h.default},i))}function a(t){var e=t.stateForm,n=t.schema,r=t.valid,a=o(t,["stateForm","schema","valid"]),s=e.context,u=e.fieldName,p=n[s][u]||m;return(0,l.h)(d.default,{title:"S-Group Properties",className:"sgroup",result:function(){return e},valid:function(){return r},params:a},(0,l.h)(c.form,{storeName:"sgroupSpecial",schema:p,init:a},(0,l.h)(c.SelectOneOf,{title:"Context",name:"context",schema:n}),(0,l.h)("fieldset",{className:"data"},(0,l.h)(i,{title:"Field name",name:"fieldName",schema:n[s]}),g(p,s,u))))}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=t("preact"),u=t("preact-redux"),c=t("../component/form"),p=t("../component/dialog"),d=r(p),f=t("../component/combobox"),h=r(f),m={key:"Custom",properties:{type:{enum:["DAT"]},context:{title:"Context",enum:["Fragment","Single Bond","Atom","Group"],default:"Fragment"},fieldName:{title:"Field name",type:"string",default:"",minLength:1,
invalidMessage:"Please, specify field name"},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field value"},radiobuttons:{enum:["Absolute","Relative","Attached"],default:"Absolute"}},required:["fieldName","fieldValue","radiobuttons"]},g=function(t,e,n){return Object.keys(t.properties).filter(function(t){return"type"!==t&&"context"!==t&&"fieldName"!==t}).map(function(t){return"radiobuttons"===t?(0,l.h)(c.Field,{name:t,type:"radio",key:e+"-"+n+"-"+t+"-radio"}):(0,l.h)(c.Field,{name:t,type:"textarea",size:"10",key:e+"-"+n+"-"+t+"-select"})})};n.default=(0,u.connect)(function(t){return{schema:t.sgroupSpecial.schema,stateForm:t.sgroupSpecial.stateForm,valid:t.sgroupSpecial.valid}})(a)},{"../component/combobox":133,"../component/dialog":134,"../component/form":135,preact:28,"preact-redux":27}],171:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=t.stateForm,n=t.valid,o=r(t,["stateForm","valid"]),i=e.type;return(0,a.h)(p.default,{title:"S-Group Properties",className:"sgroup",result:function(){return e},valid:function(){return n},params:o},(0,a.h)(u.form,{storeName:"sgroup",schema:d[i],init:o,params:o},(0,a.h)(u.SelectOneOf,{title:"Type",name:"type",schema:d}),(0,a.h)("fieldset",{class:"DAT"===i?"data":"base"},f(i))))}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=t("preact"),s=t("preact-redux"),l=t("../structschema.es"),u=t("../component/form"),c=t("../component/dialog"),p=function(t){return t&&t.__esModule?t:{default:t}}(c),d=(0,u.mapOf)(l.sgroup,"type"),f=function(t){return Object.keys(d[t].properties).filter(function(t){return"type"!==t}).map(function(e){var n={};return"name"===e&&(n.maxlength=15),"fieldName"===e&&(n.maxlength=30),"fieldValue"===e&&(n.type="textarea"),"radiobuttons"===e&&(n.type="radio"),(0,a.h)(u.Field,i({name:e,key:t+"-"+e},n))})};n.default=(0,s.connect)(function(t){return{stateForm:t.sgroup.stateForm,valid:t.sgroup.valid}})(o)},{"../component/dialog":134,"../component/form":135,"../structschema.es":192,preact:28,"preact-redux":27}],172:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function l(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function u(t,e){return console.assert(t.props&&t.props.group,"No group"),t.struct.name||t.props.group+" template "+(e+1)}function c(t){return t.reduce(function(t,e){var n=e.props.group||"Ungroupt",r=t.find(function(t){return t.name==n});return r||(r={name:n,templates:[]},t.push(r)),r.templates.push(e),t},[])}function p(t,e){console.warn("partition",t);for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function d(t){for(var e in G)t=t.replace(new RegExp("\\b"+e+"\\b","g"),G[e]);return t}function f(t){for(var e in G){var n=/[A-Z]/.test(G[e])?new RegExp("\\b"+G[e]+"\\bW","g"):new RegExp(G[e],"g");t=t.replace(n,e)}return t}function h(t){var e=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],n=RegExp("["+e.join("\\")+"]","g");return t.replace(n,"\\$&")}function m(t,e){if(console.warn("filter",e),!e)return t;var n=RegExp(h(e),"i"),r=RegExp(f(h(e)),"i");return t.reduce(function(t,e){if((-1!=e.name.search(n)||-1!=e.name.search(r))&&e.templates.length>0)t.push(e);else{var o=e.templates.filter(function(t,e){return-1!=u(t,e).search(n)||-1!=u(t,e).search(r)});o.length>0&&t.push({name:e.name,templates:o})}return t},[])}function g(t,e){console.warn("group",e);var n=t.find(function(t){return t.name==e});return n?n.templates:t.reduce(function(t,e){return t.concat.apply(t,l(e.templates))},[])}function b(t){var e=t.tmpl,n=s(t,["tmpl"]);return e.props&&e.props.prerender?(0,E.h)("svg",n,(0,E.h)("use",{xlinkHref:e.props.prerender})):(0,E.h)(I.default,T({struct:e.struct,options:{autoScaleMargin:15}},n))}function y(t){return fetch(t,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.text();throw"Could not fetch "+t})}function v(t){var e=t.props.prerender,n=e&&e.split("#",2);return{file:e&&n[0],id:e&&n[1]}}function w(t,e,n){var r=t.reduce(function(t,e){var n=v(e).file;return n&&-1==t.indexOf(n)&&t.push(n),t},[]);return Promise.all(r.map(function(t){return y(e+t).catch(function(){return null})})).then(function(t){return t.forEach(function(t){t&&(n.innerHTML+=t)}),r.filter(function(e,n){return!!t[n]})})}function x(t,e){return y(t+"library.sdf").then(function(n){var r=j.default.parse(n);return w(r,t,e).then(function(t){return r.map(function(e){var n=v(e);return n.file&&(e.props.prerender=-1!=t.indexOf(n.file)?"#"+n.id:""),e})})})}function O(t){var e=$$(".overlay")[0],n=c(t.tmpls).concat({name:"User Templates",templates:t.userTmpls});return"User"==t.group&&(t.group="User Templates"),(0,E.render)((0,E.h)(z,T({lib:n},t)),e)}Object.defineProperty(n,"__esModule",{value:!0});var S=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.init=x,n.default=O;var E=t("preact"),A=t("lru-memoize"),P=r(A),C=t("../../chem/sdf"),j=r(C),_=t("../component/visibleview"),N=r(_),R=t("../component/structrender"),I=r(R),M=t("../component/select"),B=r(M),k=t("../component/dialog"),D=r(k),L=t("../component/savebutton"),F=r(L),G={Alpha:"A",alpha:"α",Beta:"B",beta:"β",Gamma:"Г",gamma:"γ"},U=(0,P.default)(30)(function(t,e){return m(t,e)}),H=(0,P.default)(5)(function(t,e,n){return p(n,g(t,e))}),z=function(t){function e(t){o(this,e),console.info("lib constructor");var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={selected:t.selected||null,filter:"",group:t.group||t.lib[0].name},n}return a(e,t),S(e,[{key:"select",value:function(t){t==this.state.selected?this.props.onOk(this.result()):this.setState({selected:t})}},{key:"selectGroup",value:function(t){t=f(t),this.state.group!=t&&this.setState({group:t,selected:null})}},{key:"setFilter",value:function(t){this.setState({filter:t.trim(),selected:null})}},{key:"result",value:function(){var t=this.state.selected;return console.assert(!t||t.props,"Incorrect SDF parse"),t?{event:"chooseTmpl",tmpl:{struct:t.struct,aid:parseInt(t.props.atomid)+1||null,bid:parseInt(t.props.bondid)+1||null}}:null}},{key:"onAttach",value:function(t,e){this.props.onOk({event:"attachEdit",tmpl:t,index:e})}},{key:"renderRow",value:function(t,e,n){var r=this;return(0,E.h)("div",{className:"tr",key:e},t.map(function(t,o){return(0,E.h)("div",{className:t==r.state.selected?"td selected":"td",title:d(u(t,e*n+o))},(0,E.h)(b,{tmpl:t,className:"struct",onClick:function(){return r.select(t)}}),(0,E.h)("button",{className:"attach-button",onClick:function(){return r.onAttach(t,e*n+o)}},"Edit"))}))}},{key:"saveToSDF",value:function(){var t="";return this.props.lib.forEach(function(e){t+=j.default.stringify(e.templates)}),t}},{key:"render",value:function(){var t=this,e=this.state,n=e.group,r=e.filter,o=U(this.props.lib,r);return console.info("all rerender"),(0,E.h)(D.default,{title:"Template Library",className:"template-lib",params:this.props,result:function(){return t.result()},buttons:[(0,E.h)(F.default,{className:"save",data:this.saveToSDF(),filename:"ketcher-tmpls.sdf"},"Save To SDF…"),"OK","Cancel"]},(0,E.h)("label",null,(0,E.h)("input",{type:"search",placeholder:"Filter",value:r,onInput:function(e){return t.setFilter(e.target.value)}})),(0,E.h)(B.default,{className:"groups",onChange:function(e){return t.selectGroup(e)},value:d(n),options:o.map(function(t){return d(t.name)})}),(0,E.h)(N.default,{data:H(o,n,3),rowHeight:120,className:"table"},function(e,n){return t.renderRow(e,n,3)}))}}]),e}(E.Component)},{"../../chem/sdf":69,"../component/dialog":134,"../component/savebutton":139,"../component/select":140,"../component/structrender":143,"../component/visibleview":146,"lru-memoize":23,preact:28}],173:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={roundWeight:3,roundMass:3},i=["CHANGE_ANALYSE_ROUND"]},{}],174:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!1,stateForm:{label:"",charge:0,explicitValence:-1,hCount:0,invRet:0,isotope:0,radical:0,ringBondCount:0,substitutionCount:0}},i=["UPDATE_ATOM_FORM"]},{}],175:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!0,stateForm:{primary:!1,secondary:!1}},i=["UPDATE_ATTACH_POINTS_FORM"]},{}],176:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={name:"",atomid:0,bondid:0},i=["INIT_ATTACH","SET_ATTACH_POINTS","SET_TMPL_NAME"]},{}],177:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!0,stateForm:{mode:"discard"}},i=["UPDATE_AUTOMAP_FORM"]},{}],178:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!0,stateForm:{type:"single",topology:0,center:0}},i=["UPDATE_BOND_FORM"]},{}],179:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},moleculeErrors:{},stateForm:{checkOptions:["valence","radicals","pseudoatoms","stereo","query","overlapping_atoms","overlapping_bonds","rgroups","chiral","3d"]}},i=["UPDATE_CHECK_FORM","CHECK_ERRORS"]},{}],180:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var o=t("redux"),i=t("./analyse-reducer.es"),a=r(i),s=t("./atom-props-reducer.es"),l=r(s),u=t("./attach-reducer.es"),c=r(u),p=t("./attach-points-reducer.es"),d=r(p),f=t("./automap-reducer.es"),h=r(f),m=t("./bond-reducer.es"),g=r(m),b=t("./check-reducer.es"),y=r(b),v=t("./label-edit-reducer.es"),w=r(v),x=t("./recognize-reducer.es"),O=r(x),S=t("./rgroup-logic-reducer.es"),T=r(S),E=t("./settings-reducer.es"),A=r(E),P=t("./sgroup-reducer.es"),C=r(P),j=t("./sgroup-special-reducer.es"),_=r(j);n.default=(0,o.combineReducers)({analyse:a.default,attach:c.default,"attach-points":d.default,atom:l.default,automap:h.default,bond:g.default,check:y.default,"label-edit":w.default,recognize:O.default,"rgroup-logic":T.default,settings:A.default,sgroup:C.default,sgroupSpecial:_.default})},{"./analyse-reducer.es":173,"./atom-props-reducer.es":174,"./attach-points-reducer.es":175,"./attach-reducer.es":176,"./automap-reducer.es":177,"./bond-reducer.es":178,"./check-reducer.es":179,"./label-edit-reducer.es":181,"./recognize-reducer.es":182,"./rgroup-logic-reducer.es":183,"./settings-reducer.es":184,"./sgroup-reducer.es":185,"./sgroup-special-reducer.es":186,redux:42}],181:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!1,stateForm:{label:""}},i=["UPDATE_LABEL_EDIT_FORM"]},{}],182:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={file:null,structStr:null,fragment:!1},i=["SET_RECOGNIZE_STRUCT","CHANGE_RECOGNIZE_FILE","IS_FRAGMENT_RECOGNIZE"]},{}],183:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return i.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!0,stateForm:{ifthen:0,range:">0",resth:!1}},i=["UPDATE_RGROUP_LOGIC_FORM"]},{}],184:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,e=arguments[1];return a.includes(e.type)?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o=t("../actions/settings-action.es"),i={errors:{},valid:!0,stateForm:Object.assign((0,o.defaultOpts)(),JSON.parse(localStorage.getItem("ketcher-opts")))},a=["SET_DEFAULT_SETTINGS","UPDATE_SETTINGS_FORM","CANCEL_SETTINGS"]},{"../actions/settings-action.es":129}],185:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,e=arguments[1];return"UPDATE_SGROUP_FORM"===e.type?Object.assign({},t,e.payload):t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var o={errors:{},valid:!0,stateForm:{type:"GEN"}}},{}],186:[function(t,e,n){"use strict";function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f(),e=arguments[1];if("UPDATE_SGROUPSPEC_FORM"===e.type){var n=e.payload.stateForm.context,r=e.payload.stateForm.fieldName,o=null;return void 0!==n&&n!==t.stateForm.context||void 0===r?o=m(t,n):r!==t.stateForm.fieldName&&(o=g(t,r)),o=o||Object.assign({},t,e.payload),h(o,e.payload)}return t}Object.defineProperty(n,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.default=r;var i=t("../component/form"),a=t("../sgroupSpecialSchema.es"),s={title:"Context",enum:["Fragment","Single Bond","Atom","Group"],default:"Fragment"},l=Object.keys(a.sgroupSpecial).reduce(function(t,e){return t[e]=(0,i.mapOf)(a.sgroupSpecial[e],"fieldName"),Object.keys(t[e]).forEach(function(n){return t[e][n].properties.context=s}),t},{}),u=function(t){return Object.keys(t)[0]},c=function(){return u(l)},p=function(t){return u(l[t])},d=function(t,e){return l[t][e]?l[t][e].properties.fieldValue.default:""},f=function(){var t=c(),e=p(t),n=d(t,e);return{schema:l,stateForm:{context:t,fieldName:e,fieldValue:n,radiobuttons:"Absolute",type:"DAT"}}},h=function(t,e){var n=e.valid,r=e.errors,i=t.stateForm,a=i.fieldName,s=i.fieldValue;return a||(r.fieldName="does not meet minimum length of 1"),s||(r.fieldValue="does not meet minimum length of 1"),o({},t,{valid:n&&a&&s,errors:r})},m=function(t,e){var n=p(e),r=d(e,n);return o({},t,{stateForm:o({},t.stateForm,{context:e,fieldName:n,fieldValue:r})})},g=function(t,e){var n=t.stateForm.context,r=d(n,e);return o({},t,{stateForm:o({},t.stateForm,{fieldName:e,fieldValue:r})})}},{"../component/form":135,"../sgroupSpecialSchema.es":188}],187:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.settings={title:"Settings",type:"object",required:[],properties:{resetToSelect:{title:"Reset to Select Tool",type:"boolean",default:!1},rotationStep:{title:"Rotation Step, º",type:"integer",minimum:1,maximum:90,default:15},showValenceWarnings:{title:"Show valence warnings",type:"boolean",default:!0},atomColoring:{title:"Atom coloring",type:"boolean",default:!0},hideChiralFlag:{title:"Do not show the Chiral flag",type:"boolean",default:!1},font:{title:"Font",type:"string",default:"30px Arial"},fontsz:{title:"Font size",type:"integer",default:13,minimum:1,maximum:96},fontszsub:{title:"Sub font size",type:"integer",default:13,minimum:1,maximum:96},carbonExplicitly:{title:"Display carbon explicitly",type:"boolean",default:!1},showCharge:{title:"Display charge",type:"boolean",default:!0},showValence:{title:"Display valence",type:"boolean",default:!0},showHydrogenLabels:{title:"Show hydrogen labels",enum:["off","Hetero","Terminal","Terminal and Hetero","on"],default:"on"},aromaticCircle:{title:"Aromatic Bonds as circle",type:"boolean",default:!0},doubleBondWidth:{title:"Double bond width",type:"integer",default:6,minimum:1,maximum:96},bondThickness:{title:"Bond thickness",type:"integer",default:2,minimum:1,maximum:96},stereoBondWidth:{title:"Stereo (Wedge) bond width",type:"integer",default:6,minimum:1,maximum:96},miewMode:{title:"Display mode",enum:["lines","balls and sticks","licorice"],enumNames:["Lines","Balls and Sticks","Licorice"],default:"lines"},miewTheme:{title:"Background color",enum:["light","dark"],enumNames:["Light","Dark"],default:"light"},miewAtomLabel:{title:"Label coloring",enum:["no","bright","inverse","black and white","black"],enumNames:["No","Bright","Inverse","Black and White","Black"],default:"bright"},showAtomIds:{title:"Show atom Ids",type:"boolean",default:!1},showBondIds:{title:"Show bonds Ids",type:"boolean",default:!1},showHalfBondIds:{title:"Show half bonds Ids",type:"boolean",default:!1},showLoopIds:{title:"Show loop Ids",type:"boolean",default:!1}}}},{}],188:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={enum:["Absolute","Relative","Attached"],default:"Absolute"};n.sgroupSpecial={Fragment:{title:"Context",type:"Object",oneOf:[{key:"FRG_STR",title:"MDLBG_FRAGMENT_STEREO",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_FRAGMENT_STEREO"]},fieldValue:{title:"Field value",enum:["abs","(+)-enantiomer","(-)-enantiomer","racemate","steric","rel","R(a)","S(a)","R(p)","S(p)"],default:"abs"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]},{key:"FRG_COEFF",title:"MDLBG_FRAGMENT_COEFFICIENT",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_FRAGMENT_COEFFICIENT"]},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]},{key:"FRG_CHRG",title:"MDLBG_FRAGMENT_CHARGE",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_FRAGMENT_CHARGE"]},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]},{key:"FRG_RAD",title:"MDLBG_FRAGMENT_RADICALS",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_FRAGMENT_RADICALS"]},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]}]},"Single Bond":{title:"Context",type:"Object",oneOf:[{key:"SB_STR",title:"MDLBG_STEREO_KEY",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_STEREO_KEY"]},fieldValue:{title:"Field value",enum:["erythro","threo","alpha","beta","endo","exo","anti","syn","ECL","STG"],default:"erythro"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]},{key:"SB_BND",title:"MDLBG_BOND_KEY",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_BOND_KEY"]},fieldValue:{title:"Field value",enum:["Value=4"],default:"Value=4"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]}]},Atom:{title:"Context",type:"Object",oneOf:[{key:"AT_STR",title:"MDLBG_STEREO_KEY",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_STEREO_KEY"]},fieldValue:{title:"Field value",enum:["RS","SR","P-3","P-3-PI","SP-4","SP-4-PI","T-4","T-4-PI","SP-5","SP-5-PI","TB-5","TB-5-PI","OC-6","TP-6","PB-7","CU-8","SA-8","DD-8","HB-9","TPS-9"],default:"RS"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]}]},Group:{title:"Context",type:"Object",oneOf:[{key:"GRP_STR",title:"MDLBG_STEREO_KEY",properties:{type:{enum:["DAT"]},fieldName:{enum:["MDLBG_STEREO_KEY"]},fieldValue:{title:"Field value",enum:["cis","trans"],default:"cis"},radiobuttons:r},required:["fieldName","fieldValue","radiobuttons"]}]}}},{}],189:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("redux"),o=t("redux-logger"),i=t("./reducers/index.es"),a=function(t){return t&&t.__esModule?t:{default:t}}(i);n.default=(0,r.createStore)(a.default,{},(0,r.applyMiddleware)(o.logger))},{"./reducers/index.es":180,redux:42,"redux-logger":35}],190:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t){return"R#"==t.label?{type:"rlabel",values:f(t.rglabel)}:"L#"==t.label?u(t):A.default.map[t.label]?s(t):!t.label&&"attpnt"in t?{ap:p(t.attpnt)}:t}function a(t){return"rlabel"==t.type?{label:t.values.length?"R#":"C",rglabel:h(t.values)}:"list"==t.type||"not-list"==t.type?c(t):!t.label&&"ap"in t?{attpnt:d(t.ap)}:A.default.map[v(t.label)]?l(t):"A"==t.label||"*"==t.label||"Q"==t.label||"X"==t.label||"R"==t.label?(t.pseudo=t.label,l(t)):t}function s(t){return{alias:t.alias||"",label:t.label,charge:t.charge,isotope:t.isotope,explicitValence:t.explicitValence,radical:t.radical,invRet:t.invRet,exactChangeFlag:!!t.exactChangeFlag,ringBondCount:t.ringBondCount,substitutionCount:t.substitutionCount,unsaturatedAtom:!!t.unsaturatedAtom,hCount:t.hCount}}function l(t){return Object.assign({},t,{label:v(t.label)})}function u(t){return{type:t.atomList.notList?"not-list":"list",values:t.atomList.ids.map(function(t){return A.default[t].label})}}function c(t){return{pseudo:null,label:"L#",atomList:new T.default.AtomList({notList:"not-list"==t.type,ids:t.values.map(function(t){return A.default.map[t]})})}}function p(t){return{primary:(1&(t||0))>0,secondary:(2&(t||0))>0}}function d(t){return(t.primary&&1)+(t.secondary&&2)}function f(t){for(var e=[],n=0;n<32;n++)if(t&1<<n){var r=n+1;e.push(r)}return e}function h(t){var e=0;return t.forEach(function(t){e|=1<<t-1}),e}function m(t){return{type:y(t.type,t.stereo),topology:t.topology||0,center:t.reactingCenterStatus||0}}function g(t){return O({topology:t.topology,reactingCenterStatus:t.center},b(t.type))}function b(t){return Object.assign({},P[t])}function y(t,e){for(var n in P)if(P[n].type==t&&P[n].stereo==e)return n;throw"No such bond caption"}function v(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()}function w(t){var e=t.type||"GEN",n=t.attrs,r=n.absolute,o=n.attached;return t.attrs.radiobuttons=!1===r&&!1===o?"Relative":o?"Attached":"Absolute",Object.assign({type:e},t.attrs)}function x(t){var e=t.type,n=t.radiobuttons,r=o(t,["type","radiobuttons"]),i=O({},r);switch(n){case"Absolute":i.absolute=!0,i.attached=!1;break;case"Attached":i.absolute=!1,i.attached=!0;break;case"Relative":i.absolute=!1,i.attached=!1}return i.fieldName&&(i.fieldName=i.fieldName.replace(C,"")),i.fieldValue&&(i.fieldValue=i.fieldValue.replace(C,"")),{type:e,attrs:i}}Object.defineProperty(n,"__esModule",{value:!0});var O=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.fromElement=i,n.toElement=a,n.fromBond=m,n.toBond=g,n.toBondType=b,n.fromSgroup=w,n.toSgroup=x;var S=t("../chem/struct"),T=r(S),E=t("../chem/element"),A=r(E),P={single:{type:T.default.Bond.PATTERN.TYPE.SINGLE,stereo:T.default.Bond.PATTERN.STEREO.NONE},up:{type:T.default.Bond.PATTERN.TYPE.SINGLE,stereo:T.default.Bond.PATTERN.STEREO.UP},down:{type:T.default.Bond.PATTERN.TYPE.SINGLE,stereo:T.default.Bond.PATTERN.STEREO.DOWN},updown:{type:T.default.Bond.PATTERN.TYPE.SINGLE,stereo:T.default.Bond.PATTERN.STEREO.EITHER},double:{type:T.default.Bond.PATTERN.TYPE.DOUBLE,stereo:T.default.Bond.PATTERN.STEREO.NONE},crossed:{type:T.default.Bond.PATTERN.TYPE.DOUBLE,stereo:T.default.Bond.PATTERN.STEREO.CIS_TRANS},triple:{type:T.default.Bond.PATTERN.TYPE.TRIPLE,stereo:T.default.Bond.PATTERN.STEREO.NONE},aromatic:{type:T.default.Bond.PATTERN.TYPE.AROMATIC,stereo:T.default.Bond.PATTERN.STEREO.NONE},singledouble:{type:T.default.Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE,stereo:T.default.Bond.PATTERN.STEREO.NONE},singlearomatic:{type:T.default.Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC,stereo:T.default.Bond.PATTERN.STEREO.NONE},doublearomatic:{type:T.default.Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC,stereo:T.default.Bond.PATTERN.STEREO.NONE},any:{type:T.default.Bond.PATTERN.TYPE.ANY,stereo:T.default.Bond.PATTERN.STEREO.NONE}},C=/^[\s\n\r]+$/g},{"../chem/element":60,"../chem/struct":77}],191:[function(t,e,n){"use strict";function r(t,e){var n=t.trim();if(-1!=n.indexOf("$RXN"))return"rxn";var r=n.match(/^(M  END|\$END MOL)$/m);if(r){var o=r.index+r[0].length;if(o==n.length||-1!=n.slice(o,o+20).search(/^\$(MOL|END CTAB)$/m))return"mol"}return"<"==n[0]&&-1!=n.indexOf("<molecule")?"cml":"InChI"==n.slice(0,5)?"inchi":-1==n.indexOf("\n")?"smiles":e?null:"mol"}function o(t,e,n){return console.assert(u[e],"No such format"),new Promise(function(r,o){var i=l.default.stringify(t);r("mol"==e||"rxn"==e?i:n.then(function(){return n.convert({struct:i,output_format:u[e].mime})},function(){throw Error(u[e].name+" is not supported in the standalone mode")}).then(function(t){return t.struct}))})}function i(t,e,n){return new Promise(function(o,i){var a=r(t);if(console.assert(u[a],"No such format"),"mol"==a||"rxn"==a){o(l.default.parse(t,e))}else{var s=u[a].supportsCoords;o(n.then(function(){return s?n.convert({struct:t,output_format:u.mol.mime}):n.layout({struct:t.trim(),output_format:u.mol.mime})},function(){throw Error(u[a].name+" is not supported in the standalone mode")}).then(function(t){var e=l.default.parse(t.struct);return s||e.rescale(),e}))}})}function a(t,e){if("inchi"==e){if(0!==t.rgroups.count())throw"R-group fragments are not supported and will be discarded";t=t.clone(),t.sgroups.each(function(t,e){if("MUL"!=e.type&&!/^INDIGO_.+_DESC$/i.test(e.data.fieldName))throw Error("InChi data format doesn't support s-groups")})}}Object.defineProperty(n,"__esModule",{value:!0}),n.map=void 0,n.guess=r,n.toString=o,n.fromString=i,n.couldBeSaved=a;var s=t("../chem/molfile"),l=function(t){return t&&t.__esModule?t:{default:t}}(s),u=n.map={mol:{name:"MDL Molfile",mime:"chemical/x-mdl-molfile",ext:[".mol"],supportsCoords:!0},rxn:{name:"MDL Rxnfile",mime:"chemical/x-mdl-rxnfile",ext:[".rxn"],supportsCoords:!0},cml:{name:"CML",mime:"chemical/x-cml",ext:[".cml",".mrv"],supportsCoords:!0},smiles:{name:"Daylight SMILES",mime:"chemical/x-daylight-smiles",ext:[".smi",".smiles"]},smarts:{name:"Daylight SMARTS",mime:"chemical/x-daylight-smarts",ext:[".smarts"]},inchi:{name:"InChI String",mime:"chemical/x-inchi",ext:[".inchi"]}}},{"../chem/molfile":63}],192:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.atom={title:"Atom",type:"object",required:"label",properties:{label:{title:"Label",type:"string",maxLength:3},alias:{title:"Alias",type:"string"},charge:{title:"Charge",type:"integer",minimum:-1e3,maximum:1e3,default:0},explicitValence:{title:"Valence",enum:[-1,0,1,2,3,4,5,6,7,8],enumNames:["","0","I","II","III","IV","V","VI","VII","VIII"],default:-1},isotope:{title:"Isotope",type:"integer",minimum:0,default:0},radical:{title:"Radical",enum:[0,2,1,3],enumNames:["","Monoradical","Diradical (singlet)","Diradical (triplet)"],default:0},ringBondCount:{title:"Ring bond count",enum:[0,-2,-1,2,3,4],enumNames:["","As drawn","0","2","3","4"],default:0},hCount:{title:"H count",enum:[0,1,2,3,4,5],enumNames:["","0","1","2","3","4"],default:0},substitutionCount:{title:"Substitution count",enum:[0,-2,-1,1,2,3,4,5,6],enumNames:["","As drawn","0","1","2","3","4","5","6"],default:0},unsaturatedAtom:{title:"Unsaturated",type:"boolean",default:!1},invRet:{title:"Inversion",enum:[0,1,2],enumNames:["","Inverts","Retains"],default:0},exactChangeFlag:{title:"Exact change",type:"boolean",default:!1}}},n.attachmentPoints={title:"Attachment Points",type:"object",properties:{primary:{title:"Primary attachment point",type:"boolean"},secondary:{title:"Secondary attachment point",type:"boolean"}}},n.bond={title:"Bond",type:"object",required:["type"],properties:{type:{title:"Type",enum:["single","up","down","updown","double","crossed","triple","aromatic","any","singledouble","singlearomatic","doublearomatic"],enumNames:["Single","Single Up","Single Down","Single Up/Down","Double","Double Cis/Trans","Triple","Aromatic","Any","Single/Double","Single/Aromatic","Double/Aromatic"],default:"single"},topology:{title:"Topology",enum:[0,1,2],enumNames:["Either","Ring","Chain"],default:0},center:{title:"Reacting Center",enum:[0,-1,1,2,4,8,12],enumNames:["Unmarked","Not center","Center","No change","Made/broken","Order changes","Made/broken and changes"],default:0}}},n.sgroup={title:"SGroup",type:"object",required:["type"],oneOf:[{key:"GEN",title:"Generic",properties:{type:{enum:["GEN"]}}},{key:"MUL",title:"Multiple group",type:"object",properties:{type:{enum:["MUL"]},mul:{title:"Repeat count",type:"integer",default:1,minimum:1,maximum:1e3}},required:["mul"]},{key:"SRU",title:"SRU polymer",properties:{type:{enum:["SRU"]},subscript:{title:"Polymer label",type:"string",default:"n",pattern:"^[a-zA-Z]$",invalidMessage:"SRU subscript should consist of a single letter"},connectivity:{title:"Repeat Pattern",enum:["ht","hh","eu"],enumNames:["Head-to-tail","Head-to-head","Either unknown"],default:"ht"}},required:["subscript","connectivity"]},{key:"SUP",title:"Superatom",properties:{type:{enum:["SUP"]},name:{title:"Name",type:"string",default:"",minLength:1,invalidMessage:"Please, provide a name for the superatom"}}}]},n.rgroup={title:"R-Group",type:"object",properties:{range:{title:"Occurrence",type:"string",maxLength:50},resth:{title:"RestH",type:"boolean"},ifthen:{title:"Condition",type:"integer",minium:0}}}},{}],193:[function(t,e,n){
e.exports=["Benzene\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  6  6  0     0  0            999 V2000\n    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  2  0     0  0\n  3  4  1  0     0  0\n  4  5  2  0     0  0\n  5  6  1  0     0  0\n  6  1  2  0     0  0\nM  END\n","Cyclopentadiene\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  5  5  0     0  0            999 V2000\n    0.0000    1.4257    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\n   -0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\n   -0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  2  0     0  0\n  3  4  1  0     0  0\n  4  5  2  0     0  0\n  5  1  1  0     0  0\nM  END\n","Cyclohexane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  6  6  0     0  0            999 V2000\n    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  3  4  1  0     0  0\n  4  5  1  0     0  0\n  5  6  1  0     0  0\n  6  1  1  0     0  0\nM  END\n","Cyclopentane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  5  5  0     0  0            999 V2000\n    0.8090    1.5389    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.6180    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  3  4  1  0     0  0\n  4  5  1  0     0  0\n  5  1  1  0     0  0\nM  END\n","Cyclopropane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  3  3  0     0  0            999 V2000\n   -3.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.7250    0.5910    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  1  3  1  0     0  0\nM  END\n","Cyclobutane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  4  4  0     0  0            999 V2000\n   -3.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -3.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  1  3  1  0     0  0\n  3  4  1  0     0  0\n  4  2  1  0     0  0\nM  END\n","Cycloheptane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  7  7  0     0  0            999 V2000\n    0.0000    1.6293    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7835    2.2465    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7559    2.0242    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.1897    1.1289    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.6228    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7566    0.2224    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7835    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n  6  7  1  0     0  0\n  5  7  1  0     0  0\n  1  5  1  0     0  0\n  4  6  1  0     0  0\n  3  4  1  0     0  0\n  2  3  1  0     0  0\n  1  2  1  0     0  0\nM  END\n","Cyclooctane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  8  8  0     0  0            999 V2000\n    0.0000    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7053    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7056    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7079    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.4133    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.4133    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7079    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\n  8  3  1  0     0  0\n  7  8  1  0     0  0\n  6  7  1  0     0  0\n  5  6  1  0     0  0\n  4  5  1  0     0  0\n  1  4  1  0     0  0\n  2  3  1  0     0  0\n  1  2  1  0     0  0\nM  END\n"]},{}],194:[function(t,e,n){function r(t,e){a||e();var n=function(){e(),t.removeEventListener(a,n,!1)};t.addEventListener(a,n,!1)}function o(t){var e=$$(".overlay")[0],n=$("loading");return"show"==t?(e.style.display="",i(e,"show").then(function(){n.style.display=""})):i(e,"hide").then(function(){e.style.display="none",n.style.display="none"})}function i(t,e){var n="show"==e?"hide":"show";return new Promise(function(o){t.removeClassName("animate"),t.addClassName(n),setTimeout(function(){t.addClassName("animate"),t.addClassName(e),t.removeClassName(n),console.info("replace",e,t.classList)},0),console.info("start",e,t.classList),r(t,function(){t.hasClassName(e)&&(t.removeClassName("animate"),t.removeClassName(e),o(t))})})}var a=function(){var t,e=document.createElement("transitionTest"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in n)if(void 0!==e.style[t])return n[t];return!1}();e.exports={animate:i,loading:o}},{}],195:[function(t,e,n){function r(){1==arguments.length&&"min"in arguments[0]&&"max"in arguments[0]&&(this.p0=arguments[0].min,this.p1=arguments[0].max),2==arguments.length?(this.p0=arguments[0],this.p1=arguments[1]):4==arguments.length?(this.p0=new o(arguments[0],arguments[1]),this.p1=new o(arguments[2],arguments[3])):0==arguments.length?(this.p0=new o,this.p1=new o):new Error("Box2Abs constructor only accepts 4 numbers or 2 vectors or no arguments!")}var o=t("./vec2");r.prototype.toString=function(){return this.p0.toString()+" "+this.p1.toString()},r.fromRelBox=function(t){return console.assert(!!t),new r(t.x,t.y,t.x+t.width,t.y+t.height)},r.prototype.clone=function(){return new r(this.p0,this.p1)},r.union=function(t,e){return console.assert(!!t),console.assert(!!e),new r(o.min(t.p0,e.p0),o.max(t.p1,e.p1))},r.prototype.extend=function(t,e){return console.assert(!!t),e=e||t,new r(this.p0.sub(t),this.p1.add(e))},r.prototype.include=function(t){return console.assert(!!t),new r(this.p0.min(t),this.p1.max(t))},r.prototype.contains=function(t,e){return e=(e||0)-0,console.assert(!!t),t.x>=this.p0.x-e&&t.x<=this.p1.x+e&&t.y>=this.p0.y-e&&t.y<=this.p1.y+e},r.prototype.translate=function(t){return console.assert(!!t),new r(this.p0.add(t),this.p1.add(t))},r.prototype.transform=function(t,e){return console.assert(!!t),new r(t(this.p0,e),t(this.p1,e))},r.prototype.sz=function(){return this.p1.sub(this.p0)},r.prototype.centre=function(){return o.centre(this.p0,this.p1)},r.prototype.pos=function(){return this.p0},e.exports=r},{"./vec2":200}],196:[function(t,e,n){function r(t){if(void 0!==t&&t.constructor!==Object)throw Error('Passed object is not an instance of "Object"!');this._obj=t||{},this._count=0}r.prototype.each=function(t,e){var n,r,o;for(n in this._obj)o=parseInt(n,10),r=this._obj[n],isNaN(o)||(n=o),t.call(e,n,r)},r.prototype.map=function(t,e){var n=new r;return this.each(function(r,o){n.set(r,t.call(e,r,o))},this),n},r.prototype.find=function(t,e){var n,r,o;for(n in this._obj)if(r=parseInt(n,10),o=this._obj[n],isNaN(r)||(n=r),t.call(e,n,o))return n},r.prototype.findAll=function(t,e){var n,r,o,i=[];for(n in this._obj)r=parseInt(n,10),o=this._obj[n],isNaN(r)||(n=r),t.call(e,n,o)&&i.push(n);return i},r.prototype.keys=function(){var t,e=[];for(t in this._obj)e.push(t);return e},r.prototype.ikeys=function(){var t=[];for(var e in this._obj)t.push(e-0);return t},r.prototype.values=function(){var t=[];for(var e in this._obj)t.push(this._obj[e]);return t},r.prototype.set=function(t,e){var n;return this._count+=(void 0!==e?1:0)-(void 0!==this._obj[t]?1:0),void 0===e?(n=this._obj[t],delete this._obj[t],n):(this._obj[t]=e,e)},r.prototype.get=function(t){if(this._obj[t]!==Object.prototype[t])return this._obj[t]},r.prototype.has=function(t){return this._obj[t]!==Object.prototype[t]},r.prototype.unset=function(t){return this.set(t,void 0)},r.prototype.update=function(t){for(var e in t)this.set(e,t[e])},r.prototype.clear=function(){this._obj={},this._count=0},r.prototype.count=function(){return this._count},r.prototype.idList=function(){return Object.keys(this._obj)},r.prototype.keyOf=function(t){for(var e in this._obj)if(this._obj[e]===t)return e},e.exports=r},{}],197:[function(t,e,n){function r(){this._map=new o,this._nextId=0}var o=t("./map.js");r.prototype.newId=function(){return this._nextId++},r.prototype.add=function(t){var e=this._nextId++;return this._map.set(e,t),e},r.prototype.set=function(t,e){this._map.set(t,e)},r.prototype.get=function(t){return this._map.get(t)},r.prototype.has=function(t){return this._map.has(t)},r.prototype.remove=function(t){return this._map.unset(t)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.ikeys=function(){return this._map.ikeys()},r.prototype.values=function(){return this._map.values()},r.prototype.each=function(t,e){this._map.each(t,e)},r.prototype.map=function(t,e){return this._map.map(t,e)},r.prototype.find=function(t,e){return this._map.find(t,e)},r.prototype.count=function(){return this._map.count()},r.prototype.keyOf=function(t){return this._map.keyOf(t)},e.exports=r},{"./map.js":196}],198:[function(t,e,n){function r(t,e){return t.scaled(1/e.scale)}function o(t,e){return t.scaled(e.scale)}e.exports={scaled2obj:r,obj2scaled:o}},{}],199:[function(t,e,n){var r={empty:function(){return{}},single:function(t){var e={};return r.add(e,t),e},size:function(t){var e=0;for(var n in t)t[n]!==Object.prototype[n]&&e++;return e},contains:function(t,e){return void 0!==t[e]&&t[e]!==Object.prototype[e]},subset:function(t,e){for(var n in t)if(t[n]!==Object.prototype[n]&&e[n]!==t[n])return!1;return!0},intersection:function(t,e){var n={};for(var o in t)t[o]!==Object.prototype[o]&&e[o]===t[o]&&r.add(n,o);return n},disjoint:function(t,e){for(var n in t)if(t[n]!==Object.prototype[n]&&e[n]===t[n])return!1;return!0},eq:function(t,e){return r.subset(t,e)&&r.subset(e,t)},each:function(t,e,n){for(var r in t)t[r]!==Object.prototype[r]&&e.call(n,t[r])},filter:function(t,e,n){var r={};for(var o in t)t[o]!==Object.prototype[o]&&e.call(n,t[o])&&(r[t[o]]=t[o]);return r},pick:function(t){for(var e in t)if(t[e]!==Object.prototype[e])return t[e];return null},list:function(t){var e=[];for(var n in t)t[n]!==Object.prototype[n]&&e.push(t[n]);return e},add:function(t,e){t[e]=e},mergeIn:function(t,e){r.each(e,function(e){r.add(t,e)})},remove:function(t,e){var n=t[e];return delete t[e],n},clone:function(t){var e={};return r.mergeIn(e,t),e},fromList:function(t){var e={};if(t)for(var n=0;n<t.length;++n)e[t[n]-0]=t[n]-0;return e},keySetInt:function(t){var e={};return t.each(function(t){e[t-0]=t-0}),e},find:function(t,e,n){for(var r in t)if(t[r]!==Object.prototype[r]&&e.call(n,t[r]))return r;return null}};e.exports=r},{}],200:[function(t,e,n){function r(t,e,n){if(0==arguments.length)this.x=0,this.y=0,this.z=0;else if(1==arguments.length)this.x=parseFloat(t.x||0),this.y=parseFloat(t.y||0),this.z=parseFloat(t.z||0);else if(2==arguments.length)this.x=parseFloat(t||0),this.y=parseFloat(e||0),this.z=0;else{if(3!=arguments.length)throw new Error("Vec2(): invalid arguments");this.x=parseFloat(t),this.y=parseFloat(e),this.z=parseFloat(n)}}r.ZERO=new r(0,0),r.UNIT=new r(1,1),r.segmentIntersection=function(t,e,n,r){var o=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x),i=(t.x-r.x)*(e.y-r.y)-(t.y-r.y)*(e.x-r.x),a=(n.x-t.x)*(r.y-t.y)-(n.y-t.y)*(r.x-t.x),s=(n.x-e.x)*(r.y-e.y)-(n.y-e.y)*(r.x-e.x);return o*i<=0&&a*s<=0},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.equals=function(t){return console.assert(!!t),this.x==t.x&&this.y==t.y},r.prototype.add=function(t){return console.assert(!!t),new r(this.x+t.x,this.y+t.y,this.z+t.z)},r.prototype.add_=function(t){console.assert(!!t),this.x+=t.x,this.y+=t.y,this.z+=t.z},r.prototype.get_xy0=function(){return new r(this.x,this.y)},r.prototype.sub=function(t){return console.assert(!!t),new r(this.x-t.x,this.y-t.y,this.z-t.z)},r.prototype.scaled=function(t){return console.assert(0==t||!!t),new r(this.x*t,this.y*t,this.z*t)},r.prototype.negated=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.yComplement=function(t){return t=t||0,new r(this.x,t-this.y,this.z)},r.prototype.addScaled=function(t,e){return console.assert(!!t),console.assert(0==e||!!e),new r(this.x+t.x*e,this.y+t.y*e,this.z+t.z*e)},r.prototype.normalized=function(){return this.scaled(1/this.length())},r.prototype.normalize=function(){var t=this.length();return!(t<1e-6)&&(this.x/=t,this.y/=t,!0)},r.prototype.turnLeft=function(){return new r(-this.y,this.x,this.z)},r.prototype.coordStr=function(){return this.x.toString()+" , "+this.y.toString()},r.prototype.toString=function(){return"("+this.x.toFixed(2)+","+this.y.toFixed(2)+")"},r.dist=function(t,e){return console.assert(!!t),console.assert(!!e),r.diff(t,e).length()},r.max=function(t,e){return console.assert(!!t),console.assert(!!e),new r(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},r.min=function(t,e){return console.assert(!!t),console.assert(!!e),new r(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},r.prototype.max=function(t){return console.assert(!!t),new r.max(this,t)},r.prototype.min=function(t){return console.assert(!!t),new r.min(this,t)},r.prototype.ceil=function(){return new r(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},r.sum=function(t,e){return console.assert(!!t),console.assert(!!e),new r(t.x+e.x,t.y+e.y,t.z+e.z)},r.dot=function(t,e){return console.assert(!!t),console.assert(!!e),t.x*e.x+t.y*e.y},r.cross=function(t,e){return console.assert(!!t),console.assert(!!e),t.x*e.y-t.y*e.x},r.prototype.rotate=function(t){console.assert(0==t||!!t);var e=Math.sin(t),n=Math.cos(t);return this.rotateSC(e,n)},r.prototype.rotateSC=function(t,e){return console.assert(0==t||!!t),console.assert(0==e||!!e),new r(this.x*e-this.y*t,this.x*t+this.y*e,this.z)},r.angle=function(t,e){return console.assert(!!t),console.assert(!!e),Math.atan2(r.cross(t,e),r.dot(t,e))},r.prototype.oxAngle=function(){return Math.atan2(this.y,this.x)},r.diff=function(t,e){return console.assert(!!t),console.assert(!!e),new r(t.x-e.x,t.y-e.y,t.z-e.z)},r.lc=function(){for(var t=new r,e=0;e<arguments.length/2;++e)t=t.addScaled(arguments[2*e],arguments[2*e+1]);return t},r.lc2=function(t,e,n,o){return console.assert(!!t),console.assert(!!n),console.assert(0==e||!!e),console.assert(0==o||!!o),new r(t.x*e+n.x*o,t.y*e+n.y*o,t.z*e+n.z*o)},r.centre=function(t,e){return new r.lc2(t,.5,e,.5)},r.shiftRayBox=function(t,e,n){console.assert(!!t),console.assert(!!e),console.assert(!!n);var o=[n.p0,new r(n.p1.x,n.p0.y),n.p1,new r(n.p0.x,n.p1.y)],i=o.map(function(e){return e.sub(t)});e=e.normalized();for(var a=i.map(function(t){return r.cross(t,e)}),s=i.map(function(t){return r.dot(t,e)}),l=-1,u=-1,c=0;c<4;++c)a[c]>0?(l<0||s[l]<s[c])&&(l=c):(u<0||s[u]<s[c])&&(u=c);if(u<0||l<0)return 0;var p,d;return s[l]>s[u]?(p=u,d=l):(p=l,d=u),s[p]+Math.abs(a[p])*(s[d]-s[p])/(Math.abs(a[p])+Math.abs(a[d]))},e.exports=r},{}],201:[function(t,e,n){function r(){return p.stringify(m.editor.struct(),{ignoreErrors:!0})}function o(){return c.stringify(m.editor.struct(),{ignoreErrors:!0})}function i(t){"string"==typeof t&&m.ui.load(t,{rescale:!0})}function a(t){"string"==typeof t&&m.ui.load(t,{rescale:!0,fragment:!0})}function s(t,e,n){var r=new f(t,Object.assign({scale:n.bondLength||75},n));if(e){var o=c.parse(e);r.setMolecule(o)}return r.update(),r}var l=t("query-string"),u=t("./api.js"),c=t("./chem/molfile"),p=t("./chem/smiles"),d=t("./ui"),f=t("./render");window.onload=function(){var t=l.parse(document.location.search);t.api_path&&(m.apiPath=t.api_path),m.server=u(m.apiPath,{"smart-layout":!0,"ignore-stereochemistry-errors":!0,"mass-skip-error-on-pseudoatoms":!1,"gross-formula-add-rsites":!0}),m.ui=d(Object.assign({},t,h),m.server),m.editor=m.ui.editor,m.server.then(function(){t.mol&&m.ui.load(t.mol)},function(){document.title+=" (standalone)"})};var h={version:"2.0.0-alpha.7",apiPath:"",buildDate:"Tue Jul 25 2017 18:13:14 GMT+0300 (MSK)",buildNumber:null,buildOptions:"__BUILD_OPTIONS__"},m=e.exports=Object.assign({getSmiles:r,getMolfile:o,setMolecule:i,addFragment:a,showMolfile:s},h)},{"./api.js":59,"./chem/molfile":63,"./chem/smiles":72,"./render":108,"./ui":147,"query-string":29}]},{},[201])(201)}),function(t,e){"use strict";"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.returnExports=e()}(this,function(){var t,e,n=Array,r=n.prototype,o=Object,i=o.prototype,a=Function,s=a.prototype,l=String,u=l.prototype,c=Number,p=c.prototype,d=r.slice,f=r.splice,h=r.push,m=r.unshift,g=r.concat,b=r.join,y=s.call,v=s.apply,w=Math.max,x=Math.min,O=i.toString,S="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,T=Function.prototype.toString,E=/^\s*class /,A=function(t){try{var e=T.call(t),n=e.replace(/\/\/.*\n/g,""),r=n.replace(/\/\*[.\s\S]*\*\//g,""),o=r.replace(/\n/gm," ").replace(/ {2}/g," ");return E.test(o)}catch(t){return!1}},P=function(t){try{return!A(t)&&(T.call(t),!0)}catch(t){return!1}},t=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(S)return P(t);if(A(t))return!1;var e=O.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e},C=RegExp.prototype.exec,j=function(t){try{return C.call(t),!0}catch(t){return!1}};e=function(t){return"object"==typeof t&&(S?j(t):"[object RegExp]"===O.call(t))};var _,N=String.prototype.valueOf,R=function(t){try{return N.call(t),!0}catch(t){return!1}};_=function(t){return"string"==typeof t||"object"==typeof t&&(S?R(t):"[object String]"===O.call(t))};var I=o.defineProperty&&function(){try{var t={};o.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(t){return!1}}(),M=function(t){var e;return e=I?function(t,e,n,r){!r&&e in t||o.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(t,e,n,r){!r&&e in t||(t[e]=n)},function(n,r,o){for(var i in r)t.call(r,i)&&e(n,i,r[i],o)}}(i.hasOwnProperty),B=function(t){var e=typeof t;return null===t||"object"!==e&&"function"!==e},k=c.isNaN||function(t){return t!==t},D={ToInteger:function(t){var e=+t;return k(e)?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},ToPrimitive:function(e){var n,r,o;if(B(e))return e;if(r=e.valueOf,t(r)&&(n=r.call(e),B(n)))return n;if(o=e.toString,t(o)&&(n=o.call(e),B(n)))return n;throw new TypeError},ToObject:function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return o(t)},ToUint32:function(t){return t>>>0}},L=function(){};M(s,{bind:function(e){var n=this;if(!t(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var r,i=d.call(arguments,1),s=function(){if(this instanceof r){var t=v.call(n,this,g.call(i,d.call(arguments)));return o(t)===t?t:this}return v.call(n,e,g.call(i,d.call(arguments)))},l=w(0,n.length-i.length),u=[],c=0;c<l;c++)h.call(u,"$"+c);return r=a("binder","return function ("+b.call(u,",")+"){ return binder.apply(this, arguments); }")(s),n.prototype&&(L.prototype=n.prototype,r.prototype=new L,L.prototype=null),r}});var F=y.bind(i.hasOwnProperty),G=y.bind(i.toString),U=y.bind(d),H=v.bind(d),z=y.bind(u.slice),V=y.bind(u.split),W=y.bind(u.indexOf),q=y.bind(h),$=y.bind(i.propertyIsEnumerable),Y=y.bind(r.sort),K=n.isArray||function(t){return"[object Array]"===G(t)},Z=1!==[].unshift(0);M(r,{unshift:function(){return m.apply(this,arguments),this.length}},Z),M(n,{isArray:K});var J=o("a"),X="a"!==J[0]||!(0 in J),Q=function(t){var e=!0,n=!0,r=!1;if(t)try{t.call("foo",function(t,n,r){"object"!=typeof r&&(e=!1)}),t.call([1],function(){"use strict";n="string"==typeof this},"x")}catch(t){r=!0}return!!t&&!r&&e&&n};M(r,{forEach:function(e){var n,r=D.ToObject(this),o=X&&_(this)?V(this,""):r,i=-1,a=D.ToUint32(o.length);if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++i<a;)i in o&&(void 0===n?e(o[i],i,r):e.call(n,o[i],i,r))}},!Q(r.forEach)),M(r,{map:function(e){var r,o=D.ToObject(this),i=X&&_(this)?V(this,""):o,a=D.ToUint32(i.length),s=n(a);if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.map callback must be a function");for(var l=0;l<a;l++)l in i&&(s[l]=void 0===r?e(i[l],l,o):e.call(r,i[l],l,o));return s}},!Q(r.map)),M(r,{filter:function(e){var n,r,o=D.ToObject(this),i=X&&_(this)?V(this,""):o,a=D.ToUint32(i.length),s=[];if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;l<a;l++)l in i&&(n=i[l],(void 0===r?e(n,l,o):e.call(r,n,l,o))&&q(s,n));return s}},!Q(r.filter)),M(r,{every:function(e){var n,r=D.ToObject(this),o=X&&_(this)?V(this,""):r,i=D.ToUint32(o.length);if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.every callback must be a function");for(var a=0;a<i;a++)if(a in o&&!(void 0===n?e(o[a],a,r):e.call(n,o[a],a,r)))return!1;return!0}},!Q(r.every)),M(r,{some:function(e){var n,r=D.ToObject(this),o=X&&_(this)?V(this,""):r,i=D.ToUint32(o.length);if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.some callback must be a function");for(var a=0;a<i;a++)if(a in o&&(void 0===n?e(o[a],a,r):e.call(n,o[a],a,r)))return!0;return!1}},!Q(r.some));var tt=!1;r.reduce&&(tt="object"==typeof r.reduce.call("es5",function(t,e,n,r){return r})),M(r,{reduce:function(e){var n=D.ToObject(this),r=X&&_(this)?V(this,""):n,o=D.ToUint32(r.length);if(!t(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var i,a=0;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in r){i=r[a++];break}if(++a>=o)throw new TypeError("reduce of empty array with no initial value")}for(;a<o;a++)a in r&&(i=e(i,r[a],a,n));return i}},!tt);var et=!1;r.reduceRight&&(et="object"==typeof r.reduceRight.call("es5",function(t,e,n,r){return r})),M(r,{reduceRight:function(e){var n=D.ToObject(this),r=X&&_(this)?V(this,""):n,o=D.ToUint32(r.length);if(!t(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var i,a=o-1;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in r){i=r[a--];break}if(--a<0)throw new TypeError("reduceRight of empty array with no initial value")}if(a<0)return i;do{a in r&&(i=e(i,r[a],a,n))}while(a--);return i}},!et);var nt=r.indexOf&&-1!==[0,1].indexOf(1,2);M(r,{indexOf:function(t){var e=X&&_(this)?V(this,""):D.ToObject(this),n=D.ToUint32(e.length);if(0===n)return-1;var r=0;for(arguments.length>1&&(r=D.ToInteger(arguments[1])),r=r>=0?r:w(0,n+r);r<n;r++)if(r in e&&e[r]===t)return r;return-1}},nt);var rt=r.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);M(r,{lastIndexOf:function(t){var e=X&&_(this)?V(this,""):D.ToObject(this),n=D.ToUint32(e.length);if(0===n)return-1;var r=n-1;for(arguments.length>1&&(r=x(r,D.ToInteger(arguments[1]))),r=r>=0?r:n-Math.abs(r);r>=0;r--)if(r in e&&t===e[r])return r;return-1}},rt);var ot=function(){var t=[1,2],e=t.splice();return 2===t.length&&K(e)&&0===e.length}();M(r,{splice:function(t,e){return 0===arguments.length?[]:f.apply(this,arguments)}},!ot);var it=function(){var t={};return r.splice.call(t,0,0,1),1===t.length}();M(r,{splice:function(t,e){if(0===arguments.length)return[];var n=arguments;return this.length=w(D.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof e&&(n=U(arguments),n.length<2?q(n,this.length-t):n[1]=D.ToInteger(e)),f.apply(this,n)}},!it);var at=function(){var t=new n(1e5);return t[8]="x",t.splice(1,1),7===t.indexOf("x")}(),st=function(){var t=[];return t[256]="a",t.splice(257,0,"b"),"a"===t[256]}();M(r,{splice:function(t,e){for(var n,r=D.ToObject(this),o=[],i=D.ToUint32(r.length),a=D.ToInteger(t),s=a<0?w(i+a,0):x(a,i),u=x(w(D.ToInteger(e),0),i-s),c=0;c<u;)n=l(s+c),F(r,n)&&(o[c]=r[n]),c+=1;var p,d=U(arguments,2),f=d.length;if(f<u){c=s;for(var h=i-u;c<h;)n=l(c+u),p=l(c+f),F(r,n)?r[p]=r[n]:delete r[p],c+=1;c=i;for(var m=i-u+f;c>m;)delete r[c-1],c-=1}else if(f>u)for(c=i-u;c>s;)n=l(c+u-1),p=l(c+f-1),F(r,n)?r[p]=r[n]:delete r[p],c-=1;c=s;for(var g=0;g<d.length;++g)r[c]=d[g],c+=1;return r.length=i-u+f,o}},!at||!st);var lt,ut=r.join;try{lt="1,2,3"!==Array.prototype.join.call("123",",")}catch(t){lt=!0}lt&&M(r,{join:function(t){var e=void 0===t?",":t;return ut.call(_(this)?V(this,""):this,e)}},lt);var ct="1,2"!==[1,2].join(void 0);ct&&M(r,{join:function(t){var e=void 0===t?",":t;return ut.call(this,e)}},ct);var pt=function(t){for(var e=D.ToObject(this),n=D.ToUint32(e.length),r=0;r<arguments.length;)e[n+r]=arguments[r],r+=1;return e.length=n+r,n+r},dt=function(){var t={};return 1!==Array.prototype.push.call(t,void 0)||1!==t.length||void 0!==t[0]||!F(t,0)}();M(r,{push:function(t){return K(this)?h.apply(this,arguments):pt.apply(this,arguments)}},dt);var ft=function(){var t=[];return 1!==t.push(void 0)||1!==t.length||void 0!==t[0]||!F(t,0)}();M(r,{push:pt},ft),M(r,{slice:function(t,e){var n=_(this)?V(this,""):this;return H(n,arguments)}},X);var ht=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(t){}return!1}(),mt=function(){try{return[1,2].sort(/a/),!1}catch(t){}return!0}(),gt=function(){try{return[1,2].sort(void 0),!0}catch(t){}return!1}();M(r,{sort:function(e){if(void 0===e)return Y(this);if(!t(e))throw new TypeError("Array.prototype.sort callback must be a function");return Y(this,e)}},ht||!gt||!mt);var bt=!$({toString:null},"toString"),yt=$(function(){},"prototype"),vt=!F("x","0"),wt=function(t){var e=t.constructor;return e&&e.prototype===t},xt={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0},Ot=function(){if("undefined"==typeof window)return!1;for(var t in window)try{!xt["$"+t]&&F(window,t)&&null!==window[t]&&"object"==typeof window[t]&&wt(window[t])}catch(t){return!0}return!1}(),St=function(t){if("undefined"==typeof window||!Ot)return wt(t);try{return wt(t)}catch(t){return!1}},Tt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Et=Tt.length,At=function(t){return"[object Arguments]"===G(t)},Pt=function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&!K(e)&&t(e.callee)},Ct=At(arguments)?At:Pt;M(o,{keys:function(e){var n=t(e),r=Ct(e),o=null!==e&&"object"==typeof e,i=o&&_(e);if(!o&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var a=[],s=yt&&n;if(i&&vt||r)for(var u=0;u<e.length;++u)q(a,l(u));if(!r)for(var c in e)s&&"prototype"===c||!F(e,c)||q(a,l(c));if(bt)for(var p=St(e),d=0;d<Et;d++){var f=Tt[d];p&&"constructor"===f||!F(e,f)||q(a,f)}return a}});var jt=o.keys&&function(){return 2===o.keys(arguments).length}(1,2),_t=o.keys&&function(){var t=o.keys(arguments);return 1!==arguments.length||1!==t.length||1!==t[0]}(1),Nt=o.keys;M(o,{keys:function(t){return Nt(Ct(t)?U(t):t)}},!jt||_t);var Rt,It,Mt=0!==new Date(-0xc782b5b342b24).getUTCMonth(),Bt=new Date(-0x55d318d56a724),kt=new Date(14496624e5),Dt="Mon, 01 Jan -45875 11:59:59 GMT"!==Bt.toUTCString();Bt.getTimezoneOffset()<-720?(Rt="Tue Jan 02 -45875"!==Bt.toDateString(),It=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(kt.toString())):(Rt="Mon Jan 01 -45875"!==Bt.toDateString(),It=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(kt.toString()));var Lt=y.bind(Date.prototype.getFullYear),Ft=y.bind(Date.prototype.getMonth),Gt=y.bind(Date.prototype.getDate),Ut=y.bind(Date.prototype.getUTCFullYear),Ht=y.bind(Date.prototype.getUTCMonth),zt=y.bind(Date.prototype.getUTCDate),Vt=y.bind(Date.prototype.getUTCDay),Wt=y.bind(Date.prototype.getUTCHours),qt=y.bind(Date.prototype.getUTCMinutes),$t=y.bind(Date.prototype.getUTCSeconds),Yt=y.bind(Date.prototype.getUTCMilliseconds),Kt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Zt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Jt=function(t,e){return Gt(new Date(e,t,0))};M(Date.prototype,{getFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Lt(this);return t<0&&Ft(this)>11?t+1:t},getMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Lt(this),e=Ft(this);return t<0&&e>11?0:e},getDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Lt(this),e=Ft(this),n=Gt(this);if(t<0&&e>11){if(12===e)return n;return Jt(0,t+1)-n+1}return n},getUTCFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Ut(this);return t<0&&Ht(this)>11?t+1:t},getUTCMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Ut(this),e=Ht(this);return t<0&&e>11?0:e},getUTCDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Ut(this),e=Ht(this),n=zt(this);if(t<0&&e>11){if(12===e)return n;return Jt(0,t+1)-n+1}return n}},Mt),M(Date.prototype,{toUTCString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Vt(this),e=zt(this),n=Ht(this),r=Ut(this),o=Wt(this),i=qt(this),a=$t(this);return Kt[t]+", "+(e<10?"0"+e:e)+" "+Zt[n]+" "+r+" "+(o<10?"0"+o:o)+":"+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+" GMT"}},Mt||Dt),M(Date.prototype,{toDateString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=this.getDay(),e=this.getDate(),n=this.getMonth(),r=this.getFullYear();return Kt[t]+" "+Zt[n]+" "+(e<10?"0"+e:e)+" "+r}},Mt||Rt),(Mt||It)&&(Date.prototype.toString=function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=this.getDay(),e=this.getDate(),n=this.getMonth(),r=this.getFullYear(),o=this.getHours(),i=this.getMinutes(),a=this.getSeconds(),s=this.getTimezoneOffset(),l=Math.floor(Math.abs(s)/60),u=Math.floor(Math.abs(s)%60);return Kt[t]+" "+Zt[n]+" "+(e<10?"0"+e:e)+" "+r+" "+(o<10?"0"+o:o)+":"+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+" GMT"+(s>0?"-":"+")+(l<10?"0"+l:l)+(u<10?"0"+u:u)},I&&o.defineProperty(Date.prototype,"toString",{configurable:!0,enumerable:!1,writable:!0}));var Xt=Date.prototype.toISOString&&-1===new Date(-621987552e5).toISOString().indexOf("-000001"),Qt=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString(),te=y.bind(Date.prototype.getTime);M(Date.prototype,{toISOString:function(){if(!isFinite(this)||!isFinite(te(this)))throw new RangeError("Date.prototype.toISOString called on non-finite value.");var t=Ut(this),e=Ht(this);t+=Math.floor(e/12),e=(e%12+12)%12;var n=[e+1,zt(this),Wt(this),qt(this),$t(this)];t=(t<0?"-":t>9999?"+":"")+z("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6)
;for(var r=0;r<n.length;++r)n[r]=z("00"+n[r],-2);return t+"-"+U(n,0,2).join("-")+"T"+U(n,2).join(":")+"."+z("000"+Yt(this),-3)+"Z"}},Xt||Qt),function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(-621987552e5).toJSON().indexOf("-000001")&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(t){return!1}}()||(Date.prototype.toJSON=function(e){var n=o(this),r=D.ToPrimitive(n);if("number"==typeof r&&!isFinite(r))return null;var i=n.toISOString;if(!t(i))throw new TypeError("toISOString property is not callable");return i.call(n)});var ee=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),ne=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));if(isNaN(Date.parse("2000-01-01T00:00:00.000Z"))||ne||!ee){var re=Math.pow(2,31)-1,oe=k(new Date(1970,0,1,0,0,0,re+1).getTime());Date=function(t){var e=function(n,r,o,i,a,s,u){var c,p=arguments.length;if(this instanceof t){var d=s,f=u;if(oe&&p>=7&&u>re){var h=Math.floor(u/re)*re,m=Math.floor(h/1e3);d+=m,f-=1e3*m}c=1===p&&l(n)===n?new t(e.parse(n)):p>=7?new t(n,r,o,i,a,d,f):p>=6?new t(n,r,o,i,a,d):p>=5?new t(n,r,o,i,a):p>=4?new t(n,r,o,i):p>=3?new t(n,r,o):p>=2?new t(n,r):p>=1?new t(n instanceof t?+n:n):new t}else c=t.apply(this,arguments);return B(c)||M(c,{constructor:e},!0),c},n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365],o=function(t,e){var n=e>1?1:0;return r[e]+Math.floor((t-1969+n)/4)-Math.floor((t-1901+n)/100)+Math.floor((t-1601+n)/400)+365*(t-1970)},i=function(e){var n=0,r=e;if(oe&&r>re){var o=Math.floor(r/re)*re,i=Math.floor(o/1e3);n+=i,r-=1e3*i}return c(new t(1970,0,1,0,0,n,r))};for(var a in t)F(t,a)&&(e[a]=t[a]);return M(e,{now:t.now,UTC:t.UTC},!0),e.prototype=t.prototype,M(e.prototype,{constructor:e},!0),M(e,{parse:function(e){var r=n.exec(e);if(r){var a,s=c(r[1]),l=c(r[2]||1)-1,u=c(r[3]||1)-1,p=c(r[4]||0),d=c(r[5]||0),f=c(r[6]||0),h=Math.floor(1e3*c(r[7]||0)),m=Boolean(r[4]&&!r[8]),g="-"===r[9]?1:-1,b=c(r[10]||0),y=c(r[11]||0);return p<(d>0||f>0||h>0?24:25)&&d<60&&f<60&&h<1e3&&l>-1&&l<12&&b<24&&y<60&&u>-1&&u<o(s,l+1)-o(s,l)&&(a=60*(24*(o(s,l)+u)+p+b*g),a=1e3*(60*(a+d+y*g)+f)+h,m&&(a=i(a)),-864e13<=a&&a<=864e13)?a:NaN}return t.parse.apply(this,arguments)}}),e}(Date)}Date.now||(Date.now=function(){return(new Date).getTime()});var ie=p.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0)),ae={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(t,e){for(var n=-1,r=e;++n<ae.size;)r+=t*ae.data[n],ae.data[n]=r%ae.base,r=Math.floor(r/ae.base)},divide:function(t){for(var e=ae.size,n=0;--e>=0;)n+=ae.data[e],ae.data[e]=Math.floor(n/t),n=n%t*ae.base},numToString:function(){for(var t=ae.size,e="";--t>=0;)if(""!==e||0===t||0!==ae.data[t]){var n=l(ae.data[t]);""===e?e=n:e+=z("0000000",0,7-n.length)+n}return e},pow:function t(e,n,r){return 0===n?r:n%2==1?t(e,n-1,r*e):t(e*e,n/2,r)},log:function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}};M(p,{toFixed:function(t){var e,n,r,o,i,a,s,u;if(e=c(t),(e=k(e)?0:Math.floor(e))<0||e>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(n=c(this),k(n))return"NaN";if(n<=-1e21||n>=1e21)return l(n);if(r="",n<0&&(r="-",n=-n),o="0",n>1e-21)if(i=ae.log(n*ae.pow(2,69,1))-69,a=i<0?n*ae.pow(2,-i,1):n/ae.pow(2,i,1),a*=4503599627370496,(i=52-i)>0){for(ae.multiply(0,a),s=e;s>=7;)ae.multiply(1e7,0),s-=7;for(ae.multiply(ae.pow(10,s,1),0),s=i-1;s>=23;)ae.divide(1<<23),s-=23;ae.divide(1<<s),ae.multiply(1,1),ae.divide(2),o=ae.numToString()}else ae.multiply(0,a),ae.multiply(1<<-i,0),o=ae.numToString()+z("0.00000000000000000000",2,2+e);return e>0?(u=o.length,o=u<=e?r+z("0.0000000000000000000",0,e-u+2)+o:r+z(o,0,u-e)+"."+z(o,u-e)):o=r+o,o}},ie);var se=function(){try{return"1"===1..toPrecision(void 0)}catch(t){return!0}}(),le=p.toPrecision;M(p,{toPrecision:function(t){return void 0===t?le.call(this):le.call(this,t)}},se),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?function(){var t=void 0===/()??/.exec("")[1],n=Math.pow(2,32)-1;u.split=function(r,o){var i=String(this);if(void 0===r&&0===o)return[];if(!e(r))return V(this,r,o);var a,s,l,u,c=[],p=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(r.sticky?"y":""),d=0,f=new RegExp(r.source,p+"g");t||(a=new RegExp("^"+f.source+"$(?!\\s)",p));var m=void 0===o?n:D.ToUint32(o);for(s=f.exec(i);s&&!((l=s.index+s[0].length)>d&&(q(c,z(i,d,s.index)),!t&&s.length>1&&s[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(s[t]=void 0)}),s.length>1&&s.index<i.length&&h.apply(c,U(s,1)),u=s[0].length,d=l,c.length>=m));)f.lastIndex===s.index&&f.lastIndex++,s=f.exec(i);return d===i.length?!u&&f.test("")||q(c,""):q(c,z(i,d)),c.length>m?U(c,0,m):c}}():"0".split(void 0,0).length&&(u.split=function(t,e){return void 0===t&&0===e?[]:V(this,t,e)});var ue=u.replace;(function(){var t=[];return"x".replace(/x(.)?/g,function(e,n){q(t,n)}),1===t.length&&void 0===t[0]})()||(u.replace=function(n,r){var o=t(r),i=e(n)&&/\)[*?]/.test(n.source);if(o&&i){var a=function(t){var e=arguments.length,o=n.lastIndex;n.lastIndex=0;var i=n.exec(t)||[];return n.lastIndex=o,q(i,arguments[e-2],arguments[e-1]),r.apply(this,i)};return ue.call(this,n,a)}return ue.call(this,n,r)});var ce=u.substr,pe="".substr&&"b"!=="0b".substr(-1);M(u,{substr:function(t,e){var n=t;return t<0&&(n=w(this.length+t,0)),ce.call(this,n,e)}},pe);var de="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",fe="​",he="["+de+"]",me=new RegExp("^"+he+he+"*"),ge=new RegExp(he+he+"*$"),be=u.trim&&(de.trim()||!fe.trim());M(u,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return l(this).replace(me,"").replace(ge,"")}},be);var ye=y.bind(String.prototype.trim),ve=u.lastIndexOf&&-1!=="abcあい".lastIndexOf("あい",2);M(u,{lastIndexOf:function(t){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");for(var e=l(this),n=l(t),r=arguments.length>1?c(arguments[1]):NaN,o=k(r)?1/0:D.ToInteger(r),i=x(w(o,0),e.length),a=n.length,s=i+a;s>0;){s=w(0,s-a);var u=W(z(e,s,i+a),n);if(-1!==u)return s+u}return-1}},ve);var we=u.lastIndexOf;if(M(u,{lastIndexOf:function(t){return we.apply(this,arguments)}},1!==u.lastIndexOf.length),8===parseInt(de+"08")&&22===parseInt(de+"0x16")||(parseInt=function(t){var e=/^[\-+]?0[xX]/;return function(n,r){var o=ye(String(n)),i=c(r)||(e.test(o)?16:10);return t(o,i)}}(parseInt)),1/parseFloat("-0")!=-1/0&&(parseFloat=function(t){return function(e){var n=ye(String(e)),r=t(n);return 0===r&&"-"===z(n,0,1)?-0:r}}(parseFloat)),"RangeError: test"!==String(new RangeError("test"))){var xe=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");var t=this.name;void 0===t?t="Error":"string"!=typeof t&&(t=l(t));var e=this.message;return void 0===e?e="":"string"!=typeof e&&(e=l(e)),t?e?t+": "+e:t:e};Error.prototype.toString=xe}if(I){var Oe=function(t,e){if($(t,e)){var n=Object.getOwnPropertyDescriptor(t,e);n.configurable&&(n.enumerable=!1,Object.defineProperty(t,e,n))}};Oe(Error.prototype,"message"),""!==Error.prototype.message&&(Error.prototype.message=""),Oe(Error.prototype,"name")}if("/a/gim"!==String(/a/gim)){var Se=function(){var t="/"+this.source+"/";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),t};RegExp.prototype.toString=Se}}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.returnExports=e()}(this,function(){"use strict";var t,e=Function.call.bind(Function.apply),n=Function.call.bind(Function.call),r=Array.isArray,o=Object.keys,i=function(t){try{return t(),!1}catch(t){return!0}},a=function(t){try{return t()}catch(t){return!1}},s=function(t){return function(){return!e(t,this,arguments)}}(i),l=!!Object.defineProperty&&function(){return!i(function(){Object.defineProperty({},"x",{get:function(){}})})}(),u="foo"===function(){}.name,c=Function.call.bind(Array.prototype.forEach),p=Function.call.bind(Array.prototype.reduce),d=Function.call.bind(Array.prototype.filter),f=Function.call.bind(Array.prototype.some),h=function(t,e,n,r){!r&&e in t||(l?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n}):t[e]=n)},m=function(t,e,n){c(o(e),function(r){var o=e[r];h(t,r,o,!!n)})},g=Function.call.bind(Object.prototype.toString),b="function"==typeof/abc/?function(t){return"function"==typeof t&&"[object Function]"===g(t)}:function(t){return"function"==typeof t},y={getter:function(t,e,n){if(!l)throw new TypeError("getters require true ES5 support");Object.defineProperty(t,e,{configurable:!0,enumerable:!1,get:n})},proxy:function(t,e,n){if(!l)throw new TypeError("getters require true ES5 support");var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return t[e]},set:function(n){t[e]=n}})},redefine:function(t,e,n){if(l){var r=Object.getOwnPropertyDescriptor(t,e);r.value=n,Object.defineProperty(t,e,r)}else t[e]=n},defineByDescriptor:function(t,e,n){l?Object.defineProperty(t,e,n):"value"in n&&(t[e]=n.value)},preserveToString:function(t,e){e&&b(e.toString)&&h(t,"toString",e.toString.bind(e),!0)}},v=Object.create||function(t,e){var n=function(){};n.prototype=t;var r=new n;return void 0!==e&&o(e).forEach(function(t){y.defineByDescriptor(r,t,e[t])}),r},w=function(t,e){return!!Object.setPrototypeOf&&a(function(){var n=function e(n){var r=new t(n);return Object.setPrototypeOf(r,e.prototype),r};return Object.setPrototypeOf(n,t),n.prototype=v(t.prototype,{constructor:{value:n}}),e(n)})},x=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}(),O=x.isFinite,S=Function.call.bind(String.prototype.indexOf),T=Function.apply.bind(Array.prototype.indexOf),E=Function.call.bind(Array.prototype.concat),A=Function.call.bind(String.prototype.slice),P=Function.call.bind(Array.prototype.push),C=Function.apply.bind(Array.prototype.push),j=Function.call.bind(Array.prototype.shift),_=Math.max,N=Math.min,R=Math.floor,I=Math.abs,M=Math.exp,B=Math.log,k=Math.sqrt,D=Function.call.bind(Object.prototype.hasOwnProperty),L=function(){},F=x.Symbol||{},G=F.species||"@@species",U=Number.isNaN||function(t){return t!==t},H=Number.isFinite||function(t){return"number"==typeof t&&O(t)},z=b(Math.sign)?Math.sign:function(t){var e=Number(t);return 0===e?e:U(e)?e:e<0?-1:1},V=function(t){return"[object Arguments]"===g(t)},W=function(t){return null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==g(t)&&"[object Function]"===g(t.callee)},q=V(arguments)?V:W,$={primitive:function(t){return null===t||"function"!=typeof t&&"object"!=typeof t},string:function(t){return"[object String]"===g(t)},regex:function(t){return"[object RegExp]"===g(t)},symbol:function(t){return"function"==typeof x.Symbol&&"symbol"==typeof t}},Y=function(t,e,n){var r=t[e];h(t,e,n,!0),y.preserveToString(t[e],r)},K="function"==typeof F&&"function"==typeof F.for&&$.symbol(F()),Z=$.symbol(F.iterator)?F.iterator:"_es6-shim iterator_";x.Set&&"function"==typeof(new x.Set)["@@iterator"]&&(Z="@@iterator"),x.Reflect||h(x,"Reflect",{},!0);var J=x.Reflect,X=String,Q={Call:function(t,n){var r=arguments.length>2?arguments[2]:[];if(!Q.IsCallable(t))throw new TypeError(t+" is not a function");return e(t,n,r)},RequireObjectCoercible:function(t,e){if(null==t)throw new TypeError(e||"Cannot call method on "+t);return t},TypeIsObject:function(t){return void 0!==t&&null!==t&&!0!==t&&!1!==t&&("function"==typeof t||"object"==typeof t)},ToObject:function(t,e){return Object(Q.RequireObjectCoercible(t,e))},IsCallable:b,IsConstructor:function(t){return Q.IsCallable(t)},ToInt32:function(t){return Q.ToNumber(t)>>0},ToUint32:function(t){return Q.ToNumber(t)>>>0},ToNumber:function(t){if("[object Symbol]"===g(t))throw new TypeError("Cannot convert a Symbol value to a number");return+t},ToInteger:function(t){var e=Q.ToNumber(t);return U(e)?0:0!==e&&H(e)?(e>0?1:-1)*R(I(e)):e},ToLength:function(t){var e=Q.ToInteger(t);return e<=0?0:e>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e},SameValue:function(t,e){return t===e?0!==t||1/t==1/e:U(t)&&U(e)},SameValueZero:function(t,e){return t===e||U(t)&&U(e)},IsIterable:function(t){return Q.TypeIsObject(t)&&(void 0!==t[Z]||q(t))},GetIterator:function(e){if(q(e))return new t(e,"value");var n=Q.GetMethod(e,Z);if(!Q.IsCallable(n))throw new TypeError("value is not an iterable");var r=Q.Call(n,e);if(!Q.TypeIsObject(r))throw new TypeError("bad iterator");return r},GetMethod:function(t,e){var n=Q.ToObject(t)[e];if(void 0!==n&&null!==n){if(!Q.IsCallable(n))throw new TypeError("Method not callable: "+e);return n}},IteratorComplete:function(t){return!!t.done},IteratorClose:function(t,e){var n=Q.GetMethod(t,"return");if(void 0!==n){var r,o;try{r=Q.Call(n,t)}catch(t){o=t}if(!e){if(o)throw o;if(!Q.TypeIsObject(r))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(t){var e=arguments.length>1?t.next(arguments[1]):t.next();if(!Q.TypeIsObject(e))throw new TypeError("bad iterator");return e},IteratorStep:function(t){var e=Q.IteratorNext(t);return!Q.IteratorComplete(e)&&e},Construct:function(t,e,n,r){var o=void 0===n?t:n;if(!r&&J.construct)return J.construct(t,e,o);var i=o.prototype;Q.TypeIsObject(i)||(i=Object.prototype);var a=v(i),s=Q.Call(t,a,e);return Q.TypeIsObject(s)?s:a},SpeciesConstructor:function(t,e){var n=t.constructor;if(void 0===n)return e;if(!Q.TypeIsObject(n))throw new TypeError("Bad constructor");var r=n[G];if(void 0===r||null===r)return e;if(!Q.IsConstructor(r))throw new TypeError("Bad @@species");return r},CreateHTML:function(t,e,n,r){var o=Q.ToString(t),i="<"+e;if(""!==n){i+=" "+n+'="'+Q.ToString(r).replace(/"/g,"&quot;")+'"'}return i+">"+o+"</"+e+">"},IsRegExp:function(t){if(!Q.TypeIsObject(t))return!1;var e=t[F.match];return void 0!==e?!!e:$.regex(t)},ToString:function(t){return X(t)}};if(l&&K){var tt=function(t){if($.symbol(F[t]))return F[t];var e=F.for("Symbol."+t);return Object.defineProperty(F,t,{configurable:!1,enumerable:!1,writable:!1,value:e}),e};if(!$.symbol(F.search)){var et=tt("search"),nt=String.prototype.search;h(RegExp.prototype,et,function(t){return Q.Call(nt,t,[this])});var rt=function(t){var e=Q.RequireObjectCoercible(this);if(null!==t&&void 0!==t){var n=Q.GetMethod(t,et);if(void 0!==n)return Q.Call(n,t,[e])}return Q.Call(nt,e,[Q.ToString(t)])};Y(String.prototype,"search",rt)}if(!$.symbol(F.replace)){var ot=tt("replace"),it=String.prototype.replace;h(RegExp.prototype,ot,function(t,e){return Q.Call(it,t,[this,e])});var at=function(t,e){var n=Q.RequireObjectCoercible(this);if(null!==t&&void 0!==t){var r=Q.GetMethod(t,ot);if(void 0!==r)return Q.Call(r,t,[n,e])}return Q.Call(it,n,[Q.ToString(t),e])};Y(String.prototype,"replace",at)}if(!$.symbol(F.split)){var st=tt("split"),lt=String.prototype.split;h(RegExp.prototype,st,function(t,e){return Q.Call(lt,t,[this,e])});var ut=function(t,e){var n=Q.RequireObjectCoercible(this);if(null!==t&&void 0!==t){var r=Q.GetMethod(t,st);if(void 0!==r)return Q.Call(r,t,[n,e])}return Q.Call(lt,n,[Q.ToString(t),e])};Y(String.prototype,"split",ut)}var ct=$.symbol(F.match),pt=ct&&function(){var t={};return t[F.match]=function(){return 42},42!=="a".match(t)}();if(!ct||pt){var dt=tt("match"),ft=String.prototype.match;h(RegExp.prototype,dt,function(t){return Q.Call(ft,t,[this])});var ht=function(t){var e=Q.RequireObjectCoercible(this);if(null!==t&&void 0!==t){var n=Q.GetMethod(t,dt);if(void 0!==n)return Q.Call(n,t,[e])}return Q.Call(ft,e,[Q.ToString(t)])};Y(String.prototype,"match",ht)}}var mt=function(t,e,n){y.preserveToString(e,t),Object.setPrototypeOf&&Object.setPrototypeOf(t,e),l?c(Object.getOwnPropertyNames(t),function(r){r in L||n[r]||y.proxy(t,r,e)}):c(Object.keys(t),function(r){r in L||n[r]||(e[r]=t[r])}),e.prototype=t.prototype,y.redefine(t.prototype,"constructor",e)},gt=function(){return this},bt=function(t){l&&!D(t,G)&&y.getter(t,G,gt)},yt=function(t,e){var n=e||function(){return this};h(t,Z,n),!t[Z]&&$.symbol(Z)&&(t[Z]=n)},vt=function(t,e,n){l?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,writable:!0,value:n}):t[e]=n},wt=function(t,e,n){if(vt(t,e,n),!Q.SameValue(t[e],n))throw new TypeError("property is nonconfigurable")},xt=function(t,e,n,r){if(!Q.TypeIsObject(t))throw new TypeError("Constructor requires `new`: "+e.name);var o=e.prototype;Q.TypeIsObject(o)||(o=n);var i=v(o);for(var a in r)if(D(r,a)){var s=r[a];h(i,a,s,!0)}return i};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Ot=String.fromCodePoint;Y(String,"fromCodePoint",function(t){return Q.Call(Ot,this,arguments)})}var St={fromCodePoint:function(t){for(var e,n=[],r=0,o=arguments.length;r<o;r++){if(e=Number(arguments[r]),!Q.SameValue(e,Q.ToInteger(e))||e<0||e>1114111)throw new RangeError("Invalid code point "+e);e<65536?P(n,String.fromCharCode(e)):(e-=65536,P(n,String.fromCharCode(55296+(e>>10))),P(n,String.fromCharCode(e%1024+56320)))}return n.join("")},raw:function(t){var e=Q.ToObject(t,"bad callSite"),n=Q.ToObject(e.raw,"bad raw value"),r=n.length,o=Q.ToLength(r);if(o<=0)return"";for(var i,a,s,l,u=[],c=0;c<o&&(i=Q.ToString(c),s=Q.ToString(n[i]),P(u,s),!(c+1>=o));)a=c+1<arguments.length?arguments[c+1]:"",l=Q.ToString(a),P(u,l),c+=1;return u.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&Y(String,"raw",St.raw),m(String,St);var Tt=function t(e,n){if(n<1)return"";if(n%2)return t(e,n-1)+e;var r=t(e,n/2);return r+r},Et={repeat:function(t){var e=Q.ToString(Q.RequireObjectCoercible(this)),n=Q.ToInteger(t);if(n<0||n>=1/0)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return Tt(e,n)},startsWith:function(t){var e=Q.ToString(Q.RequireObjectCoercible(this));if(Q.IsRegExp(t))throw new TypeError('Cannot call method "startsWith" with a regex');var n,r=Q.ToString(t);arguments.length>1&&(n=arguments[1]);var o=_(Q.ToInteger(n),0);return A(e,o,o+r.length)===r},endsWith:function(t){var e=Q.ToString(Q.RequireObjectCoercible(this));if(Q.IsRegExp(t))throw new TypeError('Cannot call method "endsWith" with a regex');var n,r=Q.ToString(t),o=e.length;arguments.length>1&&(n=arguments[1]);var i=void 0===n?o:Q.ToInteger(n),a=N(_(i,0),o);return A(e,a-r.length,a)===r},includes:function(t){if(Q.IsRegExp(t))throw new TypeError('"includes" does not accept a RegExp');var e,n=Q.ToString(t);return arguments.length>1&&(e=arguments[1]),-1!==S(this,n,e)},codePointAt:function(t){var e=Q.ToString(Q.RequireObjectCoercible(this)),n=Q.ToInteger(t),r=e.length;if(n>=0&&n<r){var o=e.charCodeAt(n),i=n+1===r;if(o<55296||o>56319||i)return o;var a=e.charCodeAt(n+1);return a<56320||a>57343?o:1024*(o-55296)+(a-56320)+65536}}};if(String.prototype.includes&&!1!=="a".includes("a",1/0)&&Y(String.prototype,"includes",Et.includes),String.prototype.startsWith&&String.prototype.endsWith){var At=i(function(){"/a/".startsWith(/a/)}),Pt=a(function(){return!1==="abc".startsWith("a",1/0)});At&&Pt||(Y(String.prototype,"startsWith",Et.startsWith),Y(String.prototype,"endsWith",Et.endsWith))}if(K){a(function(){var t=/a/;return t[F.match]=!1,"/a/".startsWith(t)})||Y(String.prototype,"startsWith",Et.startsWith);a(function(){var t=/a/;return t[F.match]=!1,"/a/".endsWith(t)})||Y(String.prototype,"endsWith",Et.endsWith);a(function(){var t=/a/;return t[F.match]=!1,"/a/".includes(t)})||Y(String.prototype,"includes",Et.includes)}m(String.prototype,Et);var Ct=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),jt=new RegExp("(^["+Ct+"]+)|(["+Ct+"]+$)","g"),_t=function(){return Q.ToString(Q.RequireObjectCoercible(this)).replace(jt,"")},Nt=["","​","￾"].join(""),Rt=new RegExp("["+Nt+"]","g"),It=/^[\-+]0x[0-9a-f]+$/i,Mt=Nt.trim().length!==Nt.length;h(String.prototype,"trim",_t,Mt);var Bt=function(t){return{value:t,done:0===arguments.length}},kt=function(t){Q.RequireObjectCoercible(t),this._s=Q.ToString(t),this._i=0};kt.prototype.next=function(){var t=this._s,e=this._i;if(void 0===t||e>=t.length)return this._s=void 0,Bt();var n,r,o=t.charCodeAt(e);return o<55296||o>56319||e+1===t.length?r=1:(n=t.charCodeAt(e+1),r=n<56320||n>57343?1:2),this._i=e+r,Bt(t.substr(e,r))},yt(kt.prototype),yt(String.prototype,function(){return new kt(this)});var Dt={from:function(t){var e,r=this;arguments.length>1&&(e=arguments[1]);var o,i;if(void 0===e)o=!1;else{if(!Q.IsCallable(e))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2]),o=!0}var a,s,l,u=void 0!==(q(t)||Q.GetMethod(t,Z));if(u){s=Q.IsConstructor(r)?Object(new r):[];var c,p,d=Q.GetIterator(t);for(l=0;;){if(!1===(c=Q.IteratorStep(d)))break;p=c.value;try{o&&(p=void 0===i?e(p,l):n(e,i,p,l)),s[l]=p}catch(t){throw Q.IteratorClose(d,!0),t}l+=1}a=l}else{var f=Q.ToObject(t);a=Q.ToLength(f.length),s=Q.IsConstructor(r)?Object(new r(a)):new Array(a);var h;for(l=0;l<a;++l)h=f[l],o&&(h=void 0===i?e(h,l):n(e,i,h,l)),wt(s,l,h)}return s.length=a,s},of:function(){for(var t=arguments.length,e=this,n=r(e)||!Q.IsCallable(e)?new Array(t):Q.Construct(e,[t]),o=0;o<t;++o)wt(n,o,arguments[o]);return n.length=t,n}};m(Array,Dt),bt(Array),t=function(t,e){this.i=0,this.array=t,this.kind=e},m(t.prototype,{next:function(){var e=this.i,n=this.array;if(!(this instanceof t))throw new TypeError("Not an ArrayIterator");if(void 0!==n)for(var r=Q.ToLength(n.length);e<r;e++){var o,i=this.kind;return"key"===i?o=e:"value"===i?o=n[e]:"entry"===i&&(o=[e,n[e]]),this.i=e+1,Bt(o)}return this.array=void 0,Bt()}}),yt(t.prototype),Array.of===Dt.of||function(){var t=function(t){this.length=t};t.prototype=[];var e=Array.of.apply(t,[1,2]);return e instanceof t&&2===e.length}()||Y(Array,"of",Dt.of);var Lt={copyWithin:function(t,e){var n,r=Q.ToObject(this),o=Q.ToLength(r.length),i=Q.ToInteger(t),a=Q.ToInteger(e),s=i<0?_(o+i,0):N(i,o),l=a<0?_(o+a,0):N(a,o);arguments.length>2&&(n=arguments[2]);var u=void 0===n?o:Q.ToInteger(n),c=u<0?_(o+u,0):N(u,o),p=N(c-l,o-s),d=1;for(l<s&&s<l+p&&(d=-1,l+=p-1,s+=p-1);p>0;)l in r?r[s]=r[l]:delete r[s],l+=d,s+=d,p-=1;return r},fill:function(t){var e;arguments.length>1&&(e=arguments[1]);var n;arguments.length>2&&(n=arguments[2]);var r=Q.ToObject(this),o=Q.ToLength(r.length);e=Q.ToInteger(void 0===e?0:e),n=Q.ToInteger(void 0===n?o:n);for(var i=e<0?_(o+e,0):N(e,o),a=n<0?o+n:n,s=i;s<o&&s<a;++s)r[s]=t;return r},find:function(t){var e=Q.ToObject(this),r=Q.ToLength(e.length);if(!Q.IsCallable(t))throw new TypeError("Array#find: predicate must be a function");for(var o,i=arguments.length>1?arguments[1]:null,a=0;a<r;a++)if(o=e[a],i){if(n(t,i,o,a,e))return o}else if(t(o,a,e))return o},findIndex:function(t){var e=Q.ToObject(this),r=Q.ToLength(e.length);if(!Q.IsCallable(t))throw new TypeError("Array#findIndex: predicate must be a function");for(var o=arguments.length>1?arguments[1]:null,i=0;i<r;i++)if(o){if(n(t,o,e[i],i,e))return i}else if(t(e[i],i,e))return i;return-1},keys:function(){return new t(this,"key")},values:function(){return new t(this,"value")},entries:function(){return new t(this,"entry")}};if(Array.prototype.keys&&!Q.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!Q.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[Z]&&(m(Array.prototype,{values:Array.prototype[Z]}),$.symbol(F.unscopables)&&(Array.prototype[F.unscopables].values=!0)),u&&Array.prototype.values&&"values"!==Array.prototype.values.name){var Ft=Array.prototype.values;Y(Array.prototype,"values",function(){return Q.Call(Ft,this,arguments)}),h(Array.prototype,Z,Array.prototype.values,!0)}m(Array.prototype,Lt),1/[!0].indexOf(!0,-0)<0&&h(Array.prototype,"indexOf",function(t){var e=T(this,arguments);return 0===e&&1/e<0?0:e},!0),yt(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&yt(Object.getPrototypeOf([].values()));var Gt=function(){return a(function(){return 0===Array.from({length:-1}).length})}(),Ut=function(){var t=Array.from([0].entries());return 1===t.length&&r(t[0])&&0===t[0][0]&&0===t[0][1]}();if(Gt&&Ut||Y(Array,"from",Dt.from),!function(){return a(function(){return Array.from([0],void 0)})}()){var Ht=Array.from;Y(Array,"from",function(t){return arguments.length>1&&void 0!==arguments[1]?Q.Call(Ht,this,arguments):n(Ht,this,t)})}var zt=-(Math.pow(2,32)-1),Vt=function(t,e){var r={length:zt};return r[e?(r.length>>>0)-1:0]=!0,a(function(){return n(t,r,function(){throw new RangeError("should not reach here")},[]),!0})};if(!Vt(Array.prototype.forEach)){var Wt=Array.prototype.forEach;Y(Array.prototype,"forEach",function(t){return Q.Call(Wt,this.length>=0?this:[],arguments)})}if(!Vt(Array.prototype.map)){var qt=Array.prototype.map;Y(Array.prototype,"map",function(t){return Q.Call(qt,this.length>=0?this:[],arguments)})}if(!Vt(Array.prototype.filter)){var $t=Array.prototype.filter;Y(Array.prototype,"filter",function(t){return Q.Call($t,this.length>=0?this:[],arguments)})}if(!Vt(Array.prototype.some)){var Yt=Array.prototype.some;Y(Array.prototype,"some",function(t){return Q.Call(Yt,this.length>=0?this:[],arguments)})}if(!Vt(Array.prototype.every)){var Kt=Array.prototype.every;Y(Array.prototype,"every",function(t){return Q.Call(Kt,this.length>=0?this:[],arguments)})}if(!Vt(Array.prototype.reduce)){var Zt=Array.prototype.reduce;Y(Array.prototype,"reduce",function(t){return Q.Call(Zt,this.length>=0?this:[],arguments)})}if(!Vt(Array.prototype.reduceRight,!0)){var Jt=Array.prototype.reduceRight;Y(Array.prototype,"reduceRight",function(t){return Q.Call(Jt,this.length>=0?this:[],arguments)})}var Xt=8!==Number("0o10"),Qt=2!==Number("0b10"),te=f(Nt,function(t){return 0===Number(t+0+t)});if(Xt||Qt||te){var ee=Number,ne=/^0b[01]+$/i,re=/^0o[0-7]+$/i,oe=ne.test.bind(ne),ie=re.test.bind(re),ae=function(t){var e;if("function"==typeof t.valueOf&&(e=t.valueOf(),$.primitive(e)))return e;if("function"==typeof t.toString&&(e=t.toString(),$.primitive(e)))return e;throw new TypeError("No default value")},se=Rt.test.bind(Rt),le=It.test.bind(It),ue=function(){var t=function(e){var n;"string"==typeof(n=arguments.length>0?$.primitive(e)?e:ae(e):0)&&(n=Q.Call(_t,n),oe(n)?n=parseInt(A(n,2),2):ie(n)?n=parseInt(A(n,2),8):(se(n)||le(n))&&(n=NaN));var r=this,o=a(function(){return ee.prototype.valueOf.call(r),!0});return r instanceof t&&!o?new ee(n):ee(n)};return t}();mt(ee,ue,{}),m(ue,{NaN:ee.NaN,MAX_VALUE:ee.MAX_VALUE,MIN_VALUE:ee.MIN_VALUE,NEGATIVE_INFINITY:ee.NEGATIVE_INFINITY,POSITIVE_INFINITY:ee.POSITIVE_INFINITY}),Number=ue,y.redefine(x,"Number",ue)}var ce=Math.pow(2,53)-1;m(Number,{MAX_SAFE_INTEGER:ce,MIN_SAFE_INTEGER:-ce,EPSILON:2.220446049250313e-16,parseInt:x.parseInt,parseFloat:x.parseFloat,isFinite:H,isInteger:function(t){return H(t)&&Q.ToInteger(t)===t},isSafeInteger:function(t){return Number.isInteger(t)&&I(t)<=Number.MAX_SAFE_INTEGER},isNaN:U}),h(Number,"parseInt",x.parseInt,Number.parseInt!==x.parseInt),[,1].find(function(t,e){return 0===e})||Y(Array.prototype,"find",Lt.find),0!==[,1].findIndex(function(t,e){return 0===e})&&Y(Array.prototype,"findIndex",Lt.findIndex);var pe=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),de=function(t,e){l&&pe(t,e)&&Object.defineProperty(t,e,{enumerable:!1})},fe=function(){for(var t=Number(this),e=arguments.length,n=e-t,r=new Array(n<0?0:n),o=t;o<e;++o)r[o-t]=arguments[o];return r},he=function(t){return function(e,n){return e[n]=t[n],e}},me=function(t,e){var n,r=o(Object(e));return Q.IsCallable(Object.getOwnPropertySymbols)&&(n=d(Object.getOwnPropertySymbols(Object(e)),pe(e))),p(E(r,n||[]),he(e),t)},ge={assign:function(t,e){var n=Q.ToObject(t,"Cannot convert undefined or null to object");return p(Q.Call(fe,1,arguments),me,n)},is:function(t,e){return Q.SameValue(t,e)}};if(Object.assign&&Object.preventExtensions&&function(){var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}}()&&Y(Object,"assign",ge.assign),m(Object,ge),l){var be={setPrototypeOf:function(t,e){var r,o=function(t,e){if(!Q.TypeIsObject(t))throw new TypeError("cannot set prototype on a non-object");if(null!==e&&!Q.TypeIsObject(e))throw new TypeError("can only set prototype to an object or null"+e)},i=function(t,e){return o(t,e),n(r,t,e),t};try{r=t.getOwnPropertyDescriptor(t.prototype,"__proto__").set,n(r,{},null)}catch(e){if(t.prototype!=={}.__proto__)return;r=function(t){this.__proto__=t},i.polyfill=i(i({},null),t.prototype)instanceof t}return i}(Object)};m(Object,be)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&function(){var t=Object.create(null),e=Object.getPrototypeOf,n=Object.setPrototypeOf;Object.getPrototypeOf=function(n){var r=e(n);return r===t?null:r},Object.setPrototypeOf=function(e,r){return n(e,null===r?t:r)},Object.setPrototypeOf.polyfill=!1}(),!!i(function(){Object.keys("foo")})){var ye=Object.keys;Y(Object,"keys",function(t){return ye(Q.ToObject(t))}),o=Object.keys}if(i(function(){Object.keys(/a/g)})){var ve=Object.keys;Y(Object,"keys",function(t){if($.regex(t)){var e=[];for(var n in t)D(t,n)&&P(e,n);return e}return ve(t)}),o=Object.keys}if(Object.getOwnPropertyNames){if(!!i(function(){Object.getOwnPropertyNames("foo")})){var we="object"==typeof window?Object.getOwnPropertyNames(window):[],xe=Object.getOwnPropertyNames;Y(Object,"getOwnPropertyNames",function(t){var e=Q.ToObject(t);if("[object Window]"===g(e))try{return xe(e)}catch(t){return E([],we)}return xe(e)})}}if(Object.getOwnPropertyDescriptor){if(!!i(function(){Object.getOwnPropertyDescriptor("foo","bar")})){var Oe=Object.getOwnPropertyDescriptor;Y(Object,"getOwnPropertyDescriptor",function(t,e){return Oe(Q.ToObject(t),e)})}}if(Object.seal){if(!!i(function(){Object.seal("foo")})){var Se=Object.seal;Y(Object,"seal",function(t){return Q.TypeIsObject(t)?Se(t):t})}}if(Object.isSealed){if(!!i(function(){Object.isSealed("foo")})){var Te=Object.isSealed;Y(Object,"isSealed",function(t){return!Q.TypeIsObject(t)||Te(t)})}}if(Object.freeze){if(!!i(function(){Object.freeze("foo")})){var Ee=Object.freeze;Y(Object,"freeze",function(t){return Q.TypeIsObject(t)?Ee(t):t})}}if(Object.isFrozen){if(!!i(function(){Object.isFrozen("foo")})){var Ae=Object.isFrozen;Y(Object,"isFrozen",function(t){return!Q.TypeIsObject(t)||Ae(t)})}}if(Object.preventExtensions){if(!!i(function(){Object.preventExtensions("foo")})){var Pe=Object.preventExtensions;Y(Object,"preventExtensions",function(t){return Q.TypeIsObject(t)?Pe(t):t})}}if(Object.isExtensible){if(!!i(function(){Object.isExtensible("foo")})){var Ce=Object.isExtensible;Y(Object,"isExtensible",function(t){return!!Q.TypeIsObject(t)&&Ce(t)})}}if(Object.getPrototypeOf){if(!!i(function(){Object.getPrototypeOf("foo")})){var je=Object.getPrototypeOf;Y(Object,"getPrototypeOf",function(t){return je(Q.ToObject(t))})}}var _e=l&&function(){var t=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return t&&Q.IsCallable(t.get)}();if(l&&!_e){var Ne=function(){if(!Q.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var t="";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.unicode&&(t+="u"),this.sticky&&(t+="y"),t};y.getter(RegExp.prototype,"flags",Ne)}var Re=l&&a(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),Ie=K&&l&&function(){var t=/./;return t[F.match]=!1,RegExp(t)===t}(),Me=a(function(){return"/abc/"===RegExp.prototype.toString.call({
source:"abc"})}),Be=Me&&a(function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})});if(!Me||!Be){var ke=RegExp.prototype.toString;h(RegExp.prototype,"toString",function(){var t=Q.RequireObjectCoercible(this);return $.regex(t)?n(ke,t):"/"+X(t.source)+"/"+X(t.flags)},!0),y.preserveToString(RegExp.prototype.toString,ke)}if(l&&(!Re||Ie)){var De=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,Le=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},Fe=function(){return this.source},Ge=Q.IsCallable(Le.get)?Le.get:Fe,Ue=RegExp,He=function(){return function t(e,n){var r=Q.IsRegExp(e);if(!(this instanceof t)&&r&&void 0===n&&e.constructor===t)return e;var o=e,i=n;return $.regex(e)?(o=Q.Call(Ge,e),i=void 0===n?Q.Call(De,e):n,new t(o,i)):(r&&(o=e.source,i=void 0===n?e.flags:n),new Ue(e,n))}}();mt(Ue,He,{$input:!0}),RegExp=He,y.redefine(x,"RegExp",He)}if(l){var ze={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};c(o(ze),function(t){t in RegExp&&!(ze[t]in RegExp)&&y.getter(RegExp,ze[t],function(){return RegExp[t]})})}bt(RegExp);var Ve=1/Number.EPSILON,We=function(t){return t+Ve-Ve},qe=Math.pow(2,-23),$e=Math.pow(2,127)*(2-qe),Ye=Math.pow(2,-126),Ke=Math.E,Ze=Math.LOG2E,Je=Math.LOG10E,Xe=Number.prototype.clz;delete Number.prototype.clz;var Qe={acosh:function(t){var e=Number(t);return U(e)||t<1?NaN:1===e?0:e===1/0?e:B(e/Ke+k(e+1)*k(e-1)/Ke)+1},asinh:function t(e){var n=Number(e);return 0!==n&&O(n)?n<0?-t(-n):B(n+k(n*n+1)):n},atanh:function(t){var e=Number(t);return U(e)||e<-1||e>1?NaN:-1===e?-1/0:1===e?1/0:0===e?e:.5*B((1+e)/(1-e))},cbrt:function(t){var e=Number(t);if(0===e)return e;var n,r=e<0;return r&&(e=-e),e===1/0?n=1/0:(n=M(B(e)/3),n=(e/(n*n)+2*n)/3),r?-n:n},clz32:function(t){var e=Number(t),n=Q.ToUint32(e);return 0===n?32:Xe?Q.Call(Xe,n):31-R(B(n+.5)*Ze)},cosh:function(t){var e=Number(t);return 0===e?1:U(e)?NaN:O(e)?(e<0&&(e=-e),e>21?M(e)/2:(M(e)+M(-e))/2):1/0},expm1:function(t){var e=Number(t);if(e===-1/0)return-1;if(!O(e)||0===e)return e;if(I(e)>.5)return M(e)-1;for(var n=e,r=0,o=1;r+n!==r;)r+=n,o+=1,n*=e/o;return r},hypot:function(t,e){for(var n=0,r=0,o=0;o<arguments.length;++o){var i=I(Number(arguments[o]));r<i?(n*=r/i*(r/i),n+=1,r=i):n+=i>0?i/r*(i/r):i}return r===1/0?1/0:r*k(n)},log2:function(t){return B(t)*Ze},log10:function(t){return B(t)*Je},log1p:function(t){var e=Number(t);return e<-1||U(e)?NaN:0===e||e===1/0?e:-1===e?-1/0:1+e-1==0?e:e*(B(1+e)/(1+e-1))},sign:z,sinh:function(t){var e=Number(t);return O(e)&&0!==e?I(e)<1?(Math.expm1(e)-Math.expm1(-e))/2:(M(e-1)-M(-e-1))*Ke/2:e},tanh:function(t){var e=Number(t);return U(e)||0===e?e:e>=20?1:e<=-20?-1:(Math.expm1(e)-Math.expm1(-e))/(M(e)+M(-e))},trunc:function(t){var e=Number(t);return e<0?-R(-e):R(e)},imul:function(t,e){var n=Q.ToUint32(t),r=Q.ToUint32(e),o=n>>>16&65535,i=65535&n,a=r>>>16&65535,s=65535&r;return i*s+(o*s+i*a<<16>>>0)|0},fround:function(t){var e=Number(t);if(0===e||e===1/0||e===-1/0||U(e))return e;var n=z(e),r=I(e);if(r<Ye)return n*We(r/Ye/qe)*Ye*qe;var o=(1+qe/Number.EPSILON)*r,i=o-(o-r);return i>$e||U(i)?n*(1/0):n*i}};m(Math,Qe),h(Math,"log1p",Qe.log1p,-1e-17!==Math.log1p(-1e-17)),h(Math,"asinh",Qe.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),h(Math,"tanh",Qe.tanh,-2e-17!==Math.tanh(-2e-17)),h(Math,"acosh",Qe.acosh,Math.acosh(Number.MAX_VALUE)===1/0),h(Math,"cbrt",Qe.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8),h(Math,"sinh",Qe.sinh,-2e-17!==Math.sinh(-2e-17));var tn=Math.expm1(10);h(Math,"expm1",Qe.expm1,tn>22025.465794806718||tn<22025.465794806718);var en=Math.round,nn=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),rn=Ve+1,on=2*Ve-1,an=[rn,on].every(function(t){return Math.round(t)===t});h(Math,"round",function(t){var e=R(t),n=-1===e?-0:e+1;return t-e<.5?e:n},!nn||!an),y.preserveToString(Math.round,en);var sn=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=Qe.imul,y.preserveToString(Math.imul,sn)),2!==Math.imul.length&&Y(Math,"imul",function(t,e){return Q.Call(sn,Math,arguments)});var ln=function(){var t=x.setTimeout;if("function"==typeof t||"object"==typeof t){Q.IsPromise=function(t){return!!Q.TypeIsObject(t)&&void 0!==t._promise};var e,r=function(t){if(!Q.IsConstructor(t))throw new TypeError("Bad promise constructor");var e=this,n=function(t,n){if(void 0!==e.resolve||void 0!==e.reject)throw new TypeError("Bad Promise implementation!");e.resolve=t,e.reject=n};if(e.resolve=void 0,e.reject=void 0,e.promise=new t(n),!Q.IsCallable(e.resolve)||!Q.IsCallable(e.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&Q.IsCallable(window.postMessage)&&(e=function(){var t=[],e=function(e){P(t,e),window.postMessage("zero-timeout-message","*")},n=function(e){if(e.source===window&&"zero-timeout-message"===e.data){if(e.stopPropagation(),0===t.length)return;j(t)()}};return window.addEventListener("message",n,!0),e});var o,i,a=Q.IsCallable(x.setImmediate)?x.setImmediate:"object"==typeof process&&process.nextTick?process.nextTick:function(){var t=x.Promise,e=t&&t.resolve&&t.resolve();return e&&function(t){return e.then(t)}}()||(Q.IsCallable(e)?e():function(e){t(e,0)}),s=function(t){return t},l=function(t){throw t},u={},c=function(t,e,n){a(function(){p(t,e,n)})},p=function(t,e,n){var r,o;if(e===u)return t(n);try{r=t(n),o=e.resolve}catch(t){r=t,o=e.reject}o(r)},d=function(t,e){var n=t._promise,r=n.reactionLength;if(r>0&&(c(n.fulfillReactionHandler0,n.reactionCapability0,e),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var o=1,i=0;o<r;o++,i+=3)c(n[i+0],n[i+2],e),t[i+0]=void 0,t[i+1]=void 0,t[i+2]=void 0;n.result=e,n.state=1,n.reactionLength=0},f=function(t,e){var n=t._promise,r=n.reactionLength;if(r>0&&(c(n.rejectReactionHandler0,n.reactionCapability0,e),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var o=1,i=0;o<r;o++,i+=3)c(n[i+1],n[i+2],e),t[i+0]=void 0,t[i+1]=void 0,t[i+2]=void 0;n.result=e,n.state=2,n.reactionLength=0},h=function(t){var e=!1;return{resolve:function(n){var r;if(!e){if(e=!0,n===t)return f(t,new TypeError("Self resolution"));if(!Q.TypeIsObject(n))return d(t,n);try{r=n.then}catch(e){return f(t,e)}if(!Q.IsCallable(r))return d(t,n);a(function(){b(t,n,r)})}},reject:function(n){if(!e)return e=!0,f(t,n)}}},g=function(t,e,r,o){t===i?n(t,e,r,o,u):n(t,e,r,o)},b=function(t,e,n){var r=h(t),o=r.resolve,i=r.reject;try{g(n,e,o,i)}catch(t){i(t)}},y=function(){var t=function(e){if(!(this instanceof t))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!Q.IsCallable(e))throw new TypeError("not a valid resolver");var n=xt(this,t,o,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),r=h(n),i=r.reject;try{e(r.resolve,i)}catch(t){i(t)}return n};return t}();o=y.prototype;var v=function(t,e,n,r){var o=!1;return function(i){if(!o&&(o=!0,e[t]=i,0==--r.count)){(0,n.resolve)(e)}}},w=function(t,e,n){for(var r,o,i=t.iterator,a=[],s={count:1},l=0;;){try{if(!1===(r=Q.IteratorStep(i))){t.done=!0;break}o=r.value}catch(e){throw t.done=!0,e}a[l]=void 0;var u=e.resolve(o),c=v(l,a,n,s);s.count+=1,g(u.then,u,c,n.reject),l+=1}if(0==--s.count){(0,n.resolve)(a)}return n.promise},O=function(t,e,n){for(var r,o,i,a=t.iterator;;){try{if(!1===(r=Q.IteratorStep(a))){t.done=!0;break}o=r.value}catch(e){throw t.done=!0,e}i=e.resolve(o),g(i.then,i,n.resolve,n.reject)}return n.promise};return m(y,{all:function(t){var e=this;if(!Q.TypeIsObject(e))throw new TypeError("Promise is not object");var n,o,i=new r(e);try{return n=Q.GetIterator(t),o={iterator:n,done:!1},w(o,e,i)}catch(t){var a=t;if(o&&!o.done)try{Q.IteratorClose(n,!0)}catch(t){a=t}var s=i.reject;return s(a),i.promise}},race:function(t){var e=this;if(!Q.TypeIsObject(e))throw new TypeError("Promise is not object");var n,o,i=new r(e);try{return n=Q.GetIterator(t),o={iterator:n,done:!1},O(o,e,i)}catch(t){var a=t;if(o&&!o.done)try{Q.IteratorClose(n,!0)}catch(t){a=t}var s=i.reject;return s(a),i.promise}},reject:function(t){var e=this;if(!Q.TypeIsObject(e))throw new TypeError("Bad promise constructor");var n=new r(e);return(0,n.reject)(t),n.promise},resolve:function(t){var e=this;if(!Q.TypeIsObject(e))throw new TypeError("Bad promise constructor");if(Q.IsPromise(t)){var n=t.constructor;if(n===e)return t}var o=new r(e);return(0,o.resolve)(t),o.promise}}),m(o,{catch:function(t){return this.then(null,t)},then:function(t,e){var n=this;if(!Q.IsPromise(n))throw new TypeError("not a promise");var o,i=Q.SpeciesConstructor(n,y);o=arguments.length>2&&arguments[2]===u&&i===y?u:new r(i);var a,p=Q.IsCallable(t)?t:s,d=Q.IsCallable(e)?e:l,f=n._promise;if(0===f.state){if(0===f.reactionLength)f.fulfillReactionHandler0=p,f.rejectReactionHandler0=d,f.reactionCapability0=o;else{var h=3*(f.reactionLength-1);f[h+0]=p,f[h+1]=d,f[h+2]=o}f.reactionLength+=1}else if(1===f.state)a=f.result,c(p,o,a);else{if(2!==f.state)throw new TypeError("unexpected Promise state");a=f.result,c(d,o,a)}return o.promise}}),u=new r(y),i=o.then,y}}();if(x.Promise&&(delete x.Promise.accept,delete x.Promise.defer,delete x.Promise.prototype.chain),"function"==typeof ln){m(x,{Promise:ln});var un=w(x.Promise,function(t){return t.resolve(42).then(function(){})instanceof t}),cn=!i(function(){x.Promise.reject(42).then(null,5).then(null,L)}),pn=i(function(){x.Promise.call(3,L)}),dn=function(t){var e=t.resolve(5);e.constructor={};var n=t.resolve(e);try{n.then(null,L).then(null,L)}catch(t){return!0}return e===n}(x.Promise),fn=l&&function(){var t=0,e=Object.defineProperty({},"then",{get:function(){t+=1}});return Promise.resolve(e),1===t}(),hn=function t(e){var n=new Promise(e);e(3,function(){}),this.then=n.then,this.constructor=t};hn.prototype=Promise.prototype,hn.all=Promise.all;var mn=a(function(){return!!hn.all([1,2])});if(un&&cn&&pn&&!dn&&fn&&!mn||(Promise=ln,Y(x,"Promise",ln)),1!==Promise.all.length){var gn=Promise.all;Y(Promise,"all",function(t){return Q.Call(gn,this,arguments)})}if(1!==Promise.race.length){var bn=Promise.race;Y(Promise,"race",function(t){return Q.Call(bn,this,arguments)})}if(1!==Promise.resolve.length){var yn=Promise.resolve;Y(Promise,"resolve",function(t){return Q.Call(yn,this,arguments)})}if(1!==Promise.reject.length){var vn=Promise.reject;Y(Promise,"reject",function(t){return Q.Call(vn,this,arguments)})}de(Promise,"all"),de(Promise,"race"),de(Promise,"resolve"),de(Promise,"reject"),bt(Promise)}var wn=function(t){var e=o(p(t,function(t,e){return t[e]=!0,t},{}));return t.join(":")===e.join(":")},xn=wn(["z","a","bb"]),On=wn(["z",1,"a","3",2]);if(l){var Sn=function(t){return xn?void 0===t||null===t?"^"+Q.ToString(t):"string"==typeof t?"$"+t:"number"==typeof t?On?t:"n"+t:"boolean"==typeof t?"b"+t:null:null},Tn=function(){return Object.create?Object.create(null):{}},En=function(t,e,o){if(r(o)||$.string(o))c(o,function(t){if(!Q.TypeIsObject(t))throw new TypeError("Iterator value "+t+" is not an entry object");e.set(t[0],t[1])});else if(o instanceof t)n(t.prototype.forEach,o,function(t,n){e.set(n,t)});else{var i,a;if(null!==o&&void 0!==o){if(a=e.set,!Q.IsCallable(a))throw new TypeError("bad map");i=Q.GetIterator(o)}if(void 0!==i)for(;;){var s=Q.IteratorStep(i);if(!1===s)break;var l=s.value;try{if(!Q.TypeIsObject(l))throw new TypeError("Iterator value "+l+" is not an entry object");n(a,e,l[0],l[1])}catch(t){throw Q.IteratorClose(i,!0),t}}}},An=function(t,e,o){if(r(o)||$.string(o))c(o,function(t){e.add(t)});else if(o instanceof t)n(t.prototype.forEach,o,function(t){e.add(t)});else{var i,a;if(null!==o&&void 0!==o){if(a=e.add,!Q.IsCallable(a))throw new TypeError("bad set");i=Q.GetIterator(o)}if(void 0!==i)for(;;){var s=Q.IteratorStep(i);if(!1===s)break;var l=s.value;try{n(a,e,l)}catch(t){throw Q.IteratorClose(i,!0),t}}}},Pn={Map:function(){var t={},e=function(t,e){this.key=t,this.value=e,this.next=null,this.prev=null};e.prototype.isRemoved=function(){return this.key===t};var r=function(t){return!!t._es6map},o=function(t,e){if(!Q.TypeIsObject(t)||!r(t))throw new TypeError("Method Map.prototype."+e+" called on incompatible receiver "+Q.ToString(t))},i=function(t,e){o(t,"[[MapIterator]]"),this.head=t._head,this.i=this.head,this.kind=e};i.prototype={next:function(){var t=this.i,e=this.kind,n=this.head;if(void 0===this.i)return Bt();for(;t.isRemoved()&&t!==n;)t=t.prev;for(var r;t.next!==n;)if(t=t.next,!t.isRemoved())return r="key"===e?t.key:"value"===e?t.value:[t.key,t.value],this.i=t,Bt(r);return this.i=void 0,Bt()}},yt(i.prototype);var a,s=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var n=xt(this,t,a,{_es6map:!0,_head:null,_storage:Tn(),_size:0}),r=new e(null,null);return r.next=r.prev=r,n._head=r,arguments.length>0&&En(t,n,arguments[0]),n};return a=s.prototype,y.getter(a,"size",function(){if(void 0===this._size)throw new TypeError("size method called on incompatible Map");return this._size}),m(a,{get:function(t){o(this,"get");var e=Sn(t);if(null!==e){var n=this._storage[e];return n?n.value:void 0}for(var r=this._head,i=r;(i=i.next)!==r;)if(Q.SameValueZero(i.key,t))return i.value},has:function(t){o(this,"has");var e=Sn(t);if(null!==e)return void 0!==this._storage[e];for(var n=this._head,r=n;(r=r.next)!==n;)if(Q.SameValueZero(r.key,t))return!0;return!1},set:function(t,n){o(this,"set");var r,i=this._head,a=i,s=Sn(t);if(null!==s){if(void 0!==this._storage[s])return this._storage[s].value=n,this;r=this._storage[s]=new e(t,n),a=i.prev}for(;(a=a.next)!==i;)if(Q.SameValueZero(a.key,t))return a.value=n,this;return r=r||new e(t,n),Q.SameValue(-0,t)&&(r.key=0),r.next=this._head,r.prev=this._head.prev,r.prev.next=r,r.next.prev=r,this._size+=1,this},delete:function(e){o(this,"delete");var n=this._head,r=n,i=Sn(e);if(null!==i){if(void 0===this._storage[i])return!1;r=this._storage[i].prev,delete this._storage[i]}for(;(r=r.next)!==n;)if(Q.SameValueZero(r.key,e))return r.key=r.value=t,r.prev.next=r.next,r.next.prev=r.prev,this._size-=1,!0;return!1},clear:function(){o(this,"clear"),this._size=0,this._storage=Tn();for(var e=this._head,n=e,r=n.next;(n=r)!==e;)n.key=n.value=t,r=n.next,n.next=n.prev=e;e.next=e.prev=e},keys:function(){return o(this,"keys"),new i(this,"key")},values:function(){return o(this,"values"),new i(this,"value")},entries:function(){return o(this,"entries"),new i(this,"key+value")},forEach:function(t){o(this,"forEach");for(var e=arguments.length>1?arguments[1]:null,r=this.entries(),i=r.next();!i.done;i=r.next())e?n(t,e,i.value[1],i.value[0],this):t(i.value[1],i.value[0],this)}}),yt(a,a.entries),s}(),Set:function(){var t,e=function(t){return t._es6set&&void 0!==t._storage},r=function(t,n){if(!Q.TypeIsObject(t)||!e(t))throw new TypeError("Set.prototype."+n+" called on incompatible receiver "+Q.ToString(t))},i=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var n=xt(this,e,t,{_es6set:!0,"[[SetData]]":null,_storage:Tn()});if(!n._es6set)throw new TypeError("bad set");return arguments.length>0&&An(e,n,arguments[0]),n};t=i.prototype;var a=function(t){var e=t;if("^null"===e)return null;if("^undefined"!==e){var n=e.charAt(0);return"$"===n?A(e,1):"n"===n?+A(e,1):"b"===n?"btrue"===e:+e}},s=function(t){if(!t["[[SetData]]"]){var e=t["[[SetData]]"]=new Pn.Map;c(o(t._storage),function(t){var n=a(t);e.set(n,n)}),t["[[SetData]]"]=e}t._storage=null};return y.getter(i.prototype,"size",function(){return r(this,"size"),this._storage?o(this._storage).length:(s(this),this["[[SetData]]"].size)}),m(i.prototype,{has:function(t){r(this,"has");var e;return this._storage&&null!==(e=Sn(t))?!!this._storage[e]:(s(this),this["[[SetData]]"].has(t))},add:function(t){r(this,"add");var e;return this._storage&&null!==(e=Sn(t))?(this._storage[e]=!0,this):(s(this),this["[[SetData]]"].set(t,t),this)},delete:function(t){r(this,"delete");var e;if(this._storage&&null!==(e=Sn(t))){var n=D(this._storage,e);return delete this._storage[e]&&n}return s(this),this["[[SetData]]"].delete(t)},clear:function(){r(this,"clear"),this._storage&&(this._storage=Tn()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return r(this,"values"),s(this),this["[[SetData]]"].values()},entries:function(){return r(this,"entries"),s(this),this["[[SetData]]"].entries()},forEach:function(t){r(this,"forEach");var e=arguments.length>1?arguments[1]:null,o=this;s(o),this["[[SetData]]"].forEach(function(r,i){e?n(t,e,i,i,o):t(i,i,o)})}}),h(i.prototype,"keys",i.prototype.values,!0),yt(i.prototype,i.prototype.values),i}()};if(x.Map||x.Set){if(!a(function(){return 2===new Map([[1,2]]).get(1)})){var Cn=x.Map;x.Map=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');var e=new Cn;return arguments.length>0&&En(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,x.Map.prototype),e},x.Map.prototype=v(Cn.prototype),h(x.Map.prototype,"constructor",x.Map,!0),y.preserveToString(x.Map,Cn)}var jn=new Map,_n=function(){var t=new Map([[1,0],[2,0],[3,0],[4,0]]);return t.set(-0,t),t.get(0)===t&&t.get(-0)===t&&t.has(0)&&t.has(-0)}(),Nn=jn.set(1,2)===jn;if(!_n||!Nn){var Rn=Map.prototype.set;Y(Map.prototype,"set",function(t,e){return n(Rn,this,0===t?0:t,e),this})}if(!_n){var In=Map.prototype.get,Mn=Map.prototype.has;m(Map.prototype,{get:function(t){return n(In,this,0===t?0:t)},has:function(t){return n(Mn,this,0===t?0:t)}},!0),y.preserveToString(Map.prototype.get,In),y.preserveToString(Map.prototype.has,Mn)}var Bn=new Set,kn=function(t){return t.delete(0),t.add(-0),!t.has(0)}(Bn),Dn=Bn.add(1)===Bn;if(!kn||!Dn){var Ln=Set.prototype.add;Set.prototype.add=function(t){return n(Ln,this,0===t?0:t),this},y.preserveToString(Set.prototype.add,Ln)}if(!kn){var Fn=Set.prototype.has;Set.prototype.has=function(t){return n(Fn,this,0===t?0:t)},y.preserveToString(Set.prototype.has,Fn);var Gn=Set.prototype.delete;Set.prototype.delete=function(t){return n(Gn,this,0===t?0:t)},y.preserveToString(Set.prototype.delete,Gn)}var Un=w(x.Map,function(t){var e=new t([]);return e.set(42,42),e instanceof t}),Hn=Object.setPrototypeOf&&!Un,zn=function(){try{return!(x.Map()instanceof x.Map)}catch(t){return t instanceof TypeError}}();if(0!==x.Map.length||Hn||!zn){var Vn=x.Map;x.Map=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');var e=new Vn;return arguments.length>0&&En(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.prototype),e},x.Map.prototype=Vn.prototype,h(x.Map.prototype,"constructor",x.Map,!0),y.preserveToString(x.Map,Vn)}var Wn=w(x.Set,function(t){var e=new t([]);return e.add(42,42),e instanceof t}),qn=Object.setPrototypeOf&&!Wn,$n=function(){try{return!(x.Set()instanceof x.Set)}catch(t){return t instanceof TypeError}}();if(0!==x.Set.length||qn||!$n){var Yn=x.Set;x.Set=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');var e=new Yn;return arguments.length>0&&An(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.prototype),e},x.Set.prototype=Yn.prototype,h(x.Set.prototype,"constructor",x.Set,!0),y.preserveToString(x.Set,Yn)}var Kn=new x.Map,Zn=!a(function(){return Kn.keys().next().done});if(("function"!=typeof x.Map.prototype.clear||0!==(new x.Set).size||0!==Kn.size||"function"!=typeof x.Map.prototype.keys||"function"!=typeof x.Set.prototype.keys||"function"!=typeof x.Map.prototype.forEach||"function"!=typeof x.Set.prototype.forEach||s(x.Map)||s(x.Set)||"function"!=typeof Kn.keys().next||Zn||!Un)&&m(x,{Map:Pn.Map,Set:Pn.Set},!0),x.Set.prototype.keys!==x.Set.prototype.values&&h(x.Set.prototype,"keys",x.Set.prototype.values,!0),yt(Object.getPrototypeOf((new x.Map).keys())),yt(Object.getPrototypeOf((new x.Set).keys())),u&&"has"!==x.Set.prototype.has.name){var Jn=x.Set.prototype.has;Y(x.Set.prototype,"has",function(t){return n(Jn,this,t)})}}m(x,Pn),bt(x.Map),bt(x.Set)}var Xn=function(t){if(!Q.TypeIsObject(t))throw new TypeError("target must be an object")},Qn={apply:function(){return Q.Call(Q.Call,null,arguments)},construct:function(t,e){if(!Q.IsConstructor(t))throw new TypeError("First argument must be a constructor.");var n=arguments.length>2?arguments[2]:t;if(!Q.IsConstructor(n))throw new TypeError("new.target must be a constructor.");return Q.Construct(t,e,n,"internal")},deleteProperty:function(t,e){if(Xn(t),l){var n=Object.getOwnPropertyDescriptor(t,e);if(n&&!n.configurable)return!1}return delete t[e]},has:function(t,e){return Xn(t),e in t}};Object.getOwnPropertyNames&&Object.assign(Qn,{ownKeys:function(t){Xn(t);var e=Object.getOwnPropertyNames(t);return Q.IsCallable(Object.getOwnPropertySymbols)&&C(e,Object.getOwnPropertySymbols(t)),e}});var tr=function(t){return!i(t)};if(Object.preventExtensions&&Object.assign(Qn,{isExtensible:function(t){return Xn(t),Object.isExtensible(t)},preventExtensions:function(t){return Xn(t),tr(function(){Object.preventExtensions(t)})}}),l){var er=function(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(!r){var o=Object.getPrototypeOf(t);if(null===o)return;return er(o,e,n)}return"value"in r?r.value:r.get?Q.Call(r.get,n):void 0},nr=function(t,e,r,o){var i=Object.getOwnPropertyDescriptor(t,e);if(!i){var a=Object.getPrototypeOf(t);if(null!==a)return nr(a,e,r,o);i={value:void 0,writable:!0,enumerable:!0,configurable:!0}}if("value"in i){if(!i.writable)return!1;if(!Q.TypeIsObject(o))return!1;return Object.getOwnPropertyDescriptor(o,e)?J.defineProperty(o,e,{value:r}):J.defineProperty(o,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}return!!i.set&&(n(i.set,o,r),!0)};Object.assign(Qn,{defineProperty:function(t,e,n){return Xn(t),tr(function(){Object.defineProperty(t,e,n)})},getOwnPropertyDescriptor:function(t,e){return Xn(t),Object.getOwnPropertyDescriptor(t,e)},get:function(t,e){Xn(t);var n=arguments.length>2?arguments[2]:t;return er(t,e,n)},set:function(t,e,n){Xn(t);var r=arguments.length>3?arguments[3]:t;return nr(t,e,n,r)}})}if(Object.getPrototypeOf){var rr=Object.getPrototypeOf;Qn.getPrototypeOf=function(t){return Xn(t),rr(t)}}if(Object.setPrototypeOf&&Qn.getPrototypeOf){var or=function(t,e){for(var n=e;n;){if(t===n)return!0;n=Qn.getPrototypeOf(n)}return!1};Object.assign(Qn,{setPrototypeOf:function(t,e){if(Xn(t),null!==e&&!Q.TypeIsObject(e))throw new TypeError("proto must be an object or null");return e===J.getPrototypeOf(t)||!(J.isExtensible&&!J.isExtensible(t))&&(!or(t,e)&&(Object.setPrototypeOf(t,e),!0))}})}var ir=function(t,e){if(Q.IsCallable(x.Reflect[t])){a(function(){return x.Reflect[t](1),x.Reflect[t](NaN),x.Reflect[t](!0),!0})&&Y(x.Reflect,t,e)}else h(x.Reflect,t,e)};Object.keys(Qn).forEach(function(t){ir(t,Qn[t])});var ar=x.Reflect.getPrototypeOf;if(u&&ar&&"getPrototypeOf"!==ar.name&&Y(x.Reflect,"getPrototypeOf",function(t){return n(ar,x.Reflect,t)}),x.Reflect.setPrototypeOf&&a(function(){return x.Reflect.setPrototypeOf(1,{}),!0})&&Y(x.Reflect,"setPrototypeOf",Qn.setPrototypeOf),x.Reflect.defineProperty&&(a(function(){var t=!x.Reflect.defineProperty(1,"test",{value:1}),e="function"!=typeof Object.preventExtensions||!x.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return t&&e})||Y(x.Reflect,"defineProperty",Qn.defineProperty)),x.Reflect.construct&&(a(function(){var t=function(){};return x.Reflect.construct(function(){},[],t)instanceof t})||Y(x.Reflect,"construct",Qn.construct)),"Invalid Date"!==String(new Date(NaN))){var sr=Date.prototype.toString,lr=function(){var t=+this;return t!==t?"Invalid Date":Q.Call(sr,this)};Y(Date.prototype,"toString",lr)}var ur={anchor:function(t){return Q.CreateHTML(this,"a","name",t)},big:function(){return Q.CreateHTML(this,"big","","")},blink:function(){return Q.CreateHTML(this,"blink","","")},bold:function(){return Q.CreateHTML(this,"b","","")},fixed:function(){return Q.CreateHTML(this,"tt","","")},fontcolor:function(t){return Q.CreateHTML(this,"font","color",t)},fontsize:function(t){return Q.CreateHTML(this,"font","size",t)},italics:function(){return Q.CreateHTML(this,"i","","")},link:function(t){return Q.CreateHTML(this,"a","href",t)},small:function(){return Q.CreateHTML(this,"small","","")},strike:function(){return Q.CreateHTML(this,"strike","","")},sub:function(){return Q.CreateHTML(this,"sub","","")},sup:function(){return Q.CreateHTML(this,"sup","","")}};c(Object.keys(ur),function(t){var e=String.prototype[t],r=!1;if(Q.IsCallable(e)){var o=n(e,"",' " '),i=E([],o.match(/"/g)).length;r=o!==o.toLowerCase()||i>2}else r=!0;r&&Y(String.prototype,t,ur[t])});var cr=function(){if(!K)return!1;var t="object"==typeof JSON&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!t)return!1;if(void 0!==t(F()))return!0;if("[null]"!==t([F()]))return!0;var e={a:F()};return e[F()]=!0,"{}"!==t(e)}(),pr=a(function(){return!K||"{}"===JSON.stringify(Object(F()))&&"[{}]"===JSON.stringify([Object(F())])});if(cr||!pr){var dr=JSON.stringify;Y(JSON,"stringify",function(t){if("symbol"!=typeof t){var e;arguments.length>1&&(e=arguments[1]);var o=[t];if(r(e))o.push(e);else{var i=Q.IsCallable(e)?e:null,a=function(t,e){var r=i?n(i,this,t,e):e;if("symbol"!=typeof r)return $.symbol(r)?he({})(r):r};o.push(a)}return arguments.length>2&&o.push(arguments[2]),dr.apply(this,o)}})}return x}),function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n||t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){"use strict";var r=t("./Array.prototype");e.exports={prototype:r,shim:function(){r.shim()}}},{"./Array.prototype":3}],2:[function(t,e,n){"use strict";e.exports=t("array-includes")},{"array-includes":14}],3:[function(t,e,n){"use strict";var r=t("./Array.prototype.includes");e.exports={includes:r,shim:function(){r.shim()}}},{"./Array.prototype.includes":2}],4:[function(t,e,n){"use strict";var r=t("object.getownpropertydescriptors"),o=t("object.entries"),i=t("object.values");e.exports={entries:o,getOwnPropertyDescriptors:r,shim:function(){r.shim(),o.shim(),i.shim()},values:i}},{"object.entries":38,"object.getownpropertydescriptors":64,"object.values":89}],5:[function(t,e,n){"use strict";var r=t("./String.prototype");e.exports={prototype:r,shim:function(){r.shim()}}},{"./String.prototype":7}],6:[function(t,e,n){"use strict";e.exports=t("string-at")},{"string-at":114}],7:[function(t,e,n){"use strict";var r=t("./String.prototype.at"),o=t("./String.prototype.padStart"),i=t("./String.prototype.padEnd"),a=t("./String.prototype.trimLeft"),s=t("./String.prototype.trimRight");e.exports={at:r,padStart:o,padEnd:i,trimLeft:a,trimRight:s,shim:function(){r.shim(),o.shim(),i.shim(),a.shim(),s.shim()}}},{"./String.prototype.at":6,"./String.prototype.padEnd":8,"./String.prototype.padStart":9,"./String.prototype.trimLeft":10,"./String.prototype.trimRight":11}],8:[function(t,e,n){"use strict";e.exports=t("string.prototype.padend")},{"string.prototype.padend":137}],9:[function(t,e,n){"use strict";e.exports=t("string.prototype.padstart")},{"string.prototype.padstart":162}],10:[function(t,e,n){"use strict";e.exports=t("string.prototype.trimleft")},{"string.prototype.trimleft":187}],11:[function(t,e,n){"use strict";e.exports=t("string.prototype.trimright")},{"string.prototype.trimright":197}],12:[function(t,e,n){"use strict";var r=t("./Array"),o=t("./Object"),i=t("./String");e.exports={Array:r,Object:o,String:i,shim:function(){r.shim(),o.shim(),i.shim()}}},{"./Array":1,"./Object":4,"./String":5}],13:[function(t,e,n){(function(n){"use strict";var r=t("es-abstract/es6"),o=Number.isNaN||function(t){return t!==t},i=Number.isFinite||function(t){return"number"==typeof t&&n.isFinite(t)},a=Array.prototype.indexOf;e.exports=function(t){var e=arguments.length>1?r.ToInteger(arguments[1]):0;if(a&&!o(t)&&i(e)&&void 0!==t)return a.apply(this,arguments)>-1;var n=r.ToObject(this),s=r.ToLength(n.length);if(0===s)return!1;for(var l=e>=0?e:Math.max(0,s+e);l<s;){if(r.SameValueZero(t,n[l]))return!0;l+=1}return!1}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es-abstract/es6":17}],14:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("es-abstract/es6"),i=t("./implementation"),a=t("./polyfill"),s=a(),l=t("./shim"),u=Array.prototype.slice,c=function(t,e){return o.RequireObjectCoercible(t),s.apply(t,u.call(arguments,1))};r(c,{implementation:i,getPolyfill:a,shim:l}),e.exports=c},{"./implementation":13,"./polyfill":35,"./shim":36,"define-properties":15,"es-abstract/es6":17}],15:[function(t,e,n){"use strict";var r=t("object-keys"),o=t("foreach"),i="function"==typeof Symbol&&"symbol"==typeof Symbol(),a=Object.prototype.toString,s=function(t){return"function"==typeof t&&"[object Function]"===a.call(t)},l=Object.defineProperty&&function(){var t={};try{Object.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(t){return!1}}(),u=function(t,e,n,r){(!(e in t)||s(r)&&r())&&(l?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},c=function(t,e){var n=arguments.length>2?arguments[2]:{},a=r(e);i&&(a=a.concat(Object.getOwnPropertySymbols(e))),o(a,function(r){u(t,r,e[r],n[r])})};c.supportsDescriptors=!!l,e.exports=c},{foreach:26,"object-keys":33}],16:[function(t,e,n){"use strict";var r=Number.isNaN||function(t){return t!==t},o=t("./helpers/isFinite"),i=t("./helpers/sign"),a=t("./helpers/mod"),s=t("is-callable"),l=t("es-to-primitive/es5"),u={ToPrimitive:l,ToBoolean:function(t){return Boolean(t)},ToNumber:function(t){return Number(t)},ToInteger:function(t){var e=this.ToNumber(t);return r(e)?0:0!==e&&o(e)?i(e)*Math.floor(Math.abs(e)):e},ToInt32:function(t){return this.ToNumber(t)>>0},ToUint32:function(t){return this.ToNumber(t)>>>0},ToUint16:function(t){var e=this.ToNumber(t);if(r(e)||0===e||!o(e))return 0;var n=i(e)*Math.floor(Math.abs(e));return a(n,65536)},ToString:function(t){return String(t)},ToObject:function(t){return this.CheckObjectCoercible(t),Object(t)},CheckObjectCoercible:function(t,e){if(null==t)throw new TypeError(e||"Cannot call method on "+t);return t},IsCallable:s,SameValue:function(t,e){return t===e?0!==t||1/t==1/e:r(t)&&r(e)}};e.exports=u},{"./helpers/isFinite":19,"./helpers/mod":21,"./helpers/sign":22,"es-to-primitive/es5":23,"is-callable":29}],17:[function(t,e,n){"use strict";var r=Object.prototype.toString,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,i=o?Symbol.prototype.toString:r,a=Number.isNaN||function(t){return t!==t},s=t("./helpers/isFinite"),l=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,u=t("./helpers/assign"),c=t("./helpers/sign"),p=t("./helpers/mod"),d=t("./helpers/isPrimitive"),f=t("es-to-primitive/es6"),h=parseInt,m=t("function-bind"),g=m.call(Function.call,String.prototype.slice),b=m.call(Function.call,RegExp.prototype.test,/^0b[01]+$/i),y=m.call(Function.call,RegExp.prototype.test,/^0o[0-7]+$/i),v=["","​","￾"].join(""),w=new RegExp("["+v+"]","g"),x=m.call(Function.call,RegExp.prototype.test,w),O=m.call(Function.call,RegExp.prototype.test,/^[\-\+]0x[0-9a-f]+$/i),S=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),T=new RegExp("(^["+S+"]+)|(["+S+"]+$)","g"),E=m.call(Function.call,String.prototype.replace),A=function(t){return E(t,T,"")},P=t("./es5"),C=t("is-regex"),j=u(u({},P),{Call:function(t,e){var n=arguments.length>2?arguments[2]:[];if(!this.IsCallable(t))throw new TypeError(t+" is not a function");return t.apply(e,n)},ToPrimitive:f,ToNumber:function(t){var e=d(t)?t:f(t,"number");if("symbol"==typeof e)throw new TypeError("Cannot convert a Symbol value to a number");if("string"==typeof e){if(b(e))return this.ToNumber(h(g(e,2),2))
;if(y(e))return this.ToNumber(h(g(e,2),8));if(x(e)||O(e))return NaN;var n=A(e);if(n!==e)return this.ToNumber(n)}return Number(e)},ToInt16:function(t){var e=this.ToUint16(t);return e>=32768?e-65536:e},ToInt8:function(t){var e=this.ToUint8(t);return e>=128?e-256:e},ToUint8:function(t){var e=this.ToNumber(t);if(a(e)||0===e||!s(e))return 0;var n=c(e)*Math.floor(Math.abs(e));return p(n,256)},ToUint8Clamp:function(t){var e=this.ToNumber(t);if(a(e)||e<=0)return 0;if(e>=255)return 255;var n=Math.floor(t);return n+.5<e?n+1:e<n+.5?n:n%2!=0?n+1:n},ToString:function(t){if("symbol"==typeof t)throw new TypeError("Cannot convert a Symbol value to a string");return String(t)},ToObject:function(t){return this.RequireObjectCoercible(t),Object(t)},ToPropertyKey:function(t){var e=this.ToPrimitive(t,String);return"symbol"==typeof e?i.call(e):this.ToString(e)},ToLength:function(t){var e=this.ToInteger(t);return e<=0?0:e>l?l:e},CanonicalNumericIndexString:function(t){if("[object String]"!==r.call(t))throw new TypeError("must be a string");if("-0"===t)return-0;var e=this.ToNumber(t);return this.SameValue(this.ToString(e),t)?e:void 0},RequireObjectCoercible:P.CheckObjectCoercible,IsArray:Array.isArray||function(t){return"[object Array]"===r.call(t)},IsConstructor:function(t){return this.IsCallable(t)},IsExtensible:function(t){return!Object.preventExtensions||!d(t)&&Object.isExtensible(t)},IsInteger:function(t){if("number"!=typeof t||a(t)||!s(t))return!1;var e=Math.abs(t);return Math.floor(e)===e},IsPropertyKey:function(t){return"string"==typeof t||"symbol"==typeof t},IsRegExp:function(t){if(!t||"object"!=typeof t)return!1;if(o){var e=RegExp[Symbol.match];if(void 0!==e)return P.ToBoolean(e)}return C(t)},SameValueZero:function(t,e){return t===e||a(t)&&a(e)}});delete j.CheckObjectCoercible,e.exports=j},{"./es5":16,"./helpers/assign":18,"./helpers/isFinite":19,"./helpers/isPrimitive":20,"./helpers/mod":21,"./helpers/sign":22,"es-to-primitive/es6":24,"function-bind":28,"is-regex":31}],18:[function(t,e,n){var r=Object.prototype.hasOwnProperty;e.exports=Object.assign||function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}},{}],19:[function(t,e,n){var r=Number.isNaN||function(t){return t!==t};e.exports=Number.isFinite||function(t){return"number"==typeof t&&!r(t)&&t!==1/0&&t!==-1/0}},{}],20:[function(t,e,n){e.exports=function(t){return null===t||"function"!=typeof t&&"object"!=typeof t}},{}],21:[function(t,e,n){e.exports=function(t,e){var n=t%e;return Math.floor(n>=0?n:n+e)}},{}],22:[function(t,e,n){e.exports=function(t){return t>=0?1:-1}},{}],23:[function(t,e,n){"use strict";var r=Object.prototype.toString,o=t("./helpers/isPrimitive"),i=t("is-callable"),a={"[[DefaultValue]]":function(t,e){var n=e||("[object Date]"===r.call(t)?String:Number);if(n===String||n===Number){var a,s,l=n===String?["toString","valueOf"]:["valueOf","toString"];for(s=0;s<l.length;++s)if(i(t[l[s]])&&(a=t[l[s]](),o(a)))return a;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")}};e.exports=function(t,e){return o(t)?t:a["[[DefaultValue]]"](t,e)}},{"./helpers/isPrimitive":25,"is-callable":29}],24:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,o=t("./helpers/isPrimitive"),i=t("is-callable"),a=t("is-date-object"),s=t("is-symbol"),l=function(t,e){if(void 0===t||null===t)throw new TypeError("Cannot call method on "+t);if("string"!=typeof e||"number"!==e&&"string"!==e)throw new TypeError('hint must be "string" or "number"');var n,r,a,s="string"===e?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(n=t[s[a]],i(n)&&(r=n.call(t),o(r)))return r;throw new TypeError("No default value")},u=function(t,e){var n=t[e];if(null!==n&&void 0!==n){if(!i(n))throw new TypeError(n+" returned for property "+e+" of object "+t+" is not a function");return n}};e.exports=function(t,e){if(o(t))return t;var n="default";arguments.length>1&&(e===String?n="string":e===Number&&(n="number"));var i;if(r&&(Symbol.toPrimitive?i=u(t,Symbol.toPrimitive):s(t)&&(i=Symbol.prototype.valueOf)),void 0!==i){var c=i.call(t,n);if(o(c))return c;throw new TypeError("unable to convert exotic object to primitive")}return"default"===n&&(a(t)||s(t))&&(n="string"),l(t,"default"===n?"number":n)}},{"./helpers/isPrimitive":25,"is-callable":29,"is-date-object":30,"is-symbol":32}],25:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],26:[function(t,e,n){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=function(t,e,n){if("[object Function]"!==o.call(e))throw new TypeError("iterator must be a function");var i=t.length;if(i===+i)for(var a=0;a<i;a++)e.call(n,t[a],a,t);else for(var s in t)r.call(t,s)&&e.call(n,t[s],s,t)}},{}],27:[function(t,e,n){var r=Array.prototype.slice,o=Object.prototype.toString;e.exports=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==o.call(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var n,i=r.call(arguments,1),a=function(){if(this instanceof n){var o=e.apply(this,i.concat(r.call(arguments)));return Object(o)===o?o:this}return e.apply(t,i.concat(r.call(arguments)))},s=Math.max(0,e.length-i.length),l=[],u=0;u<s;u++)l.push("$"+u);if(n=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(a),e.prototype){var c=function(){};c.prototype=e.prototype,n.prototype=new c,c.prototype=null}return n}},{}],28:[function(t,e,n){var r=t("./implementation");e.exports=Function.prototype.bind||r},{"./implementation":27}],29:[function(t,e,n){"use strict";var r=Function.prototype.toString,o=/^\s*class /,i=function(t){try{var e=r.call(t),n=e.replace(/\/\/.*\n/g,""),i=n.replace(/\/\*[.\s\S]*\*\//g,""),a=i.replace(/\n/gm," ").replace(/ {2}/g," ");return o.test(a)}catch(t){return!1}},a=function(t){try{return!i(t)&&(r.call(t),!0)}catch(t){return!1}},s=Object.prototype.toString,l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(l)return a(t);if(i(t))return!1;var e=s.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e}},{}],30:[function(t,e,n){"use strict";var r=Date.prototype.getDay,o=function(t){try{return r.call(t),!0}catch(t){return!1}},i=Object.prototype.toString,a="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(t){return"object"==typeof t&&null!==t&&(a?o(t):"[object Date]"===i.call(t))}},{}],31:[function(t,e,n){"use strict";var r=RegExp.prototype.exec,o=function(t){try{return r.call(t),!0}catch(t){return!1}},i=Object.prototype.toString,a="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(t){return"object"==typeof t&&(a?o(t):"[object RegExp]"===i.call(t))}},{}],32:[function(t,e,n){"use strict";var r=Object.prototype.toString;if("function"==typeof Symbol&&"symbol"==typeof Symbol()){var o=Symbol.prototype.toString,i=/^Symbol\(.*\)$/,a=function(t){return"symbol"==typeof t.valueOf()&&i.test(o.call(t))};e.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==r.call(t))return!1;try{return a(t)}catch(t){return!1}}}else e.exports=function(t){return!1}},{}],33:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=Array.prototype.slice,a=t("./isArguments"),s=!{toString:null}.propertyIsEnumerable("toString"),l=function(){}.propertyIsEnumerable("prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(t){var e=t.constructor;return e&&e.prototype===t},p={$console:!0,$frame:!0,$frameElement:!0,$frames:!0,$parent:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&r.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{c(window[t])}catch(t){return!0}}catch(t){return!0}return!1}(),f=function(t){if("undefined"==typeof window||!d)return c(t);try{return c(t)}catch(t){return!1}},h=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===o.call(t),i=a(t),c=e&&"[object String]"===o.call(t),p=[];if(!e&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var d=l&&n;if(c&&t.length>0&&!r.call(t,0))for(var h=0;h<t.length;++h)p.push(String(h));if(i&&t.length>0)for(var m=0;m<t.length;++m)p.push(String(m));else for(var g in t)d&&"prototype"===g||!r.call(t,g)||p.push(String(g));if(s)for(var b=f(t),y=0;y<u.length;++y)b&&"constructor"===u[y]||!r.call(t,u[y])||p.push(u[y]);return p};h.shim=function(){if(Object.keys){if(!function(){return 2===(Object.keys(arguments)||"").length}(1,2)){var t=Object.keys;Object.keys=function(e){return t(a(e)?i.call(e):e)}}}else Object.keys=h;return Object.keys||h},e.exports=h},{"./isArguments":34}],34:[function(t,e,n){"use strict";var r=Object.prototype.toString;e.exports=function(t){var e=r.call(t),n="[object Arguments]"===e;return n||(n="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===r.call(t.callee)),n}},{}],35:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return Array.prototype.includes||r}},{"./implementation":13}],36:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();return Array.prototype.includes!==t&&r(Array.prototype,{includes:t}),t}},{"./polyfill":35,"define-properties":15}],37:[function(t,e,n){"use strict";var r=t("es-abstract/es7"),o=t("has"),i=t("function-bind"),a=i.call(Function.call,Object.prototype.propertyIsEnumerable);e.exports=function(t){var e=r.RequireObjectCoercible(t),n=[];for(var i in e)o(e,i)&&a(e,i)&&n.push([i,e[i]]);return n}},{"es-abstract/es7":42,"function-bind":53,has:54}],38:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./implementation");r(o,{getPolyfill:t("./polyfill"),implementation:o,shim:t("./shim")}),e.exports=o},{"./implementation":37,"./polyfill":61,"./shim":62,"define-properties":39}],39:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:51,"object-keys":59}],40:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":44,"./helpers/mod":46,"./helpers/sign":47,dup:16,"es-to-primitive/es5":48,"is-callable":55}],41:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":40,"./helpers/assign":43,"./helpers/isFinite":44,"./helpers/isPrimitive":45,"./helpers/mod":46,"./helpers/sign":47,dup:17,"es-to-primitive/es6":49,"function-bind":53,"is-regex":57}],42:[function(t,e,n){"use strict";var r=t("./es6"),o=t("./helpers/assign"),i=o(r,{SameValueNonNumber:function(t,e){if("number"==typeof t||typeof t!=typeof e)throw new TypeError("SameValueNonNumber requires two non-number values of the same type.");return this.SameValue(t,e)}});e.exports=i},{"./es6":41,"./helpers/assign":43}],43:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],44:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],45:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],46:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],47:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],48:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":50,dup:23,"is-callable":55}],49:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":50,dup:24,"is-callable":55,"is-date-object":56,"is-symbol":58}],50:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],51:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],52:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],53:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":52,dup:28}],54:[function(t,e,n){var r=t("function-bind");e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":53}],55:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],56:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],57:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],58:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],59:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":60,dup:33}],60:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],61:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof Object.entries?Object.entries:r}},{"./implementation":37}],62:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(Object,{entries:t},{entries:function(){return Object.entries!==t}}),t}},{"./polyfill":61,"define-properties":39}],63:[function(t,e,n){"use strict";var r=t("es-abstract/es7"),o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,l=Function.call.bind(Array.prototype.concat),u=Function.call.bind(Array.prototype.reduce),c=s?function(t){return l(a(t),s(t))}:a,p=r.IsCallable(i)&&r.IsCallable(a),d=function(t,e,n){o&&e in t?o(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};e.exports=function(t){if(r.RequireObjectCoercible(t),!p)throw new TypeError("getOwnPropertyDescriptors requires Object.getOwnPropertyDescriptor");var e=r.ToObject(t);return u(c(e),function(t,n){return d(t,n,i(e,n)),t},{})}},{"es-abstract/es7":68}],64:[function(t,e,n){arguments[4][38][0].apply(n,arguments)},{"./implementation":63,"./polyfill":86,"./shim":87,"define-properties":65,dup:38}],65:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:77,"object-keys":84}],66:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":70,"./helpers/mod":72,"./helpers/sign":73,dup:16,"es-to-primitive/es5":74,"is-callable":80}],67:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":66,"./helpers/assign":69,"./helpers/isFinite":70,"./helpers/isPrimitive":71,"./helpers/mod":72,"./helpers/sign":73,dup:17,"es-to-primitive/es6":75,"function-bind":79,"is-regex":82}],68:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":67,"./helpers/assign":69,dup:42}],69:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],70:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],71:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],72:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],73:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],74:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":76,dup:23,"is-callable":80}],75:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":76,dup:24,"is-callable":80,"is-date-object":81,"is-symbol":83}],76:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],77:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],78:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],79:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":78,dup:28}],80:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],81:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],82:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],83:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],84:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":85,dup:33}],85:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],86:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof Object.getOwnPropertyDescriptors?Object.getOwnPropertyDescriptors:r}},{"./implementation":63}],87:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(Object,{getOwnPropertyDescriptors:t},{getOwnPropertyDescriptors:function(){return Object.getOwnPropertyDescriptors!==t}}),t}},{"./polyfill":86,"define-properties":65}],88:[function(t,e,n){"use strict";var r=t("es-abstract/es7"),o=t("has"),i=t("function-bind"),a=i.call(Function.call,Object.prototype.propertyIsEnumerable);e.exports=function(t){var e=r.RequireObjectCoercible(t),n=[];for(var i in e)o(e,i)&&a(e,i)&&n.push(e[i]);return n}},{"es-abstract/es7":93,"function-bind":104,has:105}],89:[function(t,e,n){arguments[4][38][0].apply(n,arguments)},{"./implementation":88,"./polyfill":112,"./shim":113,"define-properties":90,dup:38}],90:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:102,"object-keys":110}],91:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":95,"./helpers/mod":97,"./helpers/sign":98,dup:16,"es-to-primitive/es5":99,"is-callable":106}],92:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":91,"./helpers/assign":94,"./helpers/isFinite":95,"./helpers/isPrimitive":96,"./helpers/mod":97,"./helpers/sign":98,dup:17,"es-to-primitive/es6":100,"function-bind":104,"is-regex":108}],93:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":92,"./helpers/assign":94,dup:42}],94:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],95:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],96:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],97:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],98:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],99:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":101,dup:23,"is-callable":106}],100:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":101,dup:24,"is-callable":106,"is-date-object":107,"is-symbol":109}],101:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],102:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],103:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],104:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":103,dup:28}],105:[function(t,e,n){arguments[4][54][0].apply(n,arguments)},{dup:54,"function-bind":104}],106:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],107:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],108:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],109:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],110:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":111,dup:33}],111:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],112:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof Object.values?Object.values:r}},{"./implementation":88}],113:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(Object,{values:t},{values:function(){return Object.values!==t}}),t}},{"./polyfill":112,"define-properties":90}],114:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("es-abstract/es7"),i=t("function-bind"),a=function(t){o.RequireObjectCoercible(this);var e=o.ToObject(this),n=o.ToString(e),r=o.ToInteger(t),i=n.length;if(r<0||r>=i)return"";var a,s=n.charCodeAt(r),l=r+1,u=1;return s>=55296&&s<=56319&&i>l&&(a=n.charCodeAt(l))>=56320&&a<=57343&&(u=2),n.slice(r,r+u)},s=i.call(Function.call,a);r(s,{method:a,shim:function(){return r(String.prototype,{at:a}),String.prototype.at}}),e.exports=s},{"define-properties":115,"es-abstract/es7":118,"function-bind":129}],115:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:127,"object-keys":134}],116:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":120,"./helpers/mod":122,"./helpers/sign":123,dup:16,"es-to-primitive/es5":124,"is-callable":130}],117:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":116,"./helpers/assign":119,"./helpers/isFinite":120,"./helpers/isPrimitive":121,"./helpers/mod":122,"./helpers/sign":123,dup:17,"es-to-primitive/es6":125,"function-bind":129,"is-regex":132}],118:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":117,"./helpers/assign":119,dup:42}],119:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],120:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],121:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],122:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],123:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],124:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":126,dup:23,"is-callable":130}],125:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":126,dup:24,"is-callable":130,"is-date-object":131,"is-symbol":133}],126:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],127:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],128:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],129:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":128,dup:28}],130:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],131:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],132:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],133:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],134:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":135,dup:33}],135:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],136:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("es-abstract/es7"),i=r.call(Function.call,String.prototype.slice);e.exports=function(t){var e,n=o.RequireObjectCoercible(this),r=o.ToString(n),a=o.ToLength(r.length);arguments.length>1&&(e=arguments[1]);var s=void 0===e?"":o.ToString(e);""===s&&(s=" ");var l=o.ToLength(t);if(l<=a)return r;for(var u=l-a;s.length<u;){var c=s.length,p=u-c;s+=c>p?i(s,0,p):s}return r+(s.length>u?i(s,0,u):s)}},{"es-abstract/es7":141,"function-bind":152}],137:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("define-properties"),i=t("es-abstract/es7"),a=t("./implementation"),s=t("./polyfill"),l=t("./shim"),u=r.call(Function.apply,a),c=function(t,e){i.RequireObjectCoercible(t);var n=[e];return arguments.length>2&&n.push(arguments[2]),u(t,n)};o(c,{getPolyfill:s,implementation:a,shim:l}),e.exports=c},{"./implementation":136,"./polyfill":159,"./shim":160,"define-properties":138,"es-abstract/es7":141,"function-bind":152}],138:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:150,"object-keys":157}],139:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":143,"./helpers/mod":145,"./helpers/sign":146,dup:16,"es-to-primitive/es5":147,"is-callable":153}],140:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":139,"./helpers/assign":142,"./helpers/isFinite":143,"./helpers/isPrimitive":144,"./helpers/mod":145,"./helpers/sign":146,dup:17,"es-to-primitive/es6":148,"function-bind":152,"is-regex":155}],141:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":140,"./helpers/assign":142,dup:42}],142:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],143:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],144:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],145:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],146:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],147:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":149,dup:23,"is-callable":153}],148:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":149,dup:24,"is-callable":153,"is-date-object":154,"is-symbol":156}],149:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],150:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],151:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],152:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":151,dup:28}],153:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],154:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],155:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],156:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],157:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":158,dup:33}],158:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],159:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof String.prototype.padEnd?String.prototype.padEnd:r}},{"./implementation":136}],160:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(String.prototype,{padEnd:t},{padEnd:function(){return String.prototype.padEnd!==t}}),t}},{"./polyfill":159,"define-properties":138}],161:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("es-abstract/es7"),i=r.call(Function.call,String.prototype.slice);e.exports=function(t){var e,n=o.RequireObjectCoercible(this),r=o.ToString(n),a=o.ToLength(r.length);arguments.length>1&&(e=arguments[1]);var s=void 0===e?"":o.ToString(e);""===s&&(s=" ");var l=o.ToLength(t);if(l<=a)return r;for(var u=l-a;s.length<u;){var c=s.length,p=u-c;s+=c>p?i(s,0,p):s}return(s.length>u?i(s,0,u):s)+r}},{"es-abstract/es7":166,"function-bind":177}],162:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("define-properties"),i=t("es-abstract/es7"),a=t("./implementation"),s=t("./polyfill"),l=t("./shim"),u=r.call(Function.apply,a),c=function(t,e){i.RequireObjectCoercible(t);var n=[e];return arguments.length>2&&n.push(arguments[2]),u(t,n)};o(c,{getPolyfill:s,implementation:a,shim:l}),e.exports=c},{"./implementation":161,"./polyfill":184,"./shim":185,"define-properties":163,"es-abstract/es7":166,"function-bind":177}],163:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:175,"object-keys":182}],164:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":168,"./helpers/mod":170,"./helpers/sign":171,dup:16,"es-to-primitive/es5":172,"is-callable":178}],165:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":164,"./helpers/assign":167,"./helpers/isFinite":168,"./helpers/isPrimitive":169,"./helpers/mod":170,"./helpers/sign":171,dup:17,"es-to-primitive/es6":173,"function-bind":177,"is-regex":180}],166:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":165,"./helpers/assign":167,dup:42}],167:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],168:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],169:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],170:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],171:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],172:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":174,dup:23,"is-callable":178}],173:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":174,dup:24,"is-callable":178,"is-date-object":179,"is-symbol":181}],174:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],175:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],176:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],177:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":176,dup:28}],178:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],179:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],180:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],181:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],182:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":183,dup:33}],183:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],184:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof String.prototype.padStart?String.prototype.padStart:r}},{"./implementation":161}],185:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(String.prototype,{padStart:t},{padStart:function(){return String.prototype.padStart!==t}}),t}},{"./polyfill":184,"define-properties":163}],186:[function(t,e,n){"use strict";var r=t("function-bind"),o=r.call(Function.call,String.prototype.replace);e.exports=function(){return o(this,/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/,"")}},{"function-bind":191}],187:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("define-properties"),i=t("./implementation"),a=t("./polyfill"),s=t("./shim"),l=r.call(Function.call,a());o(l,{getPolyfill:a,implementation:i,shim:s}),e.exports=l},{"./implementation":186,"./polyfill":194,"./shim":195,"define-properties":188,"function-bind":191}],188:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:189,"object-keys":192}],189:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],190:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],191:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":190,dup:28}],192:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":193,dup:33}],193:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],194:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){if(!String.prototype.trimLeft)return r;var t="​";return t.trimLeft()!==t?r:String.prototype.trimLeft}},{"./implementation":186}],195:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();return r(String.prototype,{trimLeft:t},{trimLeft:function(){return String.prototype.trimLeft!==t}}),t}},{"./polyfill":194,"define-properties":188}],196:[function(t,e,n){"use strict";var r=t("function-bind"),o=r.call(Function.call,String.prototype.replace);e.exports=function(){return o(this,/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/,"")}},{"function-bind":201}],197:[function(t,e,n){arguments[4][187][0].apply(n,arguments)},{"./implementation":196,"./polyfill":204,"./shim":205,"define-properties":198,dup:187,"function-bind":201}],198:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:199,"object-keys":202}],199:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],200:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],201:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":200,dup:28}],202:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":203,dup:33}],203:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],204:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){if(!String.prototype.trimRight)return r;var t="​";return t.trimRight()!==t?r:String.prototype.trimRight}},{"./implementation":196}],205:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();return r(String.prototype,{trimRight:t},{trimRight:function(){return String.prototype.trimRight!==t}}),t}},{"./polyfill":204,"define-properties":198}],206:[function(t,e,n){"use strict";e.exports=t("./es7-shim").shim()},{"./es7-shim":12}]},{},[206]),function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){
return"string"!=typeof t&&(t=String(t)),t}function r(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return b.iterable&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function i(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function a(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function s(t){var e=new FileReader,n=a(e);return e.readAsArrayBuffer(t),n}function l(t){var e=new FileReader,n=a(e);return e.readAsText(t),n}function u(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}function c(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(b.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(b.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(b.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(b.arrayBuffer&&b.blob&&v(t))this._bodyArrayBuffer=c(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!b.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!w(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):b.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},b.blob&&(this.blob=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},b.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(t){var e=t.toUpperCase();return x.indexOf(e)>-1?e:t}function f(t,e){e=e||{};var n=e.body;if(t instanceof f){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=d(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function h(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(o))}}),e}function m(t){var e=new o;return t.split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var o=n.join(":").trim();e.append(r,o)}}),e}function g(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var b={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(b.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(t){return t&&DataView.prototype.isPrototypeOf(t)},w=ArrayBuffer.isView||function(t){return t&&y.indexOf(Object.prototype.toString.call(t))>-1};o.prototype.append=function(t,r){t=e(t),r=n(r);var o=this.map[t];this.map[t]=o?o+","+r:r},o.prototype.delete=function(t){delete this.map[e(t)]},o.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,r){this.map[e(t)]=n(r)},o.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},o.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),r(t)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),r(t)},o.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),r(t)},b.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},p.call(f.prototype),p.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},g.error=function(){var t=new g(null,{status:0,statusText:""});return t.type="error",t};var O=[301,302,303,307,308];g.redirect=function(t,e){if(-1===O.indexOf(e))throw new RangeError("Invalid status code");return new g(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=f,t.Response=g,t.fetch=function(t,e){return new Promise(function(n,r){var o=new f(t,e),i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:m(i.getAllResponseHeaders()||"")};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var e="response"in i?i.response:i.responseText;n(new g(e,t))},i.onerror=function(){r(new TypeError("Network request failed"))},i.ontimeout=function(){r(new TypeError("Network request failed"))},i.open(o.method,o.url,!0),"include"===o.credentials&&(i.withCredentials=!0),"responseType"in i&&b.blob&&(i.responseType="blob"),o.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this);
//# sourceMappingURL=ketcher.js.map
