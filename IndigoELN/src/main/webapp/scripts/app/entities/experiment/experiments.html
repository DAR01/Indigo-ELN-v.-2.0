<indigo-entities-controls  is-dashboard ="true"></indigo-entities-controls>
<div class="main-page-content scroll-dashboard-full" >
    <div class="row">
        <div class="col-sm-8">
            <div class="panel panel-info panel-main-h" cg-busy="{promise:loading, minDuration:700}">
                <div class="panel-heading" ng-bind="vm.experimentsStatisticsText"></div>
                <div class="panel-body panel-body-nopad" >
                    <div class="statistic-radio">
                        <input type="radio" name="experimentsSwitcher" ng-model="dView" ng-change="onViewChange()" ng-value="'open'">
                        <div>
                            <span class="statistic-txt" ng-bind="vm.openText"></span>
                            <span class="count pull-right" ng-bind="openExperimentsLength"></span>
                            <uib-progressbar animate="false" value="((openExperimentsLength * 100)/100) || 0" type="success"></uib-progressbar>
                        </div>
                    </div>
                    <div class="statistic-radio statistic-orange">
                        <input type="radio" name="experimentsSwitcher" ng-model="dView" ng-value="'wait'" ng-change="onViewChange()">
                        <div>
                            <span class="statistic-txt" ng-bind="vm.waitingAuthorsSignatureText"></span>
                            <span class="count pull-right" ng-bind="waitingExperimentsLength"></span>
                            <uib-progressbar animate="false" value="((waitingExperimentsLength * 100)/100) || 0" type="success"></uib-progressbar>
                        </div>
                    </div>
                    <div class="statistic-radio statistic-yellow">
                        <input type="radio" name="experimentsSwitcher" ng-model="dView" ng-value="'submitted'" ng-change="onViewChange()">
                        <div>
                            <span class="statistic-txt" ng-bind="vm.submittedByAuthorText"></span>
                            <span class="count pull-right" ng-bind="submittedExperimentsLength"></span>
                            <uib-progressbar animate="false" value="((submittedExperimentsLength * 100)/100) || 0" type="success"></uib-progressbar>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="panel panel-info panel-main-h">
                <div class="panel-heading" ng-bind="vm.experimentsLCText"></div>
                <div class="panel-body panel-body-nopad">
                    <div class="experiment-count-block">
                        <span ng-bind="(submittedExperimentsLength + openExperimentsLength)"></span>
                        <span ng-bind="vm.experimentsUCText"></span>
                        <span>({{vm.experimentsCommentText}})</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel panel-info panel-info-table" ng-if="dView === 'open'">
        <div class="panel-heading">{{vm.openExperimentsText}} <span class="count" ng-bind="curExperiments.length"></span></div>
        <div class="panel-body panel-body-nopad">
            <div class="table-responsive" indigo-scroller="x">
                <table class="main-table table table-striped table-condensed dash-table">
                    <thead class="main-table__header">
                    <tr  indigo-sort="predicate" ascending="reverse" callback="sort(predicate, reverse)" class="table-list">
                        <th indigo-sort-by="id" class="table-list__item table-list__item_header dash-exp-id">{{vm.experimentIDText}} <span class="glyphicon glyphicon-sort"></span> </th>
                        <th indigo-sort-by="name"  class="table-list__item table-list__item_header dash-exp-name">{{vm.titleText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="author.firstName"  class="table-list__item table-list__item_header">{{vm.authorText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <!-- <th  my-sort-by="name" class="table-list__item table-list__item_header">Status <span class="glyphicon glyphicon-sort"></span></th> -->
                        <th  class="table-list__item table-list__item_header">Co-authors</th>
                        <th indigo-sort-by="project" class="table-list__item table-list__item_header">{{vm.projectText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="creationDate" class="table-list__item table-list__item_header">{{vm.creationDateText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="lastEditDate" class="table-list__item table-list__item_header">{{vm.lastEditDateText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th class="table-list__item table-list__item_header">{{vm.idleWorkdaysText}} </span></th>
                    </tr>
                    </thead>
                    <tbody class="main-table__body">
                    <tr ng-class=" {true : 'table-list', 'slide-up' : true, 'reaction-popup'  : !!exp.reactionImage}" ng-repeat="exp in curExperimentsPaged track by $index" ng-mouseenter="experimentEnter(exp)">
                        <td class="table-list__item dash-exp-id">
                            <a  class = "ellipsis" ui-sref="entities.experiment-detail({projectId: exp.projectId, notebookId: exp.notebookId, experimentId: exp.experimentId})">{{exp.id}}</a>
                            <div style="background-image: url('data:image/svg+xml;base64,{{exp.reactionImage}}')" class="reaction-image"> </div>
                        </td>
                        <td class="table-list__item dash-exp-name"  title="{{exp.name}}">  <div class="ellipsis"> {{exp.name}} </div>  </td>
                        <td class="table-list__item">{{exp.author.firstName}}</td>
                        <!-- <td class="table-list__item">{{exp.status}}</td> -->
                        <td class="table-list__item">
                            <ul>
                                <li ng-repeat="user in exp.coAuthors track by $index">{{user.firstName + ' ' + user.lastName}}</li>
                            </ul>
                        </td>
                        <td class="table-list__item dash-proj-name"> <a class="ellipsis" ui-sref="entities.project-detail({projectId: exp.projectId})"> {{exp.project}} </a></td>
                        <td class="table-list__item dash-date" title="{{exp.creationDate | date:'MMM dd yyyy'}}"><div class="ellipsis">{{exp.creationDate | date:'MMM dd yyyy'}}</div></td>
                        <td class="table-list__item dash-date" title="{{exp.lastEditDate | date:'MMM dd yyyy'}}"><div class="ellipsis">{{exp.lastEditDate | date:'MMM dd yyyy'}}</div></td>
                        <td class="table-list__item">{{getIdleWorkdays(exp.creationDate, exp.lastEditDate) + ' day(s)'}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-info panel-info-table" ng-if="dView === 'wait'">
        <div class="panel-heading">{{vm.experimentsWaitingAuthorsSignatureText}} <span class="count count-orange" ng-bind="totalItems"></span></div>
        <div class="panel-body panel-body-nopad">
            <div class="table-responsive" indigo-scroller="x">
                <table class="main-table table table-striped table-condensed">
                    <thead class="main-table__header">
                    <tr indigo-sort="predicate" ascending="reverse" callback="sort(predicate, reverse)"  class="table-list">
                        <th indigo-sort-by="id"  class="table-list__item table-list__item_header dash-exp-id">{{vm.experimentIDText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="name"  class="table-list__item table-list__item_header">{{vm.titleText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="status"  class="table-list__item table-list__item_header">{{vm.statusText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="author.firstName"  class="table-list__item table-list__item_header">{{vm.authorText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="submitter.firstName"  class="table-list__item table-list__item_header">{{vm.submitterText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th class="table-list__item table-list__item_header">{{vm.witnessText}}</th>
                        <th indigo-sort-by="creationDate"  class="table-list__item table-list__item_header">{{vm.creationDateText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="lastEditDate"  class="table-list__item table-list__item_header">{{vm.lastActionDateText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th class="table-list__item table-list__item_header">{{vm.idleWorkdaysText}}</th>
                    </tr>
                    </thead>
                    <tbody class="main-table__body">
                    <tr class="table-list" ng-repeat="exp in curExperimentsPaged track by $index">
                        <td class="table-list__item dash-exp-id">
                            <a href="{{signatureServiceUrl}}">{{exp.id}}</a>
                        </td>
                        <td class="table-list__item">{{exp.name}}</td>
                        <td class="table-list__item">{{exp.status}}</td>
                        <td class="table-list__item">{{exp.author.firstName + ' ' + exp.author.lastName}}</td>
                        <td class="table-list__item" >{{exp.submitter.firstName + ' ' + exp.submitter.lastName}}</td>
                        <td class="table-list__item">
                            <ul>
                                <li ng-repeat="user in exp.witnesses track by $index">{{user.firstName + ' ' +
                                    user.lastName}}
                                </li>
                            </ul>
                        </td>
                        <td class="table-list__item dash-date" title="{{exp.creationDate | date:'MMM dd yyyy'}}"><div class="ellipsis">{{exp.creationDate | date:'MMM dd yyyy'}}</div></td>
                        <td class="table-list__item dash-date" title="{{exp.lastEditDate | date:'MMM dd yyyy'}}"><div class="ellipsis">{{exp.lastEditDate | date:'MMM dd yyyy'}}</div></td>
                        <td class="table-list__item">{{getIdleWorkdays(exp.creationDate, exp.lastEditDate) + ' day(s)'}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <div class="panel panel-info panel-info-table" ng-if="dView === 'submitted'">
        <div class="panel-heading">{{vm.experimentsSubmittedByAuthorText}} <span class="count count-yellow" ng-bind="totalItems"></span></div>
        <div class="panel-body panel-body-nopad">
            <div class="table-responsive" indigo-scroller="x">
                <table class="main-table table table-striped table-condensed">
                    <thead class="main-table__header">
                    <tr indigo-sort="predicate" ascending="reverse" callback="sort(predicate, reverse)"  class="table-list">
                        <th indigo-sort-by="id" class="table-list__item table-list__item_header dash-exp-id">{{vm.experimentIDText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="name" class="table-list__item table-list__item_header">{{vm.titleText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="status" class="table-list__item table-list__item_header">{{vm.statusText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="author.firstName" class="table-list__item table-list__item_header">{{vm.authorText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="submitter.firstName" class="table-list__item table-list__item_header">{{vm.submitterText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th  class="table-list__item table-list__item_header">Witness</th>
                        <th indigo-sort-by="creationDate" class="table-list__item table-list__item_header">{{vm.creationDateText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th indigo-sort-by="lastEditDate" class="table-list__item table-list__item_header">{{vm.lastEditDateText}} <span class="glyphicon glyphicon-sort"></span></th>
                        <th class="table-list__item table-list__item_header">{{vm.commentsText}}</th>
                    </tr>
                    </thead>
                    <tbody class="main-table__body">
                    <tr class="table-list" ng-repeat="exp in curExperimentsPaged track by $index">
                        <td class="table-list__item dash-exp-id">
                            <a href="{{signatureServiceUrl}}">{{exp.id}}</a>
                        </td>
                        <td class="table-list__item">{{exp.name}}</td>
                        <td class="table-list__item">{{exp.status}}</td>
                        <td class="table-list__item">{{exp.author.firstName + ' ' + exp.author.lastName}}</td>
                        <td class="table-list__item">{{exp.submitter.firstName + ' ' + exp.submitter.lastName}}</td>
                        <td class="table-list__item">
                            <ul>
                                <li ng-repeat="user in exp.witnesses track by $index">{{user.firstName + ' ' +
                                    user.lastName}}
                                </li>
                            </ul>
                        </td>
                        <td class="table-list__item dash-date" title="{{exp.creationDate | date:'MMM dd yyyy'}}"><div class="ellipsis">{{exp.creationDate | date:'MMM dd yyyy'}}</div></td>
                        <td class="table-list__item dash-date" title="{{exp.lastEditDate | date:'MMM dd yyyy'}}"><div class="ellipsis">{{exp.lastEditDate | date:'MMM dd yyyy'}}</div></td>
                        <td class="table-list__item">
                            <ul>
                                <li ng-repeat="comment in exp.comments track by $index">{{comment}}</li>
                            </ul>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="text-center" ng-show="curExperiments.length > curExperimentsPaged.length">
        <uib-pagination class="pagination-sm" total-items="totalItems" items-per-page="itemsPerPage" ng-model="page" ng-change="doPage()"></uib-pagination>
    </div>
</div>