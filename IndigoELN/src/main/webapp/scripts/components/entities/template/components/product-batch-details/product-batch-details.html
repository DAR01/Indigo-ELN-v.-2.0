<div class="panel panel-info component" indigo-collapsible-component>
    <div class="panel-heading">
        Product Batch Details
    </div>
    <div class="panel-body collapsible">
        <form class="form-inline form-batch-details">
            <label>Notebook Batch #: <span ng-bind="vm.model.productBatchDetails.fullNbkImmutablePart"></span></label>
            <indigo-select
                    indigo-model="vm.batchSelected"
                    indigo-items="vm.batches"
                    indigo-change="vm.selectBatch()"
                    indigo-item-prop="nbkBatch"
                    indigo-control="vm.selectControl"
                    class="select-inline"
            ></indigo-select>
            <indigo-checkbox
                    indigo-model="vm.showSummary"
                    indigo-label="Show summary table"
            ></indigo-checkbox>
        </form>
        <indigo-batch-summary ng-if="vm.showSummary"
                              my-tab-support="true"
                              model="vm.model"
                              share="vm.share"
                              indigo-save-experiment-fn="vm.indigoSaveExperimentFn()"
                              is-hide-column-settings="true"
        ></indigo-batch-summary>
        <indigo-table ng-if="!vm.showSummary" indigo-id="product-detail-table" indigo-columns="vm.productTableColumns"
                      indigo-rows="vm.detailTable" class="my-table-wrapper table-batch-details">

            <div class="row m-b20">
                <div class="col-lg-8 m-bt-lg">
                    <span class="txt-small bold m-r5">Batches:</span>

                    <div class="btn-group">
                        <button type="button" class="btn btn-info btn-small" ng-click="vm.addNewBatch()">
                            <i class="fa fa-plus"></i>
                            <span class="m-l5">Add</span>
                        </button>
                        <button type="button" class="btn btn-info btn-small"
                                ng-disabled="vm.indigoReadonly || !vm.batchSelected.nbkBatch"
                                ng-click="vm.duplicateBatch()">
                            <i class="fa fa-clone"></i>
                            <span class="m-l5">Duplicate</span>
                        </button>
                        <button type="button" class="btn btn-info btn-small"
                                ng-disabled="vm.indigoReadonly || !vm.batchSelected.nbkBatch"
                                ng-click="vm.deleteBatches()">
                            <i class="fa fa-trash"></i>
                            <span class="m-l5">Delete</span>
                        </button>
                        <button type="button" class="btn btn-info btn-small"
                                ng-disabled="vm.indigoReadonly || vm.isIntendedSynced()"
                                ng-click="vm.syncWithIntendedProducts()">
                            <i class="fa fa-refresh"></i>
                            <span class="m-l5">Sync</span>
                        </button>
                        <button type="button" class="btn btn-info btn-small" disabled>VnV</button>
                        <button type="button" class="btn btn-info btn-small"
                                ng-disabled="vm.indigoReadonly || !vm.batchSelected.nbkBatch"
                                ng-click="vm.registerBatches()">
                            <i class="fa fa-floppy-o"></i>
                            <span class="m-l5">Register</span>
                        </button>
                        <div class="product-batch-details__radio">
                            <input type="radio"
                                   name="batchDetailsRadio"
                                   id="batchDetailsRadioIntermediate"
                                   ng-disabled="vm.indigoReadonly || vm.model.productBatchDetails.batchType == 'Intermediate'"
                                   ng-click="vm.model.productBatchDetails.batchType = 'Intermediate'; vm.experimentForm.$setDirty()"
                                   ng-checked="vm.model.productBatchDetails.batchType == 'Intermediate'"
                                   class="product-batch-details__input">
                            <label for="batchDetailsRadioIntermediate"
                                   class="product-batch-details__label">Intermediate</label>
                        </div>
                        <div class="product-batch-details__radio">
                            <input type="radio"
                                   name="batchDetailsRadio"
                                   id="batchDetailsRadioTest"
                                   ng-disabled="vm.indigoReadonly ||vm.model.productBatchDetails.batchType == 'Test Compound'"
                                   ng-click="vm.model.productBatchDetails.batchType = 'Test Compound'; vm.experimentForm.$setDirty()"
                                   ng-checked="vm.model.productBatchDetails.batchType =='Test Compound'"
                                   class="product-batch-details__input">
                            <label for="batchDetailsRadioTest"
                                   class="product-batch-details__label">Test Compound</label>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 text-align-lg">
                    <span class="txt-small bold m-r5">SD File:</span>

                    <div class="btn-group">
                        <button type="button"
                                class="btn btn-info btn-small  btn-can-loading {{(vm.importLoading) ? 'btn-loading' : ''}}"
                                ng-click="vm.importSDFile()" ng-disabled="vm.indigoReadonly">
                            <i class="fa fa-cloud-download"></i>
                            <span class="m-l5">Import</span>
                        </button>
                        <button type="button" class="btn btn-info btn-small" ng-click="vm.exportSDFile()"
                                ng-disabled="vm.indigoReadonly || !vm.batchSelected.nbkBatch">
                            <i class="fa fa-cloud-upload"></i>
                            <span class="m-l5">Export</span>
                        </button>
                    </div>
                </div>
            </div>
        </indigo-table>

        <div class="row">
            <div class="col-md-4 col-sm-6">
                <indigo-select indigo-label="Status"
                               indigo-label-vertical="true"
                               indigo-model="vm.model.productBatchDetails.regStatus"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <indigo-input indigo-label="Conversational Batch number"
                              indigo-model="vm.model.productBatchDetails.conversationalBatchNumber"
                              indigo-label-vertical="true"
                              indigo-readonly="true"
                ></indigo-input>
                <indigo-input indigo-label="Virtual Compound Id"
                              indigo-model="vm.model.productBatchDetails.virtualCompoundId"
                              indigo-label-vertical="true"
                              indigo-readonly="vm.indigoReadonly"
                ></indigo-input>
                <indigo-select indigo-label="Source"
                               indigo-label-vertical="true"
                               indigo-model="vm.model.productBatchDetails.source"
                               indigo-items="vm.sourceValues"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <!--Source detail block-->
                <indigo-select ng-if="vm.model.productBatchDetails.source.name == 'Internal'"
                               indigo-label="Source Detail"
                               indigo-label-vertical="true"
                               indigo-model="vm.model.productBatchDetails.sourceDetail"
                               indigo-items="vm.sourceDetailInternal"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <indigo-select ng-if="vm.model.productBatchDetails.source.name == 'External'"
                               indigo-label="Source Detail"
                               indigo-label-vertical="true"
                               indigo-model="vm.model.productBatchDetails.sourceDetail"
                               indigo-items="vm.sourceDetailExternal"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <!--End block-->
                <indigo-select indigo-label="Stereoisomer Code"
                               indigo-label-vertical="true"
                               indigo-dictionary="Stereoisomer Code"
                               indigo-item-prop="name,description"
                               indigo-model="vm.model.productBatchDetails.stereoisomer"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <indigo-simple-text indigo-label="Calculated Batch MW"
                                    indigo-model="vm.model.productBatchDetails.molWeight.value | round"
                                    indigo-empty-text="none"
                ></indigo-simple-text>
                <indigo-simple-text indigo-label="Calculated Batch MF"
                                    indigo-model="vm.model.productBatchDetails.formula"
                                    indigo-empty-text="none">
                </indigo-simple-text>
                <indigo-select indigo-label="Salt Code & Name"
                               indigo-label-vertical="true"
                               indigo-items="vm.saltCodeValues"
                               indigo-model="vm.model.productBatchDetails.saltCode"
                               indigo-change="vm.recalculateSalt(model.productBatchDetails)"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <indigo-input indigo-label="Salt Equivalent"
                              indigo-model="vm.model.productBatchDetails.saltEq.value"
                              indigo-change="vm.recalculateSalt(model.productBatchDetails)"
                              indigo-type="number"
                              indigo-label-vertical="true"
                              indigo-readonly="vm.indigoReadonly || !vm.canEditSaltEq()"
                ></indigo-input>
                <indigo-text-area indigo-label="Structure comments"
                                  indigo-model="vm.model.productBatchDetails.structureComments"
                                  indigo-label-vertical="true"
                                  indigo-readonly="vm.indigoReadonly"
                ></indigo-text-area>
            </div>
            <div class="col-md-4 col-sm-6">
                <indigo-select indigo-label="Compound State"
                               indigo-label-vertical="true"
                               indigo-dictionary="Compound State"
                               indigo-model="vm.model.productBatchDetails.compoundState"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <indigo-input indigo-label="Precursor/Reactant IDs"
                              indigo-model="vm.model.productBatchDetails.precursors"
                              indigo-label-vertical="true"
                              indigo-readonly="vm.indigoReadonly || vm.share.stoichTable"
                ></indigo-input>
                <indigo-input indigo-label="Purity"
                              indigo-model="vm.model.productBatchDetails.purity.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.purity.asString">
                    <button class="btn btn-info" type="button" ng-click="vm.editPurity()"
                            ng-disabled="vm.indigoReadonly">
                        Edit
                    </button>
                </indigo-input>
                <indigo-input indigo-label="Melting Point"
                              indigo-model="vm.model.productBatchDetails.meltingPoint.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.meltingPoint.asString"
                >
                    <button class="btn btn-info" type="button" ng-click="vm.editMeltingPoint()"
                            ng-disabled="vm.indigoReadonly">Edit
                    </button>
                </indigo-input>
                <indigo-input indigo-label="Residual Solvents"
                              indigo-model="vm.model.productBatchDetails.residualSolvents.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.residualSolvents.asString"
                >
                    <button class="btn btn-info" ng-click="vm.editResidualSolvents()" type="button"
                            ng-disabled="vm.indigoReadonly">Edit
                    </button>
                </indigo-input>
                <indigo-input indigo-label="Solubility in Solvents"
                              indigo-model="vm.model.productBatchDetails.solubility.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.solubility.asString"
                >
                    <button class="btn btn-info" ng-click="vm.editSolubility()" type="button"
                            ng-disabled="vm.indigoReadonly">
                        Edit
                    </button>
                </indigo-input>
                <indigo-input indigo-label="External Supplier"
                              indigo-model="vm.model.productBatchDetails.externalSupplier.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.externalSupplier.asString"
                >
                    <button class="btn btn-info" ng-click="vm.editExternalSupplier()" type="button"
                            ng-disabled="vm.indigoReadonly">Edit
                    </button>
                </indigo-input>
            </div>
            <div class="col-md-4 col-sm-6">
                <indigo-select indigo-label="Compound Protection"
                               indigo-model="vm.model.productBatchDetails.compoundProtection"
                               indigo-label-vertical="true"
                               indigo-dictionary="Compound Protection"
                               indigo-readonly="vm.indigoReadonly"
                ></indigo-select>
                <indigo-input indigo-label="Health Hazards"
                              indigo-model="vm.model.productBatchDetails.healthHazards.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.healthHazards.asString"
                >
                    <button class="btn btn-info" type="button" ng-click="vm.editHealthHazards()"
                            ng-disabled="vm.indigoReadonly">Edit
                    </button>
                </indigo-input>
                <indigo-input indigo-label="Handling Precautions"
                              indigo-model="vm.model.productBatchDetails.handlingPrecautions.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.handlingPrecautions.asString"
                >
                    <button class="btn btn-info" type="button" ng-click="vm.editHandlingPrecautions()"
                            ng-disabled="vm.indigoReadonly">Edit
                    </button>
                </indigo-input>
                <indigo-input indigo-label="Storage Instructions"
                              indigo-model="vm.model.productBatchDetails.storageInstructions.asString"
                              indigo-label-vertical="true"
                              indigo-input-group="append"
                              indigo-readonly="true"
                              indigo-tooltip="vm.model.productBatchDetails.storageInstructions.asString"
                >
                    <button class="btn btn-info" type="button" ng-click="vm.editStorageInstructions()"
                            ng-disabled="vm.indigoReadonly">Edit
                    </button>
                </indigo-input>
                <indigo-text-area indigo-label="Batch Comments"
                                  indigo-model="vm.model.productBatchDetails.comments"
                                  indigo-label-vertical="true"
                                  indigo-readonly="vm.indigoReadonly"
                ></indigo-text-area>
            </div>
        </div>
    </div>
</div>